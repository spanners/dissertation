(function(){function r(a,b){var c;a||(a={});for(c in b)a[c]=b[c];return a}function x(){var a,b=arguments,c,d={},e=function(a,b){var c,d;typeof a!=="object"&&(a={});for(d in b)b.hasOwnProperty(d)&&(c=b[d],a[d]=c&&typeof c==="object"&&Object.prototype.toString.call(c)!=="[object Array]"&&typeof c.nodeType!=="number"?e(a[d]||{},c):b[d]);return a};b[0]===!0&&(d=b[1],b=Array.prototype.slice.call(b,2));c=b.length;for(a=0;a<c;a++)d=e(d,b[a]);return d}function z(a,b){return parseInt(a,b||10)}function fa(a){return typeof a==="string"}function S(a){return typeof a==="object"}function Ka(a){return Object.prototype.toString.call(a)==="[object Array]"}function wa(a){return typeof a==="number"}function xa(a){return P.log(a)/P.LN10}function ga(a){return P.pow(10,a)}function ha(a,b){for(var c=a.length;c--;)if(a[c]===b){a.splice(c,1);break}}function t(a){return a!==u&&a!==null}function v(a,b,c){var d,e;if(fa(b))t(c)?a.setAttribute(b,c):a&&a.getAttribute&&(e=a.getAttribute(b));else if(t(b)&&S(b))for(d in b)a.setAttribute(d,b[d]);return e}function ja(a){return Ka(a)?a:[a]}function n(){var a=arguments,b,c,d=a.length;for(b=0;b<d;b++)if(c=a[b],typeof c!=="undefined"&&c!==null)return c}function D(a,b){if(ya&&b&&b.opacity!==u)b.filter="alpha(opacity="+b.opacity*100+")";r(a.style,b)}function T(a,b,c,d,e){a=y.createElement(a);b&&r(a,b);e&&D(a,{padding:0,border:Q,margin:0});c&&D(a,c);d&&d.appendChild(a);return a}function ia(a,b){var c=function(){};c.prototype=new a;r(c.prototype,b);return c}function Da(a,b,c,d){var e=G.lang,a=+a||0,f=b===-1?(a.toString().split(".")[1]||"").length:isNaN(b=M(b))?2:b,b=c===void 0?e.decimalPoint:c,d=d===void 0?e.thousandsSep:d,e=a<0?"-":"",c=String(z(a=M(a).toFixed(f))),g=c.length>3?c.length%3:0;return e+(g?c.substr(0,g)+d:"")+c.substr(g).replace(/(\d{3})(?=\d)/g,"$1"+d)+(f?b+M(a-c).toFixed(f).slice(2):"")}function Ea(a,b){return Array((b||2)+1-String(a).length).join(0)+a}function Va(a,b,c){var d=a[b];a[b]=function(){var a=Array.prototype.slice.call(arguments);a.unshift(d);return c.apply(this,a)}}function Fa(a,b){for(var c="{",d=!1,e,f,g,h,i,j=[];(c=a.indexOf(c))!==-1;){e=a.slice(0,c);if(d){f=e.split(":");g=f.shift().split(".");i=g.length;e=b;for(h=0;h<i;h++)e=e[g[h]];if(f.length)f=f.join(":"),g=/\.([0-9])/,h=G.lang,i=void 0,/f$/.test(f)?(i=(i=f.match(g))?i[1]:-1,e=Da(e,i,h.decimalPoint,f.indexOf(",")>-1?h.thousandsSep:"")):e=ab(f,e)}j.push(e);a=a.slice(c+1);c=(d=!d)?"}":"{"}j.push(a);return j.join("")}function mb(a){return P.pow(10,N(P.log(a)/P.LN10))}function nb(a,b,c,d){var e,c=n(c,1);e=a/c;b||(b=[1,2,2.5,5,10],d&&d.allowDecimals===!1&&(c===1?b=[1,2,5,10]:c<=0.1&&(b=[1/c])));for(d=0;d<b.length;d++)if(a=b[d],e<=(b[d]+(b[d+1]||b[d]))/2)break;a*=c;return a}function Ab(){this.symbol=this.color=0}function ob(a,b){var c=a.length,d,e;for(e=0;e<c;e++)a[e].ss_i=e;a.sort(function(a,c){d=b(a,c);return d===0?a.ss_i-c.ss_i:d});for(e=0;e<c;e++)delete a[e].ss_i}function La(a){for(var b=a.length,c=a[0];b--;)a[b]<c&&(c=a[b]);return c}function za(a){for(var b=a.length,c=a[0];b--;)a[b]>c&&(c=a[b]);return c}function Ma(a,b){for(var c in a)a[c]&&a[c]!==b&&a[c].destroy&&a[c].destroy(),delete a[c]}function Na(a){bb||(bb=T(Ga));a&&bb.appendChild(a);bb.innerHTML=""}function ka(a,b){var c="Highcharts error #"+a+": www.highcharts.com/errors/"+a;if(b)throw c;else C.console&&console.log(c)}function aa(a){return parseFloat(a.toPrecision(14))}function Oa(a,b){oa=n(a,b.animation)}function Bb(){var a=G.global.useUTC,b=a?"getUTC":"get",c=a?"setUTC":"set";Pa=(a&&G.global.timezoneOffset||0)*6E4;cb=a?Date.UTC:function(a,b,c,g,h,i){return(new Date(a,b,n(c,1),n(g,0),n(h,0),n(i,0))).getTime()};pb=b+"Minutes";qb=b+"Hours";rb=b+"Day";Wa=b+"Date";db=b+"Month";eb=b+"FullYear";Cb=c+"Minutes";Db=c+"Hours";sb=c+"Date";Eb=c+"Month";Fb=c+"FullYear"}function pa(){}function Qa(a,b,c,d){this.axis=a;this.pos=b;this.type=c||"";this.isNew=!0;!c&&!d&&this.addLabel()}function qa(){this.init.apply(this,arguments)}function Gb(a,b,c,d,e,f){var g=a.chart.inverted;this.axis=a;this.isNegative=c;this.options=b;this.x=d;this.total=null;this.points={};this.stack=e;this.percent=f==="percent";this.alignOptions={align:b.align||(g?c?"left":"right":"center"),verticalAlign:b.verticalAlign||(g?"middle":c?"bottom":"top"),y:n(b.y,g?4:c?14:-6),x:n(b.x,g?c?-6:6:0)};this.textAlign=b.textAlign||(g?c?"right":"left":"center")}function tb(){this.init.apply(this,arguments)}function fb(){this.init.apply(this,arguments)}var u,y=document,C=window,P=Math,w=P.round,N=P.floor,Ha=P.ceil,s=P.max,I=P.min,M=P.abs,U=P.cos,ba=P.sin,Aa=P.PI,Ba=Aa*2/360,ra=navigator.userAgent,Hb=C.opera,ya=/msie/i.test(ra)&&!Hb,gb=y.documentMode===8,hb=/AppleWebKit/.test(ra),Xa=/Firefox/.test(ra),Ib=/(Mobile|Android|Windows Phone)/.test(ra),Ca="http://www.w3.org/2000/svg",V=!!y.createElementNS&&!!y.createElementNS(Ca,"svg").createSVGRect,Nb=Xa&&parseInt(ra.split("Firefox/")[1],10)<4,da=!V&&!ya&&!!y.createElement("canvas").getContext,Ya,ib=y.documentElement.ontouchstart!==u,Jb={},ub=0,bb,G,ab,oa,vb,E,la=function(){},Ia=[],Ga="div",Q="none",Ob=/^[0-9]+$/,Kb="rgba(192,192,192,"+(V?1.0E-4:0.002)+")",Lb="stroke-width",cb,Pa,pb,qb,rb,Wa,db,eb,Cb,Db,sb,Eb,Fb,L={};C.Highcharts=C.Highcharts?ka(16,!0):{};ab=function(a,b,c){if(!t(b)||isNaN(b))return"Invalid date";var a=n(a,"%Y-%m-%d %H:%M:%S"),d=new Date(b-Pa),e,f=d[qb](),g=d[rb](),h=d[Wa](),i=d[db](),j=d[eb](),k=G.lang,l=k.weekdays,d=r({a:l[g].substr(0,3),A:l[g],d:Ea(h),e:h,b:k.shortMonths[i],B:k.months[i],m:Ea(i+1),y:j.toString().substr(2,2),Y:j,H:Ea(f),I:Ea(f%12||12),l:f%12||12,M:Ea(d[pb]()),p:f<12?"AM":"PM",P:f<12?"am":"pm",S:Ea(d.getSeconds()),L:Ea(w(b%1E3),3)},Highcharts.dateFormats);for(e in d)for(;a.indexOf("%"+e)!==-1;)a=a.replace("%"+e,typeof d[e]==="function"?d[e](b):d[e]);return c?a.substr(0,1).toUpperCase()+a.substr(1):a};Ab.prototype={wrapColor:function(a){if(this.color>=a)this.color=0},wrapSymbol:function(a){if(this.symbol>=a)this.symbol=0}};E=function(){for(var a=0,b=arguments,c=b.length,d={};a<c;a++)d[b[a++]]=b[a];return d}("millisecond",1,"second",1E3,"minute",6E4,"hour",36E5,"day",864E5,"week",6048E5,"month",26784E5,"year",31556952E3);vb={init:function(a,b,c){var b=b||"",d=a.shift,e=b.indexOf("C")>-1,f=e?7:3,g,b=b.split(" "),c=[].concat(c),h,i,j=function(a){for(g=a.length;g--;)a[g]==="M"&&a.splice(g+1,0,a[g+1],a[g+2],a[g+1],a[g+2])};e&&(j(b),j(c));a.isArea&&(h=b.splice(b.length-6,6),i=c.splice(c.length-6,6));if(d<=c.length/f&&b.length===c.length)for(;d--;)c=[].concat(c).splice(0,f).concat(c);a.shift=0;if(b.length)for(a=c.length;b.length<a;)d=[].concat(b).splice(b.length-f,f),e&&(d[f-6]=d[f-2],d[f-5]=d[f-1]),b=b.concat(d);h&&(b=b.concat(h),c=c.concat(i));return[b,c]},step:function(a,b,c,d){var e=[],f=a.length;if(c===1)e=d;else if(f===b.length&&c<1)for(;f--;)d=parseFloat(a[f]),e[f]=isNaN(d)?a[f]:c*parseFloat(b[f]-d)+d;else e=b;return e}};(function(a){C.HighchartsAdapter=C.HighchartsAdapter||a&&{init:function(b){var c=a.fx,d=c.step,e,f=a.Tween,g=f&&f.propHooks;e=a.cssHooks.opacity;a.extend(a.easing,{easeOutQuad:function(a,b,c,d,e){return-d*(b/=e)*(b-2)+c}});a.each(["cur","_default","width","height","opacity"],function(a,b){var e=d,k;b==="cur"?e=c.prototype:b==="_default"&&f&&(e=g[b],b="set");(k=e[b])&&(e[b]=function(c){var d,c=a?c:this;if(c.prop!=="align")return d=c.elem,d.attr?d.attr(c.prop,b==="cur"?u:c.now):k.apply(this,arguments)})});Va(e,"get",function(a,b,c){return b.attr?b.opacity||0:a.call(this,b,c)});e=function(a){var c=a.elem,d;if(!a.started)d=b.init(c,c.d,c.toD),a.start=d[0],a.end=d[1],a.started=!0;c.attr("d",b.step(a.start,a.end,a.pos,c.toD))};f?g.d={set:e}:d.d=e;this.each=Array.prototype.forEach?function(a,b){return Array.prototype.forEach.call(a,b)}:function(a,b){for(var c=0,d=a.length;c<d;c++)if(b.call(a[c],a[c],c,a)===!1)return c};a.fn.highcharts=function(){var a="Chart",b=arguments,c,d;fa(b[0])&&(a=b[0],b=Array.prototype.slice.call(b,1));c=b[0];if(c!==u)c.chart=c.chart||{},c.chart.renderTo=this[0],new Highcharts[a](c,b[1]),d=this;c===u&&(d=Ia[v(this[0],"data-highcharts-chart")]);return d}},getScript:a.getScript,inArray:a.inArray,adapterRun:function(b,c){return a(b)[c]()},grep:a.grep,map:function(a,c){for(var d=[],e=0,f=a.length;e<f;e++)d[e]=c.call(a[e],a[e],e,a);return d},offset:function(b){return a(b).offset()},addEvent:function(b,c,d){a(b).bind(c,d)},removeEvent:function(b,c,d){var e=y.removeEventListener?"removeEventListener":"detachEvent";y[e]&&b&&!b[e]&&(b[e]=function(){});a(b).unbind(c,d)},fireEvent:function(b,c,d,e){var f=a.Event(c),g="detached"+c,h;!ya&&d&&(delete d.layerX,delete d.layerY);r(f,d);b[c]&&(b[g]=b[c],b[c]=null);a.each(["preventDefault","stopPropagation"],function(a,b){var c=f[b];f[b]=function(){try{c.call(f)}catch(a){b==="preventDefault"&&(h=!0)}}});a(b).trigger(f);b[g]&&(b[c]=b[g],b[g]=null);e&&!f.isDefaultPrevented()&&!h&&e(f)},washMouseEvent:function(a){var c=a.originalEvent||a;if(c.pageX===u)c.pageX=a.pageX,c.pageY=a.pageY;return c},animate:function(b,c,d){var e=a(b);if(!b.style)b.style={};if(c.d)b.toD=c.d,c.d=1;e.stop();c.opacity!==u&&b.attr&&(c.opacity+="px");e.animate(c,d)},stop:function(b){a(b).stop()}}})(C.jQuery);var W=C.HighchartsAdapter,J=W||{};W&&W.init.call(W,vb);var jb=J.adapterRun,Pb=J.getScript,sa=J.inArray,p=J.each,wb=J.grep,Qb=J.offset,Ra=J.map,F=J.addEvent,X=J.removeEvent,A=J.fireEvent,Rb=J.washMouseEvent,kb=J.animate,Za=J.stop,J={enabled:!0,x:0,y:15,style:{color:"#666",cursor:"default",fontSize:"11px"}};G={colors:"#2f7ed8,#0d233a,#8bbc21,#910000,#1aadce,#492970,#f28f43,#77a1e5,#c42525,#a6c96a".split(","),symbols:["circle","diamond","square","triangle","triangle-down"],lang:{loading:"Loading...",months:"January,February,March,April,May,June,July,August,September,October,November,December".split(","),shortMonths:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(","),weekdays:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(","),decimalPoint:".",numericSymbols:"k,M,G,T,P,E".split(","),resetZoom:"Reset zoom",resetZoomTitle:"Reset zoom level 1:1",thousandsSep:","},global:{useUTC:!0,canvasToolsURL:"http://code.highcharts.com/3.0.9/modules/canvas-tools.js",VMLRadialGradientURL:"http://code.highcharts.com/3.0.9/gfx/vml-radial-gradient.png"},chart:{borderColor:"#4572A7",borderRadius:5,defaultSeriesType:"line",ignoreHiddenSeries:!0,spacing:[10,10,15,10],style:{fontFamily:'"Lucida Grande", "Lucida Sans Unicode", Verdana, Arial, Helvetica, sans-serif',fontSize:"12px"},backgroundColor:"#FFFFFF",plotBorderColor:"#C0C0C0",resetZoomButton:{theme:{zIndex:20},position:{align:"right",x:-10,y:10}}},title:{text:"Chart title",align:"center",margin:15,style:{color:"#274b6d",fontSize:"16px"}},subtitle:{text:"",align:"center",style:{color:"#4d759e"}},plotOptions:{line:{allowPointSelect:!1,showCheckbox:!1,animation:{duration:1E3},events:{},lineWidth:2,marker:{enabled:!0,lineWidth:0,radius:4,lineColor:"#FFFFFF",states:{hover:{enabled:!0},select:{fillColor:"#FFFFFF",lineColor:"#000000",lineWidth:2}}},point:{events:{}},dataLabels:x(J,{align:"center",enabled:!1,formatter:function(){return this.y===null?"":Da(this.y,-1)},verticalAlign:"bottom",y:0}),cropThreshold:300,pointRange:0,states:{hover:{marker:{}},select:{marker:{}}},stickyTracking:!0,turboThreshold:1E3}},labels:{style:{position:"absolute",color:"#3E576F"}},legend:{enabled:!0,align:"center",layout:"horizontal",labelFormatter:function(){return this.name},borderWidth:1,borderColor:"#909090",borderRadius:5,navigation:{activeColor:"#274b6d",inactiveColor:"#CCC"},shadow:!1,itemStyle:{cursor:"pointer",color:"#274b6d",fontSize:"12px"},itemHoverStyle:{color:"#000"},itemHiddenStyle:{color:"#CCC"},itemCheckboxStyle:{position:"absolute",width:"13px",height:"13px"},symbolPadding:5,verticalAlign:"bottom",x:0,y:0,title:{style:{fontWeight:"bold"}}},loading:{labelStyle:{fontWeight:"bold",position:"relative",top:"1em"},style:{position:"absolute",backgroundColor:"white",opacity:0.5,textAlign:"center"}},tooltip:{enabled:!0,animation:V,backgroundColor:"rgba(255, 255, 255, .85)",borderWidth:1,borderRadius:3,dateTimeLabelFormats:{millisecond:"%A, %b %e, %H:%M:%S.%L",second:"%A, %b %e, %H:%M:%S",minute:"%A, %b %e, %H:%M",hour:"%A, %b %e, %H:%M",day:"%A, %b %e, %Y",week:"Week from %A, %b %e, %Y",month:"%B %Y",year:"%Y"},headerFormat:'<span style="font-size: 10px">{point.key}</span><br/>',pointFormat:'<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b><br/>',shadow:!0,snap:Ib?25:10,style:{color:"#333333",cursor:"default",fontSize:"12px",padding:"8px",whiteSpace:"nowrap"}},credits:{enabled:!0,text:"Highcharts.com",href:"http://www.highcharts.com",position:{align:"right",x:-10,verticalAlign:"bottom",y:-5},style:{cursor:"pointer",color:"#909090",fontSize:"9px"}}};var Y=G.plotOptions,W=Y.line;Bb();var Sb=/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]?(?:\.[0-9]+)?)\s*\)/,Tb=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,Ub=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/,ta=function(a){var b=[],c,d;(function(a){a&&a.stops?d=Ra(a.stops,function(a){return ta(a[1])}):(c=Sb.exec(a))?b=[z(c[1]),z(c[2]),z(c[3]),parseFloat(c[4],10)]:(c=Tb.exec(a))?b=[z(c[1],16),z(c[2],16),z(c[3],16),1]:(c=Ub.exec(a))&&(b=[z(c[1]),z(c[2]),z(c[3]),1])})(a);return{get:function(c){var f;d?(f=x(a),f.stops=[].concat(f.stops),p(d,function(a,b){f.stops[b]=[f.stops[b][0],a.get(c)]})):f=b&&!isNaN(b[0])?c==="rgb"?"rgb("+b[0]+","+b[1]+","+b[2]+")":c==="a"?b[3]:"rgba("+b.join(",")+")":a;return f},brighten:function(a){if(d)p(d,function(b){b.brighten(a)});else if(wa(a)&&a!==0){var c;for(c=0;c<3;c++)b[c]+=z(a*255),b[c]<0&&(b[c]=0),b[c]>255&&(b[c]=255)}return this},rgba:b,setOpacity:function(a){b[3]=a;return this}}};pa.prototype={init:function(a,b){this.element=b==="span"?T(b):y.createElementNS(Ca,b);this.renderer=a;this.attrSetters={}},opacity:1,animate:function(a,b,c){b=n(b,oa,!0);Za(this);if(b){b=x(b);if(c)b.complete=c;kb(this,a,b)}else this.attr(a),c&&c()},attr:function(a,b){var c,d,e,f,g=this.element,h=g.nodeName.toLowerCase(),i=this.renderer,j,k=this.attrSetters,l=this.shadows,m,q,o=this;fa(a)&&t(b)&&(c=a,a={},a[c]=b);if(fa(a))c=a,h==="circle"?c={x:"cx",y:"cy"}[c]||c:c==="strokeWidth"&&(c="stroke-width"),o=v(g,c)||this[c]||0,c!=="d"&&c!=="visibility"&&c!=="fill"&&(o=parseFloat(o));else{for(c in a)if(j=!1,d=a[c],e=k[c]&&k[c].call(this,d,c),e!==!1){e!==u&&(d=e);if(c==="d")d&&d.join&&(d=d.join(" ")),/(NaN| {2}|^$)/.test(d)&&(d="M 0 0");else if(c==="x"&&h==="text")for(e=0;e<g.childNodes.length;e++)f=g.childNodes[e],v(f,"x")===v(g,"x")&&v(f,"x",d);else if(this.rotation&&(c==="x"||c==="y"))q=!0;else if(c==="fill")d=i.color(d,g,c);else if(h==="circle"&&(c==="x"||c==="y"))c={x:"cx",y:"cy"}[c]||c;else if(h==="rect"&&c==="r")v(g,{rx:d,ry:d}),j=!0;else if(c==="translateX"||c==="translateY"||c==="rotation"||c==="verticalAlign"||c==="scaleX"||c==="scaleY")j=q=!0;else if(c==="stroke")d=i.color(d,g,c);else if(c==="dashstyle")if(c="stroke-dasharray",d=d&&d.toLowerCase(),d==="solid")d=Q;else{if(d){d=d.replace("shortdashdotdot","3,1,1,1,1,1,").replace("shortdashdot","3,1,1,1").replace("shortdot","1,1,").replace("shortdash","3,1,").replace("longdash","8,3,").replace(/dot/g,"1,3,").replace("dash","4,3,").replace(/,$/,"").split(",");for(e=d.length;e--;)d[e]=z(d[e])*n(a["stroke-width"],this["stroke-width"]);d=d.join(",")}}else if(c==="width")d=z(d);else if(c==="align")c="text-anchor",d={left:"start",center:"middle",right:"end"}[d];else if(c==="title")e=g.getElementsByTagName("title")[0],e||(e=y.createElementNS(Ca,"title"),g.appendChild(e)),e.textContent=d;c==="strokeWidth"&&(c="stroke-width");if(c==="stroke-width"||c==="stroke"){this[c]=d;if(this.stroke&&this["stroke-width"])v(g,"stroke",this.stroke),v(g,"stroke-width",this["stroke-width"]),this.hasStroke=!0;else if(c==="stroke-width"&&d===0&&this.hasStroke)g.removeAttribute("stroke"),this.hasStroke=!1;j=!0}this.symbolName&&/^(x|y|width|height|r|start|end|innerR|anchorX|anchorY)/.test(c)&&(m||(this.symbolAttr(a),m=!0),j=!0);if(l&&/^(width|height|visibility|x|y|d|transform|cx|cy|r)$/.test(c))for(e=l.length;e--;)v(l[e],c,c==="height"?s(d-(l[e].cutHeight||0),0):d);if((c==="width"||c==="height")&&h==="rect"&&d<0)d=0;this[c]=d;c==="text"?(d!==this.textStr&&delete this.bBox,this.textStr=d,this.added&&i.buildText(this)):j||v(g,c,d)}q&&this.updateTransform()}return o},addClass:function(a){var b=this.element,c=v(b,"class")||"";c.indexOf(a)===-1&&v(b,"class",c+" "+a);return this},symbolAttr:function(a){var b=this;p("x,y,r,start,end,width,height,innerR,anchorX,anchorY".split(","),function(c){b[c]=n(a[c],b[c])});b.attr({d:b.renderer.symbols[b.symbolName](b.x,b.y,b.width,b.height,b)})},clip:function(a){return this.attr("clip-path",a?"url("+this.renderer.url+"#"+a.id+")":Q)},crisp:function(a,b,c,d,e){var f,g={},h={},i,a=a||this.strokeWidth||this.attr&&this.attr("stroke-width")||0;i=w(a)%2/2;h.x=N(b||this.x||0)+i;h.y=N(c||this.y||0)+i;h.width=N((d||this.width||0)-2*i);h.height=N((e||this.height||0)-2*i);h.strokeWidth=a;for(f in h)this[f]!==h[f]&&(this[f]=g[f]=h[f]);return g},css:function(a){var b=this.element,c=this.textWidth=a&&a.width&&b.nodeName.toLowerCase()==="text"&&z(a.width),d,e="",f=function(a,b){return"-"+b.toLowerCase()};if(a&&a.color)a.fill=a.color;this.styles=a=r(this.styles,a);c&&delete a.width;if(ya&&!V)D(this.element,a);else{for(d in a)e+=d.replace(/([A-Z])/g,f)+":"+a[d]+";";v(b,"style",e)}c&&this.added&&this.renderer.buildText(this);return this},on:function(a,b){var c=this,d=c.element;ib&&a==="click"?(d.ontouchstart=function(a){c.touchEventFired=Date.now();a.preventDefault();b.call(d,a)},d.onclick=function(a){(ra.indexOf("Android")===-1||Date.now()-(c.touchEventFired||0)>1100)&&b.call(d,a)}):d["on"+a]=b;return this},setRadialReference:function(a){this.element.radialReference=a;return this},translate:function(a,b){return this.attr({translateX:a,translateY:b})},invert:function(){this.inverted=!0;this.updateTransform();return this},updateTransform:function(){var a=this.translateX||0,b=this.translateY||0,c=this.scaleX,d=this.scaleY,e=this.inverted,f=this.rotation;e&&(a+=this.attr("width"),b+=this.attr("height"));a=["translate("+a+","+b+")"];e?a.push("rotate(90) scale(-1,1)"):f&&a.push("rotate("+f+" "+(this.x||0)+" "+(this.y||0)+")");(t(c)||t(d))&&a.push("scale("+n(c,1)+" "+n(d,1)+")");a.length&&v(this.element,"transform",a.join(" "))},toFront:function(){var a=this.element;a.parentNode.appendChild(a);return this},align:function(a,b,c){var d,e,f,g,h={};e=this.renderer;f=e.alignedObjects;if(a){if(this.alignOptions=a,this.alignByTranslate=b,!c||fa(c))this.alignTo=d=c||"renderer",ha(f,this),f.push(this),c=null}else a=this.alignOptions,b=this.alignByTranslate,d=this.alignTo;c=n(c,e[d],e);d=a.align;e=a.verticalAlign;f=(c.x||0)+(a.x||0);g=(c.y||0)+(a.y||0);if(d==="right"||d==="center")f+=(c.width-(a.width||0))/{right:1,center:2}[d];h[b?"translateX":"x"]=w(f);if(e==="bottom"||e==="middle")g+=(c.height-(a.height||0))/({bottom:1,middle:2}[e]||1);h[b?"translateY":"y"]=w(g);this[this.placed?"animate":"attr"](h);this.placed=!0;this.alignAttr=h;return this},getBBox:function(){var a=this.bBox,b=this.renderer,c,d,e=this.rotation;c=this.element;var f=this.styles,g=e*Ba;d=this.textStr;var h;if(d===""||Ob.test(d))h=d.length+"|"+f.fontSize+"|"+f.fontFamily,a=b.cache[h];if(!a){if(c.namespaceURI===Ca||b.forExport){try{a=c.getBBox?r({},c.getBBox()):{width:c.offsetWidth,height:c.offsetHeight}}catch(i){}if(!a||a.width<0)a={width:0,height:0}}else a=this.htmlGetBBox();if(b.isSVG){c=a.width;d=a.height;if(ya&&f&&f.fontSize==="11px"&&d.toPrecision(3)==="16.9")a.height=d=14;if(e)a.width=M(d*ba(g))+M(c*U(g)),a.height=M(d*U(g))+M(c*ba(g))}this.bBox=a;h&&(b.cache[h]=a)}return a},show:function(){return this.attr({visibility:"visible"})},hide:function(){return this.attr({visibility:"hidden"})},fadeOut:function(a){var b=this;b.animate({opacity:0},{duration:a||150,complete:function(){b.hide()}})},add:function(a){var b=this.renderer,c=a||b,d=c.element||b.box,e=d.childNodes,f=this.element,g=v(f,"zIndex"),h;if(a)this.parentGroup=a;this.parentInverted=a&&a.inverted;this.textStr!==void 0&&b.buildText(this);if(g)c.handleZ=!0,g=z(g);if(c.handleZ)for(c=0;c<e.length;c++)if(a=e[c],b=v(a,"zIndex"),a!==f&&(z(b)>g||!t(g)&&t(b))){d.insertBefore(f,a);h=!0;break}h||d.appendChild(f);this.added=!0;A(this,"add");return this},safeRemoveChild:function(a){var b=a.parentNode;b&&b.removeChild(a)},destroy:function(){var a=this,b=a.element||{},c=a.shadows,d=a.renderer.isSVG&&b.nodeName==="SPAN"&&a.parentGroup,e,f;b.onclick=b.onmouseout=b.onmouseover=b.onmousemove=b.point=null;Za(a);if(a.clipPath)a.clipPath=a.clipPath.destroy();if(a.stops){for(f=0;f<a.stops.length;f++)a.stops[f]=a.stops[f].destroy();a.stops=null}a.safeRemoveChild(b);for(c&&p(c,function(b){a.safeRemoveChild(b)});d&&d.div.childNodes.length===0;)b=d.parentGroup,a.safeRemoveChild(d.div),delete d.div,d=b;a.alignTo&&ha(a.renderer.alignedObjects,a);for(e in a)delete a[e];return null},shadow:function(a,b,c){var d=[],e,f,g=this.element,h,i,j,k;if(a){i=n(a.width,3);j=(a.opacity||0.15)/i;k=this.parentInverted?"(-1,-1)":"("+n(a.offsetX,1)+", "+n(a.offsetY,1)+")";for(e=1;e<=i;e++){f=g.cloneNode(0);h=i*2+1-2*e;v(f,{isShadow:"true",stroke:a.color||"black","stroke-opacity":j*e,"stroke-width":h,transform:"translate"+k,fill:Q});if(c)v(f,"height",s(v(f,"height")-h,0)),f.cutHeight=h;b?b.element.appendChild(f):g.parentNode.insertBefore(f,g);d.push(f)}this.shadows=d}return this}};var ua=function(){this.init.apply(this,arguments)};ua.prototype={Element:pa,init:function(a,b,c,d){var e=location,f,g;f=this.createElement("svg").attr({version:"1.1"});g=f.element;a.appendChild(g);a.innerHTML.indexOf("xmlns")===-1&&v(g,"xmlns",Ca);this.isSVG=!0;this.box=g;this.boxWrapper=f;this.alignedObjects=[];this.url=(Xa||hb)&&y.getElementsByTagName("base").length?e.href.replace(/#.*?$/,"").replace(/([\('\)])/g,"\\$1").replace(/ /g,"%20"):"";this.createElement("desc").add().element.appendChild(y.createTextNode("Created with Highcharts 3.0.9"));this.defs=this.createElement("defs").add();this.forExport=d;this.gradients={};this.cache={};this.setSize(b,c,!1);var h;if(Xa&&a.getBoundingClientRect)this.subPixelFix=b=function(){D(a,{left:0,top:0});h=a.getBoundingClientRect();D(a,{left:Ha(h.left)-h.left+"px",top:Ha(h.top)-h.top+"px"})},b(),F(C,"resize",b)},isHidden:function(){return!this.boxWrapper.getBBox().width},destroy:function(){var a=this.defs;this.box=null;this.boxWrapper=this.boxWrapper.destroy();Ma(this.gradients||{});this.gradients=null;if(a)this.defs=a.destroy();this.subPixelFix&&X(C,"resize",this.subPixelFix);return this.alignedObjects=null},createElement:function(a){var b=new this.Element;b.init(this,a);return b},draw:function(){},buildText:function(a){for(var b=a.element,c=this,d=c.forExport,e=n(a.textStr,"").toString().replace(/<(b|strong)>/g,'<span style="font-weight:bold">').replace(/<(i|em)>/g,'<span style="font-style:italic">').replace(/<a/g,"<span").replace(/<\/(b|strong|i|em|a)>/g,"</span>").split(/<br.*?>/g),f=b.childNodes,g=/style="([^"]+)"/,h=/href="(http[^"]+)"/,i=v(b,"x"),j=a.styles,k=a.textWidth,l=j&&j.lineHeight,m=f.length,q=function(a){return l?z(l):c.fontMetrics(/px$/.test(a&&a.style.fontSize)?a.style.fontSize:j.fontSize||11).h};m--;)b.removeChild(f[m]);k&&!a.added&&this.box.appendChild(b);e[e.length-1]===""&&e.pop();p(e,function(e,f){var l,m=0,e=e.replace(/<span/g,"|||<span").replace(/<\/span>/g,"</span>|||");l=e.split("|||");p(l,function(e){if(e!==""||l.length===1){var o={},n=y.createElementNS(Ca,"tspan"),p;g.test(e)&&(p=e.match(g)[1].replace(/(;| |^)color([ :])/,"$1fill$2"),v(n,"style",p));h.test(e)&&!d&&(v(n,"onclick",'location.href="'+
e.match(h)[1]+'"'),D(n,{cursor:"pointer"}));e=(e.replace(/<(.|\n)*?>/g,"")||" ").replace(/&lt;/g,"<").replace(/&gt;/g,">");if(e!==" "&&(n.appendChild(y.createTextNode(e)),m?o.dx=0:o.x=i,v(n,o),!m&&f&&(!V&&d&&D(n,{display:"block"}),v(n,"dy",q(n),hb&&n.offsetHeight)),b.appendChild(n),m++,k))for(var e=e.replace(/([^\^])-/g,"$1- ").split(" "),o=e.length>1&&j.whiteSpace!=="nowrap",t,s,w=a._clipHeight,u=[],r=q(),$=1;o&&(e.length||u.length);)delete a.bBox,t=a.getBBox(),s=t.width,!V&&c.forExport&&(s=c.measureSpanWidth(n.firstChild.data,a.styles)),t=s>k,!t||e.length===1?(e=u,u=[],e.length&&($++,w&&$*r>w?(e=["..."],a.attr("title",a.textStr)):(n=y.createElementNS(Ca,"tspan"),v(n,{dy:r,x:i}),p&&v(n,"style",p),b.appendChild(n),s>k&&(k=s)))):(n.removeChild(n.firstChild),u.unshift(e.pop())),e.length&&n.appendChild(y.createTextNode(e.join(" ").replace(/- /g,"-")))}})})},button:function(a,b,c,d,e,f,g,h,i){var j=this.label(a,b,c,i,null,null,null,null,"button"),k=0,l,m,q,o,n,p,a={x1:0,y1:0,x2:0,y2:1},e=x({"stroke-width":1,stroke:"#CCCCCC",fill:{linearGradient:a,stops:[[0,"#FEFEFE"],[1,"#F6F6F6"]]},r:2,padding:5,style:{color:"black"}},e);q=e.style;delete e.style;f=x(e,{stroke:"#68A",fill:{linearGradient:a,stops:[[0,"#FFF"],[1,"#ACF"]]}},f);o=f.style;delete f.style;g=x(e,{stroke:"#68A",fill:{linearGradient:a,stops:[[0,"#9BD"],[1,"#CDF"]]}},g);n=g.style;delete g.style;h=x(e,{style:{color:"#CCC"}},h);p=h.style;delete h.style;F(j.element,ya?"mouseover":"mouseenter",function(){k!==3&&j.attr(f).css(o)});F(j.element,ya?"mouseout":"mouseleave",function(){k!==3&&(l=[e,f,g][k],m=[q,o,n][k],j.attr(l).css(m))});j.setState=function(a){(j.state=k=a)?a===2?j.attr(g).css(n):a===3&&j.attr(h).css(p):j.attr(e).css(q)};return j.on("click",function(){k!==3&&d.call(j)}).attr(e).css(r({cursor:"default"},q))},crispLine:function(a,b){a[1]===a[4]&&(a[1]=a[4]=w(a[1])-b%2/2);a[2]===a[5]&&(a[2]=a[5]=w(a[2])+b%2/2);return a},path:function(a){var b={fill:Q};Ka(a)?b.d=a:S(a)&&r(b,a);return this.createElement("path").attr(b)},circle:function(a,b,c){a=S(a)?a:{x:a,y:b,r:c};return this.createElement("circle").attr(a)},arc:function(a,b,c,d,e,f){if(S(a))b=a.y,c=a.r,d=a.innerR,e=a.start,f=a.end,a=a.x;a=this.symbol("arc",a||0,b||0,c||0,c||0,{innerR:d||0,start:e||0,end:f||0});a.r=c;return a},rect:function(a,b,c,d,e,f){e=S(a)?a.r:e;e=this.createElement("rect").attr({rx:e,ry:e,fill:Q});return e.attr(S(a)?a:e.crisp(f,a,b,s(c,0),s(d,0)))},setSize:function(a,b,c){var d=this.alignedObjects,e=d.length;this.width=a;this.height=b;for(this.boxWrapper[n(c,!0)?"animate":"attr"]({width:a,height:b});e--;)d[e].align()},g:function(a){var b=this.createElement("g");return t(a)?b.attr({"class":"highcharts-"+a}):b},image:function(a,b,c,d,e){var f={preserveAspectRatio:Q};arguments.length>1&&r(f,{x:b,y:c,width:d,height:e});f=this.createElement("image").attr(f);f.element.setAttributeNS?f.element.setAttributeNS("http://www.w3.org/1999/xlink","href",a):f.element.setAttribute("hc-svg-href",a);return f},symbol:function(a,b,c,d,e,f){var g,h=this.symbols[a],h=h&&h(w(b),w(c),d,e,f),i=/^url\((.*?)\)$/,j,k;if(h)g=this.path(h),r(g,{symbolName:a,x:b,y:c,width:d,height:e}),f&&r(g,f);else if(i.test(a))k=function(a,b){a.element&&(a.attr({width:b[0],height:b[1]}),a.alignByTranslate||a.translate(w((d-b[0])/2),w((e-b[1])/2)))},j=a.match(i)[1],a=Jb[j],g=this.image(j).attr({x:b,y:c}),g.isImg=!0,a?k(g,a):(g.attr({width:0,height:0}),T("img",{onload:function(){k(g,Jb[j]=[this.width,this.height])},src:j}));return g},symbols:{circle:function(a,b,c,d){var e=0.166*c;return["M",a+c/2,b,"C",a+c+e,b,a+c+e,b+d,a+c/2,b+d,"C",a-e,b+d,a-e,b,a+c/2,b,"Z"]},square:function(a,b,c,d){return["M",a,b,"L",a+c,b,a+c,b+d,a,b+d,"Z"]},triangle:function(a,b,c,d){return["M",a+c/2,b,"L",a+c,b+d,a,b+d,"Z"]},"triangle-down":function(a,b,c,d){return["M",a,b,"L",a+c,b,a+c/2,b+d,"Z"]},diamond:function(a,b,c,d){return["M",a+c/2,b,"L",a+c,b+d/2,a+c/2,b+d,a,b+d/2,"Z"]},arc:function(a,b,c,d,e){var f=e.start,c=e.r||c||d,g=e.end-0.001,d=e.innerR,h=e.open,i=U(f),j=ba(f),k=U(g),g=ba(g),e=e.end-f<Aa?0:1;return["M",a+c*i,b+c*j,"A",c,c,0,e,1,a+c*k,b+c*g,h?"M":"L",a+d*k,b+d*g,"A",d,d,0,e,0,a+d*i,b+d*j,h?"":"Z"]}},clipRect:function(a,b,c,d){var e="highcharts-"+ub++,f=this.createElement("clipPath").attr({id:e}).add(this.defs),a=this.rect(a,b,c,d,0).add(f);a.id=e;a.clipPath=f;return a},color:function(a,b,c){var d=this,e,f=/^rgba/,g,h,i,j,k,l,m,q=[];a&&a.linearGradient?g="linearGradient":a&&a.radialGradient&&(g="radialGradient");if(g){c=a[g];h=d.gradients;j=a.stops;b=b.radialReference;Ka(c)&&(a[g]=c={x1:c[0],y1:c[1],x2:c[2],y2:c[3],gradientUnits:"userSpaceOnUse"});g==="radialGradient"&&b&&!t(c.gradientUnits)&&(c=x(c,{cx:b[0]-b[2]/2+c.cx*b[2],cy:b[1]-b[2]/2+c.cy*b[2],r:c.r*b[2],gradientUnits:"userSpaceOnUse"}));for(m in c)m!=="id"&&q.push(m,c[m]);for(m in j)q.push(j[m]);q=q.join(",");h[q]?a=h[q].id:(c.id=a="highcharts-"+ub++,h[q]=i=d.createElement(g).attr(c).add(d.defs),i.stops=[],p(j,function(a){f.test(a[1])?(e=ta(a[1]),k=e.get("rgb"),l=e.get("a")):(k=a[1],l=1);a=d.createElement("stop").attr({offset:a[0],"stop-color":k,"stop-opacity":l}).add(i);i.stops.push(a)}));return"url("+d.url+"#"+a+")"}else return f.test(a)?(e=ta(a),v(b,c+"-opacity",e.get("a")),e.get("rgb")):(b.removeAttribute(c+"-opacity"),a)},text:function(a,b,c,d){var e=G.chart.style,f=da||!V&&this.forExport;if(d&&!this.forExport)return this.html(a,b,c);b=w(n(b,0));c=w(n(c,0));a=this.createElement("text").attr({x:b,y:c,text:a}).css({fontFamily:e.fontFamily,fontSize:e.fontSize});f&&a.css({position:"absolute"});a.x=b;a.y=c;return a},fontMetrics:function(a){var a=z(a||11),a=a<24?a+4:w(a*1.2),b=w(a*0.8);return{h:a,b:b}},label:function(a,b,c,d,e,f,g,h,i){function j(){var a,b;a=n.element.style;va=(Z===void 0||Sa===void 0||o.styles.textAlign)&&n.getBBox();o.width=(Z||va.width||0)+2*ea+lb;o.height=(Sa||va.height||0)+2*ea;$=ea+q.fontMetrics(a&&a.fontSize).b;if(y){if(!H)a=w(-s*ea),b=h?-$:0,o.box=H=d?q.symbol(d,a,b,o.width,o.height,v):q.rect(a,b,o.width,o.height,0,v[Lb]),H.add(o);H.isImg||H.attr(x({width:o.width,height:o.height},v));v=null}}function k(){var a=o.styles,a=a&&a.textAlign,b=lb+ea*(1-s),c;c=h?0:$;if(t(Z)&&(a==="center"||a==="right"))b+={center:0.5,right:1}[a]*(Z-va.width);(b!==n.x||c!==n.y)&&n.attr({x:b,y:c});n.x=b;n.y=c}function l(a,b){H?H.attr(a,b):v[a]=b}function m(){n.add(o);o.attr({text:a,x:b,y:c});H&&t(e)&&o.attr({anchorX:e,anchorY:f})}var q=this,o=q.g(i),n=q.text("",0,0,g).attr({zIndex:1}),H,va,s=0,ea=3,lb=0,Z,Sa,Ta,K,B=0,v={},$,g=o.attrSetters,y;F(o,"add",m);g.width=function(a){Z=a;return!1};g.height=function(a){Sa=a;return!1};g.padding=function(a){t(a)&&a!==ea&&(ea=a,k());return!1};g.paddingLeft=function(a){t(a)&&a!==lb&&(lb=a,k());return!1};g.align=function(a){s={left:0,center:0.5,right:1}[a];return!1};g.text=function(a,b){n.attr(b,a);j();k();return!1};g[Lb]=function(a,b){y=!0;B=a%2/2;l(b,a);return!1};g.stroke=g.fill=g.r=function(a,b){b==="fill"&&(y=!0);l(b,a);return!1};g.anchorX=function(a,b){e=a;l(b,a+B-Ta);return!1};g.anchorY=function(a,b){f=a;l(b,a-K);return!1};g.x=function(a){o.x=a;a-=s*((Z||va.width)+ea);Ta=w(a);o.attr("translateX",Ta);return!1};g.y=function(a){K=o.y=w(a);o.attr("translateY",K);return!1};var z=o.css;return r(o,{css:function(a){if(a){var b={},a=x(a);p("fontSize,fontWeight,fontFamily,color,lineHeight,width,textDecoration,textShadow".split(","),function(c){a[c]!==u&&(b[c]=a[c],delete a[c])});n.css(b)}return z.call(o,a)},getBBox:function(){return{width:va.width+2*ea,height:va.height+2*ea,x:va.x-ea,y:va.y-ea}},shadow:function(a){H&&H.shadow(a);return o},destroy:function(){X(o,"add",m);X(o.element,"mouseenter");X(o.element,"mouseleave");n&&(n=n.destroy());H&&(H=H.destroy());pa.prototype.destroy.call(o);o=q=j=k=l=m=null}})}};Ya=ua;r(pa.prototype,{htmlCss:function(a){var b=this.element;if(b=a&&b.tagName==="SPAN"&&a.width)delete a.width,this.textWidth=b,this.updateTransform();this.styles=r(this.styles,a);D(this.element,a);return this},htmlGetBBox:function(){var a=this.element,b=this.bBox;if(!b){if(a.nodeName==="text")a.style.position="absolute";b=this.bBox={x:a.offsetLeft,y:a.offsetTop,width:a.offsetWidth,height:a.offsetHeight}}return b},htmlUpdateTransform:function(){if(this.added){var a=this.renderer,b=this.element,c=this.translateX||0,d=this.translateY||0,e=this.x||0,f=this.y||0,g=this.textAlign||"left",h={left:0,center:0.5,right:1}[g],i=this.shadows;D(b,{marginLeft:c,marginTop:d});i&&p(i,function(a){D(a,{marginLeft:c+1,marginTop:d+1})});this.inverted&&p(b.childNodes,function(c){a.invertChild(c,b)});if(b.tagName==="SPAN"){var j=this.rotation,k,l=z(this.textWidth),m=[j,g,b.innerHTML,this.textWidth].join(",");if(m!==this.cTT){k=a.fontMetrics(b.style.fontSize).b;t(j)&&this.setSpanRotation(j,h,k);i=n(this.elemWidth,b.offsetWidth);if(i>l&&/[ \-]/.test(b.textContent||b.innerText))D(b,{width:l+"px",display:"block",whiteSpace:"normal"}),i=l;this.getSpanCorrection(i,k,h,j,g)}D(b,{left:e+(this.xCorr||0)+"px",top:f+(this.yCorr||0)+"px"});if(hb)k=b.offsetHeight;this.cTT=m}}else this.alignOnAdd=!0},setSpanRotation:function(a,b,c){var d={},e=ya?"-ms-transform":hb?"-webkit-transform":Xa?"MozTransform":Hb?"-o-transform":"";d[e]=d.transform="rotate("+a+"deg)";d[e+(Xa?"Origin":"-origin")]=b*100+"% "+
c+"px";D(this.element,d)},getSpanCorrection:function(a,b,c){this.xCorr=-a*c;this.yCorr=-b}});r(ua.prototype,{html:function(a,b,c){var d=G.chart.style,e=this.createElement("span"),f=e.attrSetters,g=e.element,h=e.renderer;f.text=function(a){a!==g.innerHTML&&delete this.bBox;g.innerHTML=a;return!1};f.x=f.y=f.align=f.rotation=function(a,b){b==="align"&&(b="textAlign");e[b]=a;e.htmlUpdateTransform();return!1};e.attr({text:a,x:w(b),y:w(c)}).css({position:"absolute",whiteSpace:"nowrap",fontFamily:d.fontFamily,fontSize:d.fontSize});e.css=e.htmlCss;if(h.isSVG)e.add=function(a){var b,c=h.box.parentNode,d=[];if(this.parentGroup=a){if(b=a.div,!b){for(;a;)d.push(a),a=a.parentGroup;p(d.reverse(),function(a){var d;b=a.div=a.div||T(Ga,{className:v(a.element,"class")},{position:"absolute",left:(a.translateX||0)+"px",top:(a.translateY||0)+"px"},b||c);d=b.style;r(a.attrSetters,{translateX:function(a){d.left=a+"px"},translateY:function(a){d.top=a+"px"},visibility:function(a,b){d[b]=a}})})}}else b=c;b.appendChild(g);e.added=!0;e.alignOnAdd&&e.htmlUpdateTransform();return e};return e}});var R;if(!V&&!da){Highcharts.VMLElement=R={init:function(a,b){var c=["<",b,' filled="f" stroked="f"'],d=["position: ","absolute",";"],e=b===Ga;(b==="shape"||e)&&d.push("left:0;top:0;width:1px;height:1px;");d.push("visibility: ",e?"hidden":"visible");c.push(' style="',d.join(""),'"/>');if(b)c=e||b==="span"||b==="img"?c.join(""):a.prepVML(c),this.element=T(c);this.renderer=a;this.attrSetters={}},add:function(a){var b=this.renderer,c=this.element,d=b.box,d=a?a.element||a:d;a&&a.inverted&&b.invertChild(c,d);d.appendChild(c);this.added=!0;this.alignOnAdd&&!this.deferUpdateTransform&&this.updateTransform();A(this,"add");return this},updateTransform:pa.prototype.htmlUpdateTransform,setSpanRotation:function(){var a=this.rotation,b=U(a*Ba),c=ba(a*Ba);D(this.element,{filter:a?["progid:DXImageTransform.Microsoft.Matrix(M11=",b,", M12=",-c,", M21=",c,", M22=",b,", sizingMethod='auto expand')"].join(""):Q})},getSpanCorrection:function(a,b,c,d,e){var f=d?U(d*Ba):1,g=d?ba(d*Ba):0,h=n(this.elemHeight,this.element.offsetHeight),i;this.xCorr=f<0&&-a;this.yCorr=g<0&&-h;i=f*g<0;this.xCorr+=g*b*(i?1-c:c);this.yCorr-=f*b*(d?i?c:1-c:1);e&&e!=="left"&&(this.xCorr-=a*c*(f<0?-1:1),d&&(this.yCorr-=h*c*(g<0?-1:1)),D(this.element,{textAlign:e}))},pathToVML:function(a){for(var b=a.length,c=[];b--;)if(wa(a[b]))c[b]=w(a[b]*10)-5;else if(a[b]==="Z")c[b]="x";else if(c[b]=a[b],a.isArc&&(a[b]==="wa"||a[b]==="at"))c[b+5]===c[b+7]&&(c[b+7]+=a[b+7]>a[b+5]?1:-1),c[b+6]===c[b+8]&&(c[b+8]+=a[b+8]>a[b+6]?1:-1);return c.join(" ")||"x"},attr:function(a,b){var c,d,e,f=this.element||{},g=f.style,h=f.nodeName,i=this.renderer,j=this.symbolName,k,l=this.shadows,m,q=this.attrSetters,o=this;fa(a)&&t(b)&&(c=a,a={},a[c]=b);if(fa(a))c=a,o=c==="strokeWidth"||c==="stroke-width"?this.strokeweight:this[c];else for(c in a)if(d=a[c],m=!1,e=q[c]&&q[c].call(this,d,c),e!==!1&&d!==null){e!==u&&(d=e);if(j&&/^(x|y|r|start|end|width|height|innerR|anchorX|anchorY)/.test(c))k||(this.symbolAttr(a),k=!0),m=!0;else if(c==="d"){d=d||[];this.d=d.join(" ");f.path=d=this.pathToVML(d);if(l)for(e=l.length;e--;)l[e].path=l[e].cutOff?this.cutOffPath(d,l[e].cutOff):d;m=!0}else if(c==="visibility"){if(l)for(e=l.length;e--;)l[e].style[c]=d;h==="DIV"&&(d=d==="hidden"?"-999em":0,gb||(g[c]=d?"visible":"hidden"),c="top");g[c]=d;m=!0}else if(c==="zIndex")d&&(g[c]=d),m=!0;else if(sa(c,["x","y","width","height"])!==-1)this[c]=d,c==="x"||c==="y"?c={x:"left",y:"top"}[c]:d=s(0,d),this.updateClipping?(this[c]=d,this.updateClipping()):g[c]=d,m=!0;else if(c==="class"&&h==="DIV")f.className=d;else if(c==="stroke")d=i.color(d,f,c),c="strokecolor";else if(c==="stroke-width"||c==="strokeWidth")f.stroked=d?!0:!1,c="strokeweight",this[c]=d,wa(d)&&(d+="px");else if(c==="dashstyle")(f.getElementsByTagName("stroke")[0]||T(i.prepVML(["<stroke/>"]),null,null,f))[c]=d||"solid",this.dashstyle=d,m=!0;else if(c==="fill")if(h==="SPAN")g.color=d;else{if(h!=="IMG")f.filled=d!==Q?!0:!1,d=i.color(d,f,c,this),c="fillcolor"}else if(c==="opacity")m=!0;else if(h==="shape"&&c==="rotation")this[c]=f.style[c]=d,f.style.left=-w(ba(d*Ba)+1)+"px",f.style.top=w(U(d*Ba))+"px";else if(c==="translateX"||c==="translateY"||c==="rotation")this[c]=d,this.updateTransform(),m=!0;m||(gb?f[c]=d:v(f,c,d))}return o},clip:function(a){var b=this,c;a?(c=a.members,ha(c,b),c.push(b),b.destroyClip=function(){ha(c,b)},a=a.getCSS(b)):(b.destroyClip&&b.destroyClip(),a={clip:gb?"inherit":"rect(auto)"});return b.css(a)},css:pa.prototype.htmlCss,safeRemoveChild:function(a){a.parentNode&&Na(a)},destroy:function(){this.destroyClip&&this.destroyClip();return pa.prototype.destroy.apply(this)},on:function(a,b){this.element["on"+a]=function(){var a=C.event;a.target=a.srcElement;b(a)};return this},cutOffPath:function(a,b){var c,a=a.split(/[ ,]/);c=a.length;if(c===9||c===11)a[c-4]=a[c-2]=z(a[c-2])-10*b;return a.join(" ")},shadow:function(a,b,c){var d=[],e,f=this.element,g=this.renderer,h,i=f.style,j,k=f.path,l,m,q,o;k&&typeof k.value!=="string"&&(k="x");m=k;if(a){q=n(a.width,3);o=(a.opacity||0.15)/q;for(e=1;e<=3;e++){l=q*2+1-2*e;c&&(m=this.cutOffPath(k.value,l+0.5));j=['<shape isShadow="true" strokeweight="',l,'" filled="false" path="',m,'" coordsize="10 10" style="',f.style.cssText,'" />'];h=T(g.prepVML(j),null,{left:z(i.left)+n(a.offsetX,1),top:z(i.top)+n(a.offsetY,1)});if(c)h.cutOff=l+1;j=['<stroke color="',a.color||"black",'" opacity="',o*e,'"/>'];T(g.prepVML(j),null,null,h);b?b.element.appendChild(h):f.parentNode.insertBefore(h,f);d.push(h)}this.shadows=d}return this}};R=ia(pa,R);var xb={Element:R,isIE8:ra.indexOf("MSIE 8.0")>-1,init:function(a,b,c){var d,e;this.alignedObjects=[];d=this.createElement(Ga);e=d.element;e.style.position="relative";a.appendChild(d.element);this.isVML=!0;this.box=e;this.boxWrapper=d;this.cache={};this.setSize(b,c,!1);if(!y.namespaces.hcv){y.namespaces.add("hcv","urn:schemas-microsoft-com:vml");try{y.createStyleSheet().cssText="hcv\\:fill, hcv\\:path, hcv\\:shape, hcv\\:stroke{ behavior:url(#default#VML); display: inline-block; } "}catch(f){y.styleSheets[0].cssText+="hcv\\:fill, hcv\\:path, hcv\\:shape, hcv\\:stroke{ behavior:url(#default#VML); display: inline-block; } "}}},isHidden:function(){return!this.box.offsetWidth},clipRect:function(a,b,c,d){var e=this.createElement(),f=S(a);return r(e,{members:[],left:(f?a.x:a)+1,top:(f?a.y:b)+1,width:(f?a.width:c)-1,height:(f?a.height:d)-1,getCSS:function(a){var b=a.element,c=b.nodeName,a=a.inverted,d=this.top-(c==="shape"?b.offsetTop:0),e=this.left,b=e+this.width,f=d+this.height,d={clip:"rect("+w(a?e:d)+"px,"+w(a?f:b)+"px,"+w(a?b:f)+"px,"+w(a?d:e)+"px)"};!a&&gb&&c==="DIV"&&r(d,{width:b+"px",height:f+"px"});return d},updateClipping:function(){p(e.members,function(a){a.css(e.getCSS(a))})}})},color:function(a,b,c,d){var e=this,f,g=/^rgba/,h,i,j=Q;a&&a.linearGradient?i="gradient":a&&a.radialGradient&&(i="pattern");if(i){var k,l,m=a.linearGradient||a.radialGradient,q,o,n,H,s,t="",a=a.stops,u,w=[],r=function(){h=['<fill colors="'+w.join(",")+'" opacity="',n,'" o:opacity2="',o,'" type="',i,'" ',t,'focus="100%" method="any" />'];T(e.prepVML(h),null,null,b)};q=a[0];u=a[a.length-1];q[0]>0&&a.unshift([0,q[1]]);u[0]<1&&a.push([1,u[1]]);p(a,function(a,b){g.test(a[1])?(f=ta(a[1]),k=f.get("rgb"),l=f.get("a")):(k=a[1],l=1);w.push(a[0]*100+"% "+k);b?(n=l,H=k):(o=l,s=k)});if(c==="fill")if(i==="gradient")c=m.x1||m[0]||0,a=m.y1||m[1]||0,q=m.x2||m[2]||0,m=m.y2||m[3]||0,t='angle="'+(90-P.atan((m-a)/(q-c))*180/Aa)+'"',r();else{var j=m.r,Sa=j*2,Ta=j*2,v=m.cx,B=m.cy,x=b.radialReference,$,j=function(){x&&($=d.getBBox(),v+=(x[0]-$.x)/$.width-
0.5,B+=(x[1]-$.y)/$.height-0.5,Sa*=x[2]/$.width,Ta*=x[2]/$.height);t='src="'+G.global.VMLRadialGradientURL+'" size="'+Sa+","+Ta+'" origin="0.5,0.5" position="'+v+","+B+'" color2="'+s+'" ';r()};d.added?j():F(d,"add",j);j=H}else j=k}else if(g.test(a)&&b.tagName!=="IMG")f=ta(a),h=["<",c,' opacity="',f.get("a"),'"/>'],T(this.prepVML(h),null,null,b),j=f.get("rgb");else{j=b.getElementsByTagName(c);if(j.length)j[0].opacity=1,j[0].type="solid";j=a}return j},prepVML:function(a){var b=this.isIE8,a=a.join("");b?(a=a.replace("/>",' xmlns="urn:schemas-microsoft-com:vml" />'),a=a.indexOf('style="')===-1?a.replace("/>",' style="display:inline-block;behavior:url(#default#VML);" />'):a.replace('style="','style="display:inline-block;behavior:url(#default#VML);')):a=a.replace("<","<hcv:");return a},text:ua.prototype.html,path:function(a){var b={coordsize:"10 10"};Ka(a)?b.d=a:S(a)&&r(b,a);return this.createElement("shape").attr(b)},circle:function(a,b,c){var d=this.symbol("circle");if(S(a))c=a.r,b=a.y,a=a.x;d.isCircle=!0;d.r=c;return d.attr({x:a,y:b})},g:function(a){var b;a&&(b={className:"highcharts-"+a,"class":"highcharts-"+a});return this.createElement(Ga).attr(b)},image:function(a,b,c,d,e){var f=this.createElement("img").attr({src:a});arguments.length>1&&f.attr({x:b,y:c,width:d,height:e});return f},rect:function(a,b,c,d,e,f){var g=this.symbol("rect");g.r=S(a)?a.r:e;return g.attr(S(a)?a:g.crisp(f,a,b,s(c,0),s(d,0)))},invertChild:function(a,b){var c=b.style;D(a,{flip:"x",left:z(c.width)-1,top:z(c.height)-1,rotation:-90})},symbols:{arc:function(a,b,c,d,e){var f=e.start,g=e.end,h=e.r||c||d,c=e.innerR,d=U(f),i=ba(f),j=U(g),k=ba(g);if(g-f===0)return["x"];f=["wa",a-h,b-h,a+h,b+h,a+h*d,b+h*i,a+h*j,b+h*k];e.open&&!c&&f.push("e","M",a,b);f.push("at",a-c,b-c,a+c,b+c,a+c*j,b+c*k,a+c*d,b+c*i,"x","e");f.isArc=!0;return f},circle:function(a,b,c,d,e){e&&(c=d=2*e.r);e&&e.isCircle&&(a-=c/2,b-=d/2);return["wa",a,b,a+c,b+d,a+c,b+d/2,a+c,b+d/2,"e"]},rect:function(a,b,c,d,e){var f=a+c,g=b+d,h;!t(e)||!e.r?f=ua.prototype.symbols.square.apply(0,arguments):(h=I(e.r,c,d),f=["M",a+h,b,"L",f-h,b,"wa",f-2*h,b,f,b+2*h,f-h,b,f,b+h,"L",f,g-h,"wa",f-2*h,g-2*h,f,g,f,g-h,f-h,g,"L",a+h,g,"wa",a,g-2*h,a+2*h,g,a+h,g,a,g-h,"L",a,b+h,"wa",a,b,a+2*h,b+2*h,a,b+h,a+h,b,"x","e"]);return f}}};Highcharts.VMLRenderer=R=function(){this.init.apply(this,arguments)};R.prototype=x(ua.prototype,xb);Ya=R}ua.prototype.measureSpanWidth=function(a,b){var c=y.createElement("span"),d;d=y.createTextNode(a);c.appendChild(d);D(c,b);this.box.appendChild(c);d=c.offsetWidth;Na(c);return d};var Mb;if(da)Highcharts.CanVGRenderer=R=function(){Ca="http://www.w3.org/1999/xhtml"},R.prototype.symbols={},Mb=function(){function a(){var a=b.length,d;for(d=0;d<a;d++)b[d]();b=[]}var b=[];return{push:function(c,d){b.length===0&&Pb(d,a);b.push(c)}}}(),Ya=R;Qa.prototype={addLabel:function(){var a=this.axis,b=a.options,c=a.chart,d=a.horiz,e=a.categories,f=a.names,g=this.pos,h=b.labels,i=a.tickPositions,d=d&&e&&!h.step&&!h.staggerLines&&!h.rotation&&c.plotWidth/i.length||!d&&(c.margin[3]||c.chartWidth*0.33),j=g===i[0],k=g===i[i.length-1],l,f=e?n(e[g],f[g],g):g,e=this.label,m=i.info;a.isDatetimeAxis&&m&&(l=b.dateTimeLabelFormats[m.higherRanks[g]||m.unitName]);this.isFirst=j;this.isLast=k;b=a.labelFormatter.call({axis:a,chart:c,isFirst:j,isLast:k,dateTimeLabelFormat:l,value:a.isLog?aa(ga(f)):f});g=d&&{width:s(1,w(d-2*(h.padding||10)))+"px"};g=r(g,h.style);if(t(e))e&&e.attr({text:b}).css(g);else{l={align:a.labelAlign};if(wa(h.rotation))l.rotation=h.rotation;if(d&&h.ellipsis)l._clipHeight=a.len/i.length;this.label=t(b)&&h.enabled?c.renderer.text(b,0,0,h.useHTML).attr(l).css(g).add(a.labelGroup):null}},getLabelSize:function(){var a=this.label,b=this.axis;return a?a.getBBox()[b.horiz?"height":"width"]:0},getLabelSides:function(){var a=this.label.getBBox(),b=this.axis,c=b.horiz,d=b.options.labels,a=c?a.width:a.height,b=c?a*{left:0,center:0.5,right:1}[b.labelAlign]-d.x:a;return[-b,a-b]},handleOverflow:function(a,b){var B;var c=!0,d=this.axis,e=this.isFirst,f=this.isLast,g=d.horiz?b.x:b.y,h=d.reversed,i=d.tickPositions,j=this.getLabelSides(),k=j[0],j=j[1],l=d.pos,m=l+d.len,q=this.label.line||0,o=d.labelEdge,n=d.justifyLabels&&(e||f);o[q]===u||g+k>o[q]?o[q]=g+j:n||(c=!1);if(n)B=(d=d.ticks[i[a+(e?1:-1)]])&&d.label.xy&&d.label.xy.x+d.getLabelSides()[e?0:1],i=B,e&&!h||f&&h?g+k<l&&(g=l-k,d&&g+j>i&&(c=!1)):g+j>m&&(g=m-j,d&&g+k<i&&(c=!1)),b.x=g;return c},getPosition:function(a,b,c,d){var e=this.axis,f=e.chart,g=d&&f.oldChartHeight||f.chartHeight;return{x:a?e.translate(b+c,null,null,d)+
e.transB:e.left+e.offset+(e.opposite?(d&&f.oldChartWidth||f.chartWidth)-e.right-e.left:0),y:a?g-e.bottom+e.offset-(e.opposite?e.height:0):g-e.translate(b+c,null,null,d)-e.transB}},getLabelPosition:function(a,b,c,d,e,f,g,h){var i=this.axis,j=i.transA,k=i.reversed,l=i.staggerLines,m=i.chart.renderer.fontMetrics(e.style.fontSize).b,q=e.rotation,a=a+e.x-(f&&d?f*j*(k?-1:1):0),b=b+e.y-(f&&!d?f*j*(k?1:-1):0);q&&i.side===2&&(b-=m-m*U(q*Ba));!t(e.y)&&!q&&(b+=m-c.getBBox().height/2);if(l)c.line=g/(h||1)%l,b+=c.line*(i.labelOffset/l);return{x:a,y:b}},getMarkPath:function(a,b,c,d,e,f){return f.crispLine(["M",a,b,"L",a+(e?0:-c),b+(e?c:0)],d)},render:function(a,b,c){var d=this.axis,e=d.options,f=d.chart.renderer,g=d.horiz,h=this.type,i=this.label,j=this.pos,k=e.labels,l=this.gridLine,m=h?h+"Grid":"grid",q=h?h+"Tick":"tick",o=e[m+"LineWidth"],p=e[m+"LineColor"],H=e[m+"LineDashStyle"],s=e[q+"Length"],m=e[q+"Width"]||0,t=e[q+"Color"],w=e[q+"Position"],q=this.mark,r=k.step,Z=!0,x=d.tickmarkOffset,v=this.getPosition(g,j,x,b),y=v.x,v=v.y,B=g&&y===d.pos+d.len||!g&&v===d.pos?-1:1;this.isActive=!0;if(o){j=d.getPlotLinePath(j+x,o*B,b,!0);if(l===u){l={stroke:p,"stroke-width":o};if(H)l.dashstyle=H;if(!h)l.zIndex=1;if(b)l.opacity=0;this.gridLine=l=o?f.path(j).attr(l).add(d.gridGroup):null}if(!b&&l&&j)l[this.isNew?"attr":"animate"]({d:j,opacity:c})}if(m&&s)w==="inside"&&(s=-s),d.opposite&&(s=-s),h=this.getMarkPath(y,v,s,m*B,g,f),q?q.animate({d:h,opacity:c}):this.mark=f.path(h).attr({stroke:t,"stroke-width":m,opacity:c}).add(d.axisGroup);if(i&&!isNaN(y))i.xy=v=this.getLabelPosition(y,v,i,g,k,x,a,r),this.isFirst&&!this.isLast&&!n(e.showFirstLabel,1)||this.isLast&&!this.isFirst&&!n(e.showLastLabel,1)?Z=!1:!d.isRadial&&!k.step&&!k.rotation&&!b&&c!==0&&(Z=this.handleOverflow(a,v)),r&&a%r&&(Z=!1),Z&&!isNaN(v.y)?(v.opacity=c,i[this.isNew?"attr":"animate"](v),this.isNew=!1):i.attr("y",-9999)},destroy:function(){Ma(this,this.axis)}};var yb=function(a,b){this.axis=a;if(b)this.options=b,this.id=b.id};yb.prototype={render:function(){var a=this,b=a.axis,c=b.horiz,d=(b.pointRange||0)/2,e=a.options,f=e.label,g=a.label,h=e.width,i=e.to,j=e.from,k=t(j)&&t(i),l=e.value,m=e.dashStyle,q=a.svgElem,o=[],p,H=e.color,w=e.zIndex,r=e.events,u=b.chart.renderer;b.isLog&&(j=xa(j),i=xa(i),l=xa(l));if(h){if(o=b.getPlotLinePath(l,h),d={stroke:H,"stroke-width":h},m)d.dashstyle=m}else if(k){if(j=s(j,b.min-d),i=I(i,b.max+d),o=b.getPlotBandPath(j,i,e),d={fill:H},e.borderWidth)d.stroke=e.borderColor,d["stroke-width"]=e.borderWidth}else return;if(t(w))d.zIndex=w;if(q)if(o)q.animate({d:o},null,q.onGetPath);else{if(q.hide(),q.onGetPath=function(){q.show()},g)a.label=g=g.destroy()}else if(o&&o.length&&(a.svgElem=q=u.path(o).attr(d).add(),r))for(p in e=function(b){q.on(b,function(c){r[b].apply(a,[c])})},r)e(p);if(f&&t(f.text)&&o&&o.length&&b.width>0&&b.height>0){f=x({align:c&&k&&"center",x:c?!k&&4:10,verticalAlign:!c&&k&&"middle",y:c?k?16:10:k?6:-4,rotation:c&&!k&&90},f);if(!g)a.label=g=u.text(f.text,0,0,f.useHTML).attr({align:f.textAlign||f.align,rotation:f.rotation,zIndex:w}).css(f.style).add();b=[o[1],o[4],n(o[6],o[1])];o=[o[2],o[5],n(o[7],o[2])];c=La(b);k=La(o);g.align(f,!1,{x:c,y:k,width:za(b)-c,height:za(o)-k});g.show()}else g&&g.hide();return a},destroy:function(){ha(this.axis.plotLinesAndBands,this);delete this.axis;Ma(this)}};qa.prototype={defaultOptions:{dateTimeLabelFormats:{millisecond:"%H:%M:%S.%L",second:"%H:%M:%S",minute:"%H:%M",hour:"%H:%M",day:"%e. %b",week:"%e. %b",month:"%b '%y",year:"%Y"},endOnTick:!1,gridLineColor:"#C0C0C0",labels:J,lineColor:"#C0D0E0",lineWidth:1,minPadding:0.01,maxPadding:0.01,minorGridLineColor:"#E0E0E0",minorGridLineWidth:1,minorTickColor:"#A0A0A0",minorTickLength:2,minorTickPosition:"outside",startOfWeek:1,startOnTick:!1,tickColor:"#C0D0E0",tickLength:5,tickmarkPlacement:"between",tickPixelInterval:100,tickPosition:"outside",tickWidth:1,title:{align:"middle",style:{color:"#4d759e",fontWeight:"bold"}},type:"linear"},defaultYAxisOptions:{endOnTick:!0,gridLineWidth:1,tickPixelInterval:72,showLastLabel:!0,labels:{x:-8,y:3},lineWidth:0,maxPadding:0.05,minPadding:0.05,startOnTick:!0,tickWidth:0,title:{rotation:270,text:"Values"},stackLabels:{enabled:!1,formatter:function(){return Da(this.total,-1)},style:J.style}},defaultLeftAxisOptions:{labels:{x:-8,y:null},title:{rotation:270}},defaultRightAxisOptions:{labels:{x:8,y:null},title:{rotation:90}},defaultBottomAxisOptions:{labels:{x:0,y:14},title:{rotation:0}},defaultTopAxisOptions:{labels:{x:0,y:-5},title:{rotation:0}},init:function(a,b){var c=b.isX;this.horiz=a.inverted?!c:c;this.coll=(this.isXAxis=c)?"xAxis":"yAxis";this.opposite=b.opposite;this.side=b.side||(this.horiz?this.opposite?0:2:this.opposite?1:3);this.setOptions(b);var d=this.options,e=d.type;this.labelFormatter=d.labels.formatter||this.defaultLabelFormatter;this.userOptions=b;this.minPixelPadding=0;this.chart=a;this.reversed=d.reversed;this.zoomEnabled=d.zoomEnabled!==!1;this.categories=d.categories||e==="category";this.names=[];this.isLog=e==="logarithmic";this.isDatetimeAxis=e==="datetime";this.isLinked=t(d.linkedTo);this.tickmarkOffset=this.categories&&d.tickmarkPlacement==="between"?0.5:0;this.ticks={};this.labelEdge=[];this.minorTicks={};this.plotLinesAndBands=[];this.alternateBands={};this.len=0;this.minRange=this.userMinRange=d.minRange||d.maxZoom;this.range=d.range;this.offset=d.offset||0;this.stacks={};this.oldStacks={};this.stackExtremes={};this.min=this.max=null;this.crosshair=n(d.crosshair,ja(a.options.tooltip.crosshairs)[c?0:1],!1);var f,d=this.options.events;sa(this,a.axes)===-1&&(a.axes.push(this),a[this.coll].push(this));this.series=this.series||[];if(a.inverted&&c&&this.reversed===u)this.reversed=!0;this.removePlotLine=this.removePlotBand=this.removePlotBandOrLine;for(f in d)F(this,f,d[f]);if(this.isLog)this.val2lin=xa,this.lin2val=ga},setOptions:function(a){this.options=x(this.defaultOptions,this.isXAxis?{}:this.defaultYAxisOptions,[this.defaultTopAxisOptions,this.defaultRightAxisOptions,this.defaultBottomAxisOptions,this.defaultLeftAxisOptions][this.side],x(G[this.coll],a))},defaultLabelFormatter:function(){var a=this.axis,b=this.value,c=a.categories,d=this.dateTimeLabelFormat,e=G.lang.numericSymbols,f=e&&e.length,g,h=a.options.labels.format,a=a.isLog?b:a.tickInterval;if(h)g=Fa(h,this);else if(c)g=b;else if(d)g=ab(d,b);else if(f&&a>=1E3)for(;f--&&g===u;)c=Math.pow(1E3,f+1),a>=c&&e[f]!==null&&(g=Da(b/c,-1)+e[f]);g===u&&(g=b>=1E4?Da(b,0):Da(b,-1,u,""));return g},getSeriesExtremes:function(){var a=this,b=a.chart;a.hasVisibleSeries=!1;a.dataMin=a.dataMax=null;a.stackExtremes={};a.buildStacks();p(a.series,function(c){if(c.visible||!b.options.chart.ignoreHiddenSeries){var d;d=c.options.threshold;var e;a.hasVisibleSeries=!0;a.isLog&&d<=0&&(d=null);if(a.isXAxis){if(d=c.xData,d.length)a.dataMin=I(n(a.dataMin,d[0]),La(d)),a.dataMax=s(n(a.dataMax,d[0]),za(d))}else{c.getExtremes();e=c.dataMax;c=c.dataMin;if(t(c)&&t(e))a.dataMin=I(n(a.dataMin,c),c),a.dataMax=s(n(a.dataMax,e),e);if(t(d))if(a.dataMin>=d)a.dataMin=d,a.ignoreMinPadding=!0;else if(a.dataMax<d)a.dataMax=d,a.ignoreMaxPadding=!0}}})},translate:function(a,b,c,d,e,f){var g=this.len,h=1,i=0,j=d?this.oldTransA:this.transA,d=d?this.oldMin:this.min,k=this.minPixelPadding,e=(this.options.ordinal||this.isLog&&e)&&this.lin2val;if(!j)j=this.transA;c&&(h*=-1,i=g);this.reversed&&(h*=-1,i-=h*g);b?(a=a*h+i,a-=k,a=a/j+d,e&&(a=this.lin2val(a))):(e&&(a=this.val2lin(a)),f==="between"&&(f=0.5),a=h*(a-d)*j+i+h*k+(wa(f)?j*f*this.pointRange:0));return a},toPixels:function(a,b){return this.translate(a,!1,!this.horiz,null,!0)+(b?0:this.pos)},toValue:function(a,b){return this.translate(a-
(b?0:this.pos),!0,!this.horiz,null,!0)},getPlotLinePath:function(a,b,c,d,e){var f=this.chart,g=this.left,h=this.top,i,j,k=c&&f.oldChartHeight||f.chartHeight,l=c&&f.oldChartWidth||f.chartWidth,m;i=this.transB;e=n(e,this.translate(a,null,null,c));a=c=w(e+i);i=j=w(k-e-i);if(isNaN(e))m=!0;else if(this.horiz){if(i=h,j=k-this.bottom,a<g||a>g+this.width)m=!0}else if(a=g,c=l-this.right,i<h||i>h+this.height)m=!0;return m&&!d?null:f.renderer.crispLine(["M",a,i,"L",c,j],b||1)},getLinearTickPositions:function(a,b,c){for(var d,b=aa(N(b/a)*a),c=aa(Ha(c/a)*a),e=[];b<=c;){e.push(b);b=aa(b+a);if(b===d)break;d=b}return e},getMinorTickPositions:function(){var a=this.options,b=this.tickPositions,c=this.minorTickInterval,d=[],e;if(this.isLog){e=b.length;for(a=1;a<e;a++)d=d.concat(this.getLogTickPositions(c,b[a-1],b[a],!0))}else if(this.isDatetimeAxis&&a.minorTickInterval==="auto")d=d.concat(this.getTimeTicks(this.normalizeTimeTickInterval(c),this.min,this.max,a.startOfWeek)),d[0]<this.min&&d.shift();else for(b=this.min+
(b[0]-this.min)%c;b<=this.max;b+=c)d.push(b);return d},adjustForMinRange:function(){var a=this.options,b=this.min,c=this.max,d,e=this.dataMax-this.dataMin>=this.minRange,f,g,h,i,j;if(this.isXAxis&&this.minRange===u&&!this.isLog)t(a.min)||t(a.max)?this.minRange=null:(p(this.series,function(a){i=a.xData;for(g=j=a.xIncrement?1:i.length-1;g>0;g--)if(h=i[g]-i[g-1],f===u||h<f)f=h}),this.minRange=I(f*5,this.dataMax-this.dataMin));if(c-b<this.minRange){var k=this.minRange;d=(k-c+b)/2;d=[b-d,n(a.min,b-d)];if(e)d[2]=this.dataMin;b=za(d);c=[b+k,n(a.max,b+k)];if(e)c[2]=this.dataMax;c=La(c);c-b<k&&(d[0]=c-k,d[1]=n(a.min,c-k),b=za(d))}this.min=b;this.max=c},setAxisTranslation:function(a){var b=this.max-this.min,c=0,d,e=0,f=0,g=this.linkedParent,h=!!this.categories,i=this.transA;if(this.isXAxis||h)g?(e=g.minPointOffset,f=g.pointRangePadding):p(this.series,function(a){var g=s(a.pointRange,+h),i=a.options.pointPlacement,m=a.closestPointRange;g>b&&(g=0);c=s(c,g);e=s(e,fa(i)?0:g/2);f=s(f,i==="on"?0:g);!a.noSharedTooltip&&t(m)&&(d=t(d)?I(d,m):m)}),g=this.ordinalSlope&&d?this.ordinalSlope/d:1,this.minPointOffset=e*=g,this.pointRangePadding=f*=g,this.pointRange=I(c,b),this.closestPointRange=d;if(a)this.oldTransA=i;this.translationSlope=this.transA=i=this.len/(b+f||1);this.transB=this.horiz?this.left:this.bottom;this.minPixelPadding=i*e},setTickPositions:function(a){var b=this,c=b.chart,d=b.options,e=b.isLog,f=b.isDatetimeAxis,g=b.isXAxis,h=b.isLinked,i=b.options.tickPositioner,j=d.maxPadding,k=d.minPadding,l=d.tickInterval,m=d.minTickInterval,q=d.tickPixelInterval,o,ma=b.categories;h?(b.linkedParent=c[b.coll][d.linkedTo],c=b.linkedParent.getExtremes(),b.min=n(c.min,c.dataMin),b.max=n(c.max,c.dataMax),d.type!==b.linkedParent.options.type&&ka(11,1)):(b.min=n(b.userMin,d.min,b.dataMin),b.max=n(b.userMax,d.max,b.dataMax));if(e)!a&&I(b.min,n(b.dataMin,b.min))<=0&&ka(10,1),b.min=aa(xa(b.min)),b.max=aa(xa(b.max));if(b.range&&t(b.max))b.userMin=b.min=s(b.min,b.max-b.range),b.userMax=b.max,b.range=null;b.beforePadding&&b.beforePadding();b.adjustForMinRange();if(!ma&&!b.usePercentage&&!h&&t(b.min)&&t(b.max)&&(c=b.max-b.min)){if(!t(d.min)&&!t(b.userMin)&&k&&(b.dataMin<0||!b.ignoreMinPadding))b.min-=c*k;if(!t(d.max)&&!t(b.userMax)&&j&&(b.dataMax>0||!b.ignoreMaxPadding))b.max+=c*j}b.min===b.max||b.min===void 0||b.max===void 0?b.tickInterval=1:h&&!l&&q===b.linkedParent.options.tickPixelInterval?b.tickInterval=b.linkedParent.tickInterval:(b.tickInterval=n(l,ma?1:(b.max-b.min)*q/s(b.len,q)),!t(l)&&b.len<q&&!this.isRadial&&!ma&&d.startOnTick&&d.endOnTick&&(o=!0,b.tickInterval/=4));g&&!a&&p(b.series,function(a){a.processData(b.min!==b.oldMin||b.max!==b.oldMax)});b.setAxisTranslation(!0);b.beforeSetTickPositions&&b.beforeSetTickPositions();if(b.postProcessTickInterval)b.tickInterval=b.postProcessTickInterval(b.tickInterval);if(b.pointRange)b.tickInterval=s(b.pointRange,b.tickInterval);if(!l&&b.tickInterval<m)b.tickInterval=m;if(!f&&!e&&!l)b.tickInterval=nb(b.tickInterval,null,mb(b.tickInterval),d);b.minorTickInterval=d.minorTickInterval==="auto"&&b.tickInterval?b.tickInterval/5:d.minorTickInterval;b.tickPositions=a=d.tickPositions?[].concat(d.tickPositions):i&&i.apply(b,[b.min,b.max]);if(!a)!b.ordinalPositions&&(b.max-b.min)/b.tickInterval>s(2*b.len,200)&&ka(19,!0),a=f?b.getTimeTicks(b.normalizeTimeTickInterval(b.tickInterval,d.units),b.min,b.max,d.startOfWeek,b.ordinalPositions,b.closestPointRange,!0):e?b.getLogTickPositions(b.tickInterval,b.min,b.max):b.getLinearTickPositions(b.tickInterval,b.min,b.max),o&&a.splice(1,a.length-2),b.tickPositions=a;if(!h)e=a[0],f=a[a.length-1],h=b.minPointOffset||0,d.startOnTick?b.min=e:b.min-h>e&&a.shift(),d.endOnTick?b.max=f:b.max+h<f&&a.pop(),a.length===1&&(b.min-=0.001,b.max+=0.001)},setMaxTicks:function(){var a=this.chart,b=a.maxTicks||{},c=this.tickPositions,d=this._maxTicksKey=[this.coll,this.pos,this.len].join("-");if(!this.isLinked&&!this.isDatetimeAxis&&c&&c.length>(b[d]||0)&&this.options.alignTicks!==!1)b[d]=c.length;a.maxTicks=b},adjustTickAmount:function(){var a=this._maxTicksKey,b=this.tickPositions,c=this.chart.maxTicks;if(c&&c[a]&&!this.isDatetimeAxis&&!this.categories&&!this.isLinked&&this.options.alignTicks!==!1&&this.min!==u){var d=this.tickAmount,e=b.length;this.tickAmount=a=c[a];if(e<a){for(;b.length<a;)b.push(aa(b[b.length-1]+this.tickInterval));this.transA*=(e-1)/(a-1);this.max=b[b.length-1]}if(t(d)&&a!==d)this.isDirty=!0}},setScale:function(){var a=this.stacks,b,c,d,e;this.oldMin=this.min;this.oldMax=this.max;this.oldAxisLength=this.len;this.setAxisSize();e=this.len!==this.oldAxisLength;p(this.series,function(a){if(a.isDirtyData||a.isDirty||a.xAxis.isDirty)d=!0});if(e||d||this.isLinked||this.forceRedraw||this.userMin!==this.oldUserMin||this.userMax!==this.oldUserMax){if(!this.isXAxis)for(b in a)for(c in a[b])a[b][c].total=null,a[b][c].cum=0;this.forceRedraw=!1;this.getSeriesExtremes();this.setTickPositions();this.oldUserMin=this.userMin;this.oldUserMax=this.userMax;if(!this.isDirty)this.isDirty=e||this.min!==this.oldMin||this.max!==this.oldMax}else if(!this.isXAxis){if(this.oldStacks)a=this.stacks=this.oldStacks;for(b in a)for(c in a[b])a[b][c].cum=a[b][c].total}this.setMaxTicks()},setExtremes:function(a,b,c,d,e){var f=this,g=f.chart,c=n(c,!0),e=r(e,{min:a,max:b});A(f,"setExtremes",e,function(){f.userMin=a;f.userMax=b;f.eventArgs=e;f.isDirtyExtremes=!0;c&&g.redraw(d)})},zoom:function(a,b){this.allowZoomOutside||(t(this.dataMin)&&a<=this.dataMin&&(a=u),t(this.dataMax)&&b>=this.dataMax&&(b=u));this.displayBtn=a!==u||b!==u;this.setExtremes(a,b,!1,u,{trigger:"zoom"});return!0},setAxisSize:function(){var a=this.chart,b=this.options,c=b.offsetLeft||0,d=b.offsetRight||0,e=this.horiz,f,g;this.left=g=n(b.left,a.plotLeft+c);this.top=f=n(b.top,a.plotTop);this.width=c=n(b.width,a.plotWidth-c+d);this.height=b=n(b.height,a.plotHeight);this.bottom=a.chartHeight-b-f;this.right=a.chartWidth-c-g;this.len=s(e?c:b,0);this.pos=e?g:f},getExtremes:function(){var a=this.isLog;return{min:a?aa(ga(this.min)):this.min,max:a?aa(ga(this.max)):this.max,dataMin:this.dataMin,dataMax:this.dataMax,userMin:this.userMin,userMax:this.userMax}},getThreshold:function(a){var b=this.isLog,c=b?ga(this.min):this.min,b=b?ga(this.max):this.max;c>a||a===null?a=c:b<a&&(a=b);return this.translate(a,0,1,0,1)},autoLabelAlign:function(a){a=(n(a,0)-this.side*90+720)%360;return a>15&&a<165?"right":a>195&&a<345?"left":"center"},getOffset:function(){var a=this,b=a.chart,c=b.renderer,d=a.options,e=a.tickPositions,f=a.ticks,g=a.horiz,h=a.side,i=b.inverted?[1,0,3,2][h]:h,j,k=0,l,m=0,q=d.title,o=d.labels,ma=0,H=b.axisOffset,w=b.clipOffset,r=[-1,1,1,-1][h],v,x=1,Z=n(o.maxStaggerLines,5),y,z,K,B;a.hasData=j=a.hasVisibleSeries||t(a.min)&&t(a.max)&&!!e;a.showAxis=b=j||n(d.showEmpty,!0);a.staggerLines=a.horiz&&o.staggerLines;if(!a.axisGroup)a.gridGroup=c.g("grid").attr({zIndex:d.gridZIndex||1}).add(),a.axisGroup=c.g("axis").attr({zIndex:d.zIndex||2}).add(),a.labelGroup=c.g("axis-labels").attr({zIndex:o.zIndex||7}).add();if(j||a.isLinked){a.labelAlign=n(o.align||a.autoLabelAlign(o.rotation));p(e,function(b){f[b]?f[b].addLabel():f[b]=new Qa(a,b)});if(a.horiz&&!a.staggerLines&&Z&&!o.rotation){for(v=a.reversed?[].concat(e).reverse():e;x<Z;){j=[];y=!1;for(o=0;o<v.length;o++)z=v[o],K=(K=f[z].label&&f[z].label.getBBox())?K.width:0,B=o%x,K&&(z=a.translate(z),j[B]!==u&&z<j[B]&&(y=!0),j[B]=z+K);if(y)x++;else break}if(x>1)a.staggerLines=x}p(e,function(b){if(h===0||h===2||{1:"left",3:"right"}[h]===a.labelAlign)ma=s(f[b].getLabelSize(),ma)});if(a.staggerLines)ma*=a.staggerLines,a.labelOffset=ma}else for(v in f)f[v].destroy(),delete f[v];if(q&&q.text&&q.enabled!==!1){if(!a.axisTitle)a.axisTitle=c.text(q.text,0,0,q.useHTML).attr({zIndex:7,rotation:q.rotation||0,align:q.textAlign||{low:"left",middle:"center",high:"right"}[q.align]}).css(q.style).add(a.axisGroup),a.axisTitle.isNew=!0;if(b)k=a.axisTitle.getBBox()[g?"height":"width"],m=n(q.margin,g?5:10),l=q.offset;a.axisTitle[b?"show":"hide"]()}a.offset=r*n(d.offset,H[h]);a.axisTitleMargin=n(l,ma+m+(h!==2&&ma&&r*d.labels[g?"y":"x"]));H[h]=s(H[h],a.axisTitleMargin+k+r*a.offset);w[i]=s(w[i],N(d.lineWidth/2)*2)},getLinePath:function(a){var b=this.chart,c=this.opposite,d=this.offset,e=this.horiz,f=this.left+(c?this.width:0)+d,d=b.chartHeight-this.bottom-(c?this.height:0)+d;c&&(a*=-1);return b.renderer.crispLine(["M",e?this.left:f,e?d:this.top,"L",e?b.chartWidth-this.right:f,e?d:b.chartHeight-this.bottom],a)},getTitlePosition:function(){var a=this.horiz,b=this.left,c=this.top,d=this.len,e=this.options.title,f=a?b:c,g=this.opposite,h=this.offset,i=z(e.style.fontSize||12),d={low:f+(a?0:d),middle:f+d/2,high:f+
(a?d:0)}[e.align],b=(a?c+this.height:b)+(a?1:-1)*(g?-1:1)*this.axisTitleMargin+(this.side===2?i:0);return{x:a?d:b+(g?this.width:0)+h+(e.x||0),y:a?b-(g?this.height:0)+h:d+(e.y||0)}},render:function(){var a=this,b=a.horiz,c=a.reversed,d=a.chart,e=d.renderer,f=a.options,g=a.isLog,h=a.isLinked,i=a.tickPositions,j,k=a.axisTitle,l=a.stacks,m=a.ticks,q=a.minorTicks,o=a.alternateBands,n=f.stackLabels,H=f.alternateGridColor,s=a.tickmarkOffset,r=f.lineWidth,w=d.hasRendered&&t(a.oldMin)&&!isNaN(a.oldMin),v=a.hasData,x=a.showAxis,y,z=a.justifyLabels=!a.staggerLines&&b&&f.labels.overflow==="justify",K;a.labelEdge.length=0;p([m,q,o],function(a){for(var b in a)a[b].isActive=!1});if(v||h)if(a.minorTickInterval&&!a.categories&&p(a.getMinorTickPositions(),function(b){q[b]||(q[b]=new Qa(a,b,"minor"));w&&q[b].isNew&&q[b].render(null,!0);q[b].render(null,!1,1)}),i.length&&(j=i.slice(),(b&&c||!b&&!c)&&j.reverse(),z&&(j=j.slice(1).concat([j[0]])),p(j,function(b,c){z&&(c=c===j.length-1?0:c+1);if(!h||b>=a.min&&b<=a.max)m[b]||(m[b]=new Qa(a,b)),w&&m[b].isNew&&m[b].render(c,!0,0.1),m[b].render(c,!1,1)}),s&&a.min===0&&(m[-1]||(m[-1]=new Qa(a,-1,null,!0)),m[-1].render(-1))),H&&p(i,function(b,c){if(c%2===0&&b<a.max)o[b]||(o[b]=new yb(a)),y=b+s,K=i[c+1]!==u?i[c+1]+s:a.max,o[b].options={from:g?ga(y):y,to:g?ga(K):K,color:H},o[b].render(),o[b].isActive=!0}),!a._addedPlotLB)p((f.plotLines||[]).concat(f.plotBands||[]),function(b){a.addPlotBandOrLine(b)}),a._addedPlotLB=!0;p([m,q,o],function(a){var b,c,e=[],f=oa?oa.duration||500:0,g=function(){for(c=e.length;c--;)a[e[c]]&&!a[e[c]].isActive&&(a[e[c]].destroy(),delete a[e[c]])};for(b in a)if(!a[b].isActive)a[b].render(b,!1,0),a[b].isActive=!1,e.push(b);a===o||!d.hasRendered||!f?g():f&&setTimeout(g,f)});if(r)b=a.getLinePath(r),a.axisLine?a.axisLine.animate({d:b}):a.axisLine=e.path(b).attr({stroke:f.lineColor,"stroke-width":r,zIndex:7}).add(a.axisGroup),a.axisLine[x?"show":"hide"]();if(k&&x)k[k.isNew?"attr":"animate"](a.getTitlePosition()),k.isNew=!1;if(n&&n.enabled){var B,A,f=a.stackTotalGroup;if(!f)a.stackTotalGroup=f=e.g("stack-labels").attr({visibility:"visible",zIndex:6}).add();f.translate(d.plotLeft,d.plotTop);for(B in l)for(A in e=l[B],e)e[A].render(f)}a.isDirty=!1},redraw:function(){var a=this.chart.pointer;a.reset&&a.reset(!0);this.render();p(this.plotLinesAndBands,function(a){a.render()});p(this.series,function(a){a.isDirty=!0})},buildStacks:function(){var a=this.series,b=a.length;if(!this.isXAxis){for(;b--;)a[b].setStackedPoints();if(this.usePercentage)for(b=0;b<a.length;b++)a[b].setPercentStacks()}},destroy:function(a){var b=this,c=b.stacks,d,e=b.plotLinesAndBands;a||X(b);for(d in c)Ma(c[d]),c[d]=null;p([b.ticks,b.minorTicks,b.alternateBands],function(a){Ma(a)});for(a=e.length;a--;)e[a].destroy();p("stackTotalGroup,axisLine,axisTitle,axisGroup,cross,gridGroup,labelGroup".split(","),function(a){b[a]&&(b[a]=b[a].destroy())});this.cross&&this.cross.destroy()},drawCrosshair:function(a,b){if(this.crosshair)if((t(b)||!n(this.crosshair.snap,!0))===!1)this.hideCrosshair();else{var c,d=this.crosshair,e=d.animation;n(d.snap,!0)?t(b)&&(c=this.chart.inverted!=this.horiz?b.plotX:this.len-b.plotY):c=this.horiz?a.chartX-this.pos:this.len-a.chartY+this.pos;c=this.isRadial?this.getPlotLinePath(this.isXAxis?b.x:n(b.stackY,b.y)):this.getPlotLinePath(null,null,null,null,c);if(c===null)this.hideCrosshair();else if(this.cross)this.cross.attr({visibility:"visible"})[e?"animate":"attr"]({d:c},e);else{e={"stroke-width":d.width||1,stroke:d.color||"#C0C0C0",zIndex:d.zIndex||2};if(d.dashStyle)e.dashstyle=d.dashStyle;this.cross=this.chart.renderer.path(c).attr(e).add()}}},hideCrosshair:function(){this.cross&&this.cross.hide()}};r(qa.prototype,{getPlotBandPath:function(a,b){var c=this.getPlotLinePath(b),d=this.getPlotLinePath(a);d&&c?d.push(c[4],c[5],c[1],c[2]):d=null;return d},addPlotBand:function(a){this.addPlotBandOrLine(a,"plotBands")},addPlotLine:function(a){this.addPlotBandOrLine(a,"plotLines")},addPlotBandOrLine:function(a,b){var c=(new yb(this,a)).render(),d=this.userOptions;c&&(b&&(d[b]=d[b]||[],d[b].push(a)),this.plotLinesAndBands.push(c));return c},removePlotBandOrLine:function(a){for(var b=this.plotLinesAndBands,c=this.options,d=this.userOptions,e=b.length;e--;)b[e].id===a&&b[e].destroy();p([c.plotLines||[],d.plotLines||[],c.plotBands||[],d.plotBands||[]],function(b){for(e=b.length;e--;)b[e].id===a&&ha(b,b[e])})}});qa.prototype.getLogTickPositions=function(a,b,c,d){var e=this.options,f=this.len,g=[];if(!d)this._minorAutoInterval=null;if(a>=0.5)a=w(a),g=this.getLinearTickPositions(a,b,c);else if(a>=0.08)for(var f=N(b),h,i,j,k,l,e=a>0.3?[1,2,4]:a>0.15?[1,2,4,6,8]:[1,2,3,4,5,6,7,8,9];f<c+1&&!l;f++){i=e.length;for(h=0;h<i&&!l;h++)j=xa(ga(f)*e[h]),j>b&&(!d||k<=c)&&g.push(k),k>c&&(l=!0),k=j}else if(b=ga(b),c=ga(c),a=e[d?"minorTickInterval":"tickInterval"],a=n(a==="auto"?null:a,this._minorAutoInterval,(c-b)*(e.tickPixelInterval/(d?5:1))/((d?f/this.tickPositions.length:f)||1)),a=nb(a,null,mb(a)),g=Ra(this.getLinearTickPositions(a,b,c),xa),!d)this._minorAutoInterval=a/5;if(!d)this.tickInterval=a;return g};qa.prototype.getTimeTicks=function(a,b,c,d){var e=[],f={},g=G.global.useUTC,h,i=new Date(b-Pa),j=a.unitRange,k=a.count;if(t(b)){j>=E.second&&(i.setMilliseconds(0),i.setSeconds(j>=E.minute?0:k*N(i.getSeconds()/k)));if(j>=E.minute)i[Cb](j>=E.hour?0:k*N(i[pb]()/k));if(j>=E.hour)i[Db](j>=E.day?0:k*N(i[qb]()/k));if(j>=E.day)i[sb](j>=E.month?1:k*N(i[Wa]()/k));j>=E.month&&(i[Eb](j>=E.year?0:k*N(i[db]()/k)),h=i[eb]());j>=E.year&&(h-=h%k,i[Fb](h));if(j===E.week)i[sb](i[Wa]()-i[rb]()+n(d,1));b=1;Pa&&(i=new Date(i.getTime()+Pa));h=i[eb]();for(var d=i.getTime(),l=i[db](),m=i[Wa](),q=g?Pa:(864E5+i.getTimezoneOffset()*6E4)%864E5;d<c;)e.push(d),j===E.year?d=cb(h+b*k,0):j===E.month?d=cb(h,l+b*k):!g&&(j===E.day||j===E.week)?d=cb(h,l,m+b*k*(j===E.day?1:7)):d+=j*k,b++;e.push(d);p(wb(e,function(a){return j<=E.hour&&a%E.day===q}),function(a){f[a]="day"})}e.info=r(a,{higherRanks:f,totalRange:j*k});return e};qa.prototype.normalizeTimeTickInterval=function(a,b){var c=b||[["millisecond",[1,2,5,10,20,25,50,100,200,500]],["second",[1,2,5,10,15,30]],["minute",[1,2,5,10,15,30]],["hour",[1,2,3,4,6,8,12]],["day",[1,2]],["week",[1,2]],["month",[1,2,3,4,6]],["year",null]],d=c[c.length-1],e=E[d[0]],f=d[1],g;for(g=0;g<c.length;g++)if(d=c[g],e=E[d[0]],f=d[1],c[g+1]&&a<=(e*f[f.length-1]+E[c[g+1][0]])/2)break;e===E.year&&a<5*e&&(f=[1,2,5]);c=nb(a/e,f,d[0]==="year"?s(mb(a/e),1):1);return{unitRange:e,count:c,unitName:d[0]}};Gb.prototype={destroy:function(){Ma(this,this.axis)},render:function(a){var b=this.options,c=b.format,c=c?Fa(c,this):b.formatter.call(this);this.label?this.label.attr({text:c,visibility:"hidden"}):this.label=this.axis.chart.renderer.text(c,0,0,b.useHTML).css(b.style).attr({align:this.textAlign,rotation:b.rotation,visibility:"hidden"}).add(a)},setOffset:function(a,b){var c=this.axis,d=c.chart,e=d.inverted,f=this.isNegative,g=c.translate(this.percent?100:this.total,0,0,0,1),c=c.translate(0),c=M(g-c),h=d.xAxis[0].translate(this.x)+a,i=d.plotHeight,f={x:e?f?g:g-c:h,y:e?i-h-b:f?i-g-c:i-g,width:e?c:b,height:e?b:c};if(e=this.label)e.align(this.alignOptions,null,f),f=e.alignAttr,e.attr({visibility:this.options.crop===!1||d.isInsidePlot(f.x,f.y)?V?"inherit":"visible":"hidden"})}};tb.prototype={init:function(a,b){var c=b.borderWidth,d=b.style,e=z(d.padding);this.chart=a;this.options=b;this.crosshairs=[];this.now={x:0,y:0};this.isHidden=!0;this.label=a.renderer.label("",0,0,b.shape,null,null,b.useHTML,null,"tooltip").attr({padding:e,fill:b.backgroundColor,"stroke-width":c,r:b.borderRadius,zIndex:8}).css(d).css({padding:0}).add().attr({y:-999});da||this.label.shadow(b.shadow);this.shared=b.shared},destroy:function(){if(this.label)this.label=this.label.destroy();clearTimeout(this.hideTimer);clearTimeout(this.tooltipTimeout)},move:function(a,b,c,d){var e=this,f=e.now,g=e.options.animation!==!1&&!e.isHidden;r(f,{x:g?(2*f.x+a)/3:a,y:g?(f.y+b)/2:b,anchorX:g?(2*f.anchorX+c)/3:c,anchorY:g?(f.anchorY+d)/2:d});e.label.attr(f);if(g&&(M(a-f.x)>1||M(b-f.y)>1))clearTimeout(this.tooltipTimeout),this.tooltipTimeout=setTimeout(function(){e&&e.move(a,b,c,d)},32)},hide:function(){var a=this,b;clearTimeout(this.hideTimer);if(!this.isHidden)b=this.chart.hoverPoints,this.hideTimer=setTimeout(function(){a.label.fadeOut();a.isHidden=!0},n(this.options.hideDelay,500)),b&&p(b,function(a){a.setState()}),this.chart.hoverPoints=null},getAnchor:function(a,b){var c,d=this.chart,e=d.inverted,f=d.plotTop,g=0,h=0,i,a=ja(a);c=a[0].tooltipPos;this.followPointer&&b&&(b.chartX===u&&(b=d.pointer.normalize(b)),c=[b.chartX-d.plotLeft,b.chartY-f]);c||(p(a,function(a){i=a.series.yAxis;g+=a.plotX;h+=(a.plotLow?(a.plotLow+a.plotHigh)/2:a.plotY)+(!e&&i?i.top-f:0)}),g/=a.length,h/=a.length,c=[e?d.plotWidth-h:g,this.shared&&!e&&a.length>1&&b?b.chartY-f:e?d.plotHeight-g:h]);return Ra(c,w)},getPosition:function(a,b,c){var d=this.chart,e=d.plotLeft,f=d.plotTop,g=d.plotWidth,h=d.plotHeight,i=n(this.options.distance,12),j=c.plotX,c=c.plotY,d=j+e+(d.inverted?i:-a-i),k=c-b+f+15,l;d<7&&(d=e+s(j,0)+i);d+a>e+g&&(d-=d+a-(e+g),k=c-b+f-i,l=!0);k<f+5&&(k=f+5,l&&c>=k&&c<=k+b&&(k=c+
f+i));k+b>f+h&&(k=s(f,f+h-b-i));return{x:d,y:k}},defaultFormatter:function(a){var b=this.points||ja(this),c=b[0].series,d;d=[c.tooltipHeaderFormatter(b[0])];p(b,function(a){c=a.series;d.push(c.tooltipFormatter&&c.tooltipFormatter(a)||a.point.tooltipFormatter(c.tooltipOptions.pointFormat))});d.push(a.options.footerFormat||"");return d.join("")},refresh:function(a,b){var c=this.chart,d=this.label,e=this.options,f,g,h={},i,j=[];i=e.formatter||this.defaultFormatter;var h=c.hoverPoints,k,l=this.shared;clearTimeout(this.hideTimer);this.followPointer=ja(a)[0].series.tooltipOptions.followPointer;g=this.getAnchor(a,b);f=g[0];g=g[1];l&&(!a.series||!a.series.noSharedTooltip)?(c.hoverPoints=a,h&&p(h,function(a){a.setState()}),p(a,function(a){a.setState("hover");j.push(a.getLabelConfig())}),h={x:a[0].category,y:a[0].y},h.points=j,a=a[0]):h=a.getLabelConfig();i=i.call(h,this);h=a.series;i===!1?this.hide():(this.isHidden&&(Za(d),d.attr("opacity",1).show()),d.attr({text:i}),k=e.borderColor||a.color||h.color||"#606060",d.attr({stroke:k}),this.updatePosition({plotX:f,plotY:g}),this.isHidden=!1);A(c,"tooltipRefresh",{text:i,x:f+c.plotLeft,y:g+c.plotTop,borderColor:k})},updatePosition:function(a){var b=this.chart,c=this.label,c=(this.options.positioner||this.getPosition).call(this,c.width,c.height,a);this.move(w(c.x),w(c.y),a.plotX+b.plotLeft,a.plotY+b.plotTop)}};var $a=Highcharts.Pointer=function(a,b){this.init(a,b)};$a.prototype={init:function(a,b){var c=b.chart,d=c.events,e=da?"":c.zoomType,c=a.inverted,f;this.options=b;this.chart=a;this.zoomX=f=/x/.test(e);this.zoomY=e=/y/.test(e);this.zoomHor=f&&!c||e&&c;this.zoomVert=e&&!c||f&&c;this.runChartClick=d&&!!d.click;this.pinchDown=[];this.lastValidTouch={};if(b.tooltip.enabled)a.tooltip=new tb(a,b.tooltip);this.setDOMEvents()},normalize:function(a,b){var c,d,a=a||C.event;if(!a.target)a.target=a.srcElement;a=Rb(a);d=a.touches?a.touches.item(0):a;if(!b)this.chartPosition=b=Qb(this.chart.container);d.pageX===u?(c=s(a.x,a.clientX-b.left),d=a.y):(c=d.pageX-
b.left,d=d.pageY-b.top);return r(a,{chartX:w(c),chartY:w(d)})},getCoordinates:function(a){var b={xAxis:[],yAxis:[]};p(this.chart.axes,function(c){b[c.isXAxis?"xAxis":"yAxis"].push({axis:c,value:c.toValue(a[c.horiz?"chartX":"chartY"])})});return b},getIndex:function(a){var b=this.chart;return b.inverted?b.plotHeight+b.plotTop-a.chartY:a.chartX-b.plotLeft},runPointActions:function(a){var b=this,c=b.chart,d=c.series,e=c.tooltip,f,g,h=c.hoverPoint,i=c.hoverSeries,j,k,l=c.chartWidth,m=b.getIndex(a);if(e&&b.options.tooltip.shared&&(!i||!i.noSharedTooltip)){g=[];j=d.length;for(k=0;k<j;k++)if(d[k].visible&&d[k].options.enableMouseTracking!==!1&&!d[k].noSharedTooltip&&d[k].tooltipPoints.length&&(f=d[k].tooltipPoints[m])&&f.series)f._dist=M(m-f.clientX),l=I(l,f._dist),g.push(f);for(j=g.length;j--;)g[j]._dist>l&&g.splice(j,1);if(g.length&&g[0].clientX!==b.hoverX)e.refresh(g,a),b.hoverX=g[0].clientX}if(i&&i.tracker){if((f=i.tooltipPoints[m])&&f!==h)f.onMouseOver(a)}else e&&e.followPointer&&!e.isHidden&&(d=e.getAnchor([{}],a),e.updatePosition({plotX:d[0],plotY:d[1]}));if(e&&!b._onDocumentMouseMove)b._onDocumentMouseMove=function(a){b.onDocumentMouseMove(a)},F(y,"mousemove",b._onDocumentMouseMove);p(c.axes,function(b){b.drawCrosshair(a,n(f,h))})},reset:function(a){var b=this.chart,c=b.hoverSeries,d=b.hoverPoint,e=b.tooltip,f=e&&e.shared?b.hoverPoints:d;(a=a&&e&&f)&&ja(f)[0].plotX===u&&(a=!1);if(a)e.refresh(f),d&&d.setState(d.state,!0);else{if(d)d.onMouseOut();if(c)c.onMouseOut();e&&e.hide();if(this._onDocumentMouseMove)X(y,"mousemove",this._onDocumentMouseMove),this._onDocumentMouseMove=null;p(b.axes,function(a){a.hideCrosshair()});this.hoverX=null}},scaleGroups:function(a,b){var c=this.chart,d;p(c.series,function(e){d=a||e.getPlotBox();e.xAxis&&e.xAxis.zoomEnabled&&(e.group.attr(d),e.markerGroup&&(e.markerGroup.attr(d),e.markerGroup.clip(b?c.clipRect:null)),e.dataLabelsGroup&&e.dataLabelsGroup.attr(d))});c.clipRect.attr(b||c.clipBox)},pinchTranslate:function(a,b,c,d,e,f,g,h){a&&this.pinchTranslateDirection(!0,c,d,e,f,g,h);b&&this.pinchTranslateDirection(!1,c,d,e,f,g,h)},pinchTranslateDirection:function(a,b,c,d,e,f,g,h){var i=this.chart,j=a?"x":"y",k=a?"X":"Y",l="chart"+k,m=a?"width":"height",q=i["plot"+(a?"Left":"Top")],o,n,p=h||1,s=i.inverted,t=i.bounds[a?"h":"v"],r=b.length===1,w=b[0][l],u=c[0][l],v=!r&&b[1][l],x=!r&&c[1][l],y,c=function(){!r&&M(w-v)>20&&(p=h||M(u-x)/M(w-v));n=(q-u)/p+w;o=i["plot"+(a?"Width":"Height")]/p};c();b=n;b<t.min?(b=t.min,y=!0):b+o>t.max&&(b=t.max-o,y=!0);y?(u-=0.8*(u-g[j][0]),r||(x-=0.8*(x-g[j][1])),c()):g[j]=[u,x];s||(f[j]=n-q,f[m]=o);f=s?1/p:p;e[m]=o;e[j]=b;d[s?a?"scaleY":"scaleX":"scale"+k]=p;d["translate"+k]=f*q+(u-f*w)},pinch:function(a){var b=this,c=b.chart,d=b.pinchDown,e=c.tooltip&&c.tooltip.options.followTouchMove,f=a.touches,g=f.length,h=b.lastValidTouch,i=b.zoomHor||b.pinchHor,j=b.zoomVert||b.pinchVert,k=i||j,l=b.selectionMarker,m={},q=g===1&&(b.inClass(a.target,"highcharts-tracker")&&c.runTrackerClick||c.runChartClick),o={};(k||e)&&!q&&a.preventDefault();Ra(f,function(a){return b.normalize(a)});if(a.type==="touchstart")p(f,function(a,b){d[b]={chartX:a.chartX,chartY:a.chartY}}),h.x=[d[0].chartX,d[1]&&d[1].chartX],h.y=[d[0].chartY,d[1]&&d[1].chartY],p(c.axes,function(a){if(a.zoomEnabled){var b=c.bounds[a.horiz?"h":"v"],d=a.minPixelPadding,e=a.toPixels(a.dataMin),f=a.toPixels(a.dataMax),g=I(e,f),e=s(e,f);b.min=I(a.pos,g-d);b.max=s(a.pos+a.len,e+d)}});else if(d.length){if(!l)b.selectionMarker=l=r({destroy:la},c.plotBox);b.pinchTranslate(i,j,d,f,m,l,o,h);b.hasPinched=k;b.scaleGroups(m,o);!k&&e&&g===1&&this.runPointActions(b.normalize(a))}},dragStart:function(a){var b=this.chart;b.mouseIsDown=a.type;b.cancelClick=!1;b.mouseDownX=this.mouseDownX=a.chartX;b.mouseDownY=this.mouseDownY=a.chartY},drag:function(a){var b=this.chart,c=b.options.chart,d=a.chartX,e=a.chartY,f=this.zoomHor,g=this.zoomVert,h=b.plotLeft,i=b.plotTop,j=b.plotWidth,k=b.plotHeight,l,m=this.mouseDownX,q=this.mouseDownY;d<h?d=h:d>h+j&&(d=h+j);e<i?e=i:e>i+k&&(e=i+k);this.hasDragged=Math.sqrt(Math.pow(m-
d,2)+Math.pow(q-e,2));if(this.hasDragged>10){l=b.isInsidePlot(m-h,q-i);if(b.hasCartesianSeries&&(this.zoomX||this.zoomY)&&l&&!this.selectionMarker)this.selectionMarker=b.renderer.rect(h,i,f?1:j,g?1:k,0).attr({fill:c.selectionMarkerFill||"rgba(69,114,167,0.25)",zIndex:7}).add();this.selectionMarker&&f&&(d-=m,this.selectionMarker.attr({width:M(d),x:(d>0?0:d)+m}));this.selectionMarker&&g&&(d=e-q,this.selectionMarker.attr({height:M(d),y:(d>0?0:d)+q}));l&&!this.selectionMarker&&c.panning&&b.pan(a,c.panning)}},drop:function(a){var b=this.chart,c=this.hasPinched;if(this.selectionMarker){var d={xAxis:[],yAxis:[],originalEvent:a.originalEvent||a},e=this.selectionMarker,f=e.x,g=e.y,h;if(this.hasDragged||c)p(b.axes,function(a){if(a.zoomEnabled){var b=a.horiz,c=a.toValue(b?f:g),b=a.toValue(b?f+e.width:g+e.height);!isNaN(c)&&!isNaN(b)&&(d[a.coll].push({axis:a,min:I(c,b),max:s(c,b)}),h=!0)}}),h&&A(b,"selection",d,function(a){b.zoom(r(a,c?{animation:!1}:null))});this.selectionMarker=this.selectionMarker.destroy();c&&this.scaleGroups()}if(b)D(b.container,{cursor:b._cursor}),b.cancelClick=this.hasDragged>10,b.mouseIsDown=this.hasDragged=this.hasPinched=!1,this.pinchDown=[]},onContainerMouseDown:function(a){a=this.normalize(a);a.preventDefault&&a.preventDefault();this.dragStart(a)},onDocumentMouseUp:function(a){this.drop(a)},onDocumentMouseMove:function(a){var b=this.chart,c=this.chartPosition,d=b.hoverSeries,a=this.normalize(a,c);c&&d&&!this.inClass(a.target,"highcharts-tracker")&&!b.isInsidePlot(a.chartX-b.plotLeft,a.chartY-b.plotTop)&&this.reset()},onContainerMouseLeave:function(){this.reset();this.chartPosition=null},onContainerMouseMove:function(a){var b=this.chart,a=this.normalize(a);b.mouseIsDown==="mousedown"&&this.drag(a);(this.inClass(a.target,"highcharts-tracker")||b.isInsidePlot(a.chartX-b.plotLeft,a.chartY-b.plotTop))&&!b.openMenu&&this.runPointActions(a)},inClass:function(a,b){for(var c;a;){if(c=v(a,"class"))if(c.indexOf(b)!==-1)return!0;else if(c.indexOf("highcharts-container")!==-1)return!1;a=a.parentNode}},onTrackerMouseOut:function(a){var b=this.chart.hoverSeries,c=(a=a.relatedTarget||a.toElement)&&a.point&&a.point.series;if(b&&!b.options.stickyTracking&&!this.inClass(a,"highcharts-tooltip")&&c!==b)b.onMouseOut()},onContainerClick:function(a){var b=this.chart,c=b.hoverPoint,d=b.plotLeft,e=b.plotTop,f=b.inverted,g,h,i,a=this.normalize(a);a.cancelBubble=!0;if(!b.cancelClick)c&&this.inClass(a.target,"highcharts-tracker")?(g=this.chartPosition,h=c.plotX,i=c.plotY,r(c,{pageX:g.left+d+(f?b.plotWidth-i:h),pageY:g.top+e+(f?b.plotHeight-h:i)}),A(c.series,"click",r(a,{point:c})),b.hoverPoint&&c.firePointEvent("click",a)):(r(a,this.getCoordinates(a)),b.isInsidePlot(a.chartX-d,a.chartY-e)&&A(b,"click",a))},onContainerTouchStart:function(a){var b=this.chart;a.touches.length===1?(a=this.normalize(a),b.isInsidePlot(a.chartX-b.plotLeft,a.chartY-b.plotTop)?(this.runPointActions(a),this.pinch(a)):this.reset()):a.touches.length===2&&this.pinch(a)},onContainerTouchMove:function(a){(a.touches.length===1||a.touches.length===2)&&this.pinch(a)},onDocumentTouchEnd:function(a){this.drop(a)},setDOMEvents:function(){var a=this,b=a.chart.container,c;this._events=c=[[b,"onmousedown","onContainerMouseDown"],[b,"onmousemove","onContainerMouseMove"],[b,"onclick","onContainerClick"],[b,"mouseleave","onContainerMouseLeave"],[y,"mouseup","onDocumentMouseUp"]];ib&&c.push([b,"ontouchstart","onContainerTouchStart"],[b,"ontouchmove","onContainerTouchMove"],[y,"touchend","onDocumentTouchEnd"]);p(c,function(b){a["_"+
b[2]]=function(c){a[b[2]](c)};b[1].indexOf("on")===0?b[0][b[1]]=a["_"+b[2]]:F(b[0],b[1],a["_"+b[2]])})},destroy:function(){var a=this;p(a._events,function(b){b[1].indexOf("on")===0?b[0][b[1]]=null:X(b[0],b[1],a["_"+b[2]])});delete a._events;clearInterval(a.tooltipTimeout)}};J=Highcharts.TrackerMixin={drawTrackerPoint:function(){var a=this,b=a.chart,c=b.pointer,d=a.options.cursor,e=d&&{cursor:d},f=function(c){var d=c.target,e;if(b.hoverSeries!==a)a.onMouseOver();for(;d&&!e;)e=d.point,d=d.parentNode;if(e!==u&&e!==b.hoverPoint)e.onMouseOver(c)};p(a.points,function(a){if(a.graphic)a.graphic.element.point=a;if(a.dataLabel)a.dataLabel.element.point=a});if(!a._hasTracking)p(a.trackerGroups,function(b){if(a[b]&&(a[b].addClass("highcharts-tracker").on("mouseover",f).on("mouseout",function(a){c.onTrackerMouseOut(a)}).css(e),ib))a[b].on("touchstart",f)}),a._hasTracking=!0},drawTrackerGraph:function(){var a=this,b=a.options,c=b.trackByArea,d=[].concat(c?a.areaPath:a.graphPath),e=d.length,f=a.chart,g=f.pointer,h=f.renderer,i=f.options.tooltip.snap,j=a.tracker,k=b.cursor,l=k&&{cursor:k},k=a.singlePoints,m,q=function(){if(f.hoverSeries!==a)a.onMouseOver()};if(e&&!c)for(m=e+1;m--;)d[m]==="M"&&d.splice(m+1,0,d[m+1]-i,d[m+2],"L"),(m&&d[m]==="M"||m===e)&&d.splice(m,0,"L",d[m-2]+i,d[m-1]);for(m=0;m<k.length;m++)e=k[m],d.push("M",e.plotX-i,e.plotY,"L",e.plotX+i,e.plotY);j?j.attr({d:d}):(a.tracker=h.path(d).attr({"stroke-linejoin":"round",visibility:a.visible?"visible":"hidden",stroke:Kb,fill:c?Kb:Q,"stroke-width":b.lineWidth+
(c?0:2*i),zIndex:2}).add(a.group),p([a.tracker,a.markerGroup],function(a){a.addClass("highcharts-tracker").on("mouseover",q).on("mouseout",function(a){g.onTrackerMouseOut(a)}).css(l);if(ib)a.on("touchstart",q)}))}};if(C.PointerEvent||C.MSPointerEvent){var na={};$a.prototype.getWebkitTouches=function(){var a,b=[];b.item=function(a){return this[a]};for(a in na)na.hasOwnProperty(a)&&b.push({pageX:na[a].pageX,pageY:na[a].pageY,target:na[a].target});return b};Va($a.prototype,"init",function(a,b,c){b.container.style["-ms-touch-action"]=b.container.style["touch-action"]="none";a.call(this,b,c)});Va($a.prototype,"setDOMEvents",function(a){var b=this;a.apply(this,Array.prototype.slice.call(arguments,1));p([[this.chart.container,"PointerDown","touchstart","onContainerTouchStart",function(a){na[a.pointerId]={pageX:a.pageX,pageY:a.pageY,target:a.currentTarget}}],[this.chart.container,"PointerMove","touchmove","onContainerTouchMove",function(a){na[a.pointerId]={pageX:a.pageX,pageY:a.pageY};if(!na[a.pointerId].target)na[a.pointerId].target=a.currentTarget}],[document,"PointerUp","touchend","onDocumentTouchEnd",function(a){delete na[a.pointerId]}]],function(a){F(a[0],window.PointerEvent?a[1].toLowerCase():"MS"+a[1],function(d){d=d.originalEvent;if(d.pointerType==="touch"||d.pointerType===d.MSPOINTER_TYPE_TOUCH)a[4](d),b[a[3]]({type:a[2],target:d.currentTarget,preventDefault:la,touches:b.getWebkitTouches()})})})})}var zb=Highcharts.Legend=function(a,b){this.init(a,b)};zb.prototype={init:function(a,b){var c=this,d=b.itemStyle,e=n(b.padding,8),f=b.itemMarginTop||0;this.options=b;if(b.enabled)c.baseline=z(d.fontSize)+3+f,c.itemStyle=d,c.itemHiddenStyle=x(d,b.itemHiddenStyle),c.itemMarginTop=f,c.padding=e,c.initialItemX=e,c.initialItemY=e-5,c.maxItemWidth=0,c.chart=a,c.itemHeight=0,c.lastLineHeight=0,c.symbolWidth=n(b.symbolWidth,16),c.pages=[],c.render(),F(c.chart,"endResize",function(){c.positionCheckboxes()})},colorizeItem:function(a,b){var c=this.options,d=a.legendItem,e=a.legendLine,f=a.legendSymbol,g=this.itemHiddenStyle.color,c=b?c.itemStyle.color:g,h=b?a.legendColor||a.color:g,g=a.options&&a.options.marker,i={stroke:h,fill:h},j;d&&d.css({fill:c,color:c});e&&e.attr({stroke:h});if(f){if(g&&f.isMarker)for(j in g=a.convertAttribs(g),g)d=g[j],d!==u&&(i[j]=d);f.attr(i)}},positionItem:function(a){var b=this.options,c=b.symbolPadding,b=!b.rtl,d=a._legendItemPos,e=d[0],d=d[1],f=a.checkbox;a.legendGroup&&a.legendGroup.translate(b?e:this.legendWidth-e-2*c-4,d);if(f)f.x=e,f.y=d},destroyItem:function(a){var b=a.checkbox;p(["legendItem","legendLine","legendSymbol","legendGroup"],function(b){a[b]&&(a[b]=a[b].destroy())});b&&Na(a.checkbox)},destroy:function(){var a=this.group,b=this.box;if(b)this.box=b.destroy();if(a)this.group=a.destroy()},positionCheckboxes:function(a){var b=this.group.alignAttr,c,d=this.clipHeight||this.legendHeight;if(b)c=b.translateY,p(this.allItems,function(e){var f=e.checkbox,g;f&&(g=c+f.y+(a||0)+3,D(f,{left:b.translateX+e.legendItemWidth+f.x-20+"px",top:g+"px",display:g>c-6&&g<c+d-6?"":Q}))})},renderTitle:function(){var a=this.padding,b=this.options.title,c=0;if(b.text){if(!this.title)this.title=this.chart.renderer.label(b.text,a-3,a-4,null,null,null,null,null,"legend-title").attr({zIndex:1}).css(b.style).add(this.group);a=this.title.getBBox();c=a.height;this.offsetWidth=a.width;this.contentGroup.attr({translateY:c})}this.titleHeight=c},renderItem:function(a){var B;var b=this,c=b.chart,d=c.renderer,e=b.options,f=e.layout==="horizontal",g=b.symbolWidth,h=e.symbolPadding,i=b.itemStyle,j=b.itemHiddenStyle,k=b.padding,l=f?n(e.itemDistance,8):0,m=!e.rtl,q=e.width,o=e.itemMarginBottom||0,p=b.itemMarginTop,t=b.initialItemX,r=a.legendItem,u=a.series&&a.series.drawLegendSymbol?a.series:a,v=u.options,v=v&&v.showCheckbox,y=e.useHTML;if(!r&&(a.legendGroup=d.g("legend-item").attr({zIndex:1}).add(b.scrollGroup),u.drawLegendSymbol(b,a),a.legendItem=r=d.text(e.labelFormat?Fa(e.labelFormat,a):e.labelFormatter.call(a),m?g+h:-h,b.baseline,y).css(x(a.visible?i:j)).attr({align:m?"left":"right",zIndex:2}).add(a.legendGroup),(y?r:a.legendGroup).on("mouseover",function(){a.setState("hover");r.css(b.options.itemHoverStyle)}).on("mouseout",function(){r.css(a.visible?i:j);a.setState()}).on("click",function(b){var c=function(){a.setVisible()},b={browserEvent:b};a.firePointEvent?a.firePointEvent("legendItemClick",b,c):A(a,"legendItemClick",b,c)}),b.colorizeItem(a,a.visible),v))a.checkbox=T("input",{type:"checkbox",checked:a.selected,defaultChecked:a.selected},e.itemCheckboxStyle,c.container),F(a.checkbox,"click",function(b){A(a,"checkboxClick",{checked:b.target.checked},function(){a.select()})});d=r.getBBox();B=a.legendItemWidth=e.itemWidth||a.legendItemWidth||g+h+d.width+l+(v?20:0),e=B;b.itemHeight=g=w(a.legendItemHeight||d.height);if(f&&b.itemX-t+e>(q||c.chartWidth-2*k-t))b.itemX=t,b.itemY+=p+b.lastLineHeight+o,b.lastLineHeight=0;b.maxItemWidth=s(b.maxItemWidth,e);b.lastItemY=p+b.itemY+o;b.lastLineHeight=s(g,b.lastLineHeight);a._legendItemPos=[b.itemX,b.itemY];f?b.itemX+=e:(b.itemY+=p+g+o,b.lastLineHeight=g);b.offsetWidth=q||s((f?b.itemX-t-l:e)+k,b.offsetWidth)},getAllItems:function(){var a=[];p(this.chart.series,function(b){var c=b.options;if(n(c.showInLegend,!t(c.linkedTo)?u:!1,!0))a=a.concat(b.legendItems||(c.legendType==="point"?b.data:b))});return a},render:function(){var a=this,b=a.chart,c=b.renderer,d=a.group,e,f,g,h,i=a.box,j=a.options,k=a.padding,l=j.borderWidth,m=j.backgroundColor;a.itemX=a.initialItemX;a.itemY=a.initialItemY;a.offsetWidth=0;a.lastItemY=0;if(!d)a.group=d=c.g("legend").attr({zIndex:7}).add(),a.contentGroup=c.g().attr({zIndex:1}).add(d),a.scrollGroup=c.g().add(a.contentGroup);a.renderTitle();e=a.getAllItems();ob(e,function(a,b){return(a.options&&a.options.legendIndex||0)-(b.options&&b.options.legendIndex||0)});j.reversed&&e.reverse();a.allItems=e;a.display=f=!!e.length;p(e,function(b){a.renderItem(b)});g=j.width||a.offsetWidth;h=a.lastItemY+a.lastLineHeight+a.titleHeight;h=a.handleOverflow(h);if(l||m){g+=k;h+=k;if(i){if(g>0&&h>0)i[i.isNew?"attr":"animate"](i.crisp(null,null,null,g,h)),i.isNew=!1}else a.box=i=c.rect(0,0,g,h,j.borderRadius,l||0).attr({stroke:j.borderColor,"stroke-width":l||0,fill:m||Q}).add(d).shadow(j.shadow),i.isNew=!0;i[f?"show":"hide"]()}a.legendWidth=g;a.legendHeight=h;p(e,function(b){a.positionItem(b)});f&&d.align(r({width:g,height:h},j),!0,"spacingBox");b.isResizing||this.positionCheckboxes()},handleOverflow:function(a){var b=this,c=this.chart,d=c.renderer,e=this.options,f=e.y,f=c.spacingBox.height+(e.verticalAlign==="top"?-f:f)-this.padding,g=e.maxHeight,h,i=this.clipRect,j=e.navigation,k=n(j.animation,!0),l=j.arrowSize||12,m=this.nav,q=this.pages,o,s=this.allItems;e.layout==="horizontal"&&(f/=2);g&&(f=I(f,g));q.length=0;if(a>f&&!e.useHTML){this.clipHeight=h=f-20-this.titleHeight-this.padding;this.currentPage=n(this.currentPage,1);this.fullHeight=a;p(s,function(a,b){var c=a._legendItemPos[1],d=w(a.legendItem.bBox.height),e=q.length;if(!e||c-q[e-1]>h)q.push(o||c);b===s.length-1&&c+d-q[e-1]>h&&q.push(c);c!==o&&(o=c)});if(!i)i=b.clipRect=d.clipRect(0,this.padding,9999,0),b.contentGroup.clip(i);i.attr({height:h});if(!m)this.nav=m=d.g().attr({zIndex:1}).add(this.group),this.up=d.symbol("triangle",0,0,l,l).on("click",function(){b.scroll(-1,k)}).add(m),this.pager=d.text("",15,10).css(j.style).add(m),this.down=d.symbol("triangle-down",0,0,l,l).on("click",function(){b.scroll(1,k)}).add(m);b.scroll(0);a=f}else if(m)i.attr({height:c.chartHeight}),m.hide(),this.scrollGroup.attr({translateY:1}),this.clipHeight=0;return a},scroll:function(a,b){var c=this.pages,d=c.length,e=this.currentPage+a,f=this.clipHeight,g=this.options.navigation,h=g.activeColor,g=g.inactiveColor,i=this.pager,j=this.padding;e>d&&(e=d);if(e>0)b!==u&&Oa(b,this.chart),this.nav.attr({translateX:j,translateY:f+this.padding+7+this.titleHeight,visibility:"visible"}),this.up.attr({fill:e===1?g:h}).css({cursor:e===1?"default":"pointer"}),i.attr({text:e+"/"+d}),this.down.attr({x:18+this.pager.getBBox().width,fill:e===d?g:h}).css({cursor:e===d?"default":"pointer"}),c=-c[e-1]+this.initialItemY,this.scrollGroup.animate({translateY:c}),this.currentPage=e,this.positionCheckboxes(c)}};R=Highcharts.LegendSymbolMixin={drawRectangle:function(a,b){var c=a.options.symbolHeight||12;b.legendSymbol=this.chart.renderer.rect(0,a.baseline-5-c/2,a.symbolWidth,c,n(a.options.symbolRadius,2)).attr({zIndex:3}).add(b.legendGroup)},drawLineMarker:function(a){var b=this.options,c=b.marker,d;d=a.symbolWidth;var e=this.chart.renderer,f=this.legendGroup,a=a.baseline-w(e.fontMetrics(a.options.itemStyle.fontSize).b*0.3),g;if(b.lineWidth){g={"stroke-width":b.lineWidth};if(b.dashStyle)g.dashstyle=b.dashStyle;this.legendLine=e.path(["M",0,a,"L",d,a]).attr(g).add(f)}if(c&&c.enabled)b=c.radius,this.legendSymbol=d=e.symbol(this.symbol,d/2-b,a-b,2*b,2*b).add(f),d.isMarker=!0}};/Trident\/7\.0/.test(ra)&&Va(zb.prototype,"positionItem",function(a,b){var c=this,d=function(){b._legendItemPos&&a.call(c,b)};c.chart.renderer.forExport?d():setTimeout(d)});fb.prototype={init:function(a,b){var c,d=a.series;a.series=null;c=x(G,a);c.series=a.series=d;this.userOptions=a;d=c.chart;this.margin=this.splashArray("margin",d);this.spacing=this.splashArray("spacing",d);var e=d.events;this.bounds={h:{},v:{}};this.callback=b;this.isResizing=0;this.options=c;this.axes=[];this.series=[];this.hasCartesianSeries=d.showAxes;var f=this,g;f.index=Ia.length;Ia.push(f);d.reflow!==!1&&F(f,"load",function(){f.initReflow()});if(e)for(g in e)F(f,g,e[g]);f.xAxis=[];f.yAxis=[];f.animation=da?!1:n(d.animation,!0);f.pointCount=0;f.counters=new Ab;f.firstRender()},initSeries:function(a){var b=this.options.chart;(b=L[a.type||b.type||b.defaultSeriesType])||ka(17,!0);b=new b;b.init(this,a);return b},isInsidePlot:function(a,b,c){var d=c?b:a,a=c?a:b;return d>=0&&d<=this.plotWidth&&a>=0&&a<=this.plotHeight},adjustTickAmounts:function(){this.options.chart.alignTicks!==!1&&p(this.axes,function(a){a.adjustTickAmount()});this.maxTicks=null},redraw:function(a){var b=this.axes,c=this.series,d=this.pointer,e=this.legend,f=this.isDirtyLegend,g,h,i=this.isDirtyBox,j=c.length,k=j,l=this.renderer,m=l.isHidden(),q=[];Oa(a,this);m&&this.cloneRenderTo();for(this.layOutTitles();k--;)if(a=c[k],a.options.stacking&&(g=!0,a.isDirty)){h=!0;break}if(h)for(k=j;k--;)if(a=c[k],a.options.stacking)a.isDirty=!0;p(c,function(a){a.isDirty&&a.options.legendType==="point"&&(f=!0)});if(f&&e.options.enabled)e.render(),this.isDirtyLegend=!1;g&&this.getStacks();if(this.hasCartesianSeries){if(!this.isResizing)this.maxTicks=null,p(b,function(a){a.setScale()});this.adjustTickAmounts();this.getMargins();p(b,function(a){a.isDirty&&(i=!0)});p(b,function(a){if(a.isDirtyExtremes)a.isDirtyExtremes=!1,q.push(function(){A(a,"afterSetExtremes",r(a.eventArgs,a.getExtremes()));delete a.eventArgs});(i||g)&&a.redraw()})}i&&this.drawChartBox();p(c,function(a){a.isDirty&&a.visible&&(!a.isCartesian||a.xAxis)&&a.redraw()});d&&d.reset&&d.reset(!0);l.draw();A(this,"redraw");m&&this.cloneRenderTo(!0);p(q,function(a){a.call()})},get:function(a){var b=this.axes,c=this.series,d,e;for(d=0;d<b.length;d++)if(b[d].options.id===a)return b[d];for(d=0;d<c.length;d++)if(c[d].options.id===a)return c[d];for(d=0;d<c.length;d++){e=c[d].points||[];for(b=0;b<e.length;b++)if(e[b].id===a)return e[b]}return null},getAxes:function(){var a=this,b=this.options,c=b.xAxis=ja(b.xAxis||{}),b=b.yAxis=ja(b.yAxis||{});p(c,function(a,b){a.index=b;a.isX=!0});p(b,function(a,b){a.index=b});c=c.concat(b);p(c,function(b){new qa(a,b)});a.adjustTickAmounts()},getSelectedPoints:function(){var a=[];p(this.series,function(b){a=a.concat(wb(b.points||[],function(a){return a.selected}))});return a},getSelectedSeries:function(){return wb(this.series,function(a){return a.selected})},getStacks:function(){var a=this;p(a.yAxis,function(a){if(a.stacks&&a.hasVisibleSeries)a.oldStacks=a.stacks});p(a.series,function(b){if(b.options.stacking&&(b.visible===!0||a.options.chart.ignoreHiddenSeries===!1))b.stackKey=b.type+n(b.options.stack,"")})},showResetZoom:function(){var a=this,b=G.lang,c=a.options.chart.resetZoomButton,d=c.theme,e=d.states,f=c.relativeTo==="chart"?null:"plotBox";this.resetZoomButton=a.renderer.button(b.resetZoom,null,null,function(){a.zoomOut()},d,e&&e.hover).attr({align:c.position.align,title:b.resetZoomTitle}).add().align(c.position,!1,f)},zoomOut:function(){var a=this;A(a,"selection",{resetSelection:!0},function(){a.zoom()})},zoom:function(a){var b,c=this.pointer,d=!1,e;!a||a.resetSelection?p(this.axes,function(a){b=a.zoom()}):p(a.xAxis.concat(a.yAxis),function(a){var e=a.axis,h=e.isXAxis;if(c[h?"zoomX":"zoomY"]||c[h?"pinchX":"pinchY"])b=e.zoom(a.min,a.max),e.displayBtn&&(d=!0)});e=this.resetZoomButton;if(d&&!e)this.showResetZoom();else if(!d&&S(e))this.resetZoomButton=e.destroy();b&&this.redraw(n(this.options.chart.animation,a&&a.animation,this.pointCount<100))},pan:function(a,b){var c=this,d=c.hoverPoints,e;d&&p(d,function(a){a.setState()});p(b==="xy"?[1,0]:[1],function(b){var d=a[b?"chartX":"chartY"],h=c[b?"xAxis":"yAxis"][0],i=c[b?"mouseDownX":"mouseDownY"],j=(h.pointRange||0)/2,k=h.getExtremes(),l=h.toValue(i-d,!0)+j,i=h.toValue(i+
c[b?"plotWidth":"plotHeight"]-d,!0)-j;h.series.length&&l>I(k.dataMin,k.min)&&i<s(k.dataMax,k.max)&&(h.setExtremes(l,i,!1,!1,{trigger:"pan"}),e=!0);c[b?"mouseDownX":"mouseDownY"]=d});e&&c.redraw(!1);D(c.container,{cursor:"move"})},setTitle:function(a,b){var f;var c=this,d=c.options,e;e=d.title=x(d.title,a);f=d.subtitle=x(d.subtitle,b),d=f;p([["title",a,e],["subtitle",b,d]],function(a){var b=a[0],d=c[b],e=a[1],a=a[2];d&&e&&(c[b]=d=d.destroy());a&&a.text&&!d&&(c[b]=c.renderer.text(a.text,0,0,a.useHTML).attr({align:a.align,"class":"highcharts-"+b,zIndex:a.zIndex||4}).css(a.style).add())});c.layOutTitles()},layOutTitles:function(){var a=0,b=this.title,c=this.subtitle,d=this.options,e=d.title,d=d.subtitle,f=this.spacingBox.width-44;if(b&&(b.css({width:(e.width||f)+"px"}).align(r({y:15},e),!1,"spacingBox"),!e.floating&&!e.verticalAlign))a=b.getBBox().height,a>=18&&a<=25&&(a=15);c&&(c.css({width:(d.width||f)+"px"}).align(r({y:a+e.margin},d),!1,"spacingBox"),!d.floating&&!d.verticalAlign&&(a=Ha(a+c.getBBox().height)));this.titleOffset=a},getChartSize:function(){var a=this.options.chart,b=this.renderToClone||this.renderTo;this.containerWidth=jb(b,"width");this.containerHeight=jb(b,"height");this.chartWidth=s(0,a.width||this.containerWidth||600);this.chartHeight=s(0,n(a.height,this.containerHeight>19?this.containerHeight:400))},cloneRenderTo:function(a){var b=this.renderToClone,c=this.container;a?b&&(this.renderTo.appendChild(c),Na(b),delete this.renderToClone):(c&&c.parentNode===this.renderTo&&this.renderTo.removeChild(c),this.renderToClone=b=this.renderTo.cloneNode(0),D(b,{position:"absolute",top:"-9999px",display:"block"}),y.body.appendChild(b),c&&b.appendChild(c))},getContainer:function(){var a,b=this.options.chart,c,d,e;this.renderTo=a=b.renderTo;e="highcharts-"+ub++;if(fa(a))this.renderTo=a=y.getElementById(a);a||ka(13,!0);c=z(v(a,"data-highcharts-chart"));!isNaN(c)&&Ia[c]&&Ia[c].destroy();v(a,"data-highcharts-chart",this.index);a.innerHTML="";a.offsetWidth||this.cloneRenderTo();this.getChartSize();c=this.chartWidth;d=this.chartHeight;this.container=a=T(Ga,{className:"highcharts-container"+(b.className?" "+b.className:""),id:e},r({position:"relative",overflow:"hidden",width:c+"px",height:d+"px",textAlign:"left",lineHeight:"normal",zIndex:0,"-webkit-tap-highlight-color":"rgba(0,0,0,0)"},b.style),this.renderToClone||a);this._cursor=a.style.cursor;this.renderer=b.forExport?new ua(a,c,d,!0):new Ya(a,c,d);da&&this.renderer.create(this,a,c,d)},getMargins:function(){var a=this.spacing,b,c=this.legend,d=this.margin,e=this.options.legend,f=n(e.margin,10),g=e.x,h=e.y,i=e.align,j=e.verticalAlign,k=this.titleOffset;this.resetMargins();b=this.axisOffset;if(k&&!t(d[0]))this.plotTop=s(this.plotTop,k+this.options.title.margin+a[0]);if(c.display&&!e.floating)if(i==="right"){if(!t(d[1]))this.marginRight=s(this.marginRight,c.legendWidth-g+f+a[1])}else if(i==="left"){if(!t(d[3]))this.plotLeft=s(this.plotLeft,c.legendWidth+g+f+a[3])}else if(j==="top"){if(!t(d[0]))this.plotTop=s(this.plotTop,c.legendHeight+h+f+a[0])}else if(j==="bottom"&&!t(d[2]))this.marginBottom=s(this.marginBottom,c.legendHeight-h+f+a[2]);this.extraBottomMargin&&(this.marginBottom+=this.extraBottomMargin);this.extraTopMargin&&(this.plotTop+=this.extraTopMargin);this.hasCartesianSeries&&p(this.axes,function(a){a.getOffset()});t(d[3])||(this.plotLeft+=b[3]);t(d[0])||(this.plotTop+=b[0]);t(d[2])||(this.marginBottom+=b[2]);t(d[1])||(this.marginRight+=b[1]);this.setChartSize()},reflow:function(a){var b=this,c=b.options.chart,d=b.renderTo,e=c.width||jb(d,"width"),f=c.height||jb(d,"height"),c=a?a.target:C,d=function(){if(b.container)b.setSize(e,f,!1),b.hasUserSize=null};if(!b.hasUserSize&&e&&f&&(c===C||c===y)){if(e!==b.containerWidth||f!==b.containerHeight)clearTimeout(b.reflowTimeout),a?b.reflowTimeout=setTimeout(d,100):d();b.containerWidth=e;b.containerHeight=f}},initReflow:function(){var a=this,b=function(b){a.reflow(b)};F(C,"resize",b);F(a,"destroy",function(){X(C,"resize",b)})},setSize:function(a,b,c){var d=this,e,f,g;d.isResizing+=1;g=function(){d&&A(d,"endResize",null,function(){d.isResizing-=1})};Oa(c,d);d.oldChartHeight=d.chartHeight;d.oldChartWidth=d.chartWidth;if(t(a))d.chartWidth=e=s(0,w(a)),d.hasUserSize=!!e;if(t(b))d.chartHeight=f=s(0,w(b));(oa?kb:D)(d.container,{width:e+"px",height:f+"px"},oa);d.setChartSize(!0);d.renderer.setSize(e,f,c);d.maxTicks=null;p(d.axes,function(a){a.isDirty=!0;a.setScale()});p(d.series,function(a){a.isDirty=!0});d.isDirtyLegend=!0;d.isDirtyBox=!0;d.getMargins();d.redraw(c);d.oldChartHeight=null;A(d,"resize");oa===!1?g():setTimeout(g,oa&&oa.duration||500)},setChartSize:function(a){var b=this.inverted,c=this.renderer,d=this.chartWidth,e=this.chartHeight,f=this.options.chart,g=this.spacing,h=this.clipOffset,i,j,k,l;this.plotLeft=i=w(this.plotLeft);this.plotTop=j=w(this.plotTop);this.plotWidth=k=s(0,w(d-i-this.marginRight));this.plotHeight=l=s(0,w(e-j-this.marginBottom));this.plotSizeX=b?l:k;this.plotSizeY=b?k:l;this.plotBorderWidth=f.plotBorderWidth||0;this.spacingBox=c.spacingBox={x:g[3],y:g[0],width:d-g[3]-g[1],height:e-g[0]-g[2]};this.plotBox=c.plotBox={x:i,y:j,width:k,height:l};d=2*N(this.plotBorderWidth/2);b=Ha(s(d,h[3])/2);c=Ha(s(d,h[0])/2);this.clipBox={x:b,y:c,width:N(this.plotSizeX-s(d,h[1])/2-b),height:N(this.plotSizeY-s(d,h[2])/2-c)};a||p(this.axes,function(a){a.setAxisSize();a.setAxisTranslation()})},resetMargins:function(){var a=this.spacing,b=this.margin;this.plotTop=n(b[0],a[0]);this.marginRight=n(b[1],a[1]);this.marginBottom=n(b[2],a[2]);this.plotLeft=n(b[3],a[3]);this.axisOffset=[0,0,0,0];this.clipOffset=[0,0,0,0]},drawChartBox:function(){var a=this.options.chart,b=this.renderer,c=this.chartWidth,d=this.chartHeight,e=this.chartBackground,f=this.plotBackground,g=this.plotBorder,h=this.plotBGImage,i=a.borderWidth||0,j=a.backgroundColor,k=a.plotBackgroundColor,l=a.plotBackgroundImage,m=a.plotBorderWidth||0,q,o=this.plotLeft,n=this.plotTop,p=this.plotWidth,s=this.plotHeight,r=this.plotBox,t=this.clipRect,w=this.clipBox;q=i+(a.shadow?8:0);if(i||j)if(e)e.animate(e.crisp(null,null,null,c-q,d-q));else{e={fill:j||Q};if(i)e.stroke=a.borderColor,e["stroke-width"]=i;this.chartBackground=b.rect(q/2,q/2,c-q,d-q,a.borderRadius,i).attr(e).add().shadow(a.shadow)}if(k)f?f.animate(r):this.plotBackground=b.rect(o,n,p,s,0).attr({fill:k}).add().shadow(a.plotShadow);if(l)h?h.animate(r):this.plotBGImage=b.image(l,o,n,p,s).add();t?t.animate({width:w.width,height:w.height}):this.clipRect=b.clipRect(w);if(m)g?g.animate(g.crisp(null,o,n,p,s)):this.plotBorder=b.rect(o,n,p,s,0,-m).attr({stroke:a.plotBorderColor,"stroke-width":m,zIndex:1}).add();this.isDirtyBox=!1},propFromSeries:function(){var a=this,b=a.options.chart,c,d=a.options.series,e,f;p(["inverted","angular","polar"],function(g){c=L[b.type||b.defaultSeriesType];f=a[g]||b[g]||c&&c.prototype[g];for(e=d&&d.length;!f&&e--;)(c=L[d[e].type])&&c.prototype[g]&&(f=!0);a[g]=f})},linkSeries:function(){var a=this,b=a.series;p(b,function(a){a.linkedSeries.length=0});p(b,function(b){var d=b.options.linkedTo;if(fa(d)&&(d=d===":previous"?a.series[b.index-1]:a.get(d)))d.linkedSeries.push(b),b.linkedParent=d})},render:function(){var a=this,b=a.axes,c=a.renderer,d=a.options,e=d.labels,f=d.credits,g;a.setTitle();a.legend=new zb(a,d.legend);a.getStacks();p(b,function(a){a.setScale()});a.getMargins();a.maxTicks=null;p(b,function(a){a.setTickPositions(!0);a.setMaxTicks()});a.adjustTickAmounts();a.getMargins();a.drawChartBox();a.hasCartesianSeries&&p(b,function(a){a.render()});if(!a.seriesGroup)a.seriesGroup=c.g("series-group").attr({zIndex:3}).add();p(a.series,function(a){a.translate();a.setTooltipPoints();a.render()});e.items&&p(e.items,function(b){var d=r(e.style,b.style),f=z(d.left)+a.plotLeft,g=z(d.top)+a.plotTop+12;delete d.left;delete d.top;c.text(b.html,f,g).attr({zIndex:2}).css(d).add()});if(f.enabled&&!a.credits)g=f.href,a.credits=c.text(f.text,0,0).on("click",function(){if(g)location.href=g}).attr({align:f.position.align,zIndex:8}).css(f.style).add().align(f.position);a.hasRendered=!0},destroy:function(){var a=this,b=a.axes,c=a.series,d=a.container,e,f=d&&d.parentNode;A(a,"destroy");Ia[a.index]=u;a.renderTo.removeAttribute("data-highcharts-chart");X(a);for(e=b.length;e--;)b[e]=b[e].destroy();for(e=c.length;e--;)c[e]=c[e].destroy();p("title,subtitle,chartBackground,plotBackground,plotBGImage,plotBorder,seriesGroup,clipRect,credits,pointer,scroller,rangeSelector,legend,resetZoomButton,tooltip,renderer".split(","),function(b){var c=a[b];c&&c.destroy&&(a[b]=c.destroy())});if(d)d.innerHTML="",X(d),f&&Na(d);for(e in a)delete a[e]},isReadyToRender:function(){var a=this;return!V&&C==C.top&&y.readyState!=="complete"||da&&!C.canvg?(da?Mb.push(function(){a.firstRender()},a.options.global.canvasToolsURL):y.attachEvent("onreadystatechange",function(){y.detachEvent("onreadystatechange",a.firstRender);y.readyState==="complete"&&a.firstRender()}),!1):!0},firstRender:function(){var a=this,b=a.options,c=a.callback;if(a.isReadyToRender())a.getContainer(),A(a,"init"),a.resetMargins(),a.setChartSize(),a.propFromSeries(),a.getAxes(),p(b.series||[],function(b){a.initSeries(b)}),a.linkSeries(),A(a,"beforeRender"),a.pointer=new $a(a,b),a.render(),a.renderer.draw(),c&&c.apply(a,[a]),p(a.callbacks,function(b){b.apply(a,[a])}),a.cloneRenderTo(!0),A(a,"load")},splashArray:function(a,b){var c=b[a],c=S(c)?c:[c,c,c,c];return[n(b[a+"Top"],c[0]),n(b[a+"Right"],c[1]),n(b[a+"Bottom"],c[2]),n(b[a+"Left"],c[3])]}};fb.prototype.callbacks=[];var xb=Highcharts.CenteredSeriesMixin={getCenter:function(){var a=this.options,b=this.chart,c=2*(a.slicedOffset||0),d,e=b.plotWidth-2*c,f=b.plotHeight-2*c,b=a.center,a=[n(b[0],"50%"),n(b[1],"50%"),a.size||"100%",a.innerSize||0],g=I(e,f),h;return Ra(a,function(a,b){h=/%$/.test(a);d=b<2||b===2&&h;return(h?[e,f,g,g][b]*z(a)/100:a)+(d?c:0)})}},Ja=function(){};Ja.prototype={init:function(a,b,c){this.series=a;this.applyOptions(b,c);this.pointAttr={};if(a.options.colorByPoint&&(b=a.options.colors||a.chart.options.colors,this.color=this.color||b[a.colorCounter++],a.colorCounter===b.length))a.colorCounter=0;a.chart.pointCount++;return this},applyOptions:function(a,b){var c=this.series,d=c.pointValKey,a=Ja.prototype.optionsToObject.call(this,a);r(this,a);this.options=this.options?r(this.options,a):a;if(d)this.y=this[d];if(this.x===u&&c)this.x=b===u?c.autoIncrement():b;return this},optionsToObject:function(a){var b={},c=this.series,d=c.pointArrayMap||["y"],e=d.length,f=0,g=0;if(typeof a==="number"||a===null)b[d[0]]=a;else if(Ka(a)){if(a.length>e){c=typeof a[0];if(c==="string")b.name=a[0];else if(c==="number")b.x=a[0];f++}for(;g<e;)b[d[g++]]=a[f++]}else if(typeof a==="object"){b=a;if(a.dataLabels)c._hasPointLabels=!0;if(a.marker)c._hasPointMarkers=!0}return b},destroy:function(){var a=this.series.chart,b=a.hoverPoints,c;a.pointCount--;if(b&&(this.setState(),ha(b,this),!b.length))a.hoverPoints=null;if(this===a.hoverPoint)this.onMouseOut();if(this.graphic||this.dataLabel)X(this),this.destroyElements();this.legendItem&&a.legend.destroyItem(this);for(c in this)this[c]=null},destroyElements:function(){for(var a="graphic,dataLabel,dataLabelUpper,group,connector,shadowGroup".split(","),b,c=6;c--;)b=a[c],this[b]&&(this[b]=this[b].destroy())},getLabelConfig:function(){return{x:this.category,y:this.y,key:this.name||this.category,series:this.series,point:this,percentage:this.percentage,total:this.total||this.stackTotal}},select:function(a,b){var c=this,d=c.series,e=d.chart,a=n(a,!c.selected);c.firePointEvent(a?"select":"unselect",{accumulate:b},function(){c.selected=c.options.selected=a;d.options.data[sa(c,d.data)]=c.options;c.setState(a&&"select");b||p(e.getSelectedPoints(),function(a){if(a.selected&&a!==c)a.selected=a.options.selected=!1,d.options.data[sa(a,d.data)]=a.options,a.setState(""),a.firePointEvent("unselect")})})},onMouseOver:function(a){var b=this.series,c=b.chart,d=c.tooltip,e=c.hoverPoint;if(e&&e!==this)e.onMouseOut();this.firePointEvent("mouseOver");d&&(!d.shared||b.noSharedTooltip)&&d.refresh(this,a);this.setState("hover");c.hoverPoint=this},onMouseOut:function(){var a=this.series.chart,b=a.hoverPoints;if(!b||sa(this,b)===-1)this.firePointEvent("mouseOut"),this.setState(),a.hoverPoint=null},tooltipFormatter:function(a){var b=this.series,c=b.tooltipOptions,d=n(c.valueDecimals,""),e=c.valuePrefix||"",f=c.valueSuffix||"";p(b.pointArrayMap||["y"],function(b){b="{point."+b;if(e||f)a=a.replace(b+"}",e+b+"}"+f);a=a.replace(b+"}",b+":,."+d+"f}")});return Fa(a,{point:this,series:this.series})},firePointEvent:function(a,b,c){var d=this,e=this.series.options;(e.point.events[a]||d.options&&d.options.events&&d.options.events[a])&&this.importEvents();a==="click"&&e.allowPointSelect&&(c=function(a){d.select(null,a.ctrlKey||a.metaKey||a.shiftKey)});A(this,a,b,c)},importEvents:function(){if(!this.hasImportedEvents){var a=x(this.series.options.point,this.options).events,b;this.events=a;for(b in a)F(this,b,a[b]);this.hasImportedEvents=!0}},setState:function(a,b){var c=this.plotX,d=this.plotY,e=this.series,f=e.options.states,g=Y[e.type].marker&&e.options.marker,h=g&&!g.enabled,i=g&&g.states[a],j=i&&i.enabled===!1,k=e.stateMarkerGraphic,l=this.marker||{},m=e.chart,q=this.pointAttr,a=a||"",b=b&&k;if(!(a===this.state&&!b||this.selected&&a!=="select"||f[a]&&f[a].enabled===!1||a&&(j||h&&!i.enabled)||a&&l.states&&l.states[a]&&l.states[a].enabled===!1)){if(this.graphic)f=g&&this.graphic.symbolName&&q[a].r,this.graphic.attr(x(q[a],f?{x:c-f,y:d-f,width:2*f,height:2*f}:{}));else{if(a&&i)if(f=i.radius,l=l.symbol||e.symbol,k&&k.currentSymbol!==l&&(k=k.destroy()),k)k[b?"animate":"attr"]({x:c-f,y:d-f});else e.stateMarkerGraphic=k=m.renderer.symbol(l,c-f,d-f,2*f,2*f).attr(q[a]).add(e.markerGroup),k.currentSymbol=l;if(k)k[a&&m.isInsidePlot(c,d,m.inverted)?"show":"hide"]()}this.state=a}}};var O=function(){};O.prototype={isCartesian:!0,type:"line",pointClass:Ja,sorted:!0,requireSorting:!0,pointAttrToOptions:{stroke:"lineColor","stroke-width":"lineWidth",fill:"fillColor",r:"radius"},axisTypes:["xAxis","yAxis"],colorCounter:0,parallelArrays:["x","y"],init:function(a,b){var c=this,d,e,f=a.series,g=function(a,b){return n(a.options.index,a._i)-n(b.options.index,b._i)};c.chart=a;c.options=b=c.setOptions(b);c.linkedSeries=[];c.bindAxes();r(c,{name:b.name,state:"",pointAttr:{},visible:b.visible!==!1,selected:b.selected===!0});if(da)b.animation=!1;e=b.events;for(d in e)F(c,d,e[d]);if(e&&e.click||b.point&&b.point.events&&b.point.events.click||b.allowPointSelect)a.runTrackerClick=!0;c.getColor();c.getSymbol();p(c.parallelArrays,function(a){c[a+"Data"]=[]});c.setData(b.data,!1);if(c.isCartesian)a.hasCartesianSeries=!0;f.push(c);c._i=f.length-1;ob(f,g);this.yAxis&&ob(this.yAxis.series,g);p(f,function(a,b){a.index=b;a.name=a.name||"Series "+(b+1)})},bindAxes:function(){var a=this,b=a.options,c=a.chart,d;p(a.axisTypes||[],function(e){p(c[e],function(c){d=c.options;if(b[e]===d.index||b[e]!==u&&b[e]===d.id||b[e]===u&&d.index===0)c.series.push(a),a[e]=c,c.isDirty=!0});!a[e]&&a.optionalAxis!==e&&ka(18,!0)})},updateParallelArrays:function(a,b){var c=a.series,d=arguments;p(c.parallelArrays,typeof b==="number"?function(d){var f=d==="y"&&c.toYData?c.toYData(a):a[d];c[d+"Data"][b]=f}:function(a){Array.prototype[b].apply(c[a+"Data"],Array.prototype.slice.call(d,2))})},autoIncrement:function(){var a=this.options,b=this.xIncrement,b=n(b,a.pointStart,0);this.pointInterval=n(this.pointInterval,a.pointInterval,1);this.xIncrement=b+this.pointInterval;return b},getSegments:function(){var a=-1,b=[],c,d=this.points,e=d.length;if(e)if(this.options.connectNulls){for(c=e;c--;)d[c].y===null&&d.splice(c,1);d.length&&(b=[d])}else p(d,function(c,g){c.y===null?(g>a+1&&b.push(d.slice(a+1,g)),a=g):g===e-1&&b.push(d.slice(a+1,g+1))});this.segments=b},setOptions:function(a){var b=this.chart,c=b.options.plotOptions,b=b.userOptions||{},d=b.plotOptions||{},e=c[this.type];this.userOptions=a;c=x(e,c.series,a);this.tooltipOptions=x(G.tooltip,G.plotOptions[this.type].tooltip,b.tooltip,d.series&&d.series.tooltip,d[this.type]&&d[this.type].tooltip,a.tooltip);e.marker===null&&delete c.marker;return c},getColor:function(){var a=this.options,b=this.userOptions,c=this.chart.options.colors,d=this.chart.counters,e;e=a.color||Y[this.type].color;if(!e&&!a.colorByPoint)t(b._colorIndex)?a=b._colorIndex:(b._colorIndex=d.color,a=d.color++),e=c[a];this.color=e;d.wrapColor(c.length)},getSymbol:function(){var a=this.userOptions,b=this.options.marker,c=this.chart,d=c.options.symbols,c=c.counters;this.symbol=b.symbol;if(!this.symbol)t(a._symbolIndex)?a=a._symbolIndex:(a._symbolIndex=c.symbol,a=c.symbol++),this.symbol=d[a];if(/^url/.test(this.symbol))b.radius=0;c.wrapSymbol(d.length)},drawLegendSymbol:R.drawLineMarker,setData:function(a,b){var c=this,d=c.points,e=c.options,f=c.chart,g=null,h=c.xAxis,i=h&&!!h.categories,j;c.xIncrement=null;c.pointRange=i?1:e.pointRange;c.colorCounter=0;var a=a||[],k=a.length;j=e.turboThreshold;var l=this.xData,m=this.yData,q=c.pointArrayMap,q=q&&q.length;p(this.parallelArrays,function(a){c[a+"Data"].length=0});if(j&&k>j){for(j=0;g===null&&j<k;)g=a[j],j++;if(wa(g)){i=n(e.pointStart,0);e=n(e.pointInterval,1);for(j=0;j<k;j++)l[j]=i,m[j]=a[j],i+=e;c.xIncrement=i}else if(Ka(g))if(q)for(j=0;j<k;j++)e=a[j],l[j]=e[0],m[j]=e.slice(1,q+1);else for(j=0;j<k;j++)e=a[j],l[j]=e[0],m[j]=e[1];else ka(12)}else for(j=0;j<k;j++)if(a[j]!==u&&(e={series:c},c.pointClass.prototype.applyOptions.apply(e,[a[j]]),c.updateParallelArrays(e,j),i&&e.name))h.names[e.x]=e.name;fa(m[0])&&ka(14,!0);c.data=[];c.options.data=a;for(j=d&&d.length||0;j--;)d[j]&&d[j].destroy&&d[j].destroy();if(h)h.minRange=h.userMinRange;c.isDirty=c.isDirtyData=f.isDirtyBox=!0;n(b,!0)&&f.redraw(!1)},processData:function(a){var b=this.xData,c=this.yData,d=b.length,e;e=0;var f,g,h=this.xAxis,i=this.options,j=i.cropThreshold,k=this.isCartesian;if(k&&!this.isDirty&&!h.isDirty&&!this.yAxis.isDirty&&!a)return!1;if(k&&this.sorted&&(!j||d>j||this.forceCrop))if(a=h.min,h=h.max,b[d-1]<a||b[0]>h)b=[],c=[];else if(b[0]<a||b[d-1]>h)e=this.cropData(this.xData,this.yData,a,h),b=e.xData,c=e.yData,e=e.start,f=!0;for(h=b.length-1;h>=0;h--)d=b[h]-b[h-1],d>0&&(g===u||d<g)?g=d:d<0&&this.requireSorting&&ka(15);this.cropped=f;this.cropStart=e;this.processedXData=b;this.processedYData=c;if(i.pointRange===null)this.pointRange=g||1;this.closestPointRange=g},cropData:function(a,b,c,d){var e=a.length,f=0,g=e,h=n(this.cropShoulder,1),i;for(i=0;i<e;i++)if(a[i]>=c){f=s(0,i-h);break}for(;i<e;i++)if(a[i]>d){g=i+h;break}return{xData:a.slice(f,g),yData:b.slice(f,g),start:f,end:g}},generatePoints:function(){var a=this.options.data,b=this.data,c,d=this.processedXData,e=this.processedYData,f=this.pointClass,g=d.length,h=this.cropStart||0,i,j=this.hasGroupedData,k,l=[],m;if(!b&&!j)b=[],b.length=a.length,b=this.data=b;for(m=0;m<g;m++)i=h+m,j?l[m]=(new f).init(this,[d[m]].concat(ja(e[m]))):(b[i]?k=b[i]:a[i]!==u&&(b[i]=k=(new f).init(this,a[i],d[m])),l[m]=k);if(b&&(g!==(c=b.length)||j))for(m=0;m<c;m++)if(m===h&&!j&&(m+=g),b[m])b[m].destroyElements(),b[m].plotX=u;this.data=b;this.points=l},setStackedPoints:function(){if(this.options.stacking&&!(this.visible!==!0&&this.chart.options.chart.ignoreHiddenSeries!==!1)){var a=this.processedXData,b=this.processedYData,c=[],d=b.length,e=this.options,f=e.threshold,g=e.stack,e=e.stacking,h=this.stackKey,i="-"+h,j=this.negStacks,k=this.yAxis,l=k.stacks,m=k.oldStacks,q,o,n,p,r;for(n=0;n<d;n++){p=a[n];r=b[n];o=(q=j&&r<f)?i:h;l[o]||(l[o]={});if(!l[o][p])m[o]&&m[o][p]?(l[o][p]=m[o][p],l[o][p].total=null):l[o][p]=new Gb(k,k.options.stackLabels,q,p,g,e);o=l[o][p];o.points[this.index]=[o.cum||0];e==="percent"?(q=q?h:i,j&&l[q]&&l[q][p]?(q=l[q][p],o.total=q.total=s(q.total,o.total)+M(r)||0):o.total=aa(o.total+(M(r)||0))):o.total=aa(o.total+(r||0));o.cum=(o.cum||0)+(r||0);o.points[this.index].push(o.cum);c[n]=o.cum}if(e==="percent")k.usePercentage=!0;this.stackedYData=c;k.oldStacks={}}},setPercentStacks:function(){var a=this,b=a.stackKey,c=a.yAxis.stacks;p([b,"-"+b],function(b){var d;for(var e=a.xData.length,f,g;e--;)if(f=a.xData[e],d=(g=c[b]&&c[b][f])&&g.points[a.index],f=d)g=g.total?100/g.total:0,f[0]=aa(f[0]*g),f[1]=aa(f[1]*g),a.stackedYData[e]=f[1]})},getExtremes:function(a){var b=this.yAxis,c=this.processedXData,d,e=[],f=0;d=this.xAxis.getExtremes();var g=d.min,h=d.max,i,j,k,l,a=a||this.stackedYData||this.processedYData;d=a.length;for(l=0;l<d;l++)if(j=c[l],k=a[l],i=k!==null&&k!==u&&(!b.isLog||k.length||k>0),j=this.getExtremesFromAll||this.cropped||(c[l+1]||j)>=g&&(c[l-1]||j)<=h,i&&j)if(i=k.length)for(;i--;)k[i]!==null&&(e[f++]=k[i]);else e[f++]=k;this.dataMin=n(void 0,La(e));this.dataMax=n(void 0,za(e))},translate:function(){this.processedXData||this.processData();this.generatePoints();for(var a=this.options,b=a.stacking,c=this.xAxis,d=c.categories,e=this.yAxis,f=this.points,g=f.length,h=!!this.modifyValue,i=a.pointPlacement,j=i==="between"||wa(i),k=a.threshold,a=0;a<g;a++){var l=f[a],m=l.x,q=l.y,o=l.low,p=b&&e.stacks[(this.negStacks&&q<k?"-":"")+this.stackKey];if(e.isLog&&q<=0)l.y=q=null;l.plotX=c.translate(m,0,0,0,1,i,this.type==="flags");if(b&&this.visible&&p&&p[m])p=p[m],q=p.points[this.index],o=q[0],q=q[1],o===0&&(o=n(k,e.min)),e.isLog&&o<=0&&(o=null),l.total=l.stackTotal=p.total,l.percentage=b==="percent"&&l.y/p.total*100,l.stackY=q,p.setOffset(this.pointXOffset||0,this.barW||0);l.yBottom=t(o)?e.translate(o,0,1,0,1):null;h&&(q=this.modifyValue(q,l));l.plotY=typeof q==="number"&&q!==Infinity?e.translate(q,0,1,0,1):u;l.clientX=j?c.translate(m,0,0,0,1):l.plotX;l.negative=l.y<(k||0);l.category=d&&d[l.x]!==u?d[l.x]:l.x}this.getSegments()},setTooltipPoints:function(a){var b=[],c,d,e=this.xAxis,f=e&&e.getExtremes(),g=e?e.tooltipLen||e.len:this.chart.plotSizeX,h,i,j=[];if(this.options.enableMouseTracking!==!1){if(a)this.tooltipPoints=null;p(this.segments||this.points,function(a){b=b.concat(a)});e&&e.reversed&&(b=b.reverse());this.orderTooltipPoints&&this.orderTooltipPoints(b);a=b.length;for(i=0;i<a;i++)if(e=b[i],c=e.x,c>=f.min&&c<=f.max){h=b[i+1];c=d===u?0:d+1;for(d=b[i+1]?I(s(0,N((e.clientX+(h?h.wrappedClientX||h.clientX:g))/2)),g):g;c>=0&&c<=d;)j[c++]=e}this.tooltipPoints=j}},tooltipHeaderFormatter:function(a){var b=this.tooltipOptions,c=b.dateTimeLabelFormats,d=b.xDateFormat,e=this.xAxis,f=e&&e.options.type==="datetime",b=b.headerFormat,e=e&&e.closestPointRange,g;if(f&&!d){if(e)for(g in E){if(E[g]>=e){d=c[g];break}}else d=c.day;d=d||c.year}f&&d&&wa(a.key)&&(b=b.replace("{point.key}","{point.key:"+d+"}"));return Fa(b,{point:a,series:this})},onMouseOver:function(){var a=this.chart,b=a.hoverSeries;if(b&&b!==this)b.onMouseOut();this.options.events.mouseOver&&A(this,"mouseOver");this.setState("hover");a.hoverSeries=this},onMouseOut:function(){var a=this.options,b=this.chart,c=b.tooltip,d=b.hoverPoint;if(d)d.onMouseOut();this&&a.events.mouseOut&&A(this,"mouseOut");c&&!a.stickyTracking&&(!c.shared||this.noSharedTooltip)&&c.hide();this.setState();b.hoverSeries=null},animate:function(a){var b=this,c=b.chart,d=c.renderer,e;e=b.options.animation;var f=c.clipBox,g=c.inverted,h;if(e&&!S(e))e=Y[b.type].animation;h="_sharedClip"+e.duration+e.easing;if(a)a=c[h],e=c[h+"m"],a||(c[h]=a=d.clipRect(r(f,{width:0})),c[h+"m"]=e=d.clipRect(-99,g?-c.plotLeft:-c.plotTop,99,g?c.chartWidth:c.chartHeight)),b.group.clip(a),b.markerGroup.clip(e),b.sharedClipKey=h;else{if(a=c[h])a.animate({width:c.plotSizeX},e),c[h+"m"].animate({width:c.plotSizeX+99},e);b.animate=null;b.animationTimeout=setTimeout(function(){b.afterAnimate()},e.duration)}},afterAnimate:function(){var a=this.chart,b=this.sharedClipKey,c=this.group;c&&this.options.clip!==!1&&(c.clip(a.clipRect),this.markerGroup.clip());setTimeout(function(){b&&a[b]&&(a[b]=a[b].destroy(),a[b+"m"]=a[b+"m"].destroy())},100)},drawPoints:function(){var a,b=this.points,c=this.chart,d,e,f,g,h,i,j,k,l=this.options.marker,m,q=this.markerGroup;if(l.enabled||this._hasPointMarkers)for(f=b.length;f--;)if(g=b[f],d=N(g.plotX),e=g.plotY,k=g.graphic,i=g.marker||{},a=l.enabled&&i.enabled===u||i.enabled,m=c.isInsidePlot(w(d),e,c.inverted),a&&e!==u&&!isNaN(e)&&g.y!==null)if(a=g.pointAttr[g.selected?"select":""],h=a.r,i=n(i.symbol,this.symbol),j=i.indexOf("url")===0,k)k.attr({visibility:m?V?"inherit":"visible":"hidden"}).animate(r({x:d-h,y:e-h},k.symbolName?{width:2*h,height:2*h}:{}));else{if(m&&(h>0||j))g.graphic=c.renderer.symbol(i,d-h,e-h,2*h,2*h).attr(a).add(q)}else if(k)g.graphic=k.destroy()},convertAttribs:function(a,b,c,d){var e=this.pointAttrToOptions,f,g,h={},a=a||{},b=b||{},c=c||{},d=d||{};for(f in e)g=e[f],h[f]=n(a[g],b[f],c[f],d[f]);return h},getAttribs:function(){var a=this,b=a.options,c=Y[a.type].marker?b.marker:b,d=c.states,e=d.hover,f,g=a.color,h={stroke:g,fill:g},i=a.points||[],j=[],k,l=a.pointAttrToOptions,m=b.negativeColor,n=c.lineColor,o=c.fillColor,s;b.marker?(e.radius=e.radius||c.radius+2,e.lineWidth=e.lineWidth||c.lineWidth+1):e.color=e.color||ta(e.color||g).brighten(e.brightness).get();j[""]=a.convertAttribs(c,h);p(["hover","select"],function(b){j[b]=a.convertAttribs(d[b],j[""])});a.pointAttr=j;for(g=i.length;g--;){h=i[g];if((c=h.options&&h.options.marker||h.options)&&c.enabled===!1)c.radius=0;if(h.negative&&m)h.color=h.fillColor=m;k=b.colorByPoint||h.color;if(h.options)for(s in l)t(c[l[s]])&&(k=!0);if(k){c=c||{};k=[];d=c.states||{};f=d.hover=d.hover||{};if(!b.marker)f.color=ta(f.color||h.color).brighten(f.brightness||e.brightness).get();f={color:h.color};if(!o)f.fillColor=h.color;if(!n)f.lineColor=h.color;k[""]=a.convertAttribs(r(f,c),j[""]);k.hover=a.convertAttribs(d.hover,j.hover,k[""]);k.select=a.convertAttribs(d.select,j.select,k[""])}else k=j;h.pointAttr=k}},destroy:function(){var a=this,b=a.chart,c=/AppleWebKit\/533/.test(ra),d,e,f=a.data||[],g,h,i;A(a,"destroy");X(a);p(a.axisTypes||[],function(b){if(i=a[b])ha(i.series,a),i.isDirty=i.forceRedraw=!0});a.legendItem&&a.chart.legend.destroyItem(a);for(e=f.length;e--;)(g=f[e])&&g.destroy&&g.destroy();a.points=null;clearTimeout(a.animationTimeout);p("area,graph,dataLabelsGroup,group,markerGroup,tracker,graphNeg,areaNeg,posClip,negClip".split(","),function(b){a[b]&&(d=c&&b==="group"?"hide":"destroy",a[b][d]())});if(b.hoverSeries===a)b.hoverSeries=null;ha(b.series,a);for(h in a)delete a[h]},getSegmentPath:function(a){var b=this,c=[],d=b.options.step;p(a,function(e,f){var g=e.plotX,h=e.plotY,i;b.getPointSpline?c.push.apply(c,b.getPointSpline(a,e,f)):(c.push(f?"L":"M"),d&&f&&(i=a[f-1],d==="right"?c.push(i.plotX,h):d==="center"?c.push((i.plotX+g)/2,i.plotY,(i.plotX+g)/2,h):c.push(g,i.plotY)),c.push(e.plotX,e.plotY))});return c},getGraphPath:function(){var a=this,b=[],c,d=[];p(a.segments,function(e){c=a.getSegmentPath(e);e.length>1?b=b.concat(c):d.push(e[0])});a.singlePoints=d;return a.graphPath=b},drawGraph:function(){var a=this,b=this.options,c=[["graph",b.lineColor||this.color]],d=b.lineWidth,e=b.dashStyle,f=b.linecap!=="square",g=this.getGraphPath(),h=b.negativeColor;h&&c.push(["graphNeg",h]);p(c,function(c,h){var k=c[0],l=a[k];if(l)Za(l),l.animate({d:g});else if(d&&g.length)l={stroke:c[1],"stroke-width":d,zIndex:1},e?l.dashstyle=e:f&&(l["stroke-linecap"]=l["stroke-linejoin"]="round"),a[k]=a.chart.renderer.path(g).attr(l).add(a.group).shadow(!h&&b.shadow)})},clipNeg:function(){var a=this.options,b=this.chart,c=b.renderer,d=a.negativeColor||a.negativeFillColor,e,f=this.graph,g=this.area,h=this.posClip,i=this.negClip;e=b.chartWidth;var j=b.chartHeight,k=s(e,j),l=this.yAxis;if(d&&(f||g)){d=w(l.toPixels(a.threshold||0,!0));d<0&&(k-=d);a={x:0,y:0,width:k,height:d};k={x:0,y:d,width:k,height:k};if(b.inverted)a.height=k.y=b.plotWidth-d,c.isVML&&(a={x:b.plotWidth-
d-b.plotLeft,y:0,width:e,height:j},k={x:d+b.plotLeft-e,y:0,width:b.plotLeft+d,height:e});l.reversed?(b=k,e=a):(b=a,e=k);h?(h.animate(b),i.animate(e)):(this.posClip=h=c.clipRect(b),this.negClip=i=c.clipRect(e),f&&this.graphNeg&&(f.clip(h),this.graphNeg.clip(i)),g&&(g.clip(h),this.areaNeg.clip(i)))}},invertGroups:function(){function a(){var a={width:b.yAxis.len,height:b.xAxis.len};p(["group","markerGroup"],function(c){b[c]&&b[c].attr(a).invert()})}var b=this,c=b.chart;if(b.xAxis)F(c,"resize",a),F(b,"destroy",function(){X(c,"resize",a)}),a(),b.invertGroups=a},plotGroup:function(a,b,c,d,e){var f=this[a],g=!f;g&&(this[a]=f=this.chart.renderer.g(b).attr({visibility:c,zIndex:d||0.1}).add(e));f[g?"attr":"animate"](this.getPlotBox());return f},getPlotBox:function(){return{translateX:this.xAxis?this.xAxis.left:this.chart.plotLeft,translateY:this.yAxis?this.yAxis.top:this.chart.plotTop,scaleX:1,scaleY:1}},render:function(){var a=this.chart,b,c=this.options,d=c.animation&&!!this.animate&&a.renderer.isSVG,e=this.visible?"visible":"hidden",f=c.zIndex,g=this.hasRendered,h=a.seriesGroup;b=this.plotGroup("group","series",e,f,h);this.markerGroup=this.plotGroup("markerGroup","markers",e,f,h);d&&this.animate(!0);this.getAttribs();b.inverted=this.isCartesian?a.inverted:!1;this.drawGraph&&(this.drawGraph(),this.clipNeg());this.drawDataLabels&&this.drawDataLabels();this.visible&&this.drawPoints();this.options.enableMouseTracking!==!1&&this.drawTracker();a.inverted&&this.invertGroups();c.clip!==!1&&!this.sharedClipKey&&!g&&b.clip(a.clipRect);d?this.animate():g||this.afterAnimate();this.isDirty=this.isDirtyData=!1;this.hasRendered=!0},redraw:function(){var a=this.chart,b=this.isDirtyData,c=this.group,d=this.xAxis,e=this.yAxis;c&&(a.inverted&&c.attr({width:a.plotWidth,height:a.plotHeight}),c.animate({translateX:n(d&&d.left,a.plotLeft),translateY:n(e&&e.top,a.plotTop)}));this.translate();this.setTooltipPoints(!0);this.render();b&&A(this,"updatedData")},setState:function(a){var b=this.options,c=this.graph,d=this.graphNeg,e=b.states,b=b.lineWidth,a=a||"";if(this.state!==a)this.state=a,e[a]&&e[a].enabled===!1||(a&&(b=e[a].lineWidth||b+1),c&&!c.dashstyle&&(a={"stroke-width":b},c.attr(a),d&&d.attr(a)))},setVisible:function(a,b){var c=this,d=c.chart,e=c.legendItem,f,g=d.options.chart.ignoreHiddenSeries,h=c.visible;f=(c.visible=a=c.userOptions.visible=a===u?!h:a)?"show":"hide";p(["group","dataLabelsGroup","markerGroup","tracker"],function(a){if(c[a])c[a][f]()});if(d.hoverSeries===c)c.onMouseOut();e&&d.legend.colorizeItem(c,a);c.isDirty=!0;c.options.stacking&&p(d.series,function(a){if(a.options.stacking&&a.visible)a.isDirty=!0});p(c.linkedSeries,function(b){b.setVisible(a,!1)});if(g)d.isDirtyBox=!0;b!==!1&&d.redraw();A(c,f)},show:function(){this.setVisible(!0)},hide:function(){this.setVisible(!1)},select:function(a){this.selected=a=a===u?!this.selected:a;if(this.checkbox)this.checkbox.checked=a;A(this,a?"select":"unselect")},drawTracker:J.drawTrackerGraph};r(fb.prototype,{addSeries:function(a,b,c){var d,e=this;a&&(b=n(b,!0),A(e,"addSeries",{options:a},function(){d=e.initSeries(a);e.isDirtyLegend=!0;e.linkSeries();b&&e.redraw(c)}));return d},addAxis:function(a,b,c,d){var e=b?"xAxis":"yAxis",f=this.options;new qa(this,x(a,{index:this[e].length,isX:b}));f[e]=ja(f[e]||{});f[e].push(a);n(c,!0)&&this.redraw(d)},showLoading:function(a){var b=this.options,c=this.loadingDiv,d=b.loading;if(!c)this.loadingDiv=c=T(Ga,{className:"highcharts-loading"},r(d.style,{zIndex:10,display:Q}),this.container),this.loadingSpan=T("span",null,d.labelStyle,c);this.loadingSpan.innerHTML=a||b.lang.loading;if(!this.loadingShown)D(c,{opacity:0,display:"",left:this.plotLeft+"px",top:this.plotTop+"px",width:this.plotWidth+"px",height:this.plotHeight+"px"}),kb(c,{opacity:d.style.opacity},{duration:d.showDuration||0}),this.loadingShown=!0},hideLoading:function(){var a=this.options,b=this.loadingDiv;b&&kb(b,{opacity:0},{duration:a.loading.hideDuration||100,complete:function(){D(b,{display:Q})}});this.loadingShown=!1}});r(Ja.prototype,{update:function(a,b,c){var d=this,e=d.series,f=d.graphic,g,h=e.data,i=e.chart,j=e.options,b=n(b,!0);d.firePointEvent("update",{options:a},function(){d.applyOptions(a);if(S(a)){e.getAttribs();if(f)a&&a.marker&&a.marker.symbol?d.graphic=f.destroy():f.attr(d.pointAttr[d.state||""]);if(a&&a.dataLabels&&d.dataLabel)d.dataLabel=d.dataLabel.destroy()}g=sa(d,h);e.updateParallelArrays(d,g);j.data[g]=d.options;e.isDirty=e.isDirtyData=!0;if(!e.fixedBox&&e.hasCartesianSeries)i.isDirtyBox=!0;j.legendType==="point"&&i.legend.destroyItem(d);b&&i.redraw(c)})},remove:function(a,b){var c=this,d=c.series,e=d.points,f=d.chart,g,h=d.data;Oa(b,f);a=n(a,!0);c.firePointEvent("remove",null,function(){g=sa(c,h);h.length===e.length&&e.splice(g,1);h.splice(g,1);d.options.data.splice(g,1);d.updateParallelArrays(c,"splice",g,1);c.destroy();d.isDirty=!0;d.isDirtyData=!0;a&&f.redraw()})}});r(O.prototype,{addPoint:function(a,b,c,d){var e=this.options,f=this.data,g=this.graph,h=this.area,i=this.chart,j=this.xAxis&&this.xAxis.names,k=g&&g.shift||0,l=e.data,m,q=this.xData;Oa(d,i);c&&p([g,h,this.graphNeg,this.areaNeg],function(a){if(a)a.shift=k+1});if(h)h.isArea=!0;b=n(b,!0);d={series:this};this.pointClass.prototype.applyOptions.apply(d,[a]);g=d.x;h=q.length;if(this.requireSorting&&g<q[h-1])for(m=!0;h&&q[h-1]>g;)h--;this.updateParallelArrays(d,"splice",h,0,0);this.updateParallelArrays(d,h);if(j)j[g]=d.name;l.splice(h,0,a);m&&(this.data.splice(h,0,null),this.processData());e.legendType==="point"&&this.generatePoints();c&&(f[0]&&f[0].remove?f[0].remove(!1):(f.shift(),this.updateParallelArrays(d,"shift"),l.shift()));this.isDirtyData=this.isDirty=!0;b&&(this.getAttribs(),i.redraw())},remove:function(a,b){var c=this,d=c.chart,a=n(a,!0);if(!c.isRemoving)c.isRemoving=!0,A(c,"remove",null,function(){c.destroy();d.isDirtyLegend=d.isDirtyBox=!0;d.linkSeries();a&&d.redraw(b)});c.isRemoving=!1},update:function(a,b){var c=this.chart,d=this.type,e=L[d].prototype,f,a=x(this.userOptions,{animation:!1,index:this.index,pointStart:this.xData[0]},{data:this.options.data},a);this.remove(!1);for(f in e)e.hasOwnProperty(f)&&(this[f]=u);r(this,L[a.type||d].prototype);this.init(c,a);n(b,!0)&&c.redraw(!1)}});r(qa.prototype,{update:function(a,b){var c=this.chart,a=c.options[this.coll][this.options.index]=x(this.userOptions,a);this.destroy(!0);this._addedPlotLB=this.userMin=this.userMax=u;this.init(c,r(a,{events:u}));c.isDirtyBox=!0;n(b,!0)&&c.redraw()},remove:function(a){var b=this.chart,c=this.coll;p(this.series,function(a){a.remove(!1)});ha(b.axes,this);ha(b[c],this);b.options[c].splice(this.options.index,1);p(b[c],function(a,b){a.options.index=b});this.destroy();b.isDirtyBox=!0;n(a,!0)&&b.redraw()},setTitle:function(a,b){this.update({title:a},b)},setCategories:function(a,b){this.update({categories:a},b)}});var ca=ia(O);L.line=ca;Y.area=x(W,{threshold:0});var Ua=ia(O,{type:"area",getSegments:function(){var a=[],b=[],c=[],d=this.xAxis,e=this.yAxis,f=e.stacks[this.stackKey],g={},h,i,j=this.points,k=this.options.connectNulls,l,m,n;if(this.options.stacking&&!this.cropped){for(m=0;m<j.length;m++)g[j[m].x]=j[m];for(n in f)f[n].total!==null&&c.push(+n);c.sort(function(a,b){return a-b});p(c,function(a){if(!k||g[a]&&g[a].y!==null)g[a]?b.push(g[a]):(h=d.translate(a),l=f[a].percent?f[a].total?f[a].cum*100/f[a].total:0:f[a].cum,i=e.toPixels(l,!0),b.push({y:null,plotX:h,clientX:h,plotY:i,yBottom:i,onMouseOver:la}))});b.length&&a.push(b)}else O.prototype.getSegments.call(this),a=this.segments;this.segments=a},getSegmentPath:function(a){var b=O.prototype.getSegmentPath.call(this,a),c=[].concat(b),d,e=this.options;d=b.length;var f=this.yAxis.getThreshold(e.threshold),g;d===3&&c.push("L",b[1],b[2]);if(e.stacking&&!this.closedStacks)for(d=a.length-1;d>=0;d--)g=n(a[d].yBottom,f),d<a.length-1&&e.step&&c.push(a[d+1].plotX,g),c.push(a[d].plotX,g);else this.closeSegment(c,a,f);this.areaPath=this.areaPath.concat(c);return b},closeSegment:function(a,b,c){a.push("L",b[b.length-1].plotX,c,"L",b[0].plotX,c)},drawGraph:function(){this.areaPath=[];O.prototype.drawGraph.apply(this);var a=this,b=this.areaPath,c=this.options,d=c.negativeColor,e=c.negativeFillColor,f=[["area",this.color,c.fillColor]];(d||e)&&f.push(["areaNeg",d,e]);p(f,function(d){var e=d[0],f=a[e];f?f.animate({d:b}):a[e]=a.chart.renderer.path(b).attr({fill:n(d[2],ta(d[1]).setOpacity(n(c.fillOpacity,0.75)).get()),zIndex:0}).add(a.group)})},drawLegendSymbol:R.drawRectangle});L.area=Ua;Y.spline=x(W);ca=ia(O,{type:"spline",getPointSpline:function(a,b,c){var d=b.plotX,e=b.plotY,f=a[c-1],g=a[c+1],h,i,j,k;if(f&&g){a=f.plotY;j=g.plotX;var g=g.plotY,l;h=(1.5*d+f.plotX)/2.5;i=(1.5*e+a)/2.5;j=(1.5*d+j)/2.5;k=(1.5*e+g)/2.5;l=(k-i)*(j-d)/(j-h)+e-k;i+=l;k+=l;i>a&&i>e?(i=s(a,e),k=2*e-i):i<a&&i<e&&(i=I(a,e),k=2*e-i);k>g&&k>e?(k=s(g,e),i=2*e-k):k<g&&k<e&&(k=I(g,e),i=2*e-k);b.rightContX=j;b.rightContY=k}c?(b=["C",f.rightContX||f.plotX,f.rightContY||f.plotY,h||d,i||e,d,e],f.rightContX=f.rightContY=null):b=["M",d,e];return b}});L.spline=ca;Y.areaspline=x(Y.area);Ua=Ua.prototype;ca=ia(ca,{type:"areaspline",closedStacks:!0,getSegmentPath:Ua.getSegmentPath,closeSegment:Ua.closeSegment,drawGraph:Ua.drawGraph,drawLegendSymbol:R.drawRectangle});L.areaspline=ca;Y.column=x(W,{borderColor:"#FFFFFF",borderWidth:1,borderRadius:0,groupPadding:0.2,marker:null,pointPadding:0.1,minPointLength:0,cropThreshold:50,pointRange:null,states:{hover:{brightness:0.1,shadow:!1},select:{color:"#C0C0C0",borderColor:"#000000",shadow:!1}},dataLabels:{align:null,verticalAlign:null,y:null},stickyTracking:!1,threshold:0});ca=ia(O,{type:"column",pointAttrToOptions:{stroke:"borderColor","stroke-width":"borderWidth",fill:"color",r:"borderRadius"},cropShoulder:0,trackerGroups:["group","dataLabelsGroup"],negStacks:!0,init:function(){O.prototype.init.apply(this,arguments);var a=this,b=a.chart;b.hasRendered&&p(b.series,function(b){if(b.type===a.type)b.isDirty=!0})},getColumnMetrics:function(){var a=this,b=a.options,c=a.xAxis,d=a.yAxis,e=c.reversed,f,g={},h,i=0;b.grouping===!1?i=1:p(a.chart.series,function(b){var c=b.options,e=b.yAxis;if(b.type===a.type&&b.visible&&d.len===e.len&&d.pos===e.pos)c.stacking?(f=b.stackKey,g[f]===u&&(g[f]=i++),h=g[f]):c.grouping!==!1&&(h=i++),b.columnIndex=h});var c=I(M(c.transA)*(c.ordinalSlope||b.pointRange||c.closestPointRange||1),c.len),j=c*b.groupPadding,k=(c-2*j)/i,l=b.pointWidth,b=t(l)?(k-l)/2:k*b.pointPadding,l=n(l,k-2*b);return a.columnMetrics={width:l,offset:b+(j+((e?i-(a.columnIndex||0):a.columnIndex)||0)*k-c/2)*(e?-1:1)}},translate:function(){var a=this.chart,b=this.options,c=b.borderWidth,d=this.yAxis,e=this.translatedThreshold=d.getThreshold(b.threshold),f=n(b.minPointLength,5),b=this.getColumnMetrics(),g=b.width,h=this.barW=Ha(s(g,1+2*c)),i=this.pointXOffset=b.offset,j=-(c%2?0.5:0),k=c%2?0.5:1;a.renderer.isVML&&a.inverted&&(k+=1);O.prototype.translate.apply(this);p(this.points,function(a){var b=n(a.yBottom,e),c=I(s(-999-b,a.plotY),d.len+999+b),o=a.plotX+i,p=h,r=I(c,b),t,c=s(c,b)-r;M(c)<f&&f&&(c=f,r=w(M(r-e)>f?b-f:e-(d.translate(a.y,0,1,0,1)<=e?f:0)));a.barX=o;a.pointWidth=g;b=M(o)<0.5;p=w(o+p)+j;o=w(o)+j;p-=o;t=M(r)<0.5;c=w(r+c)+k;r=w(r)+k;c-=r;b&&(o+=1,p-=1);t&&(r-=1,c+=1);a.shapeType="rect";a.shapeArgs={x:o,y:r,width:p,height:c}})},getSymbol:la,drawLegendSymbol:R.drawRectangle,drawGraph:la,drawPoints:function(){var a=this,b=this.chart,c=a.options,d=b.renderer,e=b.options.animationLimit||250,f;p(a.points,function(g){var h=g.plotY,i=g.graphic;if(h!==u&&!isNaN(h)&&g.y!==null)f=g.shapeArgs,i?(Za(i),i[b.pointCount<e?"animate":"attr"](x(f))):g.graphic=d[g.shapeType](f).attr(g.pointAttr[g.selected?"select":""]).add(a.group).shadow(c.shadow,null,c.stacking&&!c.borderRadius);else if(i)g.graphic=i.destroy()})},drawTracker:J.drawTrackerPoint,animate:function(a){var b=this.yAxis,c=this.options,d=this.chart.inverted,e={};if(V)a?(e.scaleY=0.001,a=I(b.pos+b.len,s(b.pos,b.toPixels(c.threshold))),d?e.translateX=a-b.len:e.translateY=a,this.group.attr(e)):(e.scaleY=1,e[d?"translateX":"translateY"]=b.pos,this.group.animate(e,this.options.animation),this.animate=null)},remove:function(){var a=this,b=a.chart;b.hasRendered&&p(b.series,function(b){if(b.type===a.type)b.isDirty=!0});O.prototype.remove.apply(a,arguments)}});L.column=ca;Y.bar=x(Y.column);ca=ia(ca,{type:"bar",inverted:!0});L.bar=ca;Y.scatter=x(W,{lineWidth:0,tooltip:{headerFormat:'<span style="font-size: 10px; color:{series.color}">{series.name}</span><br/>',pointFormat:"x: <b>{point.x}</b><br/>y: <b>{point.y}</b><br/>",followPointer:!0},stickyTracking:!1});ca=ia(O,{type:"scatter",sorted:!1,requireSorting:!1,noSharedTooltip:!0,trackerGroups:["markerGroup"],takeOrdinalPosition:!1,drawTracker:J.drawTrackerPoint,drawGraph:function(){this.options.lineWidth&&O.prototype.drawGraph.call(this)},setTooltipPoints:la});L.scatter=ca;Y.pie=x(W,{borderColor:"#FFFFFF",borderWidth:1,center:[null,null],clip:!1,colorByPoint:!0,dataLabels:{distance:30,enabled:!0,formatter:function(){return this.point.name}},ignoreHiddenPoint:!0,legendType:"point",marker:null,size:null,showInLegend:!1,slicedOffset:10,states:{hover:{brightness:0.1,shadow:!1}},stickyTracking:!1,tooltip:{followPointer:!0}});W={type:"pie",isCartesian:!1,pointClass:ia(Ja,{init:function(){Ja.prototype.init.apply(this,arguments);var a=this,b;if(a.y<0)a.y=null;r(a,{visible:a.visible!==!1,name:n(a.name,"Slice")});b=function(b){a.slice(b.type==="select")};F(a,"select",b);F(a,"unselect",b);return a},setVisible:function(a){var b=this,c=b.series,d=c.chart,e;b.visible=b.options.visible=a=a===u?!b.visible:a;c.options.data[sa(b,c.data)]=b.options;e=a?"show":"hide";p(["graphic","dataLabel","connector","shadowGroup"],function(a){if(b[a])b[a][e]()});b.legendItem&&d.legend.colorizeItem(b,a);if(!c.isDirty&&c.options.ignoreHiddenPoint)c.isDirty=!0,d.redraw()},slice:function(a,b,c){var d=this.series;Oa(c,d.chart);n(b,!0);this.sliced=this.options.sliced=a=t(a)?a:!this.sliced;d.options.data[sa(this,d.data)]=this.options;a=a?this.slicedTranslation:{translateX:0,translateY:0};this.graphic.animate(a);this.shadowGroup&&this.shadowGroup.animate(a)}}),requireSorting:!1,noSharedTooltip:!0,trackerGroups:["group","dataLabelsGroup"],axisTypes:[],pointAttrToOptions:{stroke:"borderColor","stroke-width":"borderWidth",fill:"color"},getColor:la,animate:function(a){var b=this,c=b.points,d=b.startAngleRad;if(!a)p(c,function(a){var c=a.graphic,a=a.shapeArgs;c&&(c.attr({r:b.center[3]/2,start:d,end:d}),c.animate({r:a.r,start:a.start,end:a.end},b.options.animation))}),b.animate=null},setData:function(a,b){O.prototype.setData.call(this,a,!1);this.processData();this.generatePoints();n(b,!0)&&this.chart.redraw()},generatePoints:function(){var a,b=0,c,d,e,f=this.options.ignoreHiddenPoint;O.prototype.generatePoints.call(this);c=this.points;d=c.length;for(a=0;a<d;a++)e=c[a],b+=f&&!e.visible?0:e.y;this.total=b;for(a=0;a<d;a++)e=c[a],e.percentage=b>0?e.y/b*100:0,e.total=b},translate:function(a){this.generatePoints();var b=0,c=this.options,d=c.slicedOffset,e=d+c.borderWidth,f,g,h,i=c.startAngle||0,j=this.startAngleRad=Aa/180*(i-90),i=(this.endAngleRad=Aa/180*((c.endAngle||i+360)-90))-j,k=this.points,l=c.dataLabels.distance,c=c.ignoreHiddenPoint,m,n=k.length,o;if(!a)this.center=a=this.getCenter();this.getX=function(b,c){h=P.asin((b-a[1])/(a[2]/2+l));return a[0]+(c?-1:1)*U(h)*(a[2]/2+l)};for(m=0;m<n;m++){o=k[m];f=j+b*i;if(!c||o.visible)b+=o.percentage/100;g=j+b*i;o.shapeType="arc";o.shapeArgs={x:a[0],y:a[1],r:a[2]/2,innerR:a[3]/2,start:w(f*1E3)/1E3,end:w(g*1E3)/1E3};h=(g+f)/2;h>0.75*i&&(h-=2*Aa);o.slicedTranslation={translateX:w(U(h)*d),translateY:w(ba(h)*d)};f=U(h)*a[2]/2;g=ba(h)*a[2]/2;o.tooltipPos=[a[0]+f*0.7,a[1]+g*0.7];o.half=h<-Aa/2||h>Aa/2?1:0;o.angle=h;e=I(e,l/2);o.labelPos=[a[0]+f+U(h)*l,a[1]+g+ba(h)*l,a[0]+
f+U(h)*e,a[1]+g+ba(h)*e,a[0]+f,a[1]+g,l<0?"center":o.half?"right":"left",h]}},setTooltipPoints:la,drawGraph:null,drawPoints:function(){var a=this,b=a.chart.renderer,c,d,e=a.options.shadow,f,g;if(e&&!a.shadowGroup)a.shadowGroup=b.g("shadow").add(a.group);p(a.points,function(h){d=h.graphic;g=h.shapeArgs;f=h.shadowGroup;if(e&&!f)f=h.shadowGroup=b.g("shadow").add(a.shadowGroup);c=h.sliced?h.slicedTranslation:{translateX:0,translateY:0};f&&f.attr(c);d?d.animate(r(g,c)):h.graphic=d=b.arc(g).setRadialReference(a.center).attr(h.pointAttr[h.selected?"select":""]).attr({"stroke-linejoin":"round"}).attr(c).add(a.group).shadow(e,f);h.visible!==void 0&&h.setVisible(h.visible)})},sortByAngle:function(a,b){a.sort(function(a,d){return a.angle!==void 0&&(d.angle-a.angle)*b})},drawTracker:J.drawTrackerPoint,drawLegendSymbol:R.drawRectangle,getCenter:xb.getCenter,getSymbol:la};W=ia(O,W);L.pie=W;O.prototype.drawDataLabels=function(){var a=this,b=a.options,c=b.cursor,d=b.dataLabels,b=a.points,e,f,g,h;if(d.enabled||a._hasPointLabels)a.dlProcessOptions&&a.dlProcessOptions(d),h=a.plotGroup("dataLabelsGroup","data-labels",a.visible?"visible":"hidden",d.zIndex||6),f=d,p(b,function(b){var j,k=b.dataLabel,l,m,p=b.connector,o=!0;e=b.options&&b.options.dataLabels;j=n(e&&e.enabled,f.enabled);if(k&&!j)b.dataLabel=k.destroy();else if(j){d=x(f,e);j=d.rotation;l=b.getLabelConfig();g=d.format?Fa(d.format,l):d.formatter.call(l,d);d.style.color=n(d.color,d.style.color,a.color,"black");if(k)if(t(g))k.attr({text:g}),o=!1;else{if(b.dataLabel=k=k.destroy(),p)b.connector=p.destroy()}else if(t(g)){k={fill:d.backgroundColor,stroke:d.borderColor,"stroke-width":d.borderWidth,r:d.borderRadius||0,rotation:j,padding:d.padding,zIndex:1};for(m in k)k[m]===u&&delete k[m];k=b.dataLabel=a.chart.renderer[j?"text":"label"](g,0,-999,null,null,null,d.useHTML).attr(k).css(r(d.style,c&&{cursor:c})).add(h).shadow(d.shadow)}k&&a.alignDataLabel(b,k,d,null,o)}})};O.prototype.alignDataLabel=function(a,b,c,d,e){var f=this.chart,g=f.inverted,h=n(a.plotX,-999),i=n(a.plotY,-999),j=b.getBBox();if(a=this.visible&&(a.series.forceDL||f.isInsidePlot(a.plotX,a.plotY,g)))d=r({x:g?f.plotWidth-i:h,y:w(g?f.plotHeight-h:i),width:0,height:0},d),r(c,{width:j.width,height:j.height}),c.rotation?(g={align:c.align,x:d.x+c.x+d.width/2,y:d.y+c.y+d.height/2},b[e?"attr":"animate"](g)):(b.align(c,null,d),g=b.alignAttr,n(c.overflow,"justify")==="justify"?this.justifyDataLabel(b,c,g,j,d,e):n(c.crop,!0)&&(a=f.isInsidePlot(g.x,g.y)&&f.isInsidePlot(g.x+j.width,g.y+j.height)));if(!a)b.attr({y:-999}),b.placed=!1};O.prototype.justifyDataLabel=function(a,b,c,d,e,f){var g=this.chart,h=b.align,i=b.verticalAlign,j,k;j=c.x;if(j<0)h==="right"?b.align="left":b.x=-j,k=!0;j=c.x+d.width;if(j>g.plotWidth)h==="left"?b.align="right":b.x=g.plotWidth-j,k=!0;j=c.y;if(j<0)i==="bottom"?b.verticalAlign="top":b.y=-j,k=!0;j=c.y+d.height;if(j>g.plotHeight)i==="top"?b.verticalAlign="bottom":b.y=g.plotHeight-j,k=!0;if(k)a.placed=!f,a.align(b,null,e)};if(L.pie)L.pie.prototype.drawDataLabels=function(){var a=this,b=a.data,c,d=a.chart,e=a.options.dataLabels,f=n(e.connectorPadding,10),g=n(e.connectorWidth,1),h=d.plotWidth,d=d.plotHeight,i,j,k=n(e.softConnector,!0),l=e.distance,m=a.center,q=m[2]/2,o=m[1],r=l>0,t,u,v,x,y=[[],[]],z,A,E,K,B,D=[0,0,0,0],I=function(a,b){return b.y-a.y};if(a.visible&&(e.enabled||a._hasPointLabels)){O.prototype.drawDataLabels.apply(a);p(b,function(a){a.dataLabel&&a.visible&&y[a.half].push(a)});for(K=0;!x&&b[K];)x=b[K]&&b[K].dataLabel&&(b[K].dataLabel.getBBox().height||21),K++;for(K=2;K--;){var b=[],J=[],F=y[K],G=F.length,C;a.sortByAngle(F,K-0.5);if(l>0){for(B=o-q-l;B<=o+q+l;B+=x)b.push(B);u=b.length;if(G>u){c=[].concat(F);c.sort(I);for(B=G;B--;)c[B].rank=B;for(B=G;B--;)F[B].rank>=u&&F.splice(B,1);G=F.length}for(B=0;B<G;B++){c=F[B];v=c.labelPos;c=9999;var L,N;for(N=0;N<u;N++)L=M(b[N]-v[1]),L<c&&(c=L,C=N);if(C<B&&b[B]!==null)C=B;else for(u<G-B+C&&b[B]!==null&&(C=u-G+B);b[C]===null;)C++;J.push({i:C,y:b[C]});b[C]=null}J.sort(I)}for(B=0;B<G;B++){c=F[B];v=c.labelPos;t=c.dataLabel;E=c.visible===!1?"hidden":"visible";c=v[1];if(l>0){if(u=J.pop(),C=u.i,A=u.y,c>A&&b[C+1]!==null||c<A&&b[C-1]!==null)A=c}else A=c;z=e.justify?m[0]+(K?-1:1)*(q+l):a.getX(C===0||C===b.length-1?c:A,K);t._attr={visibility:E,align:v[6]};t._pos={x:z+e.x+({left:f,right:-f}[v[6]]||0),y:A+e.y-10};t.connX=z;t.connY=A;if(this.options.size===null)u=t.width,z-u<f?D[3]=s(w(u-z+f),D[3]):z+u>h-f&&(D[1]=s(w(z+u-h+f),D[1])),A-x/2<0?D[0]=s(w(-A+x/2),D[0]):A+x/2>d&&(D[2]=s(w(A+x/2-d),D[2]))}}if(za(D)===0||this.verifyDataLabelOverflow(D))this.placeDataLabels(),r&&g&&p(this.points,function(b){i=b.connector;v=b.labelPos;if((t=b.dataLabel)&&t._pos)E=t._attr.visibility,z=t.connX,A=t.connY,j=k?["M",z+(v[6]==="left"?5:-5),A,"C",z,A,2*v[2]-v[4],2*v[3]-v[5],v[2],v[3],"L",v[4],v[5]]:["M",z+(v[6]==="left"?5:-5),A,"L",v[2],v[3],"L",v[4],v[5]],i?(i.animate({d:j}),i.attr("visibility",E)):b.connector=i=a.chart.renderer.path(j).attr({"stroke-width":g,stroke:e.connectorColor||b.color||"#606060",visibility:E}).add(a.group);else if(i)b.connector=i.destroy()})}},L.pie.prototype.placeDataLabels=function(){p(this.points,function(a){var a=a.dataLabel,b;if(a)(b=a._pos)?(a.attr(a._attr),a[a.moved?"animate":"attr"](b),a.moved=!0):a&&a.attr({y:-999})})},L.pie.prototype.alignDataLabel=la,L.pie.prototype.verifyDataLabelOverflow=function(a){var b=this.center,c=this.options,d=c.center,e=c=c.minSize||80,f;d[0]!==null?e=s(b[2]-s(a[1],a[3]),c):(e=s(b[2]-a[1]-a[3],c),b[0]+=(a[3]-a[1])/2);d[1]!==null?e=s(I(e,b[2]-s(a[0],a[2])),c):(e=s(I(e,b[2]-a[0]-a[2]),c),b[1]+=(a[0]-a[2])/2);e<b[2]?(b[2]=e,this.translate(b),p(this.points,function(a){if(a.dataLabel)a.dataLabel._pos=null}),this.drawDataLabels&&this.drawDataLabels()):f=!0;return f};if(L.column)L.column.prototype.alignDataLabel=function(a,b,c,d,e){var f=this.chart,g=f.inverted,h=a.dlBox||a.shapeArgs,i=a.below||a.plotY>n(this.translatedThreshold,f.plotSizeY),j=n(c.inside,!!this.options.stacking);if(h&&(d=x(h),g&&(d={x:f.plotWidth-d.y-d.height,y:f.plotHeight-d.x-d.width,width:d.height,height:d.width}),!j))g?(d.x+=i?0:d.width,d.width=0):(d.y+=i?d.height:0,d.height=0);c.align=n(c.align,!g||j?"center":i?"right":"left");c.verticalAlign=n(c.verticalAlign,g||j?"middle":i?"top":"bottom");O.prototype.alignDataLabel.call(this,a,b,c,d,e)};r(Highcharts,{Axis:qa,Chart:fb,Color:ta,Point:Ja,Tick:Qa,Tooltip:tb,Renderer:Ya,Series:O,SVGElement:pa,SVGRenderer:ua,arrayMin:La,arrayMax:za,charts:Ia,dateFormat:ab,format:Fa,pathAnim:vb,getOptions:function(){return G},hasBidiBug:Nb,isTouchDevice:Ib,numberFormat:Da,seriesTypes:L,setOptions:function(a){G=x(!0,G,a);Bb();return G},addEvent:F,removeEvent:X,createElement:T,discardElement:Na,css:D,each:p,extend:r,map:Ra,merge:x,pick:n,splat:ja,extendClass:ia,pInt:z,wrap:Va,svg:V,canvas:da,vml:!V&&!da,product:"Highcharts",version:"3.0.9"})})();(function(k,D){function J(a,b,c){this.init.call(this,a,b,c)}var N=k.arrayMin,O=k.arrayMax,t=k.each,z=k.extend,q=k.merge,P=k.map,r=k.pick,w=k.pInt,o=k.getOptions().plotOptions,h=k.seriesTypes,u=k.extendClass,K=k.splat,p=k.wrap,L=k.Axis,A=k.Tick,H=k.Point,Q=k.Pointer,R=k.TrackerMixin,S=k.CenteredSeriesMixin,x=k.Series,v=Math,E=v.round,B=v.floor,T=v.max,U=k.Color,s=function(){};z(J.prototype,{init:function(a,b,c){var d=this,e=d.defaultOptions;d.chart=b;if(b.angular)e.background={};d.options=a=q(e,a);(a=a.background)&&t([].concat(K(a)).reverse(),function(a){var f=a.backgroundColor,a=q(d.defaultBackgroundOptions,a);if(f)a.backgroundColor=f;a.color=a.backgroundColor;c.options.plotBands.unshift(a)})},defaultOptions:{center:["50%","50%"],size:"85%",startAngle:0},defaultBackgroundOptions:{shape:"circle",borderWidth:1,borderColor:"silver",backgroundColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[0,"#FFF"],[1,"#DDD"]]},from:Number.MIN_VALUE,innerRadius:0,to:Number.MAX_VALUE,outerRadius:"105%"}});var G=L.prototype,A=A.prototype,V={getOffset:s,redraw:function(){this.isDirty=!1},render:function(){this.isDirty=!1},setScale:s,setCategories:s,setTitle:s},M={isRadial:!0,defaultRadialGaugeOptions:{labels:{align:"center",x:0,y:null},minorGridLineWidth:0,minorTickInterval:"auto",minorTickLength:10,minorTickPosition:"inside",minorTickWidth:1,plotBands:[],tickLength:10,tickPosition:"inside",tickWidth:2,title:{rotation:0},zIndex:2},defaultRadialXOptions:{gridLineWidth:1,labels:{align:null,distance:15,x:0,y:null},maxPadding:0,minPadding:0,plotBands:[],showLastLabel:!1,tickLength:0},defaultRadialYOptions:{gridLineInterpolation:"circle",labels:{align:"right",x:-3,y:-2},plotBands:[],showLastLabel:!1,title:{x:4,text:null,rotation:90}},setOptions:function(a){this.options=q(this.defaultOptions,this.defaultRadialOptions,a)},getOffset:function(){G.getOffset.call(this);this.chart.axisOffset[this.side]=0;this.center=this.pane.center=S.getCenter.call(this.pane)},getLinePath:function(a,b){var c=this.center,b=r(b,c[2]/2-this.offset);return this.chart.renderer.symbols.arc(this.left+c[0],this.top+c[1],b,b,{start:this.startAngleRad,end:this.endAngleRad,open:!0,innerR:0})},setAxisTranslation:function(){G.setAxisTranslation.call(this);if(this.center)this.transA=this.isCircular?(this.endAngleRad-this.startAngleRad)/(this.max-this.min||1):this.center[2]/2/(this.max-this.min||1),this.minPixelPadding=this.isXAxis?this.transA*this.minPointOffset+(this.reversed?(this.endAngleRad-this.startAngleRad)/4:0):0},beforeSetTickPositions:function(){this.autoConnect&&(this.max+=this.categories&&1||this.pointRange||this.closestPointRange||0)},setAxisSize:function(){G.setAxisSize.call(this);if(this.isRadial)this.center=this.pane.center=k.CenteredSeriesMixin.getCenter.call(this.pane),this.len=this.width=this.height=this.isCircular?this.center[2]*(this.endAngleRad-this.startAngleRad)/2:this.center[2]/2},getPosition:function(a,b){if(!this.isCircular)b=this.translate(a),a=this.min;return this.postTranslate(this.translate(a),r(b,this.center[2]/2)-this.offset)},postTranslate:function(a,b){var c=this.chart,d=this.center,a=this.startAngleRad+a;return{x:c.plotLeft+d[0]+Math.cos(a)*b,y:c.plotTop+d[1]+Math.sin(a)*b}},getPlotBandPath:function(a,b,c){var d=this.center,e=this.startAngleRad,g=d[2]/2,f=[r(c.outerRadius,"100%"),c.innerRadius,r(c.thickness,10)],j=/%$/,n,l=this.isCircular;this.options.gridLineInterpolation==="polygon"?d=this.getPlotLinePath(a).concat(this.getPlotLinePath(b,!0)):(l||(f[0]=this.translate(a),f[1]=this.translate(b)),f=P(f,function(a){j.test(a)&&(a=w(a,10)*g/100);return a}),c.shape==="circle"||!l?(a=-Math.PI/2,b=Math.PI*1.5,n=!0):(a=e+this.translate(a),b=e+this.translate(b)),d=this.chart.renderer.symbols.arc(this.left+d[0],this.top+d[1],f[0],f[0],{start:a,end:b,innerR:r(f[1],f[0]-f[2]),open:n}));return d},getPlotLinePath:function(a,b){var c=this.center,d=this.chart,e=this.getPosition(a),g,f,j;this.isCircular?j=["M",c[0]+d.plotLeft,c[1]+d.plotTop,"L",e.x,e.y]:this.options.gridLineInterpolation==="circle"?(a=this.translate(a))&&(j=this.getLinePath(0,a)):(g=d.xAxis[0],j=[],a=this.translate(a),c=g.tickPositions,g.autoConnect&&(c=c.concat([c[0]])),b&&(c=[].concat(c).reverse()),t(c,function(c,b){f=g.getPosition(c,a);j.push(b?"L":"M",f.x,f.y)}));return j},getTitlePosition:function(){var a=this.center,b=this.chart,c=this.options.title;return{x:b.plotLeft+a[0]+(c.x||0),y:b.plotTop+a[1]-{high:0.5,middle:0.25,low:0}[c.align]*a[2]+(c.y||0)}}};p(G,"init",function(a,b,c){var i;var d=b.angular,e=b.polar,g=c.isX,f=d&&g,j,n;n=b.options;var l=c.pane||0;if(d){if(z(this,f?V:M),j=!g)this.defaultRadialOptions=this.defaultRadialGaugeOptions}else if(e)z(this,M),this.defaultRadialOptions=(j=g)?this.defaultRadialXOptions:q(this.defaultYAxisOptions,this.defaultRadialYOptions);a.call(this,b,c);if(!f&&(d||e)){a=this.options;if(!b.panes)b.panes=[];this.pane=(i=b.panes[l]=b.panes[l]||new J(K(n.pane)[l],b,this),l=i);l=l.options;b.inverted=!1;n.chart.zoomType=null;this.startAngleRad=b=(l.startAngle-90)*Math.PI/180;this.endAngleRad=n=(r(l.endAngle,l.startAngle+360)-90)*Math.PI/180;this.offset=a.offset||0;if((this.isCircular=j)&&c.max===D&&n-b===2*Math.PI)this.autoConnect=!0}});p(A,"getPosition",function(a,b,c,d,e){var g=this.axis;return g.getPosition?g.getPosition(c):a.call(this,b,c,d,e)});p(A,"getLabelPosition",function(a,b,c,d,e,g,f,j,n){var l=this.axis,i=g.y,m=g.align,y=(l.translate(this.pos)+l.startAngleRad+Math.PI/2)/Math.PI*180%360;l.isRadial?(a=l.getPosition(this.pos,l.center[2]/2+r(g.distance,-25)),g.rotation==="auto"?d.attr({rotation:y}):i===null&&(i=l.chart.renderer.fontMetrics(d.styles.fontSize).b-
d.getBBox().height/2),m===null&&(m=l.isCircular?y>20&&y<160?"left":y>200&&y<340?"right":"center":"center",d.attr({align:m})),a.x+=g.x,a.y+=i):a=a.call(this,b,c,d,e,g,f,j,n);return a});p(A,"getMarkPath",function(a,b,c,d,e,g,f){var j=this.axis;j.isRadial?(a=j.getPosition(this.pos,j.center[2]/2+d),b=["M",b,c,"L",a.x,a.y]):b=a.call(this,b,c,d,e,g,f);return b});o.arearange=q(o.area,{lineWidth:1,marker:null,threshold:null,tooltip:{pointFormat:'<span style="color:{series.color}">{series.name}</span>: <b>{point.low}</b> - <b>{point.high}</b><br/>'},trackByArea:!0,dataLabels:{verticalAlign:null,xLow:0,xHigh:0,yLow:0,yHigh:0}});h.arearange=u(h.area,{type:"arearange",pointArrayMap:["low","high"],toYData:function(a){return[a.low,a.high]},pointValKey:"low",getSegments:function(){var a=this;t(a.points,function(b){if(!a.options.connectNulls&&(b.low===null||b.high===null))b.y=null;else if(b.low===null&&b.high!==null)b.y=b.high});x.prototype.getSegments.call(this)},translate:function(){var a=this.yAxis;h.area.prototype.translate.apply(this);t(this.points,function(b){var c=b.low,d=b.high,e=b.plotY;d===null&&c===null?b.y=null:c===null?(b.plotLow=b.plotY=null,b.plotHigh=a.translate(d,0,1,0,1)):d===null?(b.plotLow=e,b.plotHigh=null):(b.plotLow=e,b.plotHigh=a.translate(d,0,1,0,1))})},getSegmentPath:function(a){var b,c=[],d=a.length,e=x.prototype.getSegmentPath,g,f;f=this.options;var j=f.step;for(b=HighchartsAdapter.grep(a,function(a){return a.plotLow!==null});d--;)g=a[d],g.plotHigh!==null&&c.push({plotX:g.plotX,plotY:g.plotHigh});a=e.call(this,b);if(j)j===!0&&(j="left"),f.step={left:"right",center:"center",right:"left"}[j];c=e.call(this,c);f.step=j;f=[].concat(a,c);c[0]="L";this.areaPath=this.areaPath.concat(a,c);return f},drawDataLabels:function(){var a=this.data,b=a.length,c,d=[],e=x.prototype,g=this.options.dataLabels,f,j=this.chart.inverted;if(g.enabled||this._hasPointLabels){for(c=b;c--;)f=a[c],f.y=f.high,f.plotY=f.plotHigh,d[c]=f.dataLabel,f.dataLabel=f.dataLabelUpper,f.below=!1,j?(g.align="left",g.x=g.xHigh):g.y=g.yHigh;e.drawDataLabels&&e.drawDataLabels.apply(this,arguments);for(c=b;c--;)f=a[c],f.dataLabelUpper=f.dataLabel,f.dataLabel=d[c],f.y=f.low,f.plotY=f.plotLow,f.below=!0,j?(g.align="right",g.x=g.xLow):g.y=g.yLow;e.drawDataLabels&&e.drawDataLabels.apply(this,arguments)}},alignDataLabel:function(){h.column.prototype.alignDataLabel.apply(this,arguments)},getSymbol:h.column.prototype.getSymbol,drawPoints:s});o.areasplinerange=q(o.arearange);h.areasplinerange=u(h.arearange,{type:"areasplinerange",getPointSpline:h.spline.prototype.getPointSpline});(function(){var a=h.column.prototype;o.columnrange=q(o.column,o.arearange,{lineWidth:1,pointRange:null});h.columnrange=u(h.arearange,{type:"columnrange",translate:function(){var b=this,c=b.yAxis,d;a.translate.apply(b);t(b.points,function(a){var g=a.shapeArgs,f=b.options.minPointLength,j;a.plotHigh=d=c.translate(a.high,0,1,0,1);a.plotLow=a.plotY;j=d;a=a.plotY-d;a<f&&(f-=a,a+=f,j-=f/2);g.height=a;g.y=j})},trackerGroups:["group","dataLabels"],drawGraph:s,pointAttrToOptions:a.pointAttrToOptions,drawPoints:a.drawPoints,drawTracker:a.drawTracker,animate:a.animate,getColumnMetrics:a.getColumnMetrics})})();o.gauge=q(o.line,{dataLabels:{enabled:!0,y:15,borderWidth:1,borderColor:"silver",borderRadius:3,crop:!1,style:{fontWeight:"bold"},verticalAlign:"top",zIndex:2},dial:{},pivot:{},tooltip:{headerFormat:""},showInLegend:!1});H={type:"gauge",pointClass:u(H,{setState:function(a){this.state=a}}),angular:!0,drawGraph:s,fixedBox:!0,forceDL:!0,trackerGroups:["group","dataLabels"],translate:function(){var a=this.yAxis,b=this.options,c=a.center;this.generatePoints();t(this.points,function(d){var e=q(b.dial,d.dial),g=w(r(e.radius,80))*c[2]/200,f=w(r(e.baseLength,70))*g/100,j=w(r(e.rearLength,10))*g/100,n=e.baseWidth||3,l=e.topWidth||1,i=a.startAngleRad+a.translate(d.y,null,null,null,!0);b.wrap===!1&&(i=Math.max(a.startAngleRad,Math.min(a.endAngleRad,i)));i=i*180/Math.PI;d.shapeType="path";d.shapeArgs={d:e.path||["M",-j,-n/2,"L",f,-n/2,g,-l/2,g,l/2,f,n/2,-j,n/2,"z"],translateX:c[0],translateY:c[1],rotation:i};d.plotX=c[0];d.plotY=c[1]})},drawPoints:function(){var a=this,b=a.yAxis.center,c=a.pivot,d=a.options,e=d.pivot,g=a.chart.renderer;t(a.points,function(f){var c=f.graphic,b=f.shapeArgs,e=b.d,i=q(d.dial,f.dial);c?(c.animate(b),b.d=e):f.graphic=g[f.shapeType](b).attr({stroke:i.borderColor||"none","stroke-width":i.borderWidth||0,fill:i.backgroundColor||"black",rotation:b.rotation}).add(a.group)});c?c.animate({translateX:b[0],translateY:b[1]}):a.pivot=g.circle(0,0,r(e.radius,5)).attr({"stroke-width":e.borderWidth||0,stroke:e.borderColor||"silver",fill:e.backgroundColor||"black"}).translate(b[0],b[1]).add(a.group)},animate:function(a){var b=this;if(!a)t(b.points,function(a){var d=a.graphic;d&&(d.attr({rotation:b.yAxis.startAngleRad*180/Math.PI}),d.animate({rotation:a.shapeArgs.rotation},b.options.animation))}),b.animate=null},render:function(){this.group=this.plotGroup("group","series",this.visible?"visible":"hidden",this.options.zIndex,this.chart.seriesGroup);x.prototype.render.call(this);this.group.clip(this.chart.clipRect)},setData:function(a,b){x.prototype.setData.call(this,a,!1);this.processData();this.generatePoints();r(b,!0)&&this.chart.redraw()},drawTracker:R.drawTrackerPoint};h.gauge=u(h.line,H);o.boxplot=q(o.column,{fillColor:"#FFFFFF",lineWidth:1,medianWidth:2,states:{hover:{brightness:-0.3}},threshold:null,tooltip:{pointFormat:'<span style="color:{series.color};font-weight:bold">{series.name}</span><br/>Maximum: {point.high}<br/>Upper quartile: {point.q3}<br/>Median: {point.median}<br/>Lower quartile: {point.q1}<br/>Minimum: {point.low}<br/>'},whiskerLength:"50%",whiskerWidth:2});h.boxplot=u(h.column,{type:"boxplot",pointArrayMap:["low","q1","median","q3","high"],toYData:function(a){return[a.low,a.q1,a.median,a.q3,a.high]},pointValKey:"high",pointAttrToOptions:{fill:"fillColor",stroke:"color","stroke-width":"lineWidth"},drawDataLabels:s,translate:function(){var a=this.yAxis,b=this.pointArrayMap;h.column.prototype.translate.apply(this);t(this.points,function(c){t(b,function(b){c[b]!==null&&(c[b+"Plot"]=a.translate(c[b],0,1,0,1))})})},drawPoints:function(){var a=this,b=a.points,c=a.options,d=a.chart.renderer,e,g,f,j,n,l,i,m,y,h,k,I,o,p,q,u,x,s,v,w,A,z,F=a.doQuartiles!==!1,C=parseInt(a.options.whiskerLength,10)/100;t(b,function(b){y=b.graphic;A=b.shapeArgs;k={};p={};u={};z=b.color||a.color;if(b.plotY!==D)if(e=b.pointAttr[b.selected?"selected":""],x=A.width,s=B(A.x),v=s+x,w=E(x/2),g=B(F?b.q1Plot:b.lowPlot),f=B(F?b.q3Plot:b.lowPlot),j=B(b.highPlot),n=B(b.lowPlot),k.stroke=b.stemColor||c.stemColor||z,k["stroke-width"]=r(b.stemWidth,c.stemWidth,c.lineWidth),k.dashstyle=b.stemDashStyle||c.stemDashStyle,p.stroke=b.whiskerColor||c.whiskerColor||z,p["stroke-width"]=r(b.whiskerWidth,c.whiskerWidth,c.lineWidth),u.stroke=b.medianColor||c.medianColor||z,u["stroke-width"]=r(b.medianWidth,c.medianWidth,c.lineWidth),u["stroke-linecap"]="round",i=k["stroke-width"]%2/2,m=s+w+i,h=["M",m,f,"L",m,j,"M",m,g,"L",m,n,"z"],F&&(i=e["stroke-width"]%2/2,m=B(m)+i,g=B(g)+i,f=B(f)+i,s+=i,v+=i,I=["M",s,f,"L",s,g,"L",v,g,"L",v,f,"L",s,f,"z"]),C&&(i=p["stroke-width"]%2/2,j+=i,n+=i,o=["M",m-
w*C,j,"L",m+w*C,j,"M",m-w*C,n,"L",m+w*C,n]),i=u["stroke-width"]%2/2,l=E(b.medianPlot)+i,q=["M",s,l,"L",v,l,"z"],y)b.stem.animate({d:h}),C&&b.whiskers.animate({d:o}),F&&b.box.animate({d:I}),b.medianShape.animate({d:q});else{b.graphic=y=d.g().add(a.group);b.stem=d.path(h).attr(k).add(y);if(C)b.whiskers=d.path(o).attr(p).add(y);if(F)b.box=d.path(I).attr(e).add(y);b.medianShape=d.path(q).attr(u).add(y)}})}});o.errorbar=q(o.boxplot,{color:"#000000",grouping:!1,linkedTo:":previous",tooltip:{pointFormat:'<span style="color:{series.color}">{series.name}</span>: <b>{point.low}</b> - <b>{point.high}</b><br/>'},whiskerWidth:null});h.errorbar=u(h.boxplot,{type:"errorbar",pointArrayMap:["low","high"],toYData:function(a){return[a.low,a.high]},pointValKey:"high",doQuartiles:!1,getColumnMetrics:function(){return this.linkedParent&&this.linkedParent.columnMetrics||h.column.prototype.getColumnMetrics.call(this)}});o.waterfall=q(o.column,{lineWidth:1,lineColor:"#333",dashStyle:"dot",borderColor:"#333"});h.waterfall=u(h.column,{type:"waterfall",upColorProp:"fill",pointArrayMap:["low","y"],pointValKey:"y",init:function(a,b){b.stacking=!0;h.column.prototype.init.call(this,a,b)},translate:function(){var a=this.options,b=this.yAxis,c,d,e,g,f,j,n,l,i;c=a.threshold;a=a.borderWidth%2/2;h.column.prototype.translate.apply(this);l=c;e=this.points;for(d=0,c=e.length;d<c;d++){g=e[d];f=g.shapeArgs;j=this.getStack(d);i=j.points[this.index];if(isNaN(g.y))g.y=this.yData[d];n=T(l,l+g.y)+i[0];f.y=b.translate(n,0,1);g.isSum||g.isIntermediateSum?(f.y=b.translate(i[1],0,1),f.height=b.translate(i[0],0,1)-f.y):l+=j.total;f.height<0&&(f.y+=f.height,f.height*=-1);g.plotY=f.y=E(f.y)-a;f.height=E(f.height);g.yBottom=f.y+f.height}},processData:function(a){var b=this.yData,c=this.points,d,e=b.length,g=this.options.threshold||0,f,j,n,l,i,m;j=f=n=l=g;for(m=0;m<e;m++)i=b[m],d=c&&c[m]?c[m]:{},i==="sum"||d.isSum?b[m]=j:i==="intermediateSum"||d.isIntermediateSum?(b[m]=f,f=g):(j+=i,f+=i),n=Math.min(j,n),l=Math.max(j,l);x.prototype.processData.call(this,a);this.dataMin=n;this.dataMax=l},toYData:function(a){if(a.isSum)return"sum";else if(a.isIntermediateSum)return"intermediateSum";return a.y},getAttribs:function(){h.column.prototype.getAttribs.apply(this,arguments);var a=this.options,b=a.states,c=a.upColor||this.color,a=k.Color(c).brighten(0.1).get(),d=q(this.pointAttr),e=this.upColorProp;d[""][e]=c;d.hover[e]=b.hover.upColor||a;d.select[e]=b.select.upColor||c;t(this.points,function(a){if(a.y>0&&!a.color)a.pointAttr=d,a.color=c})},getGraphPath:function(){var a=this.data,b=a.length,c=E(this.options.lineWidth+this.options.borderWidth)%2/2,d=[],e,g,f;for(f=1;f<b;f++)g=a[f].shapeArgs,e=a[f-1].shapeArgs,g=["M",e.x+e.width,e.y+c,"L",g.x,e.y+c],a[f-1].y<0&&(g[2]+=e.height,g[5]+=e.height),d=d.concat(g);return d},getExtremes:s,getStack:function(a){var b=this.yAxis.stacks,c=this.stackKey;this.processedYData[a]<this.options.threshold&&(c="-"+c);return b[c][a]},drawGraph:x.prototype.drawGraph});o.bubble=q(o.scatter,{dataLabels:{inside:!0,style:{color:"white",textShadow:"0px 0px 3px black"},verticalAlign:"middle"},marker:{lineColor:null,lineWidth:1},minSize:8,maxSize:"20%",tooltip:{pointFormat:"({point.x}, {point.y}), Size: {point.z}"},turboThreshold:0,zThreshold:0});h.bubble=u(h.scatter,{type:"bubble",pointArrayMap:["y","z"],parallelArrays:["x","y","z"],trackerGroups:["group","dataLabelsGroup"],bubblePadding:!0,pointAttrToOptions:{stroke:"lineColor","stroke-width":"lineWidth",fill:"fillColor"},applyOpacity:function(a){var b=this.options.marker,c=r(b.fillOpacity,0.5),a=a||b.fillColor||this.color;c!==1&&(a=U(a).setOpacity(c).get("rgba"));return a},convertAttribs:function(){var a=x.prototype.convertAttribs.apply(this,arguments);a.fill=this.applyOpacity(a.fill);return a},getRadii:function(a,b,c,d){var e,g,f,j=this.zData,n=[],l=this.options.sizeBy!=="width";for(g=0,e=j.length;g<e;g++)f=b-a,f=f>0?(j[g]-a)/(b-a):0.5,l&&f>=0&&(f=Math.sqrt(f)),n.push(v.ceil(c+f*(d-c))/2);this.radii=n},animate:function(a){var b=this.options.animation;if(!a)t(this.points,function(a){var d=a.graphic,a=a.shapeArgs;d&&a&&(d.attr("r",1),d.animate({r:a.r},b))}),this.animate=null},translate:function(){var a,b=this.data,c,d,e=this.radii;h.scatter.prototype.translate.call(this);for(a=b.length;a--;)c=b[a],d=e?e[a]:0,c.negative=c.z<(this.options.zThreshold||0),d>=this.minPxSize/2?(c.shapeType="circle",c.shapeArgs={x:c.plotX,y:c.plotY,r:d},c.dlBox={x:c.plotX-d,y:c.plotY-d,width:2*d,height:2*d}):c.shapeArgs=c.plotY=c.dlBox=D},drawLegendSymbol:function(a,b){var c=w(a.itemStyle.fontSize)/2;b.legendSymbol=this.chart.renderer.circle(c,a.baseline-c,c).attr({zIndex:3}).add(b.legendGroup);b.legendSymbol.isMarker=!0},drawPoints:h.column.prototype.drawPoints,alignDataLabel:h.column.prototype.alignDataLabel});L.prototype.beforePadding=function(){var a=this,b=this.len,c=this.chart,d=0,e=b,g=this.isXAxis,f=g?"xData":"yData",j=this.min,n={},l=v.min(c.plotWidth,c.plotHeight),i=Number.MAX_VALUE,m=-Number.MAX_VALUE,h=this.max-j,k=b/h,p=[];this.tickPositions&&(t(this.series,function(b){var f=b.options;if(b.bubblePadding&&b.visible&&(a.allowZoomOutside=!0,p.push(b),g))t(["minSize","maxSize"],function(a){var b=f[a],g=/%$/.test(b),b=w(b);n[a]=g?l*b/100:b}),b.minPxSize=n.minSize,b=b.zData,b.length&&(i=v.min(i,v.max(N(b),f.displayNegative===!1?f.zThreshold:-Number.MAX_VALUE)),m=v.max(m,O(b)))}),t(p,function(a){var b=a[f],c=b.length,l;g&&a.getRadii(i,m,n.minSize,n.maxSize);if(h>0)for(;c--;)typeof b[c]==="number"&&(l=a.radii[c],d=Math.min((b[c]-j)*k-l,d),e=Math.max((b[c]-j)*k+l,e))}),p.length&&h>0&&r(this.options.min,this.userMin)===D&&r(this.options.max,this.userMax)===D&&(e-=b,k*=(b+d-e)/b,this.min+=d/k,this.max+=e/k))};(function(){function a(a,b,c){a.call(this,b,c);if(this.chart.polar)this.closeSegment=function(a){var b=this.xAxis.center;a.push("L",b[0],b[1])},this.closedStacks=!0}function b(a,b){var c=this.chart,d=this.options.animation,e=this.group,i=this.markerGroup,m=this.xAxis.center,h=c.plotLeft,k=c.plotTop;if(c.polar){if(c.renderer.isSVG)if(d===!0&&(d={}),b){if(c={translateX:m[0]+h,translateY:m[1]+k,scaleX:0.001,scaleY:0.001},e.attr(c),i)i.attrSetters=e.attrSetters,i.attr(c)}else c={translateX:h,translateY:k,scaleX:1,scaleY:1},e.animate(c,d),i&&i.animate(c,d),this.animate=null}else a.call(this,b)}var c=x.prototype,d=Q.prototype,e;c.toXY=function(a){var b,c=this.chart;b=a.plotX;var d=a.plotY;a.rectPlotX=b;a.rectPlotY=d;a.clientX=(b/Math.PI*180+this.xAxis.pane.options.startAngle)%360;b=this.xAxis.postTranslate(a.plotX,this.yAxis.len-d);a.plotX=a.polarPlotX=b.x-c.plotLeft;a.plotY=a.polarPlotY=b.y-c.plotTop};c.orderTooltipPoints=function(a){if(this.chart.polar&&(a.sort(function(a,b){return a.clientX-b.clientX}),a[0]))a[0].wrappedClientX=a[0].clientX+360,a.push(a[0])};h.area&&p(h.area.prototype,"init",a);h.areaspline&&p(h.areaspline.prototype,"init",a);h.spline&&p(h.spline.prototype,"getPointSpline",function(a,b,c,d){var e,i,m,h,k,p,o;if(this.chart.polar){e=c.plotX;i=c.plotY;a=b[d-1];m=b[d+1];this.connectEnds&&(a||(a=b[b.length-2]),m||(m=b[1]));if(a&&m)h=a.plotX,k=a.plotY,b=m.plotX,p=m.plotY,h=(1.5*e+h)/2.5,k=(1.5*i+k)/2.5,m=(1.5*e+b)/2.5,o=(1.5*i+p)/2.5,b=Math.sqrt(Math.pow(h-e,2)+Math.pow(k-i,2)),p=Math.sqrt(Math.pow(m-e,2)+Math.pow(o-i,2)),h=Math.atan2(k-i,h-e),k=Math.atan2(o-i,m-e),o=Math.PI/2+(h+k)/2,Math.abs(h-
o)>Math.PI/2&&(o-=Math.PI),h=e+Math.cos(o)*b,k=i+Math.sin(o)*b,m=e+Math.cos(Math.PI+o)*p,o=i+Math.sin(Math.PI+o)*p,c.rightContX=m,c.rightContY=o;d?(c=["C",a.rightContX||a.plotX,a.rightContY||a.plotY,h||e,k||i,e,i],a.rightContX=a.rightContY=null):c=["M",e,i]}else c=a.call(this,b,c,d);return c});p(c,"translate",function(a){a.call(this);if(this.chart.polar&&!this.preventPostTranslate)for(var a=this.points,b=a.length;b--;)this.toXY(a[b])});p(c,"getSegmentPath",function(a,b){var c=this.points;if(this.chart.polar&&this.options.connectEnds!==!1&&b[b.length-1]===c[c.length-1]&&c[0].y!==null)this.connectEnds=!0,b=[].concat(b,[c[0]]);return a.call(this,b)});p(c,"animate",b);p(c,"setTooltipPoints",function(a,b){this.chart.polar&&z(this.xAxis,{tooltipLen:360});return a.call(this,b)});if(h.column)e=h.column.prototype,p(e,"animate",b),p(e,"translate",function(a){var b=this.xAxis,c=this.yAxis.len,d=b.center,e=b.startAngleRad,i=this.chart.renderer,h,k;this.preventPostTranslate=!0;a.call(this);if(b.isRadial){b=this.points;for(k=b.length;k--;)h=b[k],a=h.barX+e,h.shapeType="path",h.shapeArgs={d:i.symbols.arc(d[0],d[1],c-h.plotY,null,{start:a,end:a+h.pointWidth,innerR:c-r(h.yBottom,c)})},this.toXY(h)}}),p(e,"alignDataLabel",function(a,b,d,e,h,i){if(this.chart.polar){a=b.rectPlotX/Math.PI*180;if(e.align===null)e.align=a>20&&a<160?"left":a>200&&a<340?"right":"center";if(e.verticalAlign===null)e.verticalAlign=a<45||a>315?"bottom":a>135&&a<225?"top":"middle";c.alignDataLabel.call(this,b,d,e,h,i)}else a.call(this,b,d,e,h,i)});p(d,"getIndex",function(a,b){var c,d=this.chart,e;d.polar?(e=d.xAxis[0].center,c=b.chartX-e[0]-d.plotLeft,d=b.chartY-e[1]-d.plotTop,c=180-Math.round(Math.atan2(c,d)/Math.PI*180)):c=a.call(this,b);return c});p(d,"getCoordinates",function(a,b){var c=this.chart,d={xAxis:[],yAxis:[]};c.polar?t(c.axes,function(a){var e=a.isXAxis,g=a.center,h=b.chartX-g[0]-c.plotLeft,g=b.chartY-g[1]-c.plotTop;d[e?"xAxis":"yAxis"].push({axis:a,value:a.translate(e?Math.PI-Math.atan2(h,g):Math.sqrt(Math.pow(h,2)+Math.pow(g,2)),!0)})}):d=a.call(this,b);return d})})()})(Highcharts);SM.InfiniteScroll=SM.Widgets.register({__NAME:"infiniteScroll",__defaults:{threshold:100,markerID:'',windowScroll:false,onReachedEnd:function(self){},isActive:true},LATENCY:200,removeMarker:function(){this._getMarker().remove();},__init:function(){var self=this;this._$window=$(window);this.__settings.markerID="#"+this.__settings.markerID;this._hasLeftThreshold=true;if(this.__settings.isActive){this._bindEvents();setTimeout(function(){if(self._isInThreshold()){self._hitThreshold();}},0);}},__setters:{isActive:function(self,val){if(val){self._activate();}else{self._deactivate();}}},_activate:function(){if(!this._hasMarker()){this._deactivate();}
if(!this.__settings.isActive){this.__settings.isActive=true;this._hasLeftThreshold=true;this._bindEvents();if(this._isInThreshold()){this._hitThreshold();}}},_deactivate:function(){if(this.__settings.isActive||!this._hasMarker()){this.__settings.isActive=false;this._unbindEvents();}},__destroy:function(){this.set("isActive",false);},_bindEvents:function(){if(this.get("windowScroll")){this._$window.on("scroll",{self:this},this._onScroll);}else{this.$el.on("scroll",{self:this},this._onScroll);}
this._$window.on("resize",{self:this},this._onScroll);},_unbindEvents:function(){if(this.get("windowScroll")){this._$window.off("scroll",this._onScroll);}else{this.$el.off("scroll",this._onScroll);}
this._$window.off("resize",this._onScroll);},_hasMarker:function(){return this._getMarker().length>0;},_hitThreshold:function(){if(this.__settings.isActive){this.set("isActive",false);this.__settings.onReachedEnd(this);this.trigger("reachedEnd");}},_getScrollBottom:function(){if(this.__settings.windowScroll){return this._$window.scrollTop()+this._$window.height();}else{return this.$el.scrollTop()+this.el.clientHeight;}},_getMarker:function(){return $(this.get("markerID"));},_getMarkerTop:function(){var $marker=this._getMarker(),coords;if(this.__settings.windowScroll){coords=SM.DOM.getCoordinates($marker[0]);}else{coords=SM.DOM.getCoordinates($marker[0],this.$el[0]);}
return coords.top;},_isInThreshold:function(){var isInThreshold;if(!this._hasMarker()){this.set("isActive",false);return false;}
isInThreshold=this._getScrollBottom()>=(this._getMarkerTop()-this.get("threshold"));return isInThreshold;},_checkIfHitThreshold:function(){var isInThresholdNow=this._isInThreshold();if(isInThresholdNow){if(this._hasLeftThreshold){this._hitThreshold();}}
this._hasLeftThreshold=!isInThresholdNow;},_onScroll:function(e){var self=e.data.self;if(!self._isThrottling&&self.__settings.isActive){self._isThrottling=true;self._checkIfHitThreshold();setTimeout(function(){if(self.__settings.isActive){self._checkIfHitThreshold();}
self._isThrottling=false;},self.LATENCY);}}});SM.MultiSelect=SM.Widgets.register({__NAME:"multiselect",__defaults:{checkboxSelector:'input[type="checkbox"]'},__init:function(){this.set("lastTarget",null);this._checkedSelector=this.get("checkboxSelector")+":checked";$(document).on("keydown",{self:this},this._onKeydown).on("keyup",{self:this},this._onKeyup);this.$el.on("change",this.get("checkboxSelector"),{self:this},this._onCheckboxChange);},__destroy:function(){this.set("lastTarget",null);$(document).off("keydown",this._onKeydown).off("keyup",this._onKeyup);},reset:function(){this.set("lastTarget",null);},_applySelection:function(target){var lastTarget=this._getLastTarget(),$checkboxes,lastIndex,firstIndex,tempIndex;$checkboxes=this.$el.find(this.get("checkboxSelector"));lastIndex=$checkboxes.index(lastTarget);firstIndex=$checkboxes.index(target);if(lastIndex===firstIndex){return;}
if(lastIndex<firstIndex){tempIndex=lastIndex;lastIndex=firstIndex;firstIndex=tempIndex;}
$checkboxes=$checkboxes.slice(firstIndex,lastIndex+1);$checkboxes.each(function(){this.checked=true;});this.trigger({type:"applied",$checkboxes:$checkboxes});},_getLastTarget:function(){return this.get("lastTarget")||this.$el.find(this.get("checkboxSelector")).first().get(0);},_onCheckboxChange:function(e){var self=e.data.self,$target=$(e.target),isChecked=$target.prop("checked");if(isChecked&&self._isShiftPressed){self._applySelection(e.target);}
self.set("lastTarget",e.target);if(!isChecked&&!self.$el.find(self._checkedSelector).length){self.reset();}},_onKeyup:function(e){if(e.which===SM.KeyCodes.SHIFT){e.data.self._isShiftPressed=false;}},_onKeydown:function(e){if(e.which===SM.KeyCodes.SHIFT){e.data.self._isShiftPressed=true;}}});var Hightables=new function(options){var self=this,log=SM.log;self.renderTable=function(options){var tableData=options.tableData,tableClasses=options.tableClasses,tableAttrs=options.tableAttrs,$target=options.target,tableHTML;var $table=$("<table></table>"),$thead=$("<thead></thead>"),$tbody=$("<tbody></tbody>"),$tfoot=$("<tfoot></tfoot>");if(tableData.caption){_renderTableCaption(tableData.caption,$table);}
_renderTableRows(tableData.thead.rows,$thead);$table.append($thead);_renderTableRows(tableData.tbody.rows,$tbody);$table.append($tbody);if(tableData.tfoot){_renderTableRows(tableData.tfoot.rows,$tfoot);$table.append($tfoot);} 
$table.addClass(tableClasses); _.each(tableAttrs,function(value,key){$table.attr("data-"+key,value);}); if(options.useDivs||options.flattenNestedTables){ tableHTML=$table[0].outerHTML;if(options.useDivs){tableHTML=_convertTableTagsToDivs(tableHTML);} 
if(options.flattenNestedTables){tableHTML=_flattenNestedTables(tableHTML);} 
$table=$(tableHTML);} 
_bindEvents($table,options.events); $target.html($table);};function _renderTableCaption(caption,$table){var captionHTML=SM.Template.renderHTML(caption.template,caption.context);$table.append(captionHTML);}
function _renderTableRows(tableRows,tableSection){var rowHTML,cellHTML,$tr;_.each(tableRows,function(tableRow){rowHTML=_renderTableRow(tableRow);$tr=$(rowHTML);if(tableRow.cells){_.each(tableRow.cells,function(tableCell){cellHTML=_renderTableCell(tableCell);$tr.append(cellHTML);});}
tableSection.append($tr);});}
function _renderTableRow(tableRow){var rowHTML;if(tableRow.template){rowHTML=SM.Template.renderHTML(tableRow.template,tableRow.context);}else{rowHTML="<tr></tr>";}
return rowHTML;}
function _renderTableCell(tableCell){var cellHTML=SM.Template.renderHTML(tableCell.template,tableCell.context);return cellHTML;}
function _convertTableTagsToDivs(tableHTML){var tags,openingTagRegex,closingTagRegex,openingHTML,closingHTML;tags=["table","caption","thead","tbody","tfoot","tr","th","td"];_.each(tags,function(tag){openingTagRegex=new RegExp('<'+tag,'g');openingHTML="<div display='"+tag+"'";tableHTML=tableHTML.replace(openingTagRegex,openingHTML);closingTagRegex=new RegExp('</'+tag,'g');closingHTML="</div";tableHTML=tableHTML.replace(closingTagRegex,closingHTML);});return tableHTML;}
function _flattenNestedTables(tableHTML){var $table=$(tableHTML),$nestedTable=$table.find(".nested-table"),nestedTableHTML;if($nestedTable.length){nestedTableHTML=$nestedTable.html();$nestedTable.remove();tableHTML=$table[0].outerHTML+nestedTableHTML;}
return tableHTML;}
function _bindEvents($table,eventHandlers){var onCaptionClick=eventHandlers.captionClick,onThClick=eventHandlers.thClick,onTdClick=eventHandlers.tdClick;$table.on("click","caption",function(e){if(onCaptionClick){onCaptionClick(e);}});$table.on("click","th",function(e){if(onThClick){onThClick(e);}});$table.on("click","td",function(e){if(onTdClick){onTdClick(e);}});}}();SM.Highcharts={};SM.Highcharts.CHART_WIDTH=594;SM.Highcharts.MARGIN_TOP=0;SM.Highcharts.MARGIN_BOTTOM=40;SM.Highcharts.MARGIN_LEFT=95;SM.Highcharts.PLOT_AREA_WIDTH=SM.Highcharts.CHART_WIDTH-SM.Highcharts.MARGIN_LEFT;SM.Highcharts.X_AXIS_MAX_VISIBLE_LINES=4;SM.Highcharts.Y_AXIS_MAX_VISIBLE_LINES=3;SM.Highcharts.AXIS_LABEL_CHARACTER_WIDTH=8;SM.Highcharts.DATA_LABEL_CHARACTER_WIDTH=8;SM.Highcharts.DATA_LABEL_CHARACTER_HEIGHT=15;SM.Highcharts.DATA_LABEL_PADDING=10;SM.Highcharts.LEGEND_MARGIN_TOP=20;SM.Highcharts.NUM_SIGNIFICANT_DIGITS=2;SM.Highcharts.MAX_TITLE_CHARS=85;SM.Highcharts.calculateBarHeight=function(numBars){return Math.max(120-Math.ceil(numBars/2)*20,50);};SM.Highcharts.calculateChartHeight=function(chartType,options){var answerStructures=options.answerStructures,titleHeight=options.titleHeight,labelHeight=options.labelHeight,legendHeight=options.legendHeight,totalHeight,minHeight=chartType==="pie"?320:250,plotAreaHeight=200,marginTop=SM.Highcharts.calculateMarginTop(titleHeight),marginBottom=SM.Highcharts.calculateMarginBottom(labelHeight,legendHeight),numRows;if(chartType==="bar"){plotAreaHeight=SM.Highcharts.calculateBarChartHeight(options);}
 
if(chartType==="pie"||chartType==="donut"){numRows=answerStructures.rows.length;plotAreaHeight=numRows*18;}
totalHeight=plotAreaHeight+marginTop+marginBottom;return Math.max(totalHeight,minHeight);};SM.Highcharts.calculateBarChartHeight=function(options){var rows=options.answerStructures.rows,columns=options.answerStructures.cols,chartIndex=options.chartIndex, hasColumns=!_.isEmpty(columns),hasColumnChoices=hasColumns&&!_.isEmpty(columns[0].items),columnChoices=hasColumnChoices?columns[0].items:null,numBars,barHeight,plotAreaHeight; numBars=rows.length; if(options.isStacked){if(hasColumns){if(options.isMirrored){if(hasColumnChoices){numBars=columnChoices.length;}else{numBars=columns.length;}}else{numBars=rows.length;}}else{numBars=1;}}else{if(hasColumns){if(options.isDistribution){numBars=numBars*columns.length;if(hasColumnChoices){if(options.isCompared){ numBars=_.flatten(_.map(columns,function(c){return c.items;})).length;}else{numBars=columns[chartIndex].items.length*columns.length;}}}else{ if(hasColumnChoices){if(options.isCompared){numBars=columns[0].items.length;}else{numBars=rows.length;}}else{if(options.isMirrored){numBars=columns.length;}else{numBars=rows.length;}}}}}
barHeight=SM.Highcharts.calculateBarHeight(numBars);plotAreaHeight=numBars*barHeight;return plotAreaHeight;};SM.Highcharts.calculateTrendChartHeight=function(chartType,titleHeight,labelHeight,legendHeight,spacingBottom){var totalHeight,minHeight=250,plotAreaHeight=200,marginTop=SM.Highcharts.calculateMarginTop(titleHeight),marginBottom=SM.Highcharts.calculateMarginBottom(labelHeight,legendHeight),spacingBottom=spacingBottom||0;totalHeight=plotAreaHeight+marginTop+marginBottom+spacingBottom;return Math.max(totalHeight,minHeight);};SM.Highcharts.calculateChartWidth=function(chartType,options){var multiplier,calculatedWidth=0,numPoints;var numSeries=options.numSeries,numXAxisLabels=options.numXAxisLabels,isStacked=options.isStacked,isCompared=options.isCompared;if(isStacked){numPoints=numXAxisLabels;}else if(isCompared){if(_.include(["line","area"],chartType)){numPoints=numSeries;}else{numPoints=numXAxisLabels*numSeries;}}else{numPoints=Math.max(numSeries,numXAxisLabels);}
multiplier=Math.max(100-Math.ceil(numPoints/5)*20,30);if(_.contains(["column","line","area"],chartType)){calculatedWidth=multiplier*numPoints;}
return Math.max(calculatedWidth,SM.Highcharts.CHART_WIDTH);};SM.Highcharts.calculateMarginTop=function(defaultMargin,titleHeight){var marginTop=defaultMargin;if(titleHeight){marginTop+=titleHeight;}
return marginTop;};SM.Highcharts.calculateMarginBottom=function(labelHeight,legendHeight,spacingBottom){var labelMarginBottom=10,legendMarginTop=SM.Highcharts.LEGEND_MARGIN_TOP,marginBottom;marginBottom=labelMarginBottom+labelHeight;if(legendHeight&&legendHeight>0){marginBottom+=legendMarginTop+legendHeight;}
if(spacingBottom){marginBottom+=spacingBottom;}
return marginBottom;};SM.Highcharts.calculateSpacingBottom=function(spacingBottom,legendHeight){if(legendHeight&&legendHeight>0){spacingBottom+=SM.Highcharts.LEGEND_MARGIN_TOP+legendHeight;}
return spacingBottom;};SM.Highcharts.calculateMarginBottom=function(labelHeight,legendHeight){var defaultMarginBottom=20,legendMarginTop=SM.Highcharts.LEGEND_MARGIN_TOP,marginBottom;marginBottom=defaultMarginBottom+labelHeight;if(legendHeight&&legendHeight>0){marginBottom+=legendMarginTop+legendHeight;}
return marginBottom;};SM.Highcharts.calculateLegendHeight=function(series){var legendWidth=SM.Highcharts.PLOT_AREA_WIDTH,legendSwatchWidth=18,legendSwatchMarginRight=10,legendItemHeight=15,legendItemMarginTop=5,legendItemMarginBottom=5,legendItemOuterHeight=legendItemHeight+legendItemMarginTop+legendItemMarginBottom,legendItemWidth,legendItemTextWidth,legendItemCharacterWidth=5,currentLineWidth=0,numLines=1,legendItems;
if(!_.isEmpty(series)){legendItems=series[0].name?series:series[0].data; _.each(legendItems,function(legendItem){legendItemTextWidth=legendItem.name.length*legendItemCharacterWidth+6;legendItemWidth=legendSwatchWidth+legendSwatchMarginRight+legendItemTextWidth;if(currentLineWidth+legendItemWidth>legendWidth){currentLineWidth=legendItemWidth;numLines+=1;}else{currentLineWidth+=legendItemWidth;}});}
return numLines*legendItemOuterHeight;};SM.Highcharts.calculateLegendHeight_fixedItemWidth=function(series){var legendWidth=SM.Highcharts.PLOT_AREA_WIDTH,legendItemHeight=15,legendItemMarginTop=5,legendItemMarginBottom=5,legendItemOuterHeight=legendItemHeight+legendItemMarginTop+legendItemMarginBottom,legendMarginTop=20,legendItemWidth=99,numLegendsPerLine=Math.floor(legendWidth/legendItemWidth),legendItems=series[0].name?series:series[0].data;return _.size(legendItems)*legendItemOuterHeight/numLegendsPerLine+legendMarginTop;};SM.Highcharts.calculateXAxisLabelHeight=function(chartType,labels){var maxLabelLength,maxLabelWidth,maxCharsPerLine,numLines,maxNumLines,visibleNumLines;if(_.isEmpty(labels)){return 0;}
if(_.contains(["column","line","area"],chartType)){maxLabelLength=_.max(_.map(labels,function(l){return l.length;}));maxLabelWidth=514/labels.length;maxCharsPerLine=Math.ceil(maxLabelWidth/SM.Highcharts.AXIS_LABEL_CHARACTER_WIDTH);numLines=Math.ceil(maxLabelLength/maxCharsPerLine);maxNumLines=SM.Highcharts.X_AXIS_MAX_VISIBLE_LINES;visibleNumLines=(numLines>maxNumLines)?maxNumLines:numLines;return visibleNumLines*15;}else{return 30;}};




SM.Highcharts.formatAxisLabel=function(value,maxWidth,maxNumLines){if(_.isNumber(value)&&_.isFinite(value)){return SM.Highcharts.formatNumericAxisLabel(value);}else{return SM.Highcharts.formatTextualAxisLabel(value,maxWidth,maxNumLines);}};SM.Highcharts.formatNumericAxisLabel=function(x){if(x<=1000){return x;}
var s=['k','M','B','T'];var e=Math.floor(Math.log(x)/Math.log(1000));return(x/Math.pow(1000,e))+s[e-1];};SM.Highcharts.formatTextualAxisLabel=function(value,maxWidth,maxNumLines){var maxCharsPerLine=Math.ceil(maxWidth/SM.Highcharts.AXIS_LABEL_CHARACTER_WIDTH),lines=[],visibleLines,tokens,currentLine;if(value.length>maxCharsPerLine){ tokens=value.replace(/\ /g,"\xA0").split("\xA0");currentLine="";_.each(tokens,function(token,tokenIndex){if(token.length+1+currentLine.length<=maxCharsPerLine){ currentLine+=" "+token;}else{if(tokenIndex!==0){lines.push(currentLine);} 
if(token.length>=maxCharsPerLine){var numLines=Math.ceil(token.length/maxCharsPerLine);_.times(numLines,function(i){currentLine=token.slice(i*maxCharsPerLine,(i+1)*maxCharsPerLine);
 if(currentLine.length===maxCharsPerLine&&i!==numLines-1){lines.push(currentLine);}});}else{currentLine=token;}}
if(tokenIndex===tokens.length-1){lines.push(currentLine);}}); lines=_.map(lines,function(l){return $.trim(l);}); visibleLines=lines.slice(0,maxNumLines);if(lines.length>maxNumLines){var lastLine=visibleLines[visibleLines.length-1];if(lastLine.length+3>maxCharsPerLine){visibleLines[visibleLines.length-1]=lastLine.slice(0,maxCharsPerLine-3)+"...";}else{visibleLines[visibleLines.length-1]+="...";}}
value=_.map(visibleLines,function(line){return"<div>"+_.escape(line)+"</div>";});value=value.join(" ");}else{value=_.escape(value);}
return value;};SM.Highcharts.xAxisLabelFormatter=function(){var numCategories=this.axis.options.categories.length,maxWidth=this.axis.width/numCategories,maxNumLines=SM.Highcharts.X_AXIS_MAX_VISIBLE_LINES;return SM.Highcharts.formatAxisLabel(this.value,maxWidth,maxNumLines);};SM.Highcharts.yAxisLabelFormatter=function(){var maxWidth=100,maxNumLines=SM.Highcharts.Y_AXIS_MAX_VISIBLE_LINES;return SM.Highcharts.formatAxisLabel(this.value,maxWidth,maxNumLines);};SM.Highcharts.percentageLabelFormatter=function(){return this.value+"%";};SM.Highcharts.legendFormatter=function(){var self=this;self.name=_.escape(self.name);self.name=_.string.truncate(self.name,90);return self.name;};SM.Highcharts.formatTooltip=function(){var absoluteY=SM.Highcharts.formatYValue(this.point.absoluteY,"absolute",0),percentageY=SM.Highcharts.formatYValue(this.point.percentageY,"percent",2),html;if(percentageY){html='<span>'+absoluteY+'</span>'+' '+'<span>('+percentageY+')</span>';}else{html='<span>'+absoluteY+'</span>';}
return html;};SM.Highcharts.getGlobalizeFormatType=function(scaleType,decimalPlaces){var formatType;if(scaleType==="percent"){formatType="p"+decimalPlaces;}else{formatType="n"+decimalPlaces;}
return formatType;};SM.Highcharts.formatYValue=function(yValue,scaleType,decimalPlaces){var formatType=SM.Highcharts.getGlobalizeFormatType(scaleType,decimalPlaces);if(yValue){if(scaleType==="percent"){yValue=parseFloat(yValue)/100;}
yValue=Globalize.format(yValue,formatType);}
return yValue;};SM.Highcharts.floatingPointFormatter=function(){return Globalize.format(this.point.y,"n2");};SM.Highcharts.bindYAxisEvents=function($chartContainer,yAxis){if(yAxis&&yAxis.ticks){_.each(yAxis.ticks,function(tick,tickPos){var $el=$(tick.label.element);$el.unbind('click');$el.click({tickPos:tickPos,self:self},function(e){SM.CustomizeActionMenu.actionMenu.call(self,e,'yAxisLabel',{parent:$chartContainer});});});}};SM.Highcharts.bindXAxisEvents=function($chartContainer){
};SM.Highcharts.bindAreaChartEvents=function($chartContainer){var $paths=$chartContainer.find('.highcharts-series path');$paths.click(function(e){if(e.stopPropagation){ e.stopPropagation();}else{ e.cancelBubble=true;}
SM.CustomizeActionMenu.actionMenu.call(self,e,'area',{parent:$chartContainer});});};SM.Highcharts.onPointMouseOver=function(e){SM.Highcharts.toggleLegendItemHighlighting(e);};SM.Highcharts.onPointMouseOut=function(e){SM.Highcharts.toggleLegendItemHighlighting(e);};SM.Highcharts.toggleLegendItemHighlighting=function(e){var chart=e.currentTarget.series.chart,chartHasLegend=chart.options.legend.enabled,chartType=chart.options.chart.type,$legendItem;if(chartHasLegend){if(chartType==="pie"||chartType==="donut"){$legendItem=$(e.currentTarget.legendItem.element);}else{$legendItem=$(e.currentTarget.series.legendItem.element);}
if($legendItem.length){$legendItem.toggleClass('point-hovered');}}};SM.Highcharts.calculateSeriesMax=function(series){var seriesMaxes,yValues;seriesMaxes=_.map(series,function(s){yValues=_.map(s.data,function(d){return d.y;});return _.max(yValues);});return _.max(seriesMaxes);};SM.Highcharts.calculateStackedSeriesMax=function(series){var stackedTotals=[],stackedTotal,numCategories;if(_.isEmpty(series)){return 0;}else{numCategories=series[0].data.length;_.times(numCategories,function(i){stackedTotal=0;_.map(series,function(s){stackedTotal+=s.data[i].y;});stackedTotals.push(stackedTotal);});return _.max(stackedTotals);}};SM.Highcharts.calculateCustomScaleMaxRange=function(chartSeriesList,options){var defaultMax,defaultScaleOptions,defaultTickInterval,minCustomMax,maxCustomMax,customMaxStep,seriesMax,max,isPercent,isWeightedAvg,isStacked,isArea,questionIsSimple;isPercent=options.isPercent;isWeightedAvg=options.isWeightedAvg;isStacked=options.isStacked;isArea=options.isArea;questionIsSimple=options.questionIsSimple; seriesMax=0;_.each(chartSeriesList,function(series){if(isStacked||(isArea&&!questionIsSimple&&!isWeightedAvg)){max=SM.Highcharts.calculateStackedSeriesMax(series);}else{max=SM.Highcharts.calculateSeriesMax(series);}
if(max>seriesMax){seriesMax=max;}});
 defaultScaleOptions=SM.Highcharts.calculateYAxisMaxAndTickInterval(seriesMax);defaultMax=defaultScaleOptions.max;defaultTickInterval=defaultScaleOptions.tickInterval;if(isPercent){customMaxStep=10.0;}else if(isWeightedAvg){customMaxStep=defaultTickInterval;}else{customMaxStep=defaultTickInterval;}
minCustomMax=Math.round((seriesMax+(customMaxStep/2))/customMaxStep)*customMaxStep;if(isPercent){maxCustomMax=100;}else if(isWeightedAvg){maxCustomMax=defaultMax;}else{maxCustomMax=defaultMax;}
return{min:minCustomMax,max:maxCustomMax,step:customMaxStep};};SM.Highcharts.calculateYAxisMaxAndTickInterval=function(max){var tickInterval;if(max<=5){max=5;tickInterval=0.5;}else if(max<=10){max=10;tickInterval=1;}else if(max<=50){max=50;tickInterval=5;}else if(max<=100){max=100;tickInterval=10;}else if(max<=200){max=200;tickInterval=10;}else if(max<=500){max=Math.ceil((max+1)/50)*50;tickInterval=50;}else if(max<=5000){ max=Math.ceil((max+1)/500)*500;tickInterval=500;}else if(max<=50000){ max=Math.ceil((max+1)/5000)*5000;tickInterval=5000;}else if(max<=500000){ max=Math.ceil((max+1)/50000)*50000;tickInterval=50000;}else if(max<=5000000){ max=Math.ceil((max+1)/500000)*500000;tickInterval=250000;}else if(max<=50000000){ max=Math.ceil((max+1)/5000000)*5000000;tickInterval=5000000;}else if(max<=500000000){ max=Math.ceil((max+1)/50000000)*50000000;tickInterval=50000000;}else if(max<=5000000000){ max=Math.ceil((max+1)/500000000)*500000000;tickInterval=500000000;}else{max=Math.ceil((max+1)/500000)*500000;tickInterval=500000;}
return{max:max,tickInterval:tickInterval};};SM.Highcharts.DEFAULT_COLORS=["#CED428","#33BDBF","#F7AF1C","#898A7A","#2F606E","#CFCDBE","#5B5A4B","#A9BD38","#C8441A","#00898B"];SM.Highcharts.DEFAULT_OPTIONS={chart:{marginLeft:SM.Highcharts.MARGIN_LEFT,spacingRight:0, style:{fontFamily:'Arial'},plotBackgroundColor:'#F0F0F0'},title:{text:null,style:{fontFamily:'Arial',fontWeight:'bold',fontSize:'18px',color:'#333'}},colors:SM.Highcharts.DEFAULT_COLORS,xAxis:{title:{text:null
},labels:{style:{fontFamily:'Arial',fontWeight:'bold',color:'#333'},gridLineColor:'#FFF',overflow:'justify',useHTML:true},lineColor:'#CCCCCC',tickLength:0},yAxis:{labels:{overflow:'justify',style:{fontFamily:'Arial',paddingTop:'10px',color:'#333'},useHTML:true},title:{text:null},offset:0,lineColor:'#DEDEDE',lineWidth:2,gridLineColor:'#FFF'},plotOptions:{series:{pointPadding:0.05,groupPadding:0.1,animation:false,dataLabels:{style:{fontWeight:'bold',fontSize:'12px',color:'#000'},useHTML:true},point:{events:{legendItemClick:function(){return false;}}},events:{legendItemClick:function(){return false;}}}},legend:{labelFormatter:SM.Highcharts.legendFormatter,enabled:false, floating:true,borderWidth:0,x:0,y:0,useHTML:true,itemDistance:20,itemMarginTop:5,itemMarginBottom:5,itemStyle:{display:'block',color:'#000',fontFamily:'Arial',fontSize:'11px',lineHeight:'14px'}},tooltip:{animation:false,hideDelay:100,backgroundColor:'#000',borderWidth:0,shadow:false,headerFormat:'',followPointer:true,style:{fontFamily:'Arial',fontSize:'12px',color:'#FFF'},useHTML:true,formatter:SM.Highcharts.formatTooltip},credits:{enabled:false}};SM.CustomizeActionMenu={};SM.CustomizeActionMenu.ActionMenuOptionsSettings={h1:{template:'customize-label-action-menu-template',isTable:false},background:{template:'chart-customization-bg-action-menu-template',isTable:false},dataPoint:{template:'chart-customization-action-menu-template',isTable:false,visibleOptions:{change:true,customize:true}},dataLabel:{template:'chart-customization-action-menu-template',isTable:false,visibleOptions:{change:false,customize:true}},legend:{template:'chart-customization-action-menu-template',isTable:false,visibleOptions:{change:true,customize:true}},area:{template:'chart-customization-action-menu-template',isTable:false,visibleOptions:{change:true,customize:true}},yAxisLabel:{template:'chart-customization-action-menu-template',isTable:false,visibleOptions:{change:false,customize:true}},xAxisLabel:{template:'chart-customization-xAxis-action-menu-template',isTable:false},th:{template:'chart-customization-thead-action-menu-template',visibleOptions:{ascending:true,descending:true,unsorted:true,labels:true},isTable:true},'caption':{template:'customize-label-action-menu-template',isTable:true},td:{template:'customize-label-action-menu-template',isTable:true,visibleOptions:{labels:true}}};SM.CustomizeActionMenu.actionMenu=function(evt,type,options){var showing=false,actionMenuSettings=SM.CustomizeActionMenu.ActionMenuOptionsSettings[type],visibleOptions,$el=actionMenuSettings.isTable?$(evt.currentTarget):$(evt.target),menu=$el.data("actionMenu"),posx,posy,offset,menuView;visibleOptions=options.visibleOptions?SM.Object.deepExtend(actionMenuSettings.visibleOptions,options.visibleOptions):actionMenuSettings.visibleOptions;if(!menu){$el.actionMenu({templateID:actionMenuSettings.template,visibleOptions:visibleOptions,answerID:options.answerID,position:{collision:"none none"}});menu=$el.data("actionMenu");$el.one("actionMenu.afterOpen",function(e){menuView=e.actionMenu.get("menuView");menuView.$el.mouseover(function(){showing=true;}).mouseout(function(){showing=false;setTimeout(function(){if(menu&&!showing){menu.close();}},1000);});menuView.$el.find('.options').on('mouseenter',function(){showing=true;});}).mouseout(function(){setTimeout(function(){if(menu&&!showing){menu.close();}},0);});menu.open();}
menuView=menu.get("menuView");if(evt.pageX||evt.pageY){posx=evt.pageX;posy=evt.pageY;}else if(evt.clientX||evt.clientY){posx=evt.clientX+document.body.scrollLeft+
document.documentElement.scrollLeft;posy=evt.clientY+document.body.scrollTop+
document.documentElement.scrollTop;}else if(options.parent){offset=options.parent.offset();posx=evt.chartX+offset.left;posy=evt.chartY+offset.top;}
menuView.$el.css({'left':posx+'px','top':posy+'px'});};SM.SortedSummary=function(options){var self=this;
 var SORT_ORDER_ASC="ascending",SORT_ORDER_DESC="descending",SORT_ORDER_UNSORTED="unsorted"; function _initialize(options){var question=options.question,labels=options.labels,isMirrored=options.isMirrored,shouldHideEmptyData=options.shouldHideEmptyData;self.summary=self._getSortedSummaryData(question,labels,isMirrored,shouldHideEmptyData);} 
function buildColumnChoices(columns){var columnChoices={};$.each(columns,function(i,column){$.each(column.items,function(j,columnChoice){columnChoices[columnChoice.id]=columnChoice;});});return columnChoices;}
function getRowByID(rowId){return _.find(self.rows,function(r){return r.id===rowId;});}
function getColumnByID(columnId){return _.find(self.columns,function(c){return c.id===columnId;});}
function getColumnChoiceByID(columnChoiceId){return _.find(self.columnChoices,function(columnChoice){return columnChoice.id===columnChoiceId;});} 
function _buildResponsesCountsByRow(){var counts={};_.each(self.rows,function(row){counts[row.id]=calculateRowTotal(row.id);});return counts;}
function _buildResponsesCountsByColumn(){var counts={};_.each(self.columns,function(column){counts[column.id]=calculateColumnTotal(column.id);});return counts;}
function _buildRespondentCountsByRow(){var counts={},rowSummary;_.each(self.rows,function(row){rowSummary=self.summary.summary.options[row.id];if(rowSummary&&rowSummary.row_total!==undefined){counts[row.id]=rowSummary.row_total;}else{counts[row.id]=0;}});return counts;}
function _buildRespondentCountsByColumn(){var counts={},countData;if(self.isCompared){countData=self.summary.summary.answered_subtotals;}else{countData=self.summary.summary.options.col_totals;}
_.each(self.columns,function(column,i){if(countData){if(self.isCompared){counts[column.id]=countData[column.id];}else{counts[column.id]=countData[i];}}else{counts[column.id]=0;}});return counts;}
function calculateRowTotal(rowId){var total=0,rowSummary=self.summary.summary.options[rowId],columnSummary;if(rowSummary&&rowSummary.options){ _.each(self.columns,function(column,j){columnSummary=rowSummary.options[column.id];if(columnSummary){total+=columnSummary.count;}});}
return total;}
function calculateColumnTotal(columnId){var total=0,rowSummary,columnSummary;_.each(self.rows,function(row,i){rowSummary=self.summary.summary.options[row.id];if(rowSummary&&rowSummary.options){ columnSummary=rowSummary.options[columnId];if(columnSummary){total+=columnSummary.count;}}});return total;}
function calculateColumnTotals(){var columnTotals={},total;_.each(self.columns,function(column){total=calculateColumnTotal(column.id);columnTotals[column.id]=total;});return columnTotals;}
function buildColumnTotalsByRow(){var columnTotalsByRow={},rowSummary,columnSummary;$.each(self.columns,function(i,column){$.each(self.rows,function(j,row){if(columnTotalsByRow[row.id]===undefined){columnTotalsByRow[row.id]={};}
columnTotalsByRow[row.id][column.id]=0;rowSummary=self.summary.summary.options[row.id];if(rowSummary){columnSummary=rowSummary.options[column.id];if(columnSummary){if(columnSummary.row_total!==undefined&&columnSummary.row_total>=0){columnTotalsByRow[row.id][column.id]=columnSummary.row_total;}else{columnTotalsByRow[row.id][column.id]=columnSummary.count;}}}});});return columnTotalsByRow;}
function calculateColumnChoiceTotalsByRow(columnChoices){var columnChoiceTotals={},columnChoiceSummary;$.each(self.rows,function(rowIndex,row){var rowSummary=self.summary.summary.options[row.id];if(rowSummary){$.each(rowSummary.options,function(i,columnSummary){$.each(columnChoices,function(j,columnChoice){if(columnChoiceTotals[columnChoice.id]===undefined){columnChoiceTotals[columnChoice.id]=0;}
columnChoiceSummary=columnSummary.options[columnChoice.id];if(columnChoiceSummary){columnChoiceTotals[columnChoice.id]+=columnChoiceSummary.count;}});});}});return columnChoiceTotals;}
function calculateColumnChoiceTotalsByRowAndColumnChoice(columnChoices){var columnChoiceTotals={},rowSummary,columnSummary,columnChoiceSummary;_.each(self.rows,function(row,rowIndex){_.each(self.columns,function(column,columnIndex){columnChoices=columnChoices||column.items;_.each(columnChoices,function(columnChoice,columnChoiceIndex){if(columnChoiceTotals[row.id]===undefined){columnChoiceTotals[row.id]={};}
if(columnChoiceTotals[row.id][columnChoice.id]===undefined){columnChoiceTotals[row.id][columnChoice.id]=0;}
rowSummary=self.summary.summary.options[row.id];if(rowSummary){columnSummary=rowSummary.options[column.id];if(columnSummary){columnChoiceSummary=columnSummary.options[columnChoice.id];if(columnChoiceSummary){columnChoiceTotals[row.id][columnChoice.id]+=columnChoiceSummary.count;}}}});});});return columnChoiceTotals;}
function calculateColumnChoiceTotalsByColumnChoice(columnChoices){var columnChoiceTotals={},columnChoiceSummary,rowSummary;$.each(self.rows,function(rowIndex,row){rowSummary=self.summary.summary.options[row.id];if(rowSummary){$.each(rowSummary.options,function(i,columnSummary){$.each(columnChoices,function(j,columnChoice){if(columnChoiceTotals[columnChoice.id]===undefined){columnChoiceTotals[columnChoice.id]=0;}
columnChoiceSummary=columnSummary.options[columnChoice.id];if(columnChoiceSummary){columnChoiceTotals[columnChoice.id]+=columnChoiceSummary.count;}});});}else{$.each(columnChoices,function(j,columnChoice){columnChoiceTotals[columnChoice.id]=0;});}});return columnChoiceTotals;}

function getSortedRowTotals(){var sortedRowTotals=[],sortedRows=self.sortedRowsList[0]; if(sortedRows){_.each(sortedRows,function(row,position){sortedRowTotals[position]=calculateRowTotal(row.id);});}
return sortedRowTotals;}


function getSortedColumnTotals(){var sortedColumnTotals=[],sortedColumns=self.sortedColumnsList[0]; if(sortedColumns){$.each(sortedColumns,function(position,column){sortedColumnTotals[position]=calculateColumnTotal(column.id);});}
return sortedColumnTotals;}


function shouldSortOtherOption(){if(self.isCompared){return true;}else{return self.sortOptions.dimensionType!=="labels";}}
function otherIsAnAnswerChoice(){return(self.others!==undefined&&self.others[0].is_answer!==undefined);}
function appendOtherAnswerChoicesToSortedRows(){var sortedRowsList=self.sortedRowsList[0];if(otherIsAnAnswerChoice()&&!_.isEmpty(sortedRowsList)){$.each(self.others,function(i,other){sortedRowsList.push(other);});}}
function addOtherAnswerChoicesToRows(){if(otherIsAnAnswerChoice()){$.each(self.others,function(i,other){self.rows.push(other);});}} 
function hideEmptyData(){self.rows=_.filter(self.rows,function(row){return self.summary.summary.options[row.id]!==undefined;});}
function calculateWeightedAveragesForComparedSimpleQuestion(){var weightedAverages={},weightedAverage,weight,rowSummary,columnSummary,columnTotal,columnCount,columnSum;_.each(self.columns,function(column,columnIndex){columnTotal=columnSum=0;_.each(self.rows,function(row,rowIndex){rowSummary=self.summary.summary.options[row.id];if(rowSummary){columnSummary=rowSummary.options[column.id];if(columnSummary){columnCount=columnSummary.count;}else{columnCount=0;}}else{columnCount=0;}
weight=rowIndex+1;columnSum+=weight*columnCount;columnTotal+=columnCount;});if(columnTotal===0){weightedAverage=0;}else{weightedAverage=columnSum/columnTotal;}
weightedAverages[column.id]=weightedAverage;});return weightedAverages;} 
function calculateWeightedAveragesByRow(){var weightedAverages={},rowSummary,rowTotal,responses,naCount,weightedAverage;$.each(self.rows,function(index,row){rowSummary=self.summary.summary.options[row.id];if(rowSummary===undefined){weightedAverages[row.id]=0;}else{responses=rowSummary.options;rowTotal=rowSummary.row_total;if(responses){naCount=0;if(self.question.naCol!==undefined){var naCol=responses[self.question.naCol.id];if(naCol&&naCol.count){naCount=naCol.count;}}
weightedAverage=calculateWeightedAverageForRow(self.columns,responses,{naCount:naCount,total:rowTotal});weightedAverages[row.id]=weightedAverage;}else{weightedAverages[row.id]=0;}}});return weightedAverages;} 
function calculateWeightedAveragesByRowAndColumn(){var weightedAverages={},rowSummary,columnSummary,columnChoicesSummary,weightedAverage;$.each(self.rows,function(i,row){weightedAverages[row.id]={};rowSummary=self.summary.summary.options[row.id];if(rowSummary){$.each(self.columns,function(j,column){columnSummary=rowSummary.options[column.id];if(columnSummary===undefined){weightedAverages[row.id][column.id]=0;}else{columnChoicesSummary=columnSummary.options;if(columnChoicesSummary){weightedAverage=calculateWeightedAverageForColumn(self.columnChoices,columnChoicesSummary,{naCount:0});weightedAverages[row.id][column.id]=weightedAverage;}}});}else{SM.log("No data for Row#"+row.id+" on Question#"+self.question.ID);}});return weightedAverages;}
function calculateWeightedAveragesByRowAndColumnChoice(){var weightedAverages={},rowSummary,weightedAverage;$.each(self.rows,function(i,row){weightedAverages[row.id]={};rowSummary=self.summary.summary.options[row.id];if(rowSummary){$.each(self.columnChoices,function(k,columnChoice){weightedAverage=calculateWeightedAverageForColumnChoice(self.columns,rowSummary,columnChoice);weightedAverages[row.id][columnChoice.id]=weightedAverage;});}else{$.each(self.columnChoices,function(i,columnChoice){weightedAverages[row.id][columnChoice.id]=0;});}});return weightedAverages;} 
function calculateWeightedAveragesForColumnByRow(){}
function calculateWeights(choices){var weights={};$.each(choices,function(index,choice){
 if(choice.is_na){weights[choice.id]=0;return;}
if(choice.weight===undefined){weights[choice.id]=index+1;}else{weights[choice.id]=choice.weight;}});return weights;}
function calculateWeightsByColumn(columns){var weights={};$.each(columns,function(i,column){var columnChoices=column.items;$.extend(weights,calculateWeights(columnChoices));});return weights;}
function calculateWeightedAverageForRow(columns,responses,options){return calculateWeightedAverageForDimension(columns,responses,options);}
function calculateWeightedAverageForColumn(columnChoices,responses,options){return calculateWeightedAverageForDimension(columnChoices,responses,options);}
function calculateWeightedAverageForColumnChoice(columns,rowSummary,columnChoice){var sum=0,total=0,count=0,columnSummary,columnChoiceSummary;$.each(columns,function(j,column){ if(column.is_na){return;}
columnSummary=rowSummary.options[column.id];if(columnSummary){columnChoiceSummary=columnSummary.options[columnChoice.id];if(columnChoiceSummary){count=columnChoiceSummary.count;sum+=count*self.weights[column.id];total+=count;}}});return calculateWeightedAverage(sum,total);}

function calculateWeightedAverageForDimension(choices,responses,options){var options=options||{},total=options.total,naCount=options.naCount||0,shouldCalculateTotal=false,sum=0;if(_.isUndefined(total)){shouldCalculateTotal=true;total=0;}
$.each(choices,function(i,choice){var ct=0;if(undefined!==responses[choice.id]){ct=responses[choice.id].count;}
sum+=ct*self.weights[choice.id];if(shouldCalculateTotal){total+=ct;}}); total-=naCount;return calculateWeightedAverage(sum,total);}
function calculateWeightedAverage(sum,total){var value=0;if(0!==total){ value=sum/total;}
value=parseFloat(value.toFixed(2));return value;} 
self._getSortedSummaryData=function(question,labels,isMirrored,shouldHideEmptyData){self.question=question;self.isMirrored=isMirrored;self.isCompared=self.question.isCompared();self.rollup=self.question.getRollup();self.display=self.rollup.display;self.summary=self.rollup.summary;self.questionType=self.summary.type;self.questionSubType=self.question.subtype;


self.summaryType=self.isCompared?self.summary.summary.type:self.summary.type;self.hasColumnChoices=self.summaryType==="menu_matrix";self.answerStructures=SM.Summarizable.getAnswerStructures(self.question,self.display);self.rows=self.answerStructures.rows;self.columns=self.answerStructures.cols;self.columnChoices=self.hasColumnChoices?buildColumnChoices(self.columns):null; self.columnChoicesArray=self.columnChoices?_.values(self.columnChoices):null; self.others=self.answerStructures.other;self.crossedOptions=self.answerStructures.crossedOptions;self.sortOptions=self.rollup.display.getDisplayData().sort_data;if(shouldSortOtherOption()){addOtherAnswerChoicesToRows();}
if(shouldHideEmptyData){hideEmptyData();}
self.rowIds=_.map(self.rows,function(r){return r.id;});if(self.columns){self.columnIds=_.map(self.columns,function(c){return c.id;});}
if(self.hasColumnChoices){self.columnChoiceIds=_.map(self.columnChoices,function(cc){return cc.id;});}
if(self.summaryType!=="menu_matrix"){self.responsesCountsByRow=_buildResponsesCountsByRow();self.responsesCountsByColumn=_buildResponsesCountsByColumn();self.respondentCountsByColumn=_buildRespondentCountsByColumn();self.respondentCountsByRow=_buildRespondentCountsByRow();}
self.columnTotals=calculateColumnTotals();if(self.isCompared||self.summaryType==="menu_matrix"){self.columnTotalsByRow=buildColumnTotalsByRow();}
if(self.hasColumnChoices){
self.columnChoiceTotalsByRow=calculateColumnChoiceTotalsByRowAndColumnChoice();self.columnChoiceTotalsByColumnChoice=calculateColumnChoiceTotalsByColumnChoice(self.columnChoices);}
self.numRows=self.rows.length;self.numColumns=self.columns?self.columns.length:0;if(self.numColumns>0){if(self.hasColumnChoices){if(self.isCompared){self.weights=calculateWeights(self.columns);self.weightedAveragesByRowAndColumnChoice=calculateWeightedAveragesByRowAndColumnChoice();}else{self.weights=calculateWeightsByColumn(self.columns);self.weightedAveragesByRowAndColumn=calculateWeightedAveragesByRowAndColumn();}}else{self.weights=calculateWeights(self.columns);if(self.isCompared){self.weightedAveragesByColumn=calculateWeightedAveragesForComparedSimpleQuestion();}else{self.weightedAveragesByColumn=self.weights;self.weightedAveragesByRow=calculateWeightedAveragesByRow();}}}
self.sortedPositions={rows:[],columns:[],columnChoices:[]};self.sortedRowsList=[]; self.sortedColumnsList=[];self.sortedColumnChoicesList=[];setSortedPositions();if(!_.isEmpty(self.sortedRowsList)){self.sortedRowTotals=getSortedRowTotals();}
if(!_.isEmpty(self.sortedColumnsList)){self.sortedColumnTotals=getSortedColumnTotals();}
if(!shouldSortOtherOption()){appendOtherAnswerChoicesToSortedRows();}
return{sortedAnswers:{rowsList:self.sortedRowsList,columnsList:self.sortedColumnsList,columnChoicesList:self.sortedColumnChoicesList},totals:{sortedRowTotals:self.sortedRowTotals,sortedColumnTotals:self.sortedColumnTotals,columnTotalsByRow:self.columnTotalsByRow,columnChoiceTotalsByRow:self.columnChoiceTotalsByRow,columnChoiceTotalsByColumnChoice:self.columnChoiceTotalsByColumnChoice},counts:{responsesCountsByColumn:self.responsesCountsByColumn,responsesCountsByRow:self.responsesCountsByRow,respondentCountsByColumn:self.respondentCountsByColumn,respondentCountsByRow:self.respondentCountsByRow},weightedAverages:{weightedAveragesByRow:self.weightedAveragesByRow,weightedAveragesByColumn:self.weightedAveragesByColumn,weightedAveragesByRowAndColumn:self.weightedAveragesByRowAndColumn,weightedAveragesByRowAndColumnChoice:self.weightedAveragesByRowAndColumnChoice},weights:self.weights};};


function setSortedPositions(){var sortData,orderedSortOptionKeys,sortOrder,dimensionType,dimensionID;if(self.summaryType==="menu_matrix"){
orderedSortOptionKeys=_.keys(self.sortOptions).sort();_.each(orderedSortOptionKeys,function(scopedDimensionID){sortData=self.sortOptions[scopedDimensionID];sortOrder=sortData.order;dimensionID=sortData.dimensionID;dimensionType=sortData.dimensionType;_setSortedPositions(sortOrder,dimensionType,dimensionID,scopedDimensionID);});}else{sortOrder=self.sortOptions.order;dimensionType=self.sortOptions.dimensionType;dimensionID=self.sortOptions.dimensionID;_setSortedPositions(sortOrder,dimensionType,dimensionID);}
$.each(self.sortedPositions.rows,function(i,rowPositions){var sortedRows=[];$.each(rowPositions,function(rowId,position){sortedRows[position]=getRowByID(rowId);});self.sortedRowsList.push(sortedRows);});if(_.isEmpty(self.sortedRowsList)){self.sortedRowsList.push(self.rows);}
$.each(self.sortedPositions.columns,function(i,columnPositions){var sortedColumns=[];$.each(columnPositions,function(columnId,position){if(columnId!=="undefined"){sortedColumns[position]=getColumnByID(columnId);}});self.sortedColumnsList.push(sortedColumns);});if(_.isEmpty(self.sortedColumnsList)){self.sortedColumnsList.push(self.columns);}
self.sortedColumnsList.push(self.columns);$.each(self.sortedPositions.columnChoices,function(i,columnChoicePositions){var sortedColumnChoices=[];$.each(columnChoicePositions,function(columnChoiceId,position){sortedColumnChoices[position]=getColumnChoiceByID(columnChoiceId);});self.sortedColumnChoicesList.push(sortedColumnChoices);});if(_.isEmpty(self.sortedColumnChoicesList)){self.sortedColumnChoicesList.push(self.columnChoices);}}
function _setSortedPositions(sortOrder,dimensionType,dimensionID,scopedDimensionID){if(sortOrder===SORT_ORDER_UNSORTED||sortOrder===undefined||sortOrder===null){_setSortedPositionsWhenUnsorted(dimensionID,scopedDimensionID);}else{if(dimensionType==="averageRating"){_setSortedPositionsByAverageRating(sortOrder);}else if(dimensionType==="averageNumber"){setRowPositionsByAverageNumber(sortOrder);}else if(dimensionType==="totals"){_setSortedPositionsByTotals(sortOrder,dimensionID,scopedDimensionID);}else if(dimensionType==="labels"){_setSortedPositionsByLabel(sortOrder,dimensionID,scopedDimensionID);}else if(dimensionType==="responses"){setRowPositionsByResponses(sortOrder);}else{_setSortedPositionsByDimensionTypeAndID(sortOrder,dimensionType,dimensionID,scopedDimensionID)}}}
function _setSortedPositionsWhenUnsorted(dimensionID,scopedDimensionID){if(self.isMirrored){if(self.questionType==="menu_matrix"){setColumnChoicePositionsByDefaultColumnOrder(scopedDimensionID);}else if(self.isCompared){if(self.summaryType==="menu_matrix"){setColumnChoicePositionsByDefaultRowOrder(dimensionID);}else{setColumnPositionsByDefaultOrder();}}else{setColumnPositionsByDefaultOrder();}}else{if(self.isCompared){if(self.summaryType==="menu_matrix"){setColumnPositionsByDefaultOrder();}else{setRowPositionsByDefaultOrder();}}else{setRowPositionsByDefaultOrder();}}}
function _setSortedPositionsByAverageRating(sortOrder){if(self.isMirrored){setColumnPositionsByAverageRating(sortOrder);}else{setRowPositionsByAverageRating(sortOrder);}}
function _setSortedPositionsByTotals(sortOrder,dimensionID,scopedDimensionID){if(self.questionType==="simple"){if(self.questionSubType==="numerical"){setRowPositionsByRowSum(sortOrder);}else{setRowPositionsByRowCount(sortOrder);}}else if(self.questionType==="menu_matrix"){ if(self.isMirrored){setColumnChoicePositionsByRowTotal(scopedDimensionID,sortOrder);}else{setRowPositionsByColumnTotal(scopedDimensionID,sortOrder);}}else{ if(self.isCompared){if(self.isMirrored){if(self.summaryType==="menu_matrix"){ setColumnChoicePositionsByColumnTotal(scopedDimensionID,sortOrder);}else{setColumnPositionsByTotal(sortOrder);}}else{if(self.summaryType==="menu_matrix"){ setColumnPositionsByRowTotal(scopedDimensionID,sortOrder);}else{setRowPositionsByTotal(sortOrder);}}}else{if(self.isMirrored){setColumnPositionsByTotal(sortOrder);}else{setRowPositionsByTotal(sortOrder);}}}}
function _setSortedPositionsByLabel(sortOrder,dimensionID,scopedDimensionID){if(self.isCompared){if(self.isMirrored){if(self.summaryType==="menu_matrix"){setColumnChoicePositionsByLabel(dimensionID,sortOrder);}else{setColumnPositionsByLabel(sortOrder);}}else{if(self.summaryType==="menu_matrix"){setColumnPositionsByLabel(sortOrder);}else{setRowPositionsByLabel(sortOrder);}}}else{if(self.isMirrored){if(self.questionType==="menu_matrix"){setColumnChoicePositionsByLabel(scopedDimensionID,sortOrder);}else{setColumnPositionsByLabel(sortOrder);}}else{setRowPositionsByLabel(sortOrder);}}}
function _setSortedPositionsByDimensionTypeAndID(sortOrder,dimensionType,dimensionID,scopedDimensionID){if(self.isMirrored){if(self.questionType==="menu_matrix"){if(dimensionType==="row"){setColumnChoicePositionsByRowCount(scopedDimensionID,dimensionID,sortOrder);}else{setColumnChoicePositionsByDefaultColumnOrder(dimensionID);}}else{if(dimensionType==="row"){setColumnPositionsByRowCount(dimensionID,sortOrder);}else if(dimensionType==="column"){if(self.isCompared&&self.hasColumnChoices){setColumnChoicePositionByColumnCount(scopedDimensionID,dimensionID,sortOrder);}else{setColumnPositionsByDefaultOrder();}}else{if(self.isCompared&&self.hasColumnChoices){setColumnChoicePositionsByDefaultRowOrder(dimensionID);}else{setColumnPositionsByRowCount(dimensionID,sortOrder);}}}}else{
 if(self.summaryType==="menu_matrix"){if(self.isCompared){setColumnPositionsByColumnChoiceCount(scopedDimensionID,dimensionID,sortOrder);}else{setRowPositionsByColumnChoiceCount(dimensionID,sortOrder);}}else{if(dimensionType==="column"||(self.isCompared&&dimensionType==="row")){setRowPositionsByColumnCount(dimensionID,sortOrder);}else if(dimensionType==="row"){setColumnPositionsByRowCount(dimensionID,sortOrder);}else{SM.log("Shouldn't have gotten here...");setRowPositionsByDefaultOrder();}}}} 
function setRowPositionsByDefaultOrder(){var sortedRowPositions={};$.each(self.rows,function(position,row){sortedRowPositions[row.id]=position;});self.sortedPositions.rows.push(sortedRowPositions);}
function setColumnPositionsByDefaultOrder(){var sortedColumnPositions={};$.each(self.columns,function(position,column){sortedColumnPositions[column.id]=position;});self.sortedPositions.columns.push(sortedColumnPositions);}
function setColumnChoicePositionsByDefaultColumnOrder(columnId){var columnChoices,sortedColumnChoicePositions;$.each(self.columns,function(i,column){if(column.id===columnId){sortedColumnChoicePositions={};columnChoices=column.items;$.each(columnChoices,function(position,columnChoice){sortedColumnChoicePositions[columnChoice.id]=position;});self.sortedPositions.columnChoices.push(sortedColumnChoicePositions);}});}

function setColumnChoicePositionsByDefaultRowOrder(rowId){var sortedColumnChoicePositions={};$.each(_.values(self.columnChoices),function(position,columnChoice){sortedColumnChoicePositions[columnChoice.id]=position;});self.sortedPositions.columnChoices.push(sortedColumnChoicePositions);} 
function setRowPositionsByRowCount(sortOrder){var unsortedCounts=[],rowSummary;_.map(self.rows,function(row){rowSummary=self.summary.summary.options[row.id];if(rowSummary){unsortedCounts.push([row.id,rowSummary.count]);}else{unsortedCounts.push([row.id,0]);}});setSortedRowPositions(unsortedCounts,sortOrder);}
function setRowPositionsByColumnCount(columnId,sortOrder){var unsortedCounts=[],rowSummary,columnSummary;_.map(self.rows,function(row){rowSummary=self.summary.summary.options[row.id];$.each(self.columns,function(i,column){if(column.id===columnId){if(rowSummary){columnSummary=rowSummary.options[column.id];if(columnSummary){unsortedCounts.push([row.id,columnSummary.count]);}else{unsortedCounts.push([row.id,0]);}}else{unsortedCounts.push([row.id,0]);}}});});setSortedRowPositions(unsortedCounts,sortOrder);}
function setRowPositionsByColumnChoiceCount(columnChoiceId,sortOrder){var unsortedCounts=[],columnChoices,rowSummary,columnSummary,columnChoiceSummary,columnColumnChoiceIds;$.each(self.rows,function(i,row){rowSummary=self.summary.summary.options[row.id];if(rowSummary){$.each(self.columns,function(j,column){columnChoices=column.items;columnColumnChoiceIds=_.pluck(columnChoices,"id");if(_.contains(columnColumnChoiceIds,columnChoiceId)){columnSummary=rowSummary.options[column.id];if(columnSummary){$.each(columnChoices,function(k,columnChoice){if(columnChoice.id===columnChoiceId){columnChoiceSummary=columnSummary.options[columnChoice.id];if(columnChoiceSummary){unsortedCounts.push([row.id,columnChoiceSummary.count]);}else{unsortedCounts.push([row.id,0]);}}});}else{unsortedCounts.push([row.id,0]);}}});}else{unsortedCounts.push([row.id,0]);}})
setSortedRowPositions(unsortedCounts,sortOrder);}
function setColumnPositionsByRowCount(rowId,sortOrder){var unsortedCounts=[],rowSummary,columnSummary;_.map(self.columns,function(column){$.each(self.rows,function(i,row){if(row.id===rowId){rowSummary=self.summary.summary.options[row.id];if(rowSummary&&rowSummary.options){columnSummary=rowSummary.options[column.id];if(columnSummary){unsortedCounts.push([column.id,columnSummary.count]);}else{unsortedCounts.push([column.id,0]);}}else{unsortedCounts.push([column.id,0]);}}});});setSortedColumnPositions(unsortedCounts,sortOrder);}
function setColumnPositionsByColumnChoiceCount(rowId,columnChoiceId,sortOrder){var unsortedCounts=[],columnChoices,rowSummary,columnSummary,columnChoiceSummary;$.each(self.columns,function(i,column){$.each(self.rows,function(j,row){if(row.id===rowId){rowSummary=self.summary.summary.options[row.id];columnSummary=rowSummary.options[column.id];if(rowSummary&&columnSummary){columnChoices=column.items;$.each(columnChoices,function(k,columnChoice){if(columnChoice.id===columnChoiceId){columnChoiceSummary=columnSummary.options[columnChoice.id];unsortedCounts.push([column.id,columnChoiceSummary.count]);}});}else{unsortedCounts.push([column.id,0]);}}});});setSortedColumnPositions(unsortedCounts,sortOrder);}
function setColumnChoicePositionsByRowCount(columnId,rowId,sortOrder){var unsortedCounts=[],columnChoices,rowSummary,columnSummary,columnChoiceSummary;var column=getColumnByID(columnId);columnChoices=column.items;$.each(columnChoices,function(j,columnChoice){$.each(self.rows,function(k,row){if(row.id===rowId){rowSummary=self.summary.summary.options[row.id];if(rowSummary){columnSummary=rowSummary.options[column.id];if(columnSummary){columnChoiceSummary=columnSummary.options[columnChoice.id];if(columnChoiceSummary){unsortedCounts.push([columnChoice.id,columnChoiceSummary.count]);}else{unsortedCounts.push([columnChoice.id,0]);}}else{unsortedCounts.push([columnChoice.id,0]);}}else{unsortedCounts.push([columnChoice.id,0]);}}});});setSortedColumnChoicePositions(unsortedCounts,sortOrder);}
function setColumnChoicePositionByColumnCount(rowId,columnId,sortOrder){var row=getRowByID(rowId),column=getColumnByID(columnId);var columnChoices=column.items,rowSummary,columnSummary,columnChoiceSummary,unsortedCounts=[];rowSummary=self.summary.summary.options[row.id];if(rowSummary){columnSummary=rowSummary.options[column.id];if(columnSummary){$.each(columnChoices,function(i,columnChoice){columnChoiceSummary=columnSummary.options[columnChoice.id];unsortedCounts.push([columnChoice.id,columnChoiceSummary.count]);});}else{$.each(columnChoices,function(i,columnChoice){unsortedCounts.push([columnChoice.id,0]);});}}else{$.each(columnChoices,function(i,columnChoice){unsortedCounts.push([columnChoice.id,0]);});}
setSortedColumnChoicePositions(unsortedCounts,sortOrder);}
function setRowPositionsByLabel(sortOrder){var unsortedLabels=[];_.map(self.rows,function(row){unsortedLabels.push([row.id,row.text]);});setSortedRowPositions(unsortedLabels,sortOrder);}
function setColumnPositionsByLabel(sortOrder){var unsortedLabels=[];_.map(self.columns,function(column){unsortedLabels.push([column.id,column.text]);});setSortedColumnPositions(unsortedLabels,sortOrder);}
function setColumnChoicePositionsByLabel(dimensionId,sortOrder){var unsortedLabels=[],column,columnChoices;if(self.isCompared){columnChoices=_.values(self.columnChoices);}else{column=getColumnByID(dimensionId);columnChoices=column.items;}
_.map(columnChoices,function(columnChoice){unsortedLabels.push([columnChoice.id,columnChoice.text]);});setSortedColumnChoicePositions(unsortedLabels,sortOrder);} 
function setRowPositionsByTotal(sortOrder){var unsortedTotals=[],rowSummary;_.map(self.rows,function(row){rowSummary=self.summary.summary.options[row.id];if(rowSummary){unsortedTotals.push([row.id,rowSummary.row_total]);}else{unsortedTotals.push([row.id,0]);}});setSortedRowPositions(unsortedTotals,sortOrder);}
function setRowPositionsByColumnTotal(columnId,sortOrder){var unsortedTotals=[],rowSummary,columnSummary;_.map(self.rows,function(row){rowSummary=self.summary.summary.options[row.id];if(rowSummary){columnSummary=rowSummary.options[columnId];if(columnSummary){unsortedTotals.push([row.id,columnSummary.row_total]);}else{unsortedTotals.push([row.id,0]);}}else{unsortedTotals.push([row.id,0]);}});setSortedRowPositions(unsortedTotals,sortOrder);}
 
function setColumnPositionsByTotal(sortOrder){var unsortedTotals=[];_.each(self.columns,function(column){unsortedTotals.push([column.id,self.columnTotals[column.id]]);});setSortedColumnPositions(unsortedTotals,sortOrder);}
function setColumnPositionsByRowTotal(rowId,sortOrder){var unsortedTotals=[];$.each(self.columns,function(i,column){unsortedTotals.push([column.id,self.columnTotalsByRow[rowId][column.id]]);});setSortedColumnPositions(unsortedTotals,sortOrder);} 
function setColumnChoicePositionsByRowTotal(columnId,sortOrder){var unsortedTotals=[],columnChoices,columnChoiceTotals;$.each(self.columns,function(i,column){if(column.id===columnId){columnChoices=column.items;columnChoiceTotals=calculateColumnChoiceTotalsByRow(columnChoices);$.each(columnChoices,function(j,columnChoice){unsortedTotals.push([columnChoice.id,columnChoiceTotals[columnChoice.id]]);});}});setSortedColumnChoicePositions(unsortedTotals,sortOrder);}
function setColumnChoicePositionsByColumnTotal(rowId,sortOrder){var unsortedTotals=[];_.each(self.rows,function(row,i){if(row.id===rowId){_.each(self.columnChoices,function(columnChoice,j){unsortedTotals.push([columnChoice.id,self.columnChoiceTotalsByRow[row.id][columnChoice.id]]);});}});setSortedColumnChoicePositions(unsortedTotals,sortOrder);} 
function setRowPositionsByRowSum(sortOrder){var unsortedSums=[],rowSummary;_.map(self.rows,function(row){rowSummary=self.summary.summary.options[row.id];if(rowSummary){unsortedSums.push([row.id,rowSummary.sum]);}else{unsortedSums.push([row.id,0]);}});setSortedRowPositions(unsortedSums,sortOrder);} 
function setRowPositionsByAverageRating(sortOrder){var unsortedWeightedAverages=[];$.each(self.weightedAveragesByRow,function(rowId,weightedAverage){unsortedWeightedAverages.push([rowId,weightedAverage]);});setSortedRowPositions(unsortedWeightedAverages,sortOrder);}



function setColumnPositionsByAverageRating(sortOrder){var unsortedWeightedAverages=[];$.each(self.columns,function(i,column){unsortedWeightedAverages.push([column.id,column.weight]);});setSortedColumnPositions(unsortedWeightedAverages,sortOrder);} 
function setRowPositionsByAverageNumber(sortOrder){var unsortedNumbers=[],rowSummary;_.each(self.rows,function(row){rowSummary=self.summary.summary.options[row.id];if(rowSummary){unsortedNumbers.push([row.id,rowSummary.average]);}else{unsortedNumbers.push([row.id,0]);}});setSortedRowPositions(unsortedNumbers,sortOrder);} 
function setRowPositionsByResponses(sortOrder){var unsortedNumResponses=[],rowSummary;_.each(self.rows,function(row){rowSummary=self.summary.summary.options[row.id];if(rowSummary){unsortedNumResponses.push([row.id,rowSummary.count]);}else{unsortedNumResponses.push([row.id,0]);}});setSortedRowPositions(unsortedNumResponses,sortOrder);}




function setSortedRowPositions(unsortedArray,sortOrder){_setSortedDimensionPositions("rows",unsortedArray,sortOrder);}
function setSortedColumnPositions(unsortedArray,sortOrder){_setSortedDimensionPositions("columns",unsortedArray,sortOrder);}
function setSortedColumnChoicePositions(unsortedArray,sortOrder){_setSortedDimensionPositions("columnChoices",unsortedArray,sortOrder);}
function _setSortedDimensionPositions(dimensionType,unsortedArray,sortOrder){var sortedArray,sortedDimensionPositions={};if(sortOrder===SORT_ORDER_ASC){sortedArray=unsortedArray.sort(_sortAsc);}else if(sortOrder===SORT_ORDER_DESC){sortedArray=unsortedArray.sort(_sortDesc);}else if(sortOrder===SORT_ORDER_UNSORTED){sortedArray=unsortedArray;}
$.each(sortedArray,function(position,array){var dimensionId=array[0];sortedDimensionPositions[dimensionId]=position;});self.sortedPositions[dimensionType].push(sortedDimensionPositions);}
function _sortAsc(a,b){if(typeof a[1]==="string"){if(a[1].toLowerCase()>b[1].toLowerCase()){return 1;}else if(a[1].toLowerCase()<b[1].toLowerCase()){return-1;}else{return 0;}}else{return a[1]-b[1];}}
function _sortDesc(a,b){if(typeof a[1]==="string"){if(a[1].toLowerCase()<b[1].toLowerCase()){return 1;}else if(a[1].toLowerCase()>b[1].toLowerCase()){return-1;}else{return 0;}}else{return b[1]-a[1];}}
_initialize(options);};SM.Sortable={SORTING_ORDERS:{UNSORTED:"unsorted",ASCENDING:"ascending",DESCENDING:"descending"},DIMENSION_TYPES:{LABELS:"labels",RESPONSES:"responses",TOTALS:"totals",AVERAGE_RATING:"averageRating",AVERAGE_NUMBER:"averageNumber",ROW:"row",COLUMN:"column",COLUMN_CHOICE:"columnChoice",DATA_SEGMENT:'dataSegment',MIN:'min',LOWER_QUARTILE:'lowerQuartile',MEDIAN:'median',UPPER_QUARTILE:'upperQuartile',MAX:'max'}};SM.Summarizable={SCALE_TYPE_PERCENT:"percent",_createAsSummarizable:function(options){var self=this;self.question=options.question;self.isCompared=this.question.isCompared();self.rollup=this.question.getRollup();self.display=self.rollup.display;self.summary=this.rollup.summary;self.questionType=this.summary.type;self.questionSubType=this.question.subtype;self.questionFamily=this.question.family;self.questionStructure=self.question.getContextStructure();self.answerStructures=self.getAnswerStructures(self.question,self.display);self.rows=self.answerStructures.rows;self.columns=self.answerStructures.cols;self.others=self.answerStructures.other;self.crossedOptions=self.answerStructures.crossedOptions;self.numRows=self.rows.length;self.numColumns=self.columns?self.columns.length:0;self._mungeOtherData();},
getAnswerStructures:function(question,display){var self=this,questionStructure=question.getContextStructure(),answerStructures=SM.Object.deepCopy(questionStructure.answers),isMirrored=display.getDisplayData().mirror,labels=display.getDisplayData().labels,labelData,otherOption;if(labels){if(labels.rows){_.each(answerStructures.rows,function(row){labelData=labels.rows[row.id];if(labelData){if(!_.isEmpty(labelData.text)){row.text=labelData.text;}}});}
if(labels.columns){_.each(answerStructures.cols,function(column){labelData=labels.columns[column.id];if(labelData){if(!_.isEmpty(labelData.text)){column.text=labelData.text;}}});}
if(labels.columnChoices){_.each(answerStructures.cols,function(column){_.each(column.items,function(columnChoice){labelData=labels.columnChoices[columnChoice.id];if(labelData){if(!_.isEmpty(labelData.text)){columnChoice.text=labelData.text;}}});});}
if(labels.crossedOptions){_.each(answerStructures.crossedOptions,function(crossedOption){labelData=labels.crossedOptions[crossedOption.id];if(labelData){if(!_.isEmpty(labelData.text)){crossedOption.text=labelData.text;}}});if(isMirrored){_.each(answerStructures.cols,function(column){_.each(column.items,function(columnChoice){labelData=labels.crossedOptions[columnChoice.id];if(labelData){if(!_.isEmpty(labelData.text)){columnChoice.text=labelData.text;}}});});}else{_.each(answerStructures.rows,function(row){_.each(row.items,function(columnChoice){labelData=labels.crossedOptions[columnChoice.id];if(labelData){if(!_.isEmpty(labelData.text)){columnChoice.text=labelData.text;}}});});}}
if(labels.others){otherOption=answerStructures.other[0];labelData=labels.others[otherOption.id];if(!_.isEmpty(labelData.text)){otherOption.text=labelData.text;}}}
return answerStructures;},_getDisplayOptions:function(){var self=this;self.displayData=self.rollup.display.getDisplayData();self.showTable=self.displayData.show_table;self.showChart=self.displayData.show_chart;self.isMirrored=self.displayData.mirror;self.isStacked=self.displayData.isStacked;self.isWeightedAvg=self.displayData.isWeightedAvg;self.showDataLabels=self.displayData.show_data;self.hideEmptyData=!self.displayData.show_empty_data;self.scaleType=self.displayData.scale_type;self.scaleIsPercent=self.scaleType===self.SCALE_TYPE_PERCENT;self.decimalPlaces=self.scaleIsPercent?self.displayData.dp_percentage:self.displayData.dp_absolute;self.decimalPlacesAbsolute=self.displayData.dp_absolute;self.decimalPlacesPercentage=self.displayData.dp_percentage;},_getSortedSummaryData:function(){var self=this,sortedSummary=self.rollup.getSortedSummary();self.summaryType=self.isCompared?self.summary.summary.type:self.summary.type;self.hasColumnChoices=self.summaryType==="menu_matrix";if(self.isCompared){self.aggregateOverColumns=self.summaryType==="matrix"&&self.isMirrored;}else{self.aggregateOverColumns=self.isMirrored;}
self.sortedRowsList=sortedSummary.sortedAnswers.rowsList;self.sortedColumnsList=sortedSummary.sortedAnswers.columnsList;self.sortedColumnChoicesList=sortedSummary.sortedAnswers.columnChoicesList;self.responsesCountsByRow=sortedSummary.counts.responsesCountsByRow;self.responsesCountsByColumn=sortedSummary.counts.responsesCountsByColumn;self.respondentCountsByColumn=sortedSummary.counts.respondentCountsByColumn;self.respondentCountsByRow=sortedSummary.counts.respondentCountsByRow;self.sortedRowTotals=sortedSummary.totals.sortedRowTotals;self.sortedColumnTotals=sortedSummary.totals.sortedColumnTotals;self.columnTotalsByRow=sortedSummary.totals.columnTotalsByRow;self.columnChoiceTotalsByRow=sortedSummary.totals.columnChoiceTotalsByRow;self.columnChoiceTotalsByColumnChoice=sortedSummary.totals.columnChoiceTotalsByColumnChoice;self.weightedAveragesByRow=sortedSummary.weightedAverages.weightedAveragesByRow;self.weightedAveragesByColumn=sortedSummary.weightedAverages.weightedAveragesByColumn;self.weightedAveragesByRowAndColumn=sortedSummary.weightedAverages.weightedAveragesByRowAndColumn;self.weightedAveragesByRowAndColumnChoice=sortedSummary.weightedAverages.weightedAveragesByRowAndColumnChoice;self.weights=sortedSummary.weights;},

_mungeOtherData:function(){var self=this;var otherIsAnswer=(self.others!==undefined&&self.others[0].is_answer!==undefined);if(otherIsAnswer){_.each(self.others,function(other,i){self.rows.push(other);});}}};SM.SummarySeriesFactory=SM.Object.extend(SM.Summarizable,SM.Sortable,{buildSimpleSeries:function(){var self=this,series=[],seriesItem,data,datum,sortedRows,row,name,total;sortedRows=self.sortedRowsList[0];data=self._summarizeDimension(sortedRows,self.summary.summary,function(rowSummary,rowIndex,rowId){row=sortedRows[rowIndex];name=row?row.text:null;total=self.summary.answered;datum=self._buildSeriesItemDatum(rowSummary,total,name);return datum;}, function(rowIndex,rowId){row=sortedRows[rowIndex];name=row?row.text:null;datum=self._buildSeriesItemDatum(null,0,name);return datum;});seriesItem=self._buildSeriesItem(data);series.push(seriesItem);return series;},


buildSimpleSeriesFromMatrixSummary:function(){var self=this,series=[],seriesItem,data,datum,sortedColumns,row,rowSummary,column,name,total;row=self.rows[0];rowSummary=self.summary.summary.options[row.id];sortedColumns=self.sortedColumnsList[0];data=self._summarizeDimension(sortedColumns,rowSummary,function(columnSummary,columnIndex,columnId){column=sortedColumns[columnIndex];name=column?column.text:null;total=rowSummary.row_total;datum=self._buildSeriesItemDatum(columnSummary,total,name);return datum;}, function(columnIndex,columnId){column=sortedColumns[columnIndex];name=column?column.text:null;datum=self._buildSeriesItemDatum(null,0,name);return datum;});seriesItem=self._buildSeriesItem(data);series.push(seriesItem);return series;},buildSimpleSeriesFromComparedMatrixSummary:function(){var self=this,series=[],seriesItem,data,datum,column,rowSummary,columnSummary,name,total;column=self.columns[0];total=self.summary.answered;data=_.map(self.rows,function(row,rowIndex){rowSummary=self.summary.summary.options[row.id];name=row.text;if(rowSummary){columnSummary=rowSummary.options[column.id];if(columnSummary){datum=self._buildSeriesItemDatum(columnSummary,total,name);}else{datum=self._buildSeriesItemDatum(null,0,name);}}else{datum=self._buildSeriesItemDatum(null,0,name);}
return datum;});seriesItem=self._buildSeriesItem(data);series.push(seriesItem);return series;},


buildSimpleSeriesFromMenuMatrixSummary:function(columnID){var self=this,series=[],seriesItem,data,datum,sortedColumnChoices,row,rowSummary,columnSummary,columnChoice,name,total;row=self.rows[0];rowSummary=self.summary.summary.options[row.id];columnSummary=rowSummary.options[columnID];sortedColumnChoices=self.sortedColumnChoicesList[0];data=self._summarizeDimension(sortedColumnChoices,columnSummary,function(columnChoiceSummary,columnChoiceIndex,columnChoiceId){columnChoice=sortedColumnChoices[columnChoiceIndex];name=columnChoice?columnChoice.text:null;total=columnSummary.row_total;datum=self._buildSeriesItemDatum(columnChoiceSummary,total,name);return datum;}, function(columnChoiceSummary,columnChoiceIndex,columnChoiceId){columnChoice=sortedColumnChoices[columnChoiceIndex];name=columnChoice?columnChoice.text:null;datum=self._buildSeriesItemDatum(null,0,name);return datum;});seriesItem=self._buildSeriesItem(data);series.push(seriesItem);return series;},buildSimpleStackedSeries:function(sortedRows){var self=this,data,datum,series,row,name,total,numSeries;data=self._summarizeDimension(sortedRows,self.summary.summary,function(rowSummary,rowIndex,rowId){row=sortedRows[rowIndex];name=row?row.text:null;total=self.summary.answered;datum=self._buildSeriesItemDatum(rowSummary,total,name);return datum;}, function(rowIndex,rowId){row=sortedRows[rowIndex];name=row.text;datum=self._buildSeriesItemDatum(null,0,name);return datum;});series=_.map(data,function(seriesItemData,i){name=seriesItemData.name;numSeries=sortedRows.length;return self._buildSeriesItem([seriesItemData],{name:name,index:i,numSeries:numSeries});});return series;},

buildNumericalSeries:function(options){var self=this,options=options||{},series=[],seriesItem,sortedRows,rowSummary,averagesData,sumsData,responsesData,average,sum,numResponses;sortedRows=self.sortedRowsList[0];averagesData=_.map(sortedRows,function(row){rowSummary=self.summary.summary.options[row.id];average=rowSummary?rowSummary.average:0;return{absoluteY:Globalize.format(average,"n0")};});seriesItem=self._buildTableSeriesItem(averagesData,options.averageSeriesName,"averageNumber");series.push(seriesItem);sumsData=_.map(sortedRows,function(row){rowSummary=self.summary.summary.options[row.id];sum=rowSummary?rowSummary.sum:0;return{absoluteY:Globalize.format(sum,"n0")};});seriesItem=self._buildTableSeriesItem(sumsData,options.totalSeriesName,"totals");series.push(seriesItem);responsesData=_.map(sortedRows,function(row){rowSummary=self.summary.summary.options[row.id];numResponses=rowSummary?rowSummary.count:0;return{absoluteY:Globalize.format(numResponses,"n0")};});seriesItem=self._buildTableSeriesItem(responsesData,options.responsesSeriesName,"responses");series.push(seriesItem);return series;},buildMatrixSeries:function(options){var self=this,options=options||{},series=[],seriesItem,data,datum,datumOptions,sortedRows,columnSummary,row,name,total;sortedRows=self.sortedRowsList[0];_.each(self.columns,function(column,columnIndex){data=self._summarizeDimension(sortedRows,self.summary.summary, function(rowSummary,rowIndex){row=sortedRows[rowIndex];if(rowSummary.options){columnSummary=rowSummary.options[column.id];total=self.respondentCountsByRow[row.id];datumOptions={};if(self._seriesDatumHasComments(row)){datumOptions.commentData=self._buildCommentData({option:row,crossedOption:column,crossedOptionSummary:columnSummary,matrixCross:self._isMatrixCross(self.summary)});}
datum=self._buildSeriesItemDatum(columnSummary,total,null,datumOptions);}else{datum=self._buildSeriesItemDatum(null,0);}
return datum;}, function(rowIndex,rowID){row=sortedRows[rowIndex];name=row.text;datum=self._buildSeriesItemDatum(null,0);return datum;});seriesItem=self._buildSeriesItem(data,{dimension:column,index:columnIndex,numSeries:self.numColumns});series.push(seriesItem);});if(options.includeTotal){var totalsData,total;totalsData=_.map(sortedRows,function(row){total=self.respondentCountsByRow[row.id];return{absoluteY:Globalize.format(total,"n0")};});seriesItem=self._buildTableSeriesItem(totalsData,options.totalSeriesName,"totals");series.push(seriesItem);}
if(options.includeAverage){var averagesData=self._calculateAverage(sortedRows,function(row,rowIndex){return self.weightedAveragesByRow[row.id];});seriesItem=self._buildTableSeriesItem(averagesData,options.averageSeriesName,"averageRating");series.push(seriesItem);}
return series;},buildMirroredMatrixSeries:function(options){var self=this,options=options||{},series=[],seriesItem,seriesItemOptions,data,datum,datumOptions,sortedColumns,rowSummary,column,total;sortedColumns=self.sortedColumnsList[0];_.each(self.rows,function(row,rowIndex){rowSummary=self.summary.summary.options[row.id];data=self._summarizeDimension(sortedColumns,rowSummary,function(columnSummary,columnIndex){datumOptions={};column=sortedColumns[columnIndex];total=self.respondentCountsByColumn[column.id];if(self.question.randomAssignmentOption!==undefined){total=self.respondentCountsByRow[row.id];}
if(self._seriesDatumHasComments(row)){var var_id="0";if(self.question.randomAssignmentOption!==undefined){var_id=self.question.randomAssignmentOption.toString();}
datumOptions.commentData=self._buildCommentData({option:row,crossedOption:column,crossedOptionSummary:columnSummary,matrixCross:self._isMatrixCross(self.summary),variationID:var_id});}
datum=self._buildSeriesItemDatum(columnSummary,total,null,datumOptions);return datum;},function(columnIndex,columnID){column=sortedColumns[columnIndex];datum=self._buildSeriesItemDatum(null,0);return datum;});seriesItemOptions={dimension:row,index:rowIndex,numSeries:self.numRows}; if(self.question.hasCommentsPerRow()){var numComments=rowSummary?rowSummary.row_other:0;seriesItemOptions.hasCommentsPerRow=true;seriesItemOptions.numComments=Globalize.format(numComments,"n0");}
seriesItem=self._buildSeriesItem(data,seriesItemOptions);series.push(seriesItem);});if(options.includeTotal){var totalsData,total;totalsData=_.map(sortedColumns,function(column){total=self.responsesCountsByColumn[column.id];return{absoluteY:Globalize.format(total,"n0")};});seriesItem=self._buildTableSeriesItem(totalsData,options.totalSeriesName,"totals");series.push(seriesItem);}
if(options.includeAverage){var averagesData=self._calculateAverage(sortedColumns,function(column){return self.weightedAveragesByColumn[column.id];});seriesItem=self._buildTableSeriesItem(averagesData,options.averageSeriesName,"averageRating");series.push(seriesItem);}
return series;},

buildMenuMatrixSeries:function(column,columnIndex,columnChoices,columnChoiceTotals,options){var self=this,options=options||{},series=[],seriesItem,data,datum,rowSummary,columnSummary,columnChoiceSummary,numColumnChoices,sortedRows,sortedColumnChoices,total;numColumnChoices=columnChoices.length;if(self.isMirrored){sortedColumnChoices=self.sortedColumnChoicesList[columnIndex];_.each(self.rows,function(row,i){rowSummary=self.summary.summary.options[row.id];if(rowSummary){columnSummary=rowSummary.options[column.id];if(columnSummary){data=self._summarizeDimension(sortedColumnChoices,columnSummary,function(columnChoiceSummary,index,columnChoiceId){total=columnChoiceTotals[columnChoiceId];datum=self._buildSeriesItemDatum(columnChoiceSummary,total);return datum;},function(columnChoiceIndex,columnChoiceID){datum=self._buildSeriesItemDatum(null,0);return datum;});}else{data=self._dataForUnsummarizedDimension(sortedColumnChoices.length);}}else{data=self._dataForUnsummarizedDimension(sortedColumnChoices.length);}
seriesItem=self._buildSeriesItem(data,{dimension:row,index:i,numSeries:self.numRows});series.push(seriesItem);});if(options.includeTotal){var totalsData=_.map(sortedColumnChoices,function(columnChoice){total=self.columnChoiceTotalsByColumnChoice[columnChoice.id];return{absoluteY:Globalize.format(total,"n0")};});seriesItem=self._buildTableSeriesItem(totalsData,options.totalSeriesName,"totals");series.push(seriesItem);}}else{sortedRows=self.sortedRowsList[column.position-1];_.each(columnChoices,function(columnChoice,i){data=self._summarizeDimension(sortedRows,self.summary.summary,function(rowSummary){columnSummary=rowSummary.options[column.id];if(columnSummary){columnChoiceSummary=columnSummary.options[columnChoice.id];total=columnSummary.row_total;datum=self._buildSeriesItemDatum(columnChoiceSummary,total);}else{datum=self._buildSeriesItemDatum(null,0);}
return datum;},function(rowIndex,rowID){datum=self._buildSeriesItemDatum(null,0);return datum;});seriesItem=self._buildSeriesItem(data,{dimension:columnChoice,index:i,numSeries:numColumnChoices});series.push(seriesItem);});if(options.includeTotal){var totalsData=_.map(sortedRows,function(row){total=self.columnTotalsByRow[row.id][column.id];return{absoluteY:Globalize.format(total,"n0")};});seriesItem=self._buildTableSeriesItem(totalsData,options.totalSeriesName,"totals");series.push(seriesItem);}}
return series;}, buildComparedMatrixSeries:function(row,columnChoices,columnChoiceTotals,options){var self=this,options=options||{},series=[],data,datum,rowSummary,columnSummary,columnChoiceSummary,seriesItem,numColumnChoices,sortedColumns,sortedColumnChoices,totalsData,total,colID;numColumnChoices=columnChoices.length;rowSummary=self.summary.summary.options[row.id];if(self.isMirrored){sortedColumnChoices=self.sortedColumnChoicesList[row.position-1];_.each(self.columns,function(column,i){if(rowSummary){columnSummary=rowSummary.options[column.id];if(columnSummary){data=self._summarizeDimension(sortedColumnChoices,columnSummary,function(columnChoiceSummary,index,columnChoiceId){total=columnChoiceTotals[columnChoiceId];datum=self._buildSeriesItemDatum(columnChoiceSummary,total);return datum;});}else{data=_.map(columnChoices,function(columnChoice){datum=self._buildSeriesItemDatum(null,0);return datum;});}}else{data=_.map(columnChoices,function(columnChoice){datum=self._buildSeriesItemDatum(null,0);return datum;});}
seriesItem=self._buildSeriesItem(data,{dimension:column,index:i,numSeries:self.numColumns});series.push(seriesItem);});if(options.includeTotal){totalsData=_.map(sortedColumnChoices,function(columnChoice){total=self.columnChoiceTotalsByRow[row.id][columnChoice.id];return{absoluteY:Globalize.format(total,"n0")};});seriesItem=self._buildTableSeriesItem(totalsData,options.totalSeriesName,"totals");series.push(seriesItem);}}else{sortedColumns=self.sortedColumnsList[row.position-1];_.each(columnChoices,function(columnChoice,i){data=self._summarizeDimension(sortedColumns,rowSummary,function(columnSummary){colID=columnChoice.id||columnChoice.variable_id;columnChoiceSummary=columnSummary.options[colID];total=columnSummary.row_total;datum=self._buildSeriesItemDatum(columnChoiceSummary,total);return datum;},function(columnIndex,columnID){datum=self._buildSeriesItemDatum(null,0);return datum;});seriesItem=self._buildSeriesItem(data,{dimension:columnChoice,index:i,numSeries:numColumnChoices});series.push(seriesItem);});if(options.includeTotal){totalsData=_.map(sortedColumns,function(column){total=self.columnTotalsByRow[row.id][column.id];return{absoluteY:Globalize.format(total,"n0")};});seriesItem=self._buildTableSeriesItem(totalsData,options.totalSeriesName,"totals");series.push(seriesItem);}}
return series;},_buildSimpleBenchmarkTableSeries:function(quartileValues,options){ var series=[];_.each(quartileValues,function(value,index){var seriesData=[{y:value,absoluteY:value,percentageY:value,name:options.names[index]}];series.push({name:'Benchmark',data:seriesData,__options:{dimensionType:'averageRating',template:'benchmark-table-response-cell'}});});return series;},_addSimpleBenchmarkChartLabels:function(series,quartileValues,responseMean,options){




var seriesData=[],datum;_.each(quartileValues,function(value,index){var datum={x:1,y:value};datum.name=''+datum.y;seriesData.push(datum);});series.push({name:'DataOutlier',color:'white',type:'scatter',data:seriesData,marker:{fillColor:'white',lineWidth:0,lineColor:'white'},dataLabels:{align:'center',enabled:true,formatter:SM.Highcharts.floatingPointFormatter,y:-20,style:{fontSize:'10px',color:'#333'}},zIndex:-1000,showInLegend:false});datum={x:2,y:responseMean,style:{color:'red'}};datum.name=''+datum.y;series.push({name:'AverageOutlier',color:'white',type:'scatter',data:[datum],marker:{fillColor:'white',lineWidth:0,lineColor:'white'},dataLabels:{align:'center',enabled:true,formatter:SM.Highcharts.floatingPointFormatter,y:10,style:{fontSize:'10px',color:'red'}},zIndex:-1000,showInLegend:false});},_buildSimpleBenchmarkChartSeries:function(quartileValues,responseMean,options){var series=[],seriesData=[],datum,mean; _.each(quartileValues,function(value,index){seriesData.push({y:value,absoluteY:value,percentageY:value,name:options.names[index]});});

seriesData=[[],seriesData];series.push({name:'Benchmark',pointWidth:50,data:seriesData,tooltip:{headerFormat:'<em>Experiment No {point.key}</em><br/>'},color:options.colors[1],fillColor:options.colors[1],stemColor:'#333',stemWidth:1,whiskerColor:'#333',medianColor:'#333',medianWidth:1,showInLegend:false,__options:{dimensionType:'benchmark'}});
 series.push({name:'Your Average',color:'red',data:[[{y:responseMean,absoluteY:responseMean,percentageY:responseMean,name:Globalize.localize('Your Average')}]]});this._addSimpleBenchmarkChartLabels(series,quartileValues,responseMean,options);return series;},buildSimpleBenchmarkSeries:function(options){var benchmarkRollup=this.question.page.survey.getBenchmarkRollup(this.question.ID),quartileValues=benchmarkRollup.getQuartileValues(),responseMean=benchmarkRollup.getResponseMean();options.names=[Globalize.localize('Min'),Globalize.localize('Lower Quartile'),Globalize.localize('Median'),Globalize.localize('Upper Quartile'),Globalize.localize('Max')];


 if(options.tableOutput){return this._buildSimpleBenchmarkTableSeries(quartileValues,options);}
else{return this._buildSimpleBenchmarkChartSeries(quartileValues,responseMean,options);}},_dataForUnsummarizedDimension:function(numDatum){var self=this,data=[],datum;_.times(numDatum,function(i){datum=self._buildSeriesItemDatum(null,0);data.push(datum);});return data;},


 
_summarizeDimension:function(dimensionalData,summary,summaryIterator,nullIterator){var dimensionSummary,data,summarizedData=[],isRandomAssignmentQuestion=this.question.hasRandomAssignment(),randomAssignmentOption=this.question.randomAssignmentOption;_.each(dimensionalData,function(dimension,index){if(summary&&summary.options){dimensionSummary=summary.options[dimension.id];if(!dimensionSummary&&isRandomAssignmentQuestion){dimensionSummary=summary.options[randomAssignmentOption];}
if(dimensionSummary){data=summaryIterator(dimensionSummary,index,dimension.id);}else{if(nullIterator){data=nullIterator(index,dimension.id);}else{data=[0,0];}}}else{if(nullIterator){data=nullIterator(index,dimension.id);}else{data=[0,0];}}
summarizedData.push(data);});return summarizedData;}, _buildSeriesItemDatum:function(dimensionSummary,total,name,options){var self=this,valueKey,absoluteValue,percentageValue,isForNumericalChart;if(_.isEmpty(dimensionSummary)){absoluteValue=0;percentageValue=0;}else{ isForNumericalChart=(self.questionSubType==="numerical"&&!self.isCompared);valueKey=isForNumericalChart?"average":"count";absoluteValue=dimensionSummary[valueKey];if(!isForNumericalChart){percentageValue=self._calculatePercentage(absoluteValue,total);}}
return{y:self.scaleIsPercent?percentageValue:absoluteValue,absoluteY:absoluteValue,percentageY:percentageValue,name:name,__options:options};}, 
_seriesDatumHasComments:function(row){var self=this;return self.isCompared&&row.is_openended&&!row.apply_all_rows;},_buildCommentData:function(options){var self=this,option=options.option,crossedOption=options.crossedOption,crossedOptionSummary=options.crossedOptionSummary,matrixCross=options.matrixCross,numComments=crossedOptionSummary.count||0,optionID=option.id,crossedOptionID=crossedOption.id,variationID=options.variationID;return{optionID:optionID,crossedOptionID:crossedOptionID,matrixCross:matrixCross,numComments:numComments,variationID:variationID};},_isMatrixCross:function(summary){return summary.crossed_cols?"1":"0";},_calculatePercentage:function(value,total){if(total===undefined||total===0||value===undefined){return 0;}else{return value/total*100;}},


_buildSeriesItem:function(data,options){var self=this,seriesItem,dimension,dimensionIndex,numSeries;seriesItem={name:null,data:data,__options:{}
};if(!_.isEmpty(options)){dimension=options.dimension;if(dimension){seriesItem.name=dimension.text;seriesItem.__options.labelText=dimension.text;seriesItem.__options.labelHTML=dimension.mediaHTML;seriesItem.__options.dimensionType=self._getDimensionType(dimension);seriesItem.__options.dimensionID=dimension.id;}
if(options.name!==undefined){seriesItem.name=options.name;}
seriesItem.__options.hasCommentsPerRow=options.hasCommentsPerRow;seriesItem.__options.numComments=options.numComments;


dimensionIndex=options.index;numSeries=options.numSeries;if(dimensionIndex!==undefined&&numSeries!==undefined){seriesItem.index=self._seriesIndex(dimensionIndex,numSeries);seriesItem.legendIndex=self._legendIndex(dimensionIndex,numSeries);}}
seriesItem.__options.scaleType=self.scaleType;seriesItem.__options.decimalPlaces=self.decimalPlaces;seriesItem.__options.showDataLabels=self.displayData.show_data;seriesItem.__options.isLegend=self.displayData.isLegend;return seriesItem;},_seriesIndex:function(i,numSeries){var self=this,reverseSortOrder=(self.highchartsChartType==="column"&&!self.isStacked);return reverseSortOrder?i:(numSeries-i);},_legendIndex:function(i,numSeries){var reverseSortOrder=false;return reverseSortOrder?(numSeries-i):i;},_getDimensionType:function(dimension){if(dimension.type==="col"){return"column";}else if(dimension.type==="col_choice"){return"columnChoice";}else{return dimension.type;}},_buildTableSeriesItem:function(data,name,dimensionType){return{name:name,data:data,__options:{labelText:name,dimensionType:dimensionType}};},_calculateAverage:function(dimensionalData,iterator){var average,formattedAverage,averagesData;averagesData=_.map(dimensionalData,function(dimension,i){average=iterator(dimension,i);formattedAverage=Globalize.format(average,"n2");return{absoluteY:formattedAverage};});return averagesData;}});SM.Models.register("QuestionDisplay",SM.Object.deepExtend(SM.Sortable,{ DISPLAY_VALUES:{show:'show',hide:'hide',percent:'percent',absolute:'absolute',labels:'labels',legend:'legend',wtd_avg:'weighted_avg',distribution:'distribution',pie:'pie',donut:'donut',hbar:'hbar',vbar:'vbar',area:'area',line:'line',boxplot:'boxplot',stacked:'stacked',stacked_hbar:'stacked_hbar',stacked_vbar:'stacked_vbar',none:'none',menu_matrix:'menu_matrix',matrix:'matrix',mirror:'mirror'},

DISPLAY_OPTIONS:{chart_type:'chart_type',colors:'colors',stacking:'stacking',scale_type:'scale_type',scale_max_absolute:'scale_max_absolute',scale_max_percentage:'scale_max_percentage',scale_max_stacked:'scale_max_stacked',scale_max_wtd_avg:'scale_max_wtd_avg',dp_absolute:'dp_absolute', dp_percentage:'dp_percentage', mirror:'mirror',matrix_display:'matrix_display',label_type:'label_type',labels:'labels',show_data:'show_data',show_chart:'show_chart',show_table:'show_table',show_empty_data:'show_empty_data',show_benchmark:'show_benchmark',sort_data:'sort_data'},

SHARED_DISPLAY_OPTIONS:["chart_type","stacking","scale_type","matrix_display","label_type","colors","show_data","show_chart","show_table","show_empty_data","dp_absolute","dp_percentage"],DEFAULT_CHART_TYPE:'hbar',DEFAULT_DISPLAY_OPTIONS:{shared:{chart_type:'hbar',stacking:'none',matrix_display:'distribution',scale_type:'percent',show_chart:'show',show_table:'show',show_data:'hide',show_empty_data:'show',dp_absolute:'0',dp_percentage:'2'},by_question_type:{"matrix.rating":{matrix_display:'weighted_avg'},"single_choice.vertical":{show_benchmark:'hide'}},by_depth_type:{single:{label_type:'labels'},matrix:{label_type:'legend'},menu_matrix:{label_type:'legend'}},by_compared:{"true":{mirror:'mirror'},"false":{mirror:'none'}}},METAKEY_TYPE_COMPARE:'compare:',UNTYPED_DISPLAY_OPTIONS:{show_chart:true,show_table:true,show_empty_data:true,colors:true,dp_absolute:true,dp_percentage:true,labels:true}, __create:function(options){var self=this;self.question=options.question;self.rollup=options.rollup;self.tempDisplay={};self.displayUpdates={};},
 _fetchMetadata:function(){var self=this,isCompareRollup=self.rollup.isCompare(),comparePrefix=this.METAKEY_TYPE_COMPARE,display=this.question.page.survey.anviews.defaultView.getDisplayData(this.question.ID),displayNew={}; _.each(display,function(value,key){var isCompareKey=SM.String.beginsWith(key,comparePrefix),compareKey;if(!isCompareKey){if(isCompareRollup){


 compareKey=comparePrefix+key;if(self.UNTYPED_DISPLAY_OPTIONS[key]&&display[compareKey]===undefined){displayNew[key]=display[key];}}else if(!isCompareRollup){ displayNew[key]=display[key];}}else{compareKey=key;if(isCompareRollup){ key=compareKey.substr(comparePrefix.length);displayNew[key]=display[compareKey];}}});return displayNew;},_updateMetadata:function(updates,options){var self=this,isCompared=self.rollup.isCompare();options=options||{};self.question.page.survey.anviews.defaultView.updateDisplayData(self.question.ID,updates,{isCompared:isCompared,untypedKeys:self.UNTYPED_DISPLAY_OPTIONS,done:options.done,fail:options.fail});},
 getDisplayData:function(){var self=this,question=self.question,questionType=question.family+"."+question.subtype,depthType=question.depthType(),isCompared=question.isCompared(),displayMetadata=self._fetchMetadata(), tableHasOneRow,hasScaleOptions,hasDepthOptions,display; display=SM.Object.extend(self.DEFAULT_DISPLAY_OPTIONS.shared,self.DEFAULT_DISPLAY_OPTIONS.by_question_type[questionType],self.DEFAULT_DISPLAY_OPTIONS.by_depth_type[depthType],self.DEFAULT_DISPLAY_OPTIONS.by_compared[isCompared.toString()],displayMetadata, self.tempDisplay
);
if(question.isMatrix()&&display.matrix_display===self.DISPLAY_VALUES.wtd_avg){var correctMirrorValue=self.question.isCompared()?self.DISPLAY_VALUES.mirror:self.DISPLAY_VALUES.none;if(display.mirror!==correctMirrorValue){self._updateMetadata({mirror:correctMirrorValue});display.mirror=correctMirrorValue;}} 
display.depth_type=depthType;display.show_chart=(display.show_chart===this.DISPLAY_VALUES.show);display.show_table=display.show_table===this.DISPLAY_VALUES.show;display.show_data=(display.show_data===this.DISPLAY_VALUES.show);display.show_empty_data=(display.show_empty_data===this.DISPLAY_VALUES.show);display.mirror=(display.mirror===this.DISPLAY_VALUES.mirror); display.show_benchmark=question.isBenchmarkable()&&(display.show_benchmark===this.DISPLAY_VALUES.show);if(self._shouldSetDefaultSortData(display)){self._setDefaultSortData(display);}
tableHasOneRow=self.tableHasOneRow(display);
 if(question.isMultiResponse()&&(self._isPieChart(display)||self._isDonutChart(display))){display.chart_type=self.DEFAULT_CHART_TYPE;}
if(self._isStacked(display)){display.stacking=self.DISPLAY_VALUES.stacked;if(self._isVerticalBarChart(display)){display.chart_type=self.DISPLAY_VALUES.stacked_vbar;}else if(self._isHorizontalBarChart(display)){display.chart_type=self.DISPLAY_VALUES.stacked_hbar;}}



if(display.depth_type!==question.QTYPE.single){
 if(tableHasOneRow&&(self._isAreaChart(display)||self._isLineChart(display))){display.chart_type=self.DEFAULT_CHART_TYPE;}
 
if(!tableHasOneRow&&(self._isPieChart(display)||self._isDonutChart(display))){display.chart_type=self.DEFAULT_CHART_TYPE;}}
if(self._scaleIsPercent(display)&&(self._isStacked(display)||self._isAreaChart(display))&&self._tableRowsAddToMoreThan100Percent(display)){display.scale_type=this.DISPLAY_VALUES.absolute;} 
if(self._isPieChart(display)||self._isDonutChart(display)){display.scale_type=this.DISPLAY_VALUES.percent;if(display.stacking===this.DISPLAY_VALUES.none){
if(!tableHasOneRow){display.matrix_display=this.DISPLAY_VALUES.wtd_avg;}}} 
if(question.QTYPE.open_ended===question.family&&question.QTYPE.numerical===question.subtype){display.scale_type=this.DISPLAY_VALUES.absolute;} 
if(display.depth_type===question.QTYPE.single){if(display.stacking===this.DISPLAY_VALUES.stacked){ display.label_type=this.DISPLAY_VALUES.legend;}else if(!self._isPieChart(display)&&!self._isDonutChart(display)){ display.label_type=this.DISPLAY_VALUES.labels;} 
display.mirror=false; display.matrix_display=this.DISPLAY_VALUES.distribution;}
if(this.DISPLAY_VALUES.wtd_avg===display.matrix_display){display.scale_type=this.DISPLAY_VALUES.absolute;display.stacking=this.DISPLAY_VALUES.none;}
 
if(question.isSimple()){if(!self.rollup.options){ display.hasShowEmptyOptions=true;}else{_.each(question.getContextStructure().answers.rows,function(row){if(!self.rollup.options[row.id]){display.hasShowEmptyOptions=true;}});}}else{
display.show_empty_data=true;display.hasShowEmptyOptions=false;} 
if(display.show_benchmark){display.chart_type='boxplot';display.isStacked=false;display.labelType=this.DISPLAY_VALUES.legend;} 
var isDonutChart=self._isDonutChart(display),isPieChart=self._isPieChart(display),isLineChart=self._isLineChart(display),isAreaChart=self._isAreaChart(display),isBoxplotChart=self._isBoxplotChart(display),isDistribution=display.matrix_display===this.DISPLAY_VALUES.distribution,isStacked=self._isStacked(display);hasDepthOptions=!(isDonutChart||isPieChart||isBoxplotChart);hasScaleOptions=(!(isDonutChart||isPieChart||isBoxplotChart)&&isDistribution);if((isStacked||isAreaChart)&&self._tableRowsAddToMoreThan100Percent(display)){hasScaleOptions=false;}
if(question.isMultipleChoice()&&(isStacked||isAreaChart)&&!display.mirror){hasDepthOptions=false;}
if(question.isMatrix()){if(isStacked){hasDepthOptions=false;}}
if(question.isMenuMatrix()){if(isStacked){hasDepthOptions=false;}} 
display.isLegend=display.label_type===this.DISPLAY_VALUES.legend;display.isDistribution=display.matrix_display===this.DISPLAY_VALUES.distribution;display.isWeightedAvg=display.matrix_display!==this.DISPLAY_VALUES.distribution;display.isPercent=self._scaleIsPercent(display);display.isStacked=isStacked;display.isDonutChart=isDonutChart;display.isLineChart=isLineChart;display.isPieChart=isPieChart;display.isAreaChart=isAreaChart;display.isBoxplotChart=isBoxplotChart;display.isLableable=isDonutChart||isPieChart;display.hasDepthOptions=hasDepthOptions;display.hasScaleOptions=hasScaleOptions;display.isMirrorable=this._isDisplayMirrorable(display);display.tableHasOneRow=tableHasOneRow;return display;},updateDisplayData:function(updates,options){var self=this,displayData=self.getDisplayData();options=options||{};if(_.isUndefined(options.notify)){options.notify=true;}
 
if(updates.mirror){updates.sort_data=self._setDefaultSortData(displayData);}
self._updateMetadata(updates,{done:options.done,fail:options.fail});if(options.notify){self._trigger({type:"displayChange"});}},getTempDisplay:function(){var self=this;return self.tempDisplay;},updateTempDisplay:function(updates){var self=this,displayData=self.getDisplayData();
 
if(updates.mirror){updates.sort_data=self._setDefaultSortData(displayData);}
SM.Object.deepUpdate(self.tempDisplay,updates);self._trigger({type:"tempDisplayChange"});},clearTempDisplay:function(options){var self=this;options=options||{};if(_.isUndefined(options.notify)){options.notify=true;}
self.tempDisplay={};if(options.notify){self._trigger({type:"tempDisplayChange"});}},getDisplayUpdates:function(){var self=this;return self.displayUpdates;},setDisplayUpdates:function(updates){var self=this,displayUpdates=self.getDisplayUpdates();SM.Object.deepUpdate(displayUpdates,updates);},clearDisplayUpdates:function(){var self=this;self.displayUpdates={};}, getSharedDisplayUpdates:function(){var self=this,display=self.getDisplayData(),displayUpdates=self.getDisplayUpdates(),chartTypeUpdates,sharedUpdates;

sharedUpdates={chart_type:display.chart_type,colors:display.colors,show_chart:display.show_chart?self.DISPLAY_VALUES.show:self.DISPLAY_VALUES.hide,show_data:display.show_data?self.DISPLAY_VALUES.show:self.DISPLAY_VALUES.hide,scale_type:display.scale_type,dp_absolute:display.dp_absolute,dp_percentage:display.dp_percentage,stacking:display.stacking,show_empty_data:display.show_empty_data?self.DISPLAY_VALUES.show:self.DISPLAY_VALUES.hide,label_type:display.label_type,matrix_display:display.matrix_display}; if(displayUpdates.chart_type){chartTypeUpdates=self.getChartTypeUpdates(display.chart_type);}

sharedUpdates=SM.Object.extend(sharedUpdates,displayUpdates,chartTypeUpdates);_.each(sharedUpdates,function(value,key){if(!_.contains(self.SHARED_DISPLAY_OPTIONS,key)){delete sharedUpdates[key];}});
 sharedUpdates.show_chart=display.show_chart?self.DISPLAY_VALUES.show:self.DISPLAY_VALUES.hide;return sharedUpdates;}, getChartType:function(){var self=this,display=self.getDisplayData(),chartType;chartType=display[self.DISPLAY_OPTIONS.chart_type]||self.DEFAULT_CHART_TYPE;return chartType;},

getChartTypeUpdates:function(chartType){var self=this,displayUpdates={},stacking;if(chartType===self.DISPLAY_VALUES.stacked_hbar||chartType===self.DISPLAY_VALUES.stacked_vbar){stacking=self.DISPLAY_VALUES.matrix;}else{stacking=self.DISPLAY_VALUES.none;}
displayUpdates[self.DISPLAY_OPTIONS.chart_type]=chartType;displayUpdates[self.DISPLAY_OPTIONS.stacking]=stacking;displayUpdates[self.DISPLAY_OPTIONS.show_chart]=self.DISPLAY_VALUES.show;return displayUpdates;},setBenchmarkDisplay:function(on){var self=this,updates={show_benchmark:on?self.DISPLAY_VALUES.show:self.DISPLAY_VALUES.hide}; self.updateTempDisplay(updates);self.setDisplayUpdates(updates);
}, getScaleMaxOptionKey:function(){var self=this,displayData=self.getDisplayData(),key;
var isReallyStacked=displayData.isStacked||(displayData.isAreaChart&&!self.question.isSimple()&&!displayData.isWeightedAvg);if(displayData.isPercent){key=self.DISPLAY_OPTIONS.scale_max_percentage;}else{if(isReallyStacked){key=self.DISPLAY_OPTIONS.scale_max_stacked;}else if(displayData.isWeightedAvg){key=self.DISPLAY_OPTIONS.scale_max_wtd_avg;}else{key=self.DISPLAY_OPTIONS.scale_max_absolute;}}
if(displayData.mirror){key=key+":"+self.DISPLAY_OPTIONS.mirror;}
return key;},getScaleMax:function(rangeData){var self=this,displayData=self.getDisplayData(),customScaleMaxOptionKey,customScaleMax;customScaleMaxOptionKey=self.getScaleMaxOptionKey();customScaleMax=displayData[customScaleMaxOptionKey];
if(rangeData){if(customScaleMax<rangeData.min||customScaleMax>rangeData.max){customScaleMax=null;}}
return customScaleMax;},




buildLabelUpdates:function(options){var self=this,currentLabelData=self.getDisplayData().labels,displayUpdates,labelType=options.labelType,answerID=options.answerID,labelText=options.labelText;


displayUpdates={labels:currentLabelData||{}}; if(_.isEmpty(displayUpdates.labels[labelType])){displayUpdates.labels[labelType]={};}

if(labelType==="questionHeading"){displayUpdates.labels[labelType].text=labelText;}else{displayUpdates.labels[labelType][answerID]={text:labelText};}
return displayUpdates;},labelUpdatesHaveEmptyLabel:function(){var self=this,labelUpdates=self.getTempDisplay().labels,updatedHaveEmptyLabels=false;if(labelUpdates){if(labelUpdates["questionHeading"]){if(labelUpdates["questionHeading"].text===""){updatedHaveEmptyLabels=true;}}
_.each(["rows","columns","columnChoices","crossedOptions","others"],function(labelType){_.each(labelUpdates[labelType],function(labelData,answerID){if(labelData.text===""){updatedHaveEmptyLabels=true;}});});}
return updatedHaveEmptyLabels;},getQuestionHeadingLabel:function(){return this.getLabel("questionHeading");},getLabel:function(labelType,optionID){var self=this,displayData=self.getDisplayData(),label;if(_.isEmpty(displayData.labels)||_.isEmpty(displayData.labels[labelType])){return;}
if(labelType==="questionHeading"){label=displayData.labels[labelType];}else{label=displayData.labels[labelType][optionID];}
return label;}, _isDisplayMirrorable:function(display){if(display.isDonutChart||display.isPieChart||display.isBoxplotChart){return false;}else if(display.isWeightedAvg&&(display.depth_type===this.DISPLAY_VALUES.matrix||display.depth_type===this.DISPLAY_VALUES.menu_matrix)){return false;}
return true;},tableHasOneRow:function(display){var self=this,question=self.rollup.question,answers=question.getContextStructure().answers,rows=answers.rows,columns=answers.cols,tableHasOneRow=false;if(question.isMatrix()){if(question.isMenuMatrix()){if(display.mirror){tableHasOneRow=true;_.each(columns,function(c){if(c.items.length!==1){tableHasOneRow=false;}});}else{tableHasOneRow=rows.length===1;}}else{tableHasOneRow=(display.mirror&&columns.length===1)||(!display.mirror&&rows.length===1);}}
return tableHasOneRow;},


_tableRowsAddToMoreThan100Percent:function(display){var self=this,question=self.question,crossedQuestion=question.getCrossedQuestion(),isCompared=!!crossedQuestion;if(display.mirror){if(question.family===question.QTYPE.multiple_choice){return true;}}else{if(isCompared){if(crossedQuestion.isMultiResponse()){return true;}}else{if(question.isMultipleChoice()){return true;}}}
return false;},_scaleIsAbsolute:function(display){return display.scale_type===this.DISPLAY_VALUES.absolute;},_scaleIsPercent:function(display){return display.scale_type===this.DISPLAY_VALUES.percent;},_isStacked:function(display){return display.stacking!==this.DISPLAY_VALUES.none;},_isVerticalBarChart:function(display){return display.chart_type===this.DISPLAY_VALUES.vbar;},_isHorizontalBarChart:function(display){return display.chart_type===this.DISPLAY_VALUES.hbar;},_isAreaChart:function(display){return display.chart_type===this.DISPLAY_VALUES.area;},_isLineChart:function(display){return display.chart_type===this.DISPLAY_VALUES.line;},_isPieChart:function(display){return display.chart_type===this.DISPLAY_VALUES.pie;},_isDonutChart:function(display){return display.chart_type===this.DISPLAY_VALUES.donut;},_isBoxplotChart:function(display){return display.chart_type===this.DISPLAY_VALUES.boxplot;}, sort:function(dimensionType,dimensionID,sortOrder,scopedDimensionType,scopedDimensionID){var self=this,currentSortData=self.getDisplayData().sort_data,updates={},sortDataUpdates,dimensionUpdates;dimensionUpdates={dimensionType:dimensionType,dimensionID:dimensionID,order:sortOrder};if(scopedDimensionType){sortDataUpdates=SM.Object.deepCopy(currentSortData);sortDataUpdates[scopedDimensionID]=dimensionUpdates;}else{sortDataUpdates=dimensionUpdates;}
updates[this.DISPLAY_OPTIONS.sort_data]=sortDataUpdates;self.updateDisplayData(updates);}, _updateDisplaySortData:function(sortData){var self=this,updates={};updates[self.DISPLAY_OPTIONS.sort_data]=sortData;self.updateDisplayData(updates);},

_shouldSetDefaultSortData:function(display){var self=this,sortData=display.sort_data,question=self.question,isCompared=question.isCompared(),isMirrored=!!display.mirror,shouldSetDefaultSortData;shouldSetDefaultSortData=_.isEmpty(sortData)||self._sortDataAppliesToDifferentQuestion(question,sortData,isCompared,isMirrored);return shouldSetDefaultSortData;},


_sortDataAppliesToDifferentQuestion:function(question,sortData,isCompared,isMirrored){var self=this,summaryType=question.summaryType(),answers=question.getContextStructure().answers,crossedOptions=answers.crossedOptions,crossedOptionIDs,scopedSortData,dimensionID,isForDifferentQuestion=false;if(isCompared&&!isMirrored){crossedOptionIDs=_.map(crossedOptions,function(crossedOption){return crossedOption.id;});if(summaryType==="menu_matrix"){scopedSortData=_.values(sortData);_.each(scopedSortData,function(data){dimensionID=data.dimensionID;if(dimensionID&&!_.contains(crossedOptionIDs,dimensionID)){isForDifferentQuestion=true;}});}else{dimensionID=sortData.dimensionID;if(dimensionID&&!_.contains(crossedOptionIDs,dimensionID)){isForDifferentQuestion=true;}}}
return isForDifferentQuestion;},
_setDefaultSortData:function(display){var self=this,sortData=display.sort_data||{},question=self.question,summaryType=question.summaryType(),isCompared=question.isCompared(),rows=question.structure.answers.rows,columns=question.structure.answers.cols;if(summaryType==="menu_matrix"){if(isCompared){_.each(rows,function(row){sortData[row.id]={order:self.SORTING_ORDERS.UNSORTED,dimensionType:null,dimensionID:null};});}else{_.each(columns,function(column){sortData[column.id]={order:self.SORTING_ORDERS.UNSORTED,dimensionType:null,dimensionID:null};});}}else{sortData={order:self.SORTING_ORDERS.UNSORTED,dimensionType:null,dimensionID:null};}
display.sort_data=sortData;return sortData;}, isBenchmarkShown:function(){var self=this,displayData=self.getDisplayData();return displayData[self.DISPLAY_OPTIONS.show_benchmark];}}));SM.Models.register("QuestionRollup",SM.Object.deepExtend(SM.Sortable,{ METAKEY_TYPE_COMPARE:'compare:', __create:function(options){var self=this;this.isLoaded=options.isLoaded;this.question=options.question;this.questionID=this.question.ID;self.display=SM.Models.create("QuestionDisplay",{rollup:self,question:self.question});this.summary={answered_subtotals:{},options:{}};this.answered="";this.skipped="";this.type='null_rollup';this.taModelMap={};this.nestedQuestionDict={};},

load:function(rollup){var compareRule=this.question.page.survey.anviews.currentView.compareRule,summary=rollup.summary,taMap=summary.ta_data,crossedQuestion,structure;
 if(rollup.type==='compare'&&this.question.isComparable()){crossedQuestion=this.question.page.survey.getQuestion(compareRule.get("questionID"));rollup=this._mungeCompareData(rollup,compareRule,crossedQuestion);if(summary.type==="menu_matrix"){rollup=this._mungeCompareMenuMatrixRollup(rollup);if(compareRule.ruleType==="random_assignment"){structure=this.question.mungeCompareMenuMatrixRA(rollup,crossedQuestion);}else{structure=this.question.mungeCompareMenuMatrix(rollup,crossedQuestion);}}else{rollup=this._mungeCompareMatrixRollup(rollup);if(compareRule.ruleType==="random_assignment"){structure=this.question.mungeCompareMatrixRA(rollup,crossedQuestion);}else{structure=this.question.mungeCompareMatrix(rollup,crossedQuestion);}}}

this.question.setCompareStructure(structure);this.summary=rollup;this.answeredCount=rollup.answered;this.answered=Globalize.format(rollup.answered,"n0");this.answered_subtotals=rollup.summary.answered_subtotals;this.skipped=Globalize.format(rollup.skipped,"n0");this.type=rollup.type;this.otherOption=rollup.other_option;this.options=summary.options;if(summary.type==="matrix"||this.type==="matrix"){this.options.col_totals=this._buildColumnTotals();} 
if(this.question.commentField&&!this.question.commentField.is_answer){if(rollup.other_option){this.options[this.question.commentField.id]={count:rollup.other_option};}else if(summary.type==="matrix"&&this.options.other_option){this.options[this.question.commentField.id]={count:this.options.other_option.row_total};}else if(summary.type==="menu_matrix"){var otherOption=this.options.other_option;if(otherOption&&otherOption.options&&otherOption.options.other_option){this.options[this.question.commentField.id]=otherOption.options.other_option;}}}
if(taMap){this._loadTaModels(taMap);}
this._trigger({type:"loaded"});},updatePresentationRollup:function(summary,variable_id){var summaryRollup=summary[variable_id];if(summaryRollup){this.answered=summaryRollup.count;}else{this.answered=0;}},isSimple:function(){return"simple"===this.type;},isCompare:function(){return"compare"===this.type;}, getRowData:function(rowId){var rowData=this._getRowData(rowId);if(!rowData){rowData={count:0,row_max:0,row_total:0};}
return rowData;},getColData:function(rowId,colId){var colOptions=this._getColData(rowId,colId);if(!colOptions){colOptions={count:0};}
return colOptions;},getChoiceData:function(rowId,colId,choiceId){var colOptions=this._getColData(rowId,colId);if(colOptions){colOptions=colOptions.options[choiceId];}
if(!colOptions){colOptions={count:0};}
return colOptions;}, getTaModel:function(optionID,crossTabOptionID,variationID){var modelID=this._makeTaModelID(optionID,crossTabOptionID,variationID);return this.taModelMap[modelID];},createTaModel:function(optionID,crossTabOptionID,matrixCrossTab,variationID){var modelID=this._makeTaModelID(optionID,crossTabOptionID,variationID),taModel;if(this.taModelMap[modelID]){return this.taModelMap[modelID];}
taModel=SM.Models.create("TextAnalysis",{ID:modelID,matrixCrossTab:matrixCrossTab});if(variationID){taModel.variationID=variationID;}
taModel.rollup=this;this.taModelMap[modelID]=taModel;return taModel;},hasTaModels:function(){return!$.isEmptyObject(this.taModelMap);}, getDisplayMode:function(){var question=this.question,compareRule=question.page.survey.anviews.currentView.compareRule,compareRuleOn=compareRule&&compareRule.get("selected")&&!compareRule.get("isCorrupt");if(this.type==="compare"){return"compare";}
if(compareRuleOn){if(this.type==="null_rollup"||question.isMenuMatrix()){return"compare";}}
return"standard";}, getSortedSummary:function(){var self=this,display=self.display.getDisplayData(),isMirrored,shouldHideEmptyData,sortedSummary;isMirrored=display.mirror;shouldHideEmptyData=!display.show_empty_data;sortedSummary=new SM.SortedSummary({question:self.question,labels:display.labels,isMirrored:isMirrored,shouldHideEmptyData:shouldHideEmptyData});return sortedSummary.summary;}, _buildColumnTotals:function(){var question=this.question,structure=question.getContextStructure(),answerCounts=this.options,colStructs=structure.answers.cols,rowStructs=structure.answers.rows,colTotals=[];$.each(colStructs,function(i,col){colTotals.push(0);$.each(rowStructs,function(j,row){var rowId=row.id,colId=col.id;if(answerCounts[rowId]&&answerCounts[rowId].options&&answerCounts[rowId].options[colId]){colTotals[i]+=answerCounts[rowId].options[colId].count;}});});return colTotals;},_makeTaModelID:function(optionID,crossTabOptionID,variationID){var modelID;if(!optionID){optionID=0;}
if(!crossTabOptionID){crossTabOptionID=0;}
if(!variationID){variationID=0;}
modelID=['qid',this.questionID,'oid',optionID,'xid',crossTabOptionID,'vid',variationID].join('_');return modelID;},_loadTaModels:function(taMap){var rollup=this,taModelMap={},taModel;this.taModelMap=taModelMap;$.each(taMap,function(taID,taData){taModel=SM.Models.create("TextAnalysis",{ID:taID});taModel.rollup=rollup;taModelMap[taID]=taModel;taModel.load(taData);});},_getRowData:function(rowId){return this.options[rowId];},_getColData:function(rowId,colId){var rowOptions=this._getRowData(rowId);if(rowOptions){rowOptions=rowOptions.options[colId];}
return rowOptions;},_mungeCompareData:function(rollup,compareRule,crossedQuestion){var i=0,row,answered=rollup.answered;if(compareRule.ruleType==="random_assignment"){rollup.crossed_rows=this._getRACrossedList(compareRule,crossedQuestion,"rows");}else{rollup.crossed_rows=this._getCrossedList(compareRule,crossedQuestion,"rows");}
if(compareRule.ruleType==="random_assignment"){if(crossedQuestion.family==="matrix"){rollup.crossed_cols=this._getRACrossedList(compareRule,crossedQuestion,"cols");}}else{if(crossedQuestion.family==="matrix"){rollup.crossed_cols=this._getCrossedList(compareRule,crossedQuestion,"cols");}}
rollup.type="compare";rollup.crossed_question_id=crossedQuestion.ID;if(!answered){answered={this_question:0,compare_options_total:{}};if(rollup.crossed_cols&&rollup.crossed_cols.length>0){row=rollup.crossed_rows[0];answered.compare_options_total[row]={};for(;i<rollup.crossed_cols.length;i++){answered.compare_options_total[row][rollup.crossed_cols[i]]=0;}
rollup.answered=answered;rollup.summary.answered_subtotals=rollup.answered.compare_options_total[row];}else{for(;i<rollup.crossed_rows.length;i++){answered.compare_options_total[rollup.crossed_rows[i]]=0;}
rollup.answered=answered;rollup.summary.answered_subtotals=rollup.answered.compare_options_total;}}else{if(rollup.crossed_cols&&rollup.crossed_cols.length>0){row=rollup.crossed_rows[0];rollup.summary.answered_subtotals=rollup.answered.compare_options_total[row];}else{rollup.summary.answered_subtotals=rollup.answered.compare_options_total;}}
rollup.answered=rollup.answered.this_question;rollup.summary.type=this.question.getCompareType();return rollup;},_getCrossedList:function(compareRule,crossedQuestion,dimension){var allOptions=dimension==="rows"?crossedQuestion.rowList:crossedQuestion.colList,crossedOptions;if(crossedQuestion.family==="matrix"){crossedOptions=compareRule.choiceSetList[0][dimension];}else{crossedOptions=compareRule.choiceSet.get("rows");}
return $.map(allOptions,function(option){if(option.id in crossedOptions){return option.id;}});},_getRACrossedList:function(compareRule,crossedQuestion,dimension){var allOptions=crossedQuestion.randomAssignmentList,crossedOptions;if(crossedQuestion.family==="matrix"){if(dimension==="rows"){crossedOptions=compareRule.get("rows");}else{return $.map(allOptions,function(option){return option.id;});}}else{crossedOptions=compareRule.get("rows");}
return $.map(allOptions,function(option){if(option.variable_id in crossedOptions){return option.variable_id;}});},_mungeCompareMenuMatrixRollup:function(rollup){var comment,summary=rollup.summary,outerOptions=summary.options,outerOption,outerOptionID,mmOptions,mmOption,mmOptionID,mmRowOptionID,otherOption,COMMENT_FIELD="-2";for(outerOptionID in outerOptions){outerOption=outerOptions[outerOptionID];if(outerOptionID===COMMENT_FIELD){comment=outerOption;}else{outerOption.compare_options_total=outerOption.row_total.compare_options_total;if(outerOption.compare_options_total===undefined){outerOption.compare_options_total=-1;}
outerOption.row_total=outerOption.row_total.current_row;}
mmOptions=outerOption.options;for(mmOptionID in mmOptions){mmOption=mmOptions[mmOptionID];if(outerOptionID!==COMMENT_FIELD){mmOption.row_total=mmOption.row_total.current_row;mmOption.options=mmOption.compare;if(rollup.crossed_cols&&rollup.crossed_cols.length){for(mmRowOptionID in mmOption.options){}
mmOption.options=mmOption.options[mmRowOptionID];}
delete mmOption.compare;}}}
if(comment){outerOptions.other_option=comment;delete outerOptions[COMMENT_FIELD];if(comment.options[COMMENT_FIELD]!==undefined){comment.other_option=comment.options[COMMENT_FIELD];delete comment.options[COMMENT_FIELD];otherOption=comment.other_option;if(otherOption.row_total!==undefined&&otherOption.row_total.current_row!==undefined){otherOption.row_total=otherOption.row_total.current_row;otherOption.options=otherOption.compare;delete otherOption.compare;comment.options.other_option=otherOption;delete comment.other_option;}}}
return rollup;},_mungeCompareMatrixRollup:function(rollup){var comment,summary=rollup.summary,hasCrossedCols=rollup.crossed_cols!==undefined,outerOptions=summary.options,outerOptionID,outerOption,innerOptionID,rowOptionID,COMMENT_FIELD="-2";for(outerOptionID in outerOptions){outerOption=outerOptions[outerOptionID];if(outerOption.options){comment=outerOption.options[COMMENT_FIELD];}else{outerOption.row_total=outerOption.row_total.current_row;outerOption.options=outerOption.compare;if(rollup.crossed_cols&&rollup.crossed_cols.length){for(innerOptionID in outerOption.options){}
outerOption.options=outerOption.options[innerOptionID];}
delete outerOption.compare;}}
if(comment&&comment.row_total!==undefined&&comment.row_total.current_row!==undefined){comment.row_total=comment.row_total.current_row;comment.options=comment.compare;delete comment.compare;outerOptions.other_option=comment;delete outerOptions[COMMENT_FIELD];}
return rollup;}}));SM.Models.register("QuestionRollupList",{__create:function(){ this.pages={}; this.questions={};this.lastRollupsRequest=null;this.lastFetchFilteredStamp=-1;this.isLoading=false;this.failedLoad=false;this.failedLoadRequestID=null;this.isUpdating=false;}, loadSurvey:function(survey){var anviews=survey.anviews;this.survey=survey;anviews.on("selectedViewLoaded",{self:this},this._onSelectedViewLoaded);anviews.on("selectedViewChanged",{self:this},this._onSelectedViewChanged);anviews.on("selectedViewFailed",{self:this},this._onSelectedViewFailed);anviews.currentView.on("failedLoadRequestID.set",{self:this},this._onSelectedViewFailed);anviews.currentView.on("lastSwitchRequest.changed",{self:this},this._onSwitchRequestChanged);anviews.currentView.on("ruleDeleted",{self:this},this._onRuleDeleted);anviews.currentView.on("ruleAdded",{self:this},this._onRuleAdded);anviews.currentView.on("ruleEdited",{self:this},this._onRuleEdited);this.createRollupModels();},createRollupModels:function(){var self=this;_.each(self.survey.questions,function(questionModel,questionID){var pageID=questionModel.page.ID,rollupModel;if(!self.pages[pageID]){self.pages[pageID]={};}
rollupModel=SM.Models.create("QuestionRollup",{question:questionModel});self.pages[pageID][questionID]=rollupModel;self.questions[questionID]=rollupModel;});},clear:function(){this.pages={};this.questions={};this.createRollupModels();},loadRollups:function(rollups){var self=this,questionRollup;if(rollups){_.each(rollups,function(rollup,questionID){questionRollup=self.questions[questionID];if(questionRollup){if(questionRollup.question.hasRandomAssignment()){self._loadRandomAssignmentRollups(questionRollup,rollup);}else{questionRollup.load(rollup);}}});}},_loadRandomAssignmentRollups:function(question,rollups){var randomAssignmentVars=question.question.randomAssignmentList,subDict=question.nestedQuestionDict,isPresentation=question.question.family==="presentation",questionRollupModel,rollup,questionCopy,randomAssignmentOption;_.each(randomAssignmentVars,function(randomAssignmentOption){rollup=rollups[randomAssignmentOption.variable_id];if(!!rollup){question.load(rollup);if(isPresentation){question.updatePresentationRollup(rollup.summary,randomAssignmentOption.variable_id);}
questionCopy=_.clone(question);subDict[randomAssignmentOption.variable_id]=questionCopy;}else if(typeof(rollups.answered)!==undefined&&rollups.answered instanceof Object){rollup=rollups;question.load(rollup);if(isPresentation){question.updatePresentationRollup(rollup.summary,randomAssignmentOption.variable_id);}
questionCopy=_.clone(question);subDict[randomAssignmentOption.variable_id]=questionCopy;}});},onSharedDisplayDataChange:function(){var self=this,rollups=_.values(self.questions),timeoutLength=200;self.set("isUpdating",true,{notify:true});self._clearTempDisplays();_.each(rollups,function(rollup,i){setTimeout(function(){rollup.display._trigger({type:"allDisplaysChange"});if(i===rollups.length-1){self.set("isUpdating",false,{notify:true});}},timeoutLength*i);});},_clearTempDisplays:function(){var self=this,rollups=self.questions;_.each(rollups,function(rollup,questionID){rollup.display.clearTempDisplay({notify:false});});},isBuffered:function(){var isBuffered=true,survey=this.survey,buffer=survey.config.question_buffer_page_load_size,shownList=survey.shownQuestionList,pageIndex=survey.state.get("page");if(pageIndex!=='all'){shownList=this.survey.pageList[pageIndex].shownQuestionList;}
$.each(shownList,function(i,question){if(!question.hasRollupLoaded()&&i<buffer){isBuffered=false;return false;}else if(i>=buffer){return false;}});return isBuffered;},hasAll:function(){var survey=this.survey,hasAll=true,shownList=survey.shownQuestionList,pageIndex=survey.state.get("page");if(pageIndex!=='all'){shownList=survey.pageList[pageIndex].shownQuestionList;}
$.each(shownList,function(i,question){if(!question.hasRollupLoaded()){hasAll=false;return false;}});return hasAll;},isAfterLastLoadedPage:function(page){var lastQuestion=this._getLastLoadedQuestion(),lastPage; if(!lastQuestion){return false;}
lastPage=lastQuestion.page;return page.position>lastPage.position;},isAfterLastLoadedQuestion:function(question){var lastQuestion=this._getLastLoadedQuestion(); if(!lastQuestion){return false;}
return question.position>lastQuestion.position;},_getLastLoadedQuestion:function(){var survey=this.survey,unloadedQuestion,shownList=survey.shownQuestionList,pageIndex=survey.state.get("page");if(pageIndex!=='all'){shownList=survey.pageList[pageIndex].shownQuestionList;}
$.each(shownList,function(i,question){if(!question.hasRollupLoaded()){unloadedQuestion=question;return false;}});return unloadedQuestion;},fetchMoreRollups:function(){var self=this,pageIndex=this.survey.state.get("page"),requestContext={self:this},startIndex=this._getNextUnloadedQuestionIndex(pageIndex);if(startIndex>=0){$.when(requestContext,this.lastRollupsRequest).always(function(){self._makeFetchMoreRequest(requestContext);});}},fetchFiltered:function(){var self=this,requestContext={self:this,timestamp:SM.Date.timestamp()};this.set("lastFetchFilteredStamp",requestContext.timestamp);$.when(requestContext,this.lastRollupsRequest).always(function(){self._makeFetchFilteredRequest(requestContext);});},_makeFetchMoreRequest:function(context){var self=context.self,params,pageIndex=self.survey.state.get("page"),startIndex=self._getNextUnloadedQuestionIndex(pageIndex),request;context.timestamp=SM.Date.timestamp();params={view_data:self.survey.anviews.currentView.dump(),questions:self._getQuestionIDBuffer(pageIndex,startIndex)};if(params.questions.length===0){return;}
request=SM.Ajax.fetchRollups(params);$.when(context,request).done(self._onFetchedMoreRollups).fail(function(data){self._onFetchMoreRollupsFailed(context,data);});},_getQuestionIDBuffer:function(pageIndex,startIndex,ignoreLoaded){var shownList=this.survey.shownQuestionList,bufferSize=this.survey.config.question_buffer_fetch_size,buffer=[];if(pageIndex!=='all'){shownList=this.survey.pageList[pageIndex].shownQuestionList;}
shownList=shownList.slice(startIndex);$.each(shownList,function(i,questionModel){if(!questionModel.hasRollupLoaded()||ignoreLoaded){buffer.push(questionModel.ID);}else{return false;}
if(buffer.length===bufferSize){return false;}});return buffer;},_getNextUnloadedQuestionIndex:function(pageIndex){var shownList=this.survey.shownQuestionList,index=-1;if(pageIndex!=='all'){shownList=this.survey.pageList[pageIndex].shownQuestionList;}
$.each(shownList,function(i,question){if(!question.hasRollupLoaded()){index=i;return false;}});return index;},_makeFetchFilteredRequest:function(context){var self=context.self,pageIndex,params;if(context.timestamp===self.get("lastFetchFilteredStamp")){pageIndex=self.survey.state.get("page");params={view_data:self.survey.anviews.currentView.dump(),questions:self._getQuestionIDBuffer(pageIndex,0,true)};if(params.questions.length===0){

return;}
self.set("failedLoad",false);self.set("failedLoadRequestID",null);self.set("isLoading",true,{notify:true});self.lastRollupsRequest=SM.Ajax.fetchRollups(params);self.clear();$.when(context,self.lastRollupsRequest).done(self._onFetchFiltered).fail(function(data,errorMgs,jqXHR){self._onFetchFilteredFail(context,data);});}},_triggerRollupsLoaded:function(rollups){var lastLoadedPosition=-1,question,self=this;$.each(rollups,function(questionID,rollup){question=self.survey.getQuestion(questionID);if(question.position>lastLoadedPosition){lastLoadedPosition=question.position;}
question._trigger({type:"rollupLoaded"});});self.survey._trigger({type:'rollupsAppended',lastLoadedPosition:lastLoadedPosition});},_onFetchedMoreRollups:function(context,doneArgs){var data=doneArgs[0],textStatus=doneArgs[1],jqXHR=doneArgs[2],self=context.self;if(context.timestamp>self.get("lastFetchFilteredStamp")){self.survey.set("respondentCounts",data.respondent_counts,{notify:true});self.loadRollups(data.question_rollups);self._triggerRollupsLoaded(data.question_rollups);}},_onFetchMoreRollupsFailed:function(context,errorData){var requestID=errorData&&errorData.request_id;if(context.timestamp>this.get("lastFetchFilteredStamp")){this.survey._trigger({type:'fetchRollupsFailed'});}},_onFetchFiltered:function(context,doneArgs){var data=doneArgs[0],textStatus=doneArgs[1],jqXHR=doneArgs[2],self=context.self;if(context.timestamp===self.get("lastFetchFilteredStamp")){self.survey.set('respondentCounts',data.respondent_counts,{notify:true});self.loadRollups(data.question_rollups); self.survey.anviews.currentView.save();self.set("isLoading",false,{notify:true});}},_onFetchFilteredFail:function(context,errorData){var requestID=errorData&&errorData.request_id;if(context.timestamp===this.get("lastFetchFilteredStamp")){this.set("failedLoad",true);this.set("failedLoadRequestID",requestID);this.set("isLoading",false,{notify:true});this.survey.anviews.currentView.invalidateNewRules();}},_onSelectedViewChanged:function(e){var self=e.data.self,timestamp=self.survey.anviews.currentView.get("lastSwitchStamp");self.set("lastFetchFilteredStamp",timestamp);self.set("failedLoad",false);self.set("failedLoadRequestID",null);self.set("isLoading",true,{notify:true});self.clear();},_onSelectedViewLoaded:function(e){var self=e.data.self,respondentCountData=e.respondentData.respondent_counts,rollupData=e.respondentData.question_rollups;if(self.survey.anviews.currentView.get("lastSwitchStamp")===self.get("lastFetchFilteredStamp")){self.survey.set('respondentCounts',respondentCountData,{notify:true});self.loadRollups(rollupData);self.set("isLoading",false,{notify:true});}},_onSelectedViewFailed:function(e){var self=e.data.self;if(self.survey.anviews.currentView.get("lastSwitchStamp")===self.get("lastFetchFilteredStamp")){self.set("failedLoad",true);self.set("failedLoadRequestID",self.survey.anviews.currentView.get("failedLoadRequestID"));self.set("isLoading",false,{notify:true});}},_onSwitchRequestChanged:function(e){var self=e.data.self;self.lastRollupsRequest=e.value;},_onRuleDeleted:function(e){var ruleModel=e.ruleModel,self=e.data.self;if(ruleModel.get("selected")&&!e.ruleModel.isShow){self.fetchFiltered();}}, _onRuleEdited:function(e){var self=e.data.self;if(!e.ruleModel.isShow){self.fetchFiltered();}},_onRuleAdded:function(e){var self=e.data.self;if(!e.ruleModel.isShow&&e.ruleModel.get("selected")){self.fetchFiltered();}}});SM.Models.register("AppliedCategoriesSelection",{__create:function(options){this._state={};this.responseID=options.responseID;},load:function(categories){this.categories=categories;},reset:function(){this._state={};},update:function(categoryID,state){this._state[categoryID]=state;this._trigger({type:"selection.changed",isDirty:this.isDirty()});},dump:function(){var state={},currentState=this._state,responseID=this.responseID,uncategorizedID=this.categories.UNCATEGORIZED_ID,categoryMap=this.categories.map;$.each(categoryMap,function(categoryID,categoryModel){var saved,current;if(categoryID!==uncategorizedID){saved=categoryModel.getApplicationState(responseID);current=currentState[categoryID];if(current&&saved!==current){state[categoryID]=current;}else{state[categoryID]=saved;}}});return state;},isDirty:function(){var state=this._state,responseID=this.responseID,categoryMap=this.categories.map,isDirty=false;$.each(state,function(categoryID,state){var savedState=categoryMap[categoryID].getApplicationState(responseID);if(savedState!==state){isDirty=true;return false;}});return isDirty;}});SM.Models.register("FilterCategoriesSelection",{__create:function(){this.reset();},loadSelection:function(){var categoryMap=this.categories.map,state,list;this.reset();state=this._state;list=this._list;$.each(categoryMap,function(categoryID,category){if(category.isFiltering()){state[categoryID]=true;list.push(categoryID);}else{state[categoryID]=false;}});},reset:function(){this._state={};this._list=[];},isEmpty:function(){return this._list.length===0;},update:function(categoryID,state){this._state[categoryID]=state;if(state){SM.Array.addUnique(this._list,categoryID);}else{SM.Array.removeItem(this._list,categoryID);}
this._trigger({type:"selection.changed",isDirty:this.isDirty()});},clear:function(){var self=this;$.each(this.categories.map,function(categoryID){self._state[categoryID]=false;});this._list=[];this._trigger({type:"selection.changed",isDirty:this.isDirty()});},isDirty:function(){var state=this._state,categoryMap=this.categories.map,isDirty=false;$.each(state,function(categoryID,state){var savedState=categoryMap[categoryID].isFiltering();if(savedState!==state){isDirty=true;return false;}});return isDirty;},apply:function(){this.categories.taModel.filterCategories(this._list);}});SM.Models.register("TextPhrase",{MAX_CATNAME_LEN:25,ID_PREFIX:"phrase-",__create:function(options){this.ID=this.ID_PREFIX+this.__uid;},__getters:{localizedPercent:function(self){var filterCount=self.phrases.taModel.filterCount;return Globalize.formatPercent(self.responseCount/filterCount,2);},percent:function(self){var filterCount=self.phrases.taModel.filterCount;return SM.Math.toPercentString(self.responseCount/filterCount,2);},fontSize:function(self){var phrases=self.phrases,lowestSize=12,maxIncrease=32,wtdAvg;wtdAvg=(self.dscore-phrases.lowScore)/(phrases.highScore-phrases.lowScore);return lowestSize+(maxIncrease*wtdAvg);}},load:function(phrase){this.text=phrase.phrase;this.responseCount=phrase.count;this.score=phrase.score;this.dscore=phrase.dscore;},hasManyResponses:function(){return this.responseCount>1;}});SM.Models.register("TextPhraseList",{LINGO_MAX_COUNT:5000,viewModes:{CLOUD:"cloud",LIST:"list"},__create:function(options){this.ID=options.ID;this.list=[];this.sortedList=[];this.map={};this.viewMode=this.viewModes.CLOUD;},load:function(phrasesList){var self=this,lowScore=100,highScore=0;this.viewMode=this.viewModes.CLOUD;$.each(phrasesList,function(i,phrase){var phraseModel=SM.Models.create("TextPhrase");phraseModel.phrases=self;phraseModel.load(phrase);phraseModel.set("rank",i+1);lowScore=Math.min(phraseModel.dscore,lowScore);highScore=Math.max(phraseModel.dscore,highScore);self.list.push(phraseModel);self.map[phraseModel.ID]=phraseModel;self.sortedList.push(phraseModel);});this.highScore=highScore;this.lowScore=lowScore;this._sortListByText();},isLanguageAvailable:function(language){return language!=='ja'&&language!=='zh';},isOverResponseLimit:function(){var responses=this.taModel.responses;return this.taModel.filterCount>=this.LINGO_MAX_COUNT;},_sortListByText:function(){this.sortedList.sort(function(a,b){a=a.text.toLowerCase();b=b.text.toLowerCase();if(a===b){return 0;}
return a<b?-1:1;});}});SM.Models.register("TextResponse",{__create:function(options){this.ID=options.ID;},__setters:{categoryIDs:function(self,categoryIDs){var list,sortedCategories,map;self.categories={list:[],map:{}};self.categoryIDs=[];list=self.categories.list;map=self.categories.map;if(!self.responses.taModel.categories.failed){sortedCategories=self.responses.taModel.categories.sortedList;$.each(sortedCategories,function(i,categoryModel){$.each(categoryIDs,function(j,categoryID){categoryID=String(categoryID);if(categoryID===categoryModel.ID){map[categoryID]=categoryModel;list.push(categoryModel);self.categoryIDs.push(categoryID);return false;}});});self.set("isInFilter",self._isInFilter(),{notify:true});if(!self.get("isInFilter")){self.responses.remove(self.ID);}}}},load:function(responseData){var taModel=this.responses.taModel,highlights=this.responses.highlights,pacificOffsetMilliseconds=28800000,utcMilliseconds=responseData.date-pacificOffsetMilliseconds,owner=taModel.rollup.question.page.survey.owner,hasTextAnalysis=taModel.hasTextAnalysis(),currentBrowserTimezoneOffset;

this.localizedDate=new Date(utcMilliseconds);


 if(SM.TIMEZONE_OFFSET_SHIFT){currentBrowserTimezoneOffset=(SM.Date.stdTimezoneOffset()*60000);this.localizedDate=new Date(utcMilliseconds+(currentBrowserTimezoneOffset-SM.TIMEZONE_OFFSET_SHIFT));}
this.dateStr=Globalize.format(this.localizedDate,'d')+' '+Globalize.format(this.localizedDate,'t');this.content=responseData.content;this.date=responseData.date;this.number=responseData.number;this.respondentID=responseData.respondent_id;this.highlights=highlights&&highlights[this.respondentID];this.respondentUrl=taModel.rollup.question.page.survey.getRespondentUrl(this.respondentID);if(hasTextAnalysis&&this.highlights){this.text=this._highlight();}else{this.text=[{text:SM.Html.strip(responseData.content)}];}
this.categories={map:{},list:[]};if(hasTextAnalysis){this.set("categoryIDs",responseData.tag_ids||[]);}},isSelected:function(){var selection=this.responses.selection;if(selection.isNone()){return false;}
return(selection.isAll()||(selection.map[this.ID]&&!selection.selectUnloaded)||(!selection.unselectedMap[this.ID]&&selection.selectUnloaded));},addCategoryID:function(categoryID){var categoryIDs=this.get("categoryIDs");categoryIDs=categoryIDs.concat([categoryID]);this.set("categoryIDs",categoryIDs,{notify:true});},removeCategory:function(categoryID){var categories=this.categories;delete categories.map[categoryID];SM.Array.removeItem(this.categoryIDs,categoryID);categories.list=$.map(categories.list,function(category,i){if(category.ID!==categoryID){return category;}});this._trigger("category.removed");},applyCategories:function(selection,newCategory){var self=this,diff=[],categoriesMap=this.categories.map,allCategories=self.responses.taModel.categories.sortedList,categoryIDs;if(selection){categoryIDs=$.map(allCategories,function(category,i){var state=selection[category.ID];if(state==="checked"||(state==="indeterminate"&&categoriesMap[category.ID])){return category.ID;}});diff=this._diffCategories(categoryIDs,this.categoryIDs);self.set("categoryIDs",categoryIDs,{notify:true});}
if(newCategory&&newCategory.label){diff.push({action:"create",label:newCategory.label,color:newCategory.color});}
return diff;},save:function(diff){var params,self=this;if(diff.length){params=this.responses.taModel._makeParams();params.commands=diff;params.response_text_ids=[this.ID];SM.Ajax.taTagAllText(params).done(function(response,status,jqXhr){var categoryModel;if(response.new_tags.length){categoryModel=SM.Models.create("TextCategory");categoryModel.categories=self.responses.taModel.categories;categoryModel.load(response.new_tags[0]);self.responses.taModel.categories.add(categoryModel);self.addCategoryID(categoryModel.ID);}
self.responses.taModel.categories.updateCounts(response.tag_counts.tags);});}},_isInFilter:function(){var isInFilter,categories,self=this;if(this.responses&&this.responses.taModel&&this.responses.taModel.categories){categories=this.responses.taModel.categories;if(!categories.hasFilter()){return true;}
if(!this.categoryIDs.length){return categories.isInFilter(categories.UNCATEGORIZED_ID);}
$.each(this.categoryIDs,function(i,categoryID){if(categories.isInFilter(categoryID)){isInFilter=true;return false;}});return isInFilter;}
return true;},_diffCategories:function(newIDs,currentIDs){var adds=[],deletes={};if(!newIDs.length){if(!currentIDs.length){return[];}
return $.map(currentIDs,function(currentID,i){return{action:"remove",tag_id:currentID};});}
$.each(newIDs,function(i,newID){var hasID=false;$.each(currentIDs,function(i,currentID){if(currentID===newID){hasID=true;deletes[currentID]=false;}
if(currentID!==newID&&deletes[currentID]===undefined){deletes[currentID]=true;}});if(!hasID){adds.push({action:"add",tag_id:newID});}});deletes=$.map(deletes,function(isDelete,categoryID){if(isDelete){return{action:"remove",tag_id:categoryID};}});return adds.concat(deletes);},_highlight:function(){var response=this.content,endOfContent=response.length,highlighted=[],section,lastHighlightEnd=0;$.each(this.highlights,function(index,highlight){var start=highlight[0],end=highlight[1],length=end-start,gap=start-lastHighlightEnd;if(gap>0){section=response.substr(lastHighlightEnd,gap);highlighted.push({text:SM.Html.strip(section)});}
section=response.substr(start,length);lastHighlightEnd=end;highlighted.push({text:SM.Html.strip(section),highlight:true});});if(lastHighlightEnd<endOfContent){ section=response.substr(lastHighlightEnd);highlighted.push({text:SM.Html.strip(section)});}
return highlighted;}});SM.Models.register("TextResponseList",{TA_INVALID_OFFSET:0,MAX_SEARCH_STRING_LEN:60,__create:function(options){this.ID=options.ID;this.selection=SM.Models.create("ResponsesSelection",{ID:this.ID});this.selection.responses=this;this.map={};this.list=[];this.loadedCount=0;this.highlights={};},load:function(responseData){var self=this,counts=this.taModel.get("survey").respondentCounts,owner=this.taModel.rollup.question.page.survey.owner,queryCount;this.map={};this.list=[];this.loadedCount=0;this.highlights={};this.removedCount=0;this.totalCount=responseData.question_response_count;queryCount=this.taModel.filterCount<responseData.count?this.taModel.filterCount:responseData.count;this.queryCount=owner.isOverResponseLimit(queryCount)?owner.responseLimit:queryCount;this._append(responseData);this.failed=false;this._trigger({type:"loaded"});},append:function(responseData){this._append(responseData);this._trigger({type:"appended",respondents:this.list.slice(this.loadedCount-responseData.response_texts.length)});},isEmpty:function(){return this.list.length===0;},applyCategories:function(categoriesSelection,newCategory){var self=this,responseIDs=self.selection.selectedIDs(),diff,except=false,diffs=[];$.each(responseIDs,function(index,responseID){diffs=diffs.concat(self.map[responseID].applyCategories(categoriesSelection,newCategory));});diff=this._cleanDiffs(diffs);
self.selection.clear();return{diff:diff,responseIDs:responseIDs,except:except};},remove:function(responseID){this.queryCount--;this.removedCount++;delete this.map[responseID];this.list=$.map(this.list,function(responseModel){if(responseModel.ID!==responseID){return responseModel;}});this._trigger("responseRemoved");},save:function(diff,responseIDs,except){var request,params,isRemoving,self=this;function onDone(response,status,jqXhr){var categoryModel;if(response.new_tags.length){categoryModel=SM.Models.create("TextCategory");categoryModel.categories=self.taModel.categories;categoryModel.load(response.new_tags[0]);self.taModel.categories.add(categoryModel);$.each(responseIDs,function(i,responseID){self.map[responseID].addCategoryID(categoryModel.ID);});}
self.taModel.categories.updateCounts(response.tag_counts.tags);}
if(diff.length){
 isRemoving=this._isRemovingFilteredCategory(diff);if(isRemoving){this.taModel.set("isSearching",true,{notify:true});}
params=this.taModel._makeParams();params.commands=diff;if(except){
 params.except_response_text_ids=responseIDs;request=SM.Ajax.taTagExceptText(params);}else{params.response_text_ids=responseIDs;request=SM.Ajax.taTagAllText(params);}
request.done(onDone);
 if(isRemoving){request.done(function(){self.taModel.filterCategories(self.taModel.categories.filter.list);});}}},_cleanDiffs:function(diffs){var dict={};return $.map(diffs,function(diff,i){if(!dict[diff.action]){dict[diff.action]={};if(diff.action==="create"){return diff;}}
if(diff.action==="create"){return;}
if(!dict[diff.action][diff.tag_id]){dict[diff.action][diff.tag_id]=true;return diff;}});},_append:function(responseData){var self=this;SM.Object.update(this.highlights,responseData.highlights);$.each(responseData.response_texts,function(i,response){var responseModel=SM.Models.create("TextResponse",{ID:response.response_text_id});responseModel.responses=self;self.loadedCount++;response.number=self.loadedCount;responseModel.load(response);self.map[response.response_text_id]=responseModel;self.list.push(responseModel);});},_isRemovingFilteredCategory:function(diffs){var isRemoving=false,filterMap=this.taModel.categories.filter.map;$.each(diffs,function(i,diff){if(diff.action==="remove"&&filterMap[diff.tag_id]){isRemoving=true;return false;}});return isRemoving;}});SM.Models.register("TextCategory",{MAX_CATNAME_LEN:25,__getters:{localizedPercent:function(self){var filterCount=self.categories.taModel.filterCount;return Globalize.formatPercent(self.responseCount/filterCount,2);},percent:function(self){var filterCount=self.categories.taModel.filterCount;return SM.Math.toPercentString(self.responseCount/filterCount,2);}},__validators:{name:function(self,val){var obj={isValid:true},trimmed=$.trim(val);if(!trimmed){obj.isValid=false;obj.exception="empty";}
if(trimmed.length>self.MAX_CATNAME_LEN){obj.isValid=false;obj.exception="maxlength";}
if(self._isDuplicateName(val)){obj.isValid=false;obj.exception="duplicate";}
return obj;}},load:function(category){var label,color;if(category){try{label=decodeURIComponent(category.label);color=decodeURIComponent(category.color);}catch(e){label=category.label;color=category.color;}
this.name=SM.Html.strip(label);this.color=color;this.responseCount=category.response_text_count||0;this.ID=''+category.tag_id;this.isNew=false;}else{this.responseCount=0;this.color="86A33B";this.name='';this.isNew=true;}},getApplicationState:function(responseID){if(responseID){return this._getResponseApplication(responseID);}else{return this._getResponsesSelectedApplication();}},_getResponsesSelectedApplication:function(){var categories=this.categories,responses=categories.taModel.responses,selection=responses.selection,self=this,filterResponseCount=this.categories.taModel.filterCount,state='unchecked',count;

 if(this.responseCount===0){return"unchecked";}
 
if(selection.isAll()){if(this.responseCount===filterResponseCount){return"checked";}else{return"indeterminate";}


}else if(selection.get("selectUnloaded")){count=0;$.each(selection.unselectedMap,function(responseID,unselected){if(unselected&&responses.map[responseID].categories.map[self.ID]){count++;}});

 if((this.responseCount-count)===selection.get("count")){return"checked";}else if((this.responseCount-count)===0){return"unchecked";}else{return"indeterminate";}


}else{count=0;$.each(selection.map,function(responseID,selected){if(selected&&responses.map[responseID].categories.map[self.ID]){count++;}});if(selection.get("count")===count){return"checked";}else if(count===0){return"unchecked";}else{return"indeterminate";}}},_getResponseApplication:function(responseID){var responseModel=this.categories.taModel.responses.map[responseID];return responseModel.categories.map[this.ID]?"checked":"unchecked";},isFiltering:function(){return!!this.categories.filter.map[this.ID];},_colorOptions:[{name:"dkgreen",hex:"86A33B"},{name:"turquoise",hex:"4BBFBF"},{name:"blue",hex:"426496"},{name:"red",hex:"C6332A"},{name:"orange",hex:"F8922F"},{name:"ltgreen",hex:"ABBF38"},{name:"gray",hex:"898A7A"},{name:"purple",hex:"68264D"},{name:"lavender",hex:"9999FF"}],_isDuplicateName:function(name){var categories=this.categories.list,self=this,isDuplicate=false;$.each(categories,function(i,category){ if(category.ID!==self.ID&&category.name===name){isDuplicate=true;return false;}});return isDuplicate;},save:function(){var params,self=this;if(this.ID===this.categories.UNCATEGORIZED_ID){throw new Error("Cannot save uncategorized");}
if(!this.isNew){throw new Error("Cannot save a category that is not new");}
params=this.categories.taModel._makeParams();params.color=SM.Html.strip(this.color);params.label=SM.Html.strip(this.name);SM.Ajax.taCreateTag(params).done(function(response,status,jqXhr){self.load(response);self.categories.add(self);});},edit:function(updates){var params;if(this.ID===this.categories.UNCATEGORIZED_ID){throw new Error("Cannot delete the uncategorized id");}
params=this.categories.taModel._makeParams();params.tag_id=this.ID;params.color=updates.color?SM.Html.strip(updates.color):this.color;params.label=updates.name?SM.Html.strip(updates.name):this.name;this.name=params.label;this.color=params.color;SM.Ajax.taEditTag(params);this.categories._trigger({type:"category.edited",category:this});},kill:function(){var params,uncategorizedModel;if(this.ID===this.categories.UNCATEGORIZED_ID){throw new Error("Cannot delete the uncategorized id");}
params=this.categories.taModel._makeParams();params.tag_id=this.ID;uncategorizedModel=this.categories.map[this.categories.UNCATEGORIZED_ID];this.categories.remove(this);this.categories=null;SM.Ajax.taDeleteTag(params).done(function(response,status,jqXhr){var tagCounts=response.tag_counts,uncategorized;if(tagCounts.status===200){uncategorized=tagCounts.tags[uncategorizedModel.ID];if(uncategorized){uncategorizedModel.set("responseCount",uncategorized.response_text_count,{notify:true});}}});}});SM.Models.register("TextCategoriesList",{__create:function(options){this.ID=options.ID,this.map={};this.sortedList=[],this.list=[];this.filter={list:[],map:{}};},UNCATEGORIZED_ID:"-1",load:function(categoryMap){this._buildStructures(categoryMap);this._ensureUncategorizedModel();this._sortListByName();},count:function(){ return this.list.length?this.list.length-1:0;},hasMany:function(){return this.count()>1;},isEmpty:function(){return this.count()===0;},hasFilter:function(){return this.filter.list.length>0;},getFilterList:function(){var self=this;return $.map(this.filter.list,function(categoryID){return self.map[categoryID];});},isInFilter:function(categoryID){if(this.hasFilter()){return!!this.filter.map[categoryID];}
return true;},createModel:function(){var categoryModel=SM.Models.create("TextCategory");categoryModel.categories=this;categoryModel.load();return categoryModel;},add:function(categoryModel){this._add(categoryModel);this._sortListByName();this.taModel._trigger({type:"category.added",category:categoryModel});},remove:function(categoryModel){this._remove(categoryModel);this.taModel._trigger({type:"category.deleted",category:categoryModel});},loadFilterSelection:function(filterSelection){this.filterSelection=filterSelection;this.filterSelection.categories=this;},updateCounts:function(categoryData){var self=this;$.each(categoryData,function(categoryID,category){self.map[categoryID].set("responseCount",category.response_text_count,{notify:true});});},_remove:function(categoryModel){var self=this,categoryID=categoryModel.ID,filterCategoryIDs,clearedUnordered=false,clearedOrdered=false; delete this.map[categoryID]; $.each(this.list,function(i,category){if(!clearedUnordered&&categoryID===category.ID){self.list.splice(i,1);clearedUnordered=true;}
if(!clearedOrdered){category=self.sortedList[i];if(categoryID===category.ID){self.sortedList.splice(i,1);clearedOrdered=true;}}
if(clearedOrdered&&clearedUnordered){return false;}}); if(this.filter.map[categoryID]){SM.Array.removeItem(this.filter.list,categoryID);this.taModel.filterCategories(this.filter.list);} 
$.each(this.taModel.responses.list,function(i,responseModel){if(responseModel.categories.map[categoryID]){responseModel.removeCategory(categoryID);}});if(!clearedOrdered&&!clearedUnordered){throw new Error("Category was not deleted properly: deleted ordered: "+clearedOrdered," clearedUnordered: "+clearedUnordered);}},_add:function(categoryModel){this.map[categoryModel.ID]=categoryModel;this.list.push(categoryModel);this.sortedList.push(categoryModel);},_buildStructures:function(categoryMap){var self=this;$.each(categoryMap,function(categoryID,category){var categoryModel=SM.Models.create("TextCategory");categoryModel.categories=self;categoryModel.load(category);self._add(categoryModel);});},_ensureUncategorizedModel:function(){var uncategorizedModel;if(!this.map[this.UNCATEGORIZED_ID]){uncategorizedModel=SM.Models.create("TextCategory"); uncategorizedModel.load({label:Globalize.localize('Uncategorized'),color:"333333",tag_id:this.UNCATEGORIZED_ID});this.map[this.UNCATEGORIZED_ID]=uncategorizedModel;this.list.push(uncategorizedModel);this.sortedList.push(uncategorizedModel);}
this.map[this.UNCATEGORIZED_ID].set("name",Globalize.localize('Uncategorized'));this.map[this.UNCATEGORIZED_ID].set("isUncategorized",true);},_sortListByName:function(){var uncategorized=Globalize.localize('Uncategorized').toLowerCase();this.sortedList.sort(function(a,b){a=a.name.toLowerCase();b=b.name.toLowerCase();if(a===uncategorized){return 1;}
if(b===uncategorized){return-1;}
if(a===b){return 0;}
return a<b?-1:1;});}});





SM.Models.register("ResponsesSelection",{__create:function(options){this.ID=options.ID;this.map={};this.unselectedMap={};this.count=0;this.selectUnloaded=false;},isAll:function(){var selectionCount=this.count,queryCount=this.responses.queryCount;return selectionCount===queryCount&&selectionCount>0;},isNone:function(){return this.count===0;},isMany:function(){return this.count>1;},add:function(id){var selectionCount=this.count;if(!this.selectUnloaded){this.map[id]=true;}else{this.unselectedMap[id]=false;}
if(!this.isAll()){this.set("count",selectionCount+1,{notify:true});}}, selectedIDs:function(){var self=this;if(this.selectUnloaded){return $.map(this.responses.list,function(responseModel,i){var unSelected=self.unselectedMap[responseModel.ID];if(!unSelected){return responseModel.ID;}});}else{return $.map(this.map,function(isSelected,responseID){if(isSelected){return responseID;}});}},unselectedIDs:function(){var self=this;if(this.selectUnloaded){return $.map(this.unselectedMap,function(unSelected,responseID){if(unSelected){return responseID;}});}else{return $.map(this.responses.list,function(responseModel,i){var isSelected=self.map[responseModel.ID];if(!isSelected){return responseModel.ID;}});}},remove:function(id){var selectionCount=this.count;if(!this.selectUnloaded){this.map[id]=false;}else{this.unselectedMap[id]=true;}
if(!this.isNone()){this.set("count",selectionCount-1,{notify:true});}},clear:function(){this.map={};this.unselectedMap={};this.set("count",0,{notify:true});this.selectUnloaded=false;},selectAll:function(){var responsesCount=this.responses.queryCount;this.unselectedMap={};this.map={};this.set("count",responsesCount,{notify:true});this.selectUnloaded=true;}});SM.Models.register("TextAnalysis",{PAGE_SIZE:50,TA_SUCCESS:200,__create:function(options){var ids;this.ID=options.ID;ids=this.ID.split('_');this.optionID=ids[3];this.crossedOptionID=ids[5];this.matrixCrossTabID=options.matrixCrossTab||"0";this.variationID=ids[7];this.responses=SM.Models.create("TextResponseList",{ID:this.ID});this.responses.taModel=this;this.categories=SM.Models.create("TextCategoriesList",{ID:this.ID});this.categories.taModel=this;this.phrases=SM.Models.create("TextPhraseList",{ID:this.ID});this.phrases.taModel=this;},__getters:{questionID:function(self){return self.rollup.question.ID;},survey:function(self){return self.rollup.question.page.survey;}},__setters:{searchDraft:function(self,val){var searchDraft=$.trim(val);searchDraft=SM.Html.strip(searchDraft);self.searchDraft=searchDraft;}},__validators:{searchDraft:function(self,val){var searchDraft=$.trim(val);searchDraft=SM.Html.strip(searchDraft);if(!searchDraft){return{isValid:false,exception:"empty"};}
return{isValid:true};}},load:function(taData){this.enableAnalysis=taData.text_data.enable_analysis;this.lingoEnabled=this.enableAnalysis&&this.hasTextAnalysis();this._loadCategoryData(taData.tag_data);this._loadResponseData(taData.text_data);this._loadAnalysisData(taData.analysis_data);this._hasLoaded=true;this._trigger("loaded");},hasLoaded:function(){return this._hasLoaded;},hasTextAnalysis:function(){return this.rollup.question.page.survey.hasTextAnalysis();},makeModelId:function(qid,oid,xid){return['qid',qid,'oid',oid,'xid',xid].join('_');}, fetch:function(){var params=this._makeSearchParams(),searchTime,self=this; params.offset=0; SM.Ajax.taGetRollupQuestion(params).done(function(response,status,jqXhr){var taData=response[self.ID];self.load(taData);});},fetchMoreResponses:function(){var self=this,params=this._makeSearchParams(),request,searchTime;this._lastSearch=SM.Date.timestamp();searchTime=this._lastSearch;if(this.categories.hasFilter()){params.restrict_by_tag_ids=this.categories.filter.list;}
params.offset=this.responses.loadedCount;if(this.get("query")){params.search_phrase=this.get("query");request=SM.Ajax.taGetRollupSearch(params);}else if(this.get("phrase")){params.phrase=this.get("phrase");request=SM.Ajax.taGetRollupPhrase(params);}else{request=SM.Ajax.taGetRollupQuestion(params);}
request.done(function onDone(response,status,jqXhr){var taData=response[self.ID];if(self._lastSearch===searchTime){if(taData.text_data.status===self.TA_SUCCESS){self.responses.set("fetchFailErrorID",null);self.responses.append(taData.text_data);}else{self.responses.set("fetchFailErrorID",response.request_id);self.responses._trigger("fetchMoreResponses.failed");}}}).fail(function onFail(response){if(self._lastSearch===searchTime){self.responses.set("fetchFailErrorID",response.request_id);self.responses._trigger("fetchMoreResponses.failed");}});return request;},fetchResponses:function(){var params=this._makeSearchParams(),self=this,request,searchTime;params.offset=0;if(this.categories.hasFilter()){params.restrict_by_tag_ids=this.categories.filter.list;}
this._beforeResponseRequest();request=SM.Ajax.taGetRollupQuestion(params);this._handleResponseRequest(request,this._lastSearch);},clearQuery:function(){var params=this._makeSearchParams(),request,self=this; params.offset=0; this.set("query","");this.set("phrase","");this.set("searchDraft","",{notify:true});this.categories.filter.list=[];this.categories.filter.map={};this._beforeResponseRequest();request=SM.Ajax.taGetRollupQuestion(params);self._handleResponseRequest(request,this._lastSearch);},searchPhrase:function(phrase){var params=this._makeSearchParams(),request,self=this; params.offset=0;params.phrase=phrase;if(this.categories.hasFilter()){params.restrict_by_tag_ids=this.categories.filter.list;} 
this.set("query","");this.set("phrase",phrase); this._beforeResponseRequest();request=SM.Ajax.taGetRollupPhrase(params);this._handleResponseRequest(request,this._lastSearch);},searchQuery:function(query){var params=this._makeSearchParams(),request,self=this; params.offset=0;params.search_phrase=query;if(this.categories.hasFilter()){params.restrict_by_tag_ids=this.categories.filter.list;} 
this.set("phrase","");this.set("query",query);this._beforeResponseRequest();request=SM.Ajax.taGetRollupSearch(params);this._handleResponseRequest(request,this._lastSearch);},filterCategories:function(categoryIDs){var map; this.categories.filter.map={};this.categories.filter.list=categoryIDs;map=this.categories.filter.map;$.each(categoryIDs,function(index,categoryID){map[categoryID]=true;});if(this.query){this.searchQuery(this.query);}else if(this.phrase){this.searchPhrase(this.phrase);}else{this.fetchResponses();}},_lastSearch:null,_loadResponseData:function(responseData){if(responseData.status===200){this.responses.load(responseData);}else{this.responses.set("failed",true);}},_loadCategoryData:function(categoryData){if(categoryData.status===200){this.categories.load(categoryData.tags);}else{this.categories.set("failed",true);}},_loadAnalysisData:function(analysisData){if(analysisData.status===200){this.phrases.load(analysisData.text_analysis);}else{this.phrases.set("failed",true);}},_makeParams:function(){var survey=this.get("survey");return{question_id:this.get("questionID"),variation_id:this.get("variationID"),option_id:this.get("optionID"),crosstab_option_id:this.get("crossedOptionID"),matrix_crosstab:this.get("matrixCrossTabID"),view_data:survey.anviews.currentView.dump(),survey_id:survey.ID};},_makeSearchParams:function(){var params=this._makeParams();SM.Object.update(params,{language:this._getLanguageParam(),page_size:this.PAGE_SIZE,hide_ids:1,include_question_tags:1,include_question_response_count:1});return params;},_getLanguageParam:function(){switch(Globalize.culture().name){case"en":return"english";case"nl":return"dutch";case"da":return"danish";case"fr":return"french";case"de":return"german";case"it":return"italian";case"no":return"norwegian";case"pt":return"portuguese";case"ru":return"russian";case"es":return"spanish";case"sv":return"swedish";default:return"not_supported";}},_handleResponseRequest:function(request,requestTime){var self=this;request.done(function(response,status,jqXhr){var taData=response[self.ID];if(self._lastSearch===requestTime){self.set("isSearching",false);if(taData.text_data.status===self.TA_SUCCESS){self.responses.load(taData.text_data);}else{if(self._lastSearch===requestTime){self.responses.set("failed",true,{notify:true});}}}}).fail(function(){self.set("isSearching",false);if(self._lastSearch===requestTime){self.responses.set("failed",true,{notify:true});}});},_beforeResponseRequest:function(request,requestTime){this.responses.selection.clear();this.responses.set("failed",false);this.set("isSearching",true,{notify:true});this._lastSearch=SM.Date.timestamp();}});SM.Models.register("BenchmarkRollup",{__create:function(options){this.question=options.question;this.questionID=this.question.ID,this.logicalID=this.question.logicalID;},loadRollupData:function(rollupData){this._rollupData=rollupData;},getRollupData:function(){return this._rollupData;},getResponseMean:function(){ var mean=SM.Math.roundTo(this._rollupData.benchmarks[this.logicalID].response_mean,2,0);return mean;},getQuartileValues:function(){ var quartileValues=this._rollupData.benchmarks[this.logicalID].quartile_values,shortValues={};_.each(quartileValues,function(value,id){shortValues[id]=SM.Math.roundTo(value,2,0);});return shortValues;},getSampleSize:function(){return this._rollupData.benchmarks[this.logicalID].sample_size;},getDateStart:function(){return this._rollupData.date_start;},getDateEnd:function(){return this._rollupData.date_end;},revertBenchmarkRollup:function(){this._trigger({type:'revertBenchmarkRollup'});},_onFetchBenchmarkRollup:function(context,doneArgs){var data=doneArgs[0],textStatus=doneArgs[1],jqXHR=doneArgs[2],self=context.self;SM.log('fetchBenchmarkRollup returned data for question id '+self.questionID);self.loadRollupData(data);self._trigger({type:'benchmarkRollupLoaded',bmRollup:self});},_onFetchBenchmarkRollupFailed:function(context,data){SM.log('fetchBenchmarkRollup failed: '+data);},fetchBenchmarkRollup:function(bm_filter){var self=this,params={question_id:self.questionID,bm_filter:bm_filter,view_data:this.question.page.survey.anviews.currentView.dump()},context={self:self};self.lastFetchRequest=SM.Ajax.bmFetchBenchmarkRollup(params);$.when(context,self.lastFetchRequest).done(self._onFetchBenchmarkRollup).fail(function(data,errorMgs,jqXHR){self._onFetchBenchmarkRollupFailed(context,data);});},_onFetchBenchmarkDistributionRollup:function(context,doneArgs){var data=doneArgs[0],textStatus=doneArgs[1],jqXHR=doneArgs[2],self=context.self;SM.log('Fetched benchmark distribution rollup: '+data);},_onFetchBenchmarkDistributionRollupFailed:function(context,data){SM.log('fetchBenchmarkDistributionRollup failed: '+data);},fetchBenchmarkDistributionRollup:function(bm_filter,start_percentile,end_percentile){var self=this,params={question_id:self.questionID,bm_filter:bm_filter,view_data:this.question.page.survey.anviews.currentView.dump(),start_percentile:start_percentile,end_percentile:end_percentile},context={self:self};self.lastFetchRequest=SM.Ajax.bmFetchBenchmarkDistrbutionRollup(params);$.when(context,self.lastFetchRequest).done(self._onFetchBenchmarkDistributionRollup).fail(function(data,errorMgs,jqXHR){self._onFetchBenchmarkDistributionRollupFailed(context,data);});}});SM.Models.register("BenchmarkRollupsByQuestionId",{__create:function(options){this.survey=options.survey; this.pages={}; this.questions={};this.createRollupModels();},createRollupModels:function(){var self=this;_.each(self.survey.questions,function(questionModel,questionID){var pageID=questionModel.page.ID,rollupModel;if(!self.pages[pageID]){self.pages[pageID]={};}
if(questionModel.structure.is_benchmarkable){rollupModel=SM.Models.create("BenchmarkRollup",{question:questionModel});self.pages[pageID][questionID]=rollupModel;self.questions[questionID]=rollupModel;}});},reset:function(){this.pages={};this.questions={};this.createRollupModels();},loadRollups:function(rollups){var self=this;if(rollups){_.each(rollups,function(rollup,questionID){var benchmarkRollup=self.questions[questionID];if(benchmarkRollup){benchmarkRollup.loadRollupData(rollup);}});}},getRollup:function(questionID){return this.questions[questionID]||null;}});SM.TaLearnMoreView=SM.Views.deepExtend(SM.DialogView,{__NAME:"TaLearnMore",__templateID:"ta-learn-more-dialog-template",__defaults:{width:850,isModal:true},__init:function(){this.$el.on('click','[ta-upgrade-cancel-btn]',{self:this},this._onCancel).on('click','[ta-upgrade-btn]',{self:this},this._onUpgrade);},_onCancel:function(e){var self=e.data.self;e.preventDefault();self.close();},_onUpgrade:function(e){e.data.self.close();}});SM.TaUpgradeView=SM.Views.register({__NAME:"TAUpgradeNow",__templateID:"upgrade-now-topbar-template",__model:"taModel",__init:function(){var survey=this.taModel.get("survey");this.$el.on('click','.close',{self:this},this._onCloseBtnClick);this.bindModel(survey.owner,"hasDismissedTaUpgrade.changed",{self:this},this._onDismissUpgrade);},_onCloseBtnClick:function(e){var self=e.data.self,survey=self.taModel.get("survey");e.preventDefault();survey.owner.set("hasDismissedTaUpgrade",true,{notify:true});},_onDismissUpgrade:function(e){var self=e.data.self;if(e.value){self.$el.remove();}}});SM.TaResponseShowTextView=SM.Views.register({__NAME:"TaResponseShowText",__templateID:"ta-response-summary-text-template",__model:'taModel',__init:function(){var taModel=this.taModel;if(taModel.hasTextAnalysis()){this.$el.on("click","[ta-reset-results-btn]",{self:this},this._onClear);this.bindModel(taModel.responses.selection,"count.changed",{self:this},this._update);this.bindModel(taModel.responses,"failed.set",{self:this},this._onResponsesFailed);this.bindModel(taModel.responses,"loaded",{self:this},this._update);this.bindModel(taModel.responses,"responseRemoved",{self:this},this._update);this.bindModel(taModel.categories,"category.edited",{self:this},this._update);this.bindModel(taModel,"isSearching.changed",{self:this},this._update);}},__beforeRender:function(){var responsesCount,taModel=this.taModel,responses=taModel.responses,selection=responses.selection,query=taModel.query,phrase=taModel.phrase,hasFilter=taModel.categories.hasFilter(),canClear=(query||phrase||hasFilter)&&taModel.hasTextAnalysis()&&!taModel.isSearching;responsesCount=selection.isNone()?responses.queryCount:selection.count;return{responsesFailed:responses.failed,taQuery:query||phrase||null,isSearching:taModel.isSearching,hasFilter:hasFilter,categories:taModel.categories.getFilterList(),hasSelection:!selection.isNone(),hasSingle:responsesCount===1,responsesCount:Globalize.format(responsesCount,"n0"),canClear:canClear};},_update:function(e){e.data.self.render();},_onClear:function(e){e.preventDefault();e.data.self.taModel.clearQuery();},_onResponsesFailed:function(e){if(e.value){e.data.self.render();}}});SM.TaResponseSearchFormView=SM.Views.register({__NAME:"TAResponseSearchFrom",__templateID:"ta-response-search-form-template",__model:'taModel',__init:function(){var taModel=this.taModel;if(taModel.hasTextAnalysis()){this.bindModel(taModel,"searchDraft.changed",{self:this},this._onSearchChange);this.$el.on('paste',"[ta-search-responses-input]",{self:this},this._onPaste).on("keyup","[ta-search-responses-input]",{self:this},this._onKeyup);}
this.$el.on("submit","form",{self:this},this._onFormSubmit).on('click',"[ta-search-responses-btn]",{self:this},this._onSearchBtnClick);},__beforeRender:function(){return{requireUpgrade:!this.taModel.hasTextAnalysis(),isDisabled:!this.taModel.hasTextAnalysis(),query:this.taModel.query};},__afterRender:function(){this.$el.find("[ta-search-tip]").popout();}, _onSearchBtnClick:function(e){var self=e.data.self,taModel=self.taModel;e.preventDefault();if(taModel.hasTextAnalysis()){if(taModel.validate("searchDraft",taModel.searchDraft).isValid){self.trigger({type:"search",query:taModel.searchDraft});}}},_onKeyup:function(e){var self=e.data.self,$input=$(e.target);self._isCurrentForm=true;self.taModel.set("searchDraft",$input.val(),{notify:true});},_onPaste:function(e){var self=e.data.self,$input=$(e.target);setTimeout(function(){self._isCurrentForm=true;self.taModel.set("searchDraft",$input.val(),{notify:true});},0);},_onFormSubmit:function(e){var self=e.data.self,taModel=self.taModel;e.preventDefault();if(taModel.hasTextAnalysis()){self.$el.find("[ta-search-responses-btn]").click();}},_onSearchChange:function(e){var self=e.data.self,$input=self.$el.find("[ta-search-responses-input]"); if(!$input.is(":focus")){$input.val(e.value);}}});SM.TaCategoryFormView=SM.Views.register({ __NAME:"TaCategoryForm",__templateID:"ta-category-form-template",__model:'category',__setup:function(){this.__defaults.saveText=Globalize.localize("Save");},__defaults:{isDisabled:true,ignoreEmptyName:false},__init:function(){this.$el.on("submit",{self:this},this._onFormSubmit).on("keyup","[category-name-text]",{self:this},this._onKeyup).on("paste","[category-name-text]",{self:this},this._onPaste).on("click","[color-swatch]",{self:this},this._onSwatchClick).on("click","[save-btn]",{self:this},this._onSaveClick);this.category.on("validated",{self:this},this._onNameValidation);},__destroy:function(){this.category.off("validated",this._onNameValidation);},__beforeRender:function(){var colors,category=this.category,selectedColor=this._getSelectedColor();this._currentName=category.name;colors=$.map(category._colorOptions,function(color,i){return{isSelected:color.hex===selectedColor,name:color.name,hex:color.hex};});return{maxLen:this.category.MAX_CATNAME_LEN,name:category.name,colors:colors,saveText:this.__settings.saveText,isDisabled:this.__settings.isDisabled,isEdit:!category.isNew};},__setters:{isDisabled:function(self,val){var $saveBtn=self.$el.find("[save-btn]");if(val){$saveBtn.addClass("disabled");}else{$saveBtn.removeClass("disabled");}
self.__settings.isDisabled=val;},isSaving:function(self,val){self.__settings.isSaving=val;self.render();}},_isDirty:function(){var category=this.category,currentName=this._currentName,isNameDirty=currentName!==category.name; if(!category.isNew){return isNameDirty||this._getSelectedColor()!==category.color;}else{ return isNameDirty;}},_testDirty:function(){var $saveBtn=this.$el.find("[save-btn]");if(this._dirty||this._isDirty()){this.set("isDisabled",false);}else if(!this._isDirty()&&!this._dirty){this.set("isDisabled",true);}}, markDirty:function(isDirty){this._dirty=isDirty;this._testDirty();},_dirty:false,_selectedColor:'',_onSwatchClick:function(e){var self=e.data.self,$target=$(e.target);e.preventDefault();self._selectedColor=$target.attr("color-hex");self.$el.find("[color-swatch]").removeClass("selected");$target.addClass("selected");self._testDirty();},_onSaveClick:function(e){var self=e.data.self,name,color;e.preventDefault();name=self._currentName;color=self._getSelectedColor();self._removeError();if(self.__settings.isDisabled){return;}
if((self.__settings.ignoreEmptyName&&!self._currentName)||self.category.validate("name",name).isValid){self.trigger({type:"save",color:color,name:name,ID:self.category.ID});}},_onFormSubmit:function(e){var self=e.data.self;e.preventDefault();self.$el.find("[save-btn]").click();},_onNameValidation:function(e){var self=e.data.self,nameValidation=e.validations.invalids.name,el=SM.Template.renderHTML("ta-category-name-error-template",{isEmpty:nameValidation.exception==="empty",isTooLong:nameValidation.exception==="maxlength",isDuplicate:nameValidation.exception==="duplicate"});self.$el.prepend(el);},_onKeyup:function(e){var self=e.data.self;self._currentName=$.trim(self.$el.find("[category-name-text]").val());if(e.which!==SM.KeyCodes.ENTER&&e.which!==SM.KeyCodes.NUMPAD_ENTER){self._removeError();self._testDirty();}},_onPaste:function(e){var self=e.data.self; setTimeout(function(){self._currentName=$.trim(self.$el.find("[category-name-text]").val());self._removeError();self._testDirty();},0);},_removeError:function(){this.$el.find("[category-error-msg]").remove();},_getSelectedColor:function(){return this._selectedColor||this.category.color;}});SM.TaCagetoriesAppliedView=SM.Views.register({ __NAME:"TaCategoriesApplied",__templateID:"ta-categories-chkbox-list-template",__model:'categories',__init:function(){var categories=this.categories;this.selection=SM.Models.create("AppliedCategoriesSelection",{responseID:this.__settings.responseID});this.selection.load(categories);this.$el.on('change',"[category-item-chkbx]",{self:this},this._onStateChange).on('click','[ta-list-item-overlay]',{self:this},this._onListItemClick);},__beforeRender:function(){ var sortedList=this.categories.sortedList;return{categories:this.categories.sortedList.slice(0,sortedList.length-1)};},__afterRender:function(){var list=this.categories.sortedList,responseID=this.__settings.responseID;this.$el.find("[category-item-chkbx]").each(function(i,el){var state=list[i].getApplicationState(responseID);if(state==="indeterminate"){el.indeterminate=true;}else{el.checked=state==="checked";}});},_onStateChange:function(e){var self=e.data.self,$target=$(e.target),$item=$target.closest('[category-id]'),$chkbox=$item.find("[category-item-chkbx]"),categoryID=$item.attr("category-id");self.selection.update(categoryID,e.target.checked?"checked":"unchecked");self.trigger("selectionChanged");},_onListItemClick:function(e){var self=e.data.self,$target=$(e.target),$item=$target.closest('[category-id]'),$chkbox=$item.find("[category-item-chkbx]"),indeterminate=$chkbox.get(0).indeterminate;if(indeterminate){$chkbox.get(0).indeterminate=false;$chkbox.prop("checked",true);}else{$chkbox.prop("checked",!$chkbox.prop("checked"));}
$chkbox.trigger("change").focus();}});SM.TaCategorizeMenuView=SM.Views.deepExtend(SM.BaseMenuView,{ __NAME:"TaCategorizeMenu",__templateID:"ta-categorize-menu-template",__model:'categories',__init:function(){this.$el.on("TaCategoryForm.save",{self:this},this._onApplyCategories).on("TaCategoriesApplied.selectionChanged",{self:this},this._onSelectionChange);},__afterRender:function(){var categories=this.categories,formView,categoriesView,categoryModel=categories.createModel();if(categories.count()>0){this.categoriesView=SM.Views.create(SM.TaCagetoriesAppliedView,{model:categories,responseID:this.__settings.responseID});this.el.appendChild(this.categoriesView.el);}
this.formView=SM.Views.create(SM.TaCategoryFormView,{model:categoryModel,saveText:Globalize.localize("Apply"),ignoreEmptyName:true});this.el.appendChild(this.formView.el);},_onSelectionChange:function(e){var self=e.data.self,categoriesView=self.categoriesView;self.formView.markDirty(categoriesView.selection.isDirty());},_onApplyCategories:function(e){var self=e.data.self;e.selection=self.categoriesView&&self.categoriesView.selection.dump();}});SM.CategorizeMenu=SM.Widgets.deepExtend(SM.BaseMenu,{__NAME:"categorizeMenu",__onMenuInit:function(){this.get("menuView").$el.on("TaCategoryForm.save",{self:this},this._onApplyCategories).on("click","[cancel-btn]",{self:this},this._onCancelCategories);},__onBeforeMenuOpen:function(){SM.BaseMenu.__onBeforeMenuOpen.call(this);this.get("menuView").render();},_menuView:"TaCategorizeMenuView",_onApplyCategories:function(e){var self=e.data.self;e.preventDefault();self.close();self.trigger({type:"apply",responseID:self.__settings.responseID,selection:e.selection,name:e.name,color:e.color});},_onCancelCategories:function(e){e.preventDefault();e.data.self.close();}});SM.TaCategoryFilterListView=SM.Views.register({ __NAME:"TaCagetoryFilterList",__templateID:"ta-categories-chkbox-list-template",__model:'categories',__init:function(){var categories=this.categories,filterSelection;if(!categories.filterSelection){filterSelection=SM.Models.create("FilterCategoriesSelection");categories.loadFilterSelection(filterSelection);}
categories.filterSelection.loadSelection();this.$el.on('change',"[category-item-chkbx]",{self:this},this._onStateChange).on('click','[ta-list-item-overlay]',{self:this},this._onListItemClick);},__beforeRender:function(){return{categories:this.categories.sortedList};},__afterRender:function(){var list=this.categories.sortedList;this.$el.find("[category-item-chkbx]").each(function(i,el){el.checked=list[i].isFiltering();});},_onStateChange:function(e){var self=e.data.self,$target=$(e.target),$item=$target.closest('[category-id]'),$chkbox=$item.find("[category-item-chkbx]"),categoryID=$item.attr("category-id");self.categories.filterSelection.update(categoryID,e.target.checked);},_onListItemClick:function(e){var self=e.data.self,$target=$(e.target),$item=$target.closest('[category-id]'),$chkbox=$item.find("[category-item-chkbx]");$chkbox.prop("checked",!$chkbox.prop("checked")).trigger("change").focus();}});SM.TaFilterMenuView=SM.Views.deepExtend(SM.BaseMenuView,{ __NAME:"TaFilterMenu",__templateID:"ta-filter-menu-template",__defaults:{isDisabled:true},__model:'categories', __init:function(){var categories=this.categories;categories.filterSelection.on("selection.changed",{self:this},this._onSelectionChange);this.$el.on('click','[clear-btn]',{self:this},this._onClearClick);},__destroy:function(){var categories=this.categories;categories.filterSelection.off("selection.changed",this._onSelectionChange);},__beforeRender:function(){return{isDisabled:this.__settings.isDisabled,hasFilter:this.categories.hasFilter()};},__afterRender:function(){var categories=this.categories,categoriesView;categoriesView=SM.Views.create(SM.TaCategoryFilterListView,{model:categories});this.$el.prepend(categoriesView.el);},_onClearClick:function(e){var self=e.data.self;e.preventDefault();self.categories.filterSelection.clear();self.$el.find("[clear-btn]").addClass("disabled");self.$el.find("input[type=checkbox]").prop("checked",false);},_onSelectionChange:function(e){var self=e.data.self,$clearBtn=self.$el.find("[clear-btn]"),$saveBtn=self.$el.find("[save-btn]");if(e.isDirty){$saveBtn.removeClass("disabled");}else{$saveBtn.addClass("disabled");}
if(!self.categories.filterSelection.isEmpty()){$clearBtn.removeClass("disabled");}}});SM.TaCategoriesShowTextView=SM.Views.register({__NAME:"TaCategoriesShowText",__templateID:"ta-categories-summary-text-template",__model:'categories',__init:function(){var taModel=this.categories.taModel;taModel.on("category.deleted",{self:this},this._onChangeCount);taModel.on("category.added",{self:this},this._onChangeCount);},__destroy:function(){var taModel=this.categories.taModel;taModel.off("category.deleted",this._onChangeCount);taModel.off("category.added",this._onChangeCount);},__beforeRender:function(){var categories=this.categories;return{hasCategories:!categories.isEmpty(),hasMany:categories.hasMany(),hasError:categories.failed,count:Globalize.format(categories.count(),"n0")};},_onChangeCount:function(e){var self=e.data.self;self.render();}});SM.TaCategoriesToolbarView=SM.Views.register({__NAME:"TaCategoriesToolbar",__templateID:"ta-categories-toolbar-template",__model:'taModel',__beforeRender:function(){return{isDisabled:this.taModel.categories.failed};},__afterRender:function(){var showTextView,searchFormView;searchFormView=SM.Views.create(SM.TaResponseSearchFormView,{model:this.taModel});showTextView=SM.Views.create(SM.TaCategoriesShowTextView,{model:this.taModel.categories});this.$el.find("[ta-toolbar-row-a]").prepend(searchFormView.el);this.$el.append(showTextView.el);}});SM.TaCategoryItemView=SM.Views.register({ __NAME:"TaCategoryItem",__templateID:"ta-category-item-template",__model:'category',__defaults:{mode:"view"},__init:function(){this.category.on("responseCount.changed",{self:this},this._onCountChange);},__destroy:function(){this.category.off("responseCount.changed",this._onCountChange);},__beforeRender:function(){var category=this.category;return{deleteMode:this._isDeleteMode(),viewMode:this._isViewMode(),editMode:this._isEditMode(),isSaving:this.__settings.isSaving,isUncategorized:category.isUncategorized,name:category.name,color:category.color,ID:category.ID,count:category.responseCount,localizedPercent:category.get("localizedPercent"),percent:category.get("percent")};},__afterRender:function(){var editView;if(this._isEditMode()){this.$el.on("leave",{self:this},this._onLeaveEdit).on("keyup",{self:this},this._onKeyup);editView=SM.Views.create(SM.TaCategoryFormView,{model:this.category});this.el.appendChild(editView.el);this.$el.find("input").focus();}},__setters:{mode:function(self,value){self.__settings.mode=value;self.render();}},modes:{VIEW:"view",DELETE:"delete",EDIT:"edit"},_cancel:function(){if(this.category.isNew){this.category.off("isLoading.changed",this._onLoading);}
this.$el.find('[cancel-btn]').click();},_isDeleteMode:function(){return this.__settings.mode===this.modes.DELETE;},_isViewMode:function(){return this.__settings.mode===this.modes.VIEW;},_isEditMode:function(){return this.__settings.mode===this.modes.EDIT;},_onLeaveEdit:function(e){var self=e.data.self;self.$el.off("leave");self._cancel();},_onKeyup:function(e){var self=e.data.self;if(e.which===SM.KeyCodes.ESCAPE){self.$el.off("keyup");self._cancel();}},_onCountChange:function(e){var self=e.data.self;self.render();}});SM.TaCategoriesListView=SM.Views.register({__NAME:"TaCategoriesListView",__templateID:"ta-categories-list-template",__model:'categories',__init:function(){this.categories.taModel.on("category.added",{self:this},this._onAdd);this.$el.on("TaCategoryForm.save",{self:this},this._onSave).on("click","[confirm-delete-btn]",{self:this},this._onConfirmDeleteClick).on("click","[delete-btn]",{self:this},this._onDeleteClick).on("click","[cancel-btn]",{self:this},this._onCancelClick).on("click","[edit-btn]",{self:this},this._onEditClick);},__destroy:function(){this.categories.taModel.off("category.added",this._onAdd);},__afterRender:function(){var categories=this.categories,msg,views;if(categories.failed){msg=SM.Template.render('ta-categories-error-template',{isServiceError:true});this.$el.html(msg);}else{views=$.map(categories.sortedList,function(category,index){return SM.Views.create(SM.TaCategoryItemView,{model:category}).el;});this.$el.append(views);}},_onConfirmDeleteClick:function(e){var self=e.data.self,category;e.preventDefault();category=self._getViewData(e.target);category.model.kill();category.view.$el.remove();},_onDeleteClick:function(e){var self=e.data.self,category;e.preventDefault();category=self._getViewData(e.target);category.view.set("mode",category.view.modes.DELETE);},_onCancelClick:function(e){var self=e.data.self,category;e.preventDefault();category=self._getViewData(e.target);if(category.model.isNew){category.view.$el.remove();}else{category.view.set("mode",category.view.modes.VIEW);}},_onEditClick:function(e){var self=e.data.self,category;e.preventDefault();category=self._getViewData(e.target);category.view.set("mode",category.view.modes.EDIT);},_onSave:function(e){var self=e.data.self,category;e.preventDefault();category=self._getViewData(e.target);if(category.model.isNew){category.model.color=e.color;category.model.name=e.name;category.view.set("isSaving",true);category.view.set("mode",category.view.modes.VIEW);category.model.save();}else{category.model.edit({color:e.color,name:e.name});category.view.set("mode",category.view.modes.VIEW);}},createNewCategory:function(categoryModel){var view=SM.Views.create(SM.TaCategoryItemView,{model:categoryModel,mode:"edit",isNew:true});this.$el.prepend(view.el);this.$el.find("input").focus();},_getViewData:function(el){var $item=$(el).closest("[category-id]"),view=$item.data("TaCategoryItem");return{view:view,model:view.category};},_onAdd:function(e){e.data.self.render();}});SM.TaCategoriesPanelView=SM.Views.extend({__NAME:"TaCategoriesPanel",__templateID:"ta-categories-panel-template",__model:'taModel',__init:function(){this.$el.on("click",'[ta-new-category-btn]',{self:this},this._onCreateClick);},__afterRender:function(md){var listView,toolbarView,taModel=this.taModel;toolbarView=SM.Views.create(SM.TaCategoriesToolbarView,{model:taModel});this._listView=SM.Views.create(SM.TaCategoriesListView,{model:this.taModel.categories});this.$el.append(toolbarView.el);this.$el.append(this._listView.el);},_onCreateClick:function(e){var self=e.data.self,category;e.preventDefault();if(!self.taModel.categories.failed){category=self.taModel.categories.createModel();self._listView.createNewCategory(category);}}});SM.TaResponseBtnMenuView=SM.Views.register({__NAME:"TaResponseBtnMenu",__templateID:"ta-response-btn-menu-template",__model:'taModel',__init:function(){var self=this,taModel=self.taModel,selection=taModel.responses.selection;if(taModel.hasTextAnalysis()){selection.on("count.changed",{self:this},this._enableCategorizeMenu);taModel.on("category.deleted",{self:this},this._enableFilterMenu);taModel.on("category.added",{self:this},this._enableFilterMenu);this.$el.on("categorizeMenu.apply",{self:this},this._onApplyCategories).on("menu.menuInit","[filter-menu-btn]",{self:this},this._onFilterMenuInit).on("menu.beforeOpen","[filter-menu-btn]",{self:this},this._onFilterBeforeOpen).on("menu.afterOpen","[filter-menu-btn]",{self:this},this._onFilterAfterOpen);}},__destroy:function(){var taModel=this.taModel,selection=taModel.responses.selection;if(taModel.hasTextAnalysis()){selection.off("count.changed",this._enableCategorizeMenu);taModel.off("category.deleted",this._enableFilterMenu);taModel.off("category.added",this._enableFilterMenu);}},__beforeRender:function(){var taModel=this.taModel,responses=taModel.responses,selection=responses.selection,isFilterDisabled=(!taModel.hasTextAnalysis()||taModel.categories.isEmpty()||taModel.filterCount===0||taModel.categories.failed),isCategorizeDisabled=(!taModel.hasTextAnalysis()||selection.get("count")===0||taModel.categories.failed);return{hasSelectAll:taModel.hasTextAnalysis()&&!taModel.categories.failed,isCategorizeDisabled:isCategorizeDisabled,isFilterDisabled:isFilterDisabled,requireUpgrade:!taModel.hasTextAnalysis()};},__afterRender:function(){var self=this,taModel=self.taModel,selection=taModel.responses.selection;if(taModel.hasTextAnalysis()){this.$el.find("[categorize-menu-btn]").categorizeMenu({model:this.taModel.categories});this._filterMenu=this.$el.find("[filter-menu-btn]").menu({menuView:"TaFilterMenuView",model:this.taModel.categories}).data("menu");}},_enableCategorizeMenu:function(e){var self=e.data.self,$categorizeBtn=self.$el.find("[categorize-menu-btn]");if(self.taModel.responses.selection.isNone()){$categorizeBtn.addClass("disabled");}else{$categorizeBtn.removeClass("disabled");}},_enableFilterMenu:function(e){var self=e.data.self,$filterBtn=self.$el.find("[filter-menu-btn]");if(self.taModel.categories.isEmpty()){$filterBtn.addClass("disabled");}else{$filterBtn.removeClass("disabled");}},_onApplyCategories:function(e){var self=e.data.self,updates;updates=self.taModel.responses.applyCategories(e.selection,{label:e.name,color:e.color});self.taModel.responses.save(updates.diff,updates.responseIDs,updates.except);},_onFilterBeforeOpen:function(e){var menuView=e.menu.get("menuView");menuView.render();},_onFilterAfterOpen:function(e){var menuView=e.menu.get("menuView");menuView.$el.find("input:first").focus();},_onFilterMenuInit:function(e){var self=e.data.self,menuView=e.menu.get("menuView");menuView.$el.on("click","[save-btn]",{menu:e.menu,self:self},self._onApplyFilter).on("click","[cancel-btn]",{menu:e.menu,self:self},self._onCancelFilter);},_onApplyFilter:function(e){var self=e.data.self,filterSelection=self.taModel.categories.filterSelection;e.preventDefault();if(filterSelection.isDirty()){filterSelection.apply();e.data.menu.close();}},_onCancelFilter:function(e){e.preventDefault();e.data.menu.close();}});SM.TaResponseSelectAllView=SM.Views.register({__NAME:"TaResponseSelectAllView",__templateID:"ta-select-all-template",__model:'taModel',__init:function(){var taModel=this.taModel,responses=taModel.responses,selection=responses.selection;responses.on("loaded",{self:this},this._onResponsesLoaded);taModel.on("isSearching.changed",{self:this},this._onSearching);selection.on("count.changed",{self:this},this._onCountChange);this.$el.on("click",{self:this},this._onSelectAllClick);},__destroy:function(){var taModel=this.taModel,responses=taModel.responses,selection=responses.selection;selection.off("count.changed",this._onCountChange);responses.off("loaded",this._onResponsesLoaded);},__afterRender:function(){this.$el.prop("checked",this.taModel.responses.selection.isAll()).prop("disabled",this.taModel.responses.queryCount===0||this.taModel.isSearching);}, _onSelectAllClick:function(e){var self=e.data.self,$chkbx=$(e.target),responses=self.taModel.responses,state=$chkbx.prop('checked');if(state){responses.selection.selectAll();}else{responses.selection.clear();}},_onCountChange:function(e){e.data.self.render();},_onResponsesLoaded:function(e){e.data.self.render();},_onSearching:function(e){e.data.self.render();}});SM.TaResponseToolbarView=SM.Views.register({ __NAME:"TAResponseTopBar",__templateID:"ta-response-toolbar-template",__model:'taModel', __afterRender:function(){var taModel=this.taModel,showTextView,btnView,searchFormView,selectAllView,hasSelectAllView=taModel.hasTextAnalysis()&&!taModel.categories.failed,$toolbar=this.$el.find("[ta-toolbar-row-a]");searchFormView=SM.Views.create(SM.TaResponseSearchFormView,{model:this.taModel});$toolbar.append(searchFormView.el);if(hasSelectAllView){selectAllView=SM.Views.create(SM.TaResponseSelectAllView,{model:this.taModel});$toolbar.append(selectAllView.el);}
btnView=SM.Views.create(SM.TaResponseBtnMenuView,{model:this.taModel});$toolbar.append(btnView.el);showTextView=SM.Views.create(SM.TaResponseShowTextView,{model:this.taModel});this.$el.append(showTextView.el);}});SM.TaResponseItemView=SM.Views.register({ __NAME:"TaResponseItem",__templateID:"ta-response-item-template",__model:'response',__init:function(){this.bindModel(this.response,"categoryIDs.changed",{self:this},this._onCategoryIDsChange);this.bindModel(this.response.responses.taModel.categories,"category.edited",{self:this},this._onCategoryEdited);this.bindModel(this.response,"category.removed",{self:this},this._onCategoryRemoved);},__beforeRender:function(){var response=this.response,taModel=response.responses.taModel;return{ID:response.ID,categories:response.categories.list,text:response.text,createDate:response.dateStr,respondentUrl:response.respondentUrl,isChecked:response.isSelected(),isBasic:!response.responses.taModel.hasTextAnalysis(),canCategorize:taModel.hasTextAnalysis()&&!taModel.categories.failed,actionsEnabled:this._areActionsEnabled()};},__afterRender:function(){var taModel=this.response.responses.taModel;if(taModel.hasTextAnalysis()&&!taModel.categories.failed){this.$el.find("[categorize-menu-btn]").categorizeMenu({model:taModel.categories,responseID:this.response.ID, parentEl:this.__settings.parentEl});}},_onCategoryIDsChange:function(e){var self=e.data.self;if(self.response.get("isInFilter")){self.render();}else{self.$el.remove();}},_onCategoryEdited:function(e){var self=e.data.self;if(self.response.categories.map[e.category.ID]){self.render();}},_onCategoryRemoved:function(e){var self=e.data.self;self.render();},_areActionsEnabled:function(){return!SM.App.isSharingApp();}});SM.TaLoadMoreResponsesView=SM.Views.register({__NAME:"TaLoadMoreResponsesView",__model:"responses",__templateID:"ta-load-more-responses-template",__defaults:{fetchMoreFailed:false,fetchFailErrorID:null},__init:function(){this.$el.on(SM.Event.CLICK,"[ta-responses-try-again-btn]",{self:this},this._onTryAgainClicked);this.responses.on("fetchMoreResponses.failed",{self:this},this._onFetchFail);},__destroy:function(){this.responses.off("fetchMoreResponses.failed",this._onFetchFail);},__beforeRender:function(){return{id:this.get("ID"),failed:this.get("fetchMoreFailed"),errorID:this.get("fetchFailErrorID")};},_onFetchFail:function(e){var self=e.data.self;self.set("fetchMoreFailed",true);self.set("fetchFailErrorID",self.responses.fetchFailErrorID);self.render();},_onTryAgainClicked:function(e){var self=e.data.self;e.preventDefault();self.set("fetchMoreFailed",false);self.set("fetchFailErrorID",null);self.render();self.responses.taModel.fetchMoreResponses();}});SM.TaResponseListView=SM.Views.register({__NAME:"TaResponseList",__templateID:"ta-response-list-template",__model:'responses',__create:function(){this.set("lazyLoaderID",this.__NAME+"loader"+this.__uid);},__init:function(){this.$el.on("infiniteScroll.reachedEnd",{self:this},this._requestMoreResponses).on("multiselect.applied",{self:this},this._onMultiSelectApplied); this.responses.on("appended",{self:this},this._onResponsesAppended);if(this.responses.taModel.hasTextAnalysis()){this.responses.selection.on("count.changed",{self:this},this._onCountChange);this.responses.taModel.on("isSearching.changed",{self:this},this._onIsSearching);this.responses.on("loaded",{self:this},this._onResponsesLoaded);this.responses.on("failed.set",{self:this},this._onResponsesFailed);this.$el.on("change","[response-item-chkbx]",{self:this},this._onItemSelected);this.$el.on("categorizeMenu.apply","[categorize-menu-btn]",{self:this},this._onApplyCategories);}
this._infiniteScroll=this.$el.infiniteScroll({markerID:this.get("lazyLoaderID")}).data("infiniteScroll");this.$el.multiselect({checkboxSelector:"input[response-item-chkbx]"});},__destroy:function(){ this.responses.off("appended",this._onResponsesAppended);if(this.responses.taModel.hasTextAnalysis()){this.responses.selection.off("count.changed",this._onCountChange);this.responses.taModel.off("isSearching.changed",this._onIsSearching);this.responses.off("failed.set",this._onResponsesFailed);this.responses.off("loaded",this._onResponsesLoaded);}},__afterRender:function(){var responses=this.responses,self=this,loadMoreView,html,frag;if(responses.failed){html=SM.Template.render('ta-responses-error-template',{isServiceError:true});this.$el.html(html);}else if(responses.taModel.isSearching){html=SM.Template.render('ta-search-response-spinner-template');this.$el.html(html);}else{if(!responses.isEmpty()){frag=this._createListFragment(responses.list);this.$el.append(frag);}
if(this._hasUnloadedResponses()){loadMoreView=SM.Views.create(SM.TaLoadMoreResponsesView,{model:this.responses,ID:this.get("lazyLoaderID")});this.$el.append(loadMoreView.el);}}},_createListFragment:function(responsesList){var frag=document.createDocumentFragment(),self=this;$.each(responsesList,function(i,response){var el=SM.Views.create(SM.TaResponseItemView,{model:response,parentEl:self.el}).el;frag.appendChild(el);});return frag;},_requestMoreResponses:function(e){var self=e.data.self;self.responses.taModel.fetchMoreResponses();e.stopPropagation();},_hasUnloadedResponses:function(){return this.responses.loadedCount<(this.responses.queryCount+this.responses.removedCount);},_updateResponseSelection:function(checkbox){var $checkbox=$(checkbox),selection=this.responses.selection,selected=checkbox.checked,$item=$checkbox.closest("[data-response-id]"),id=$item.attr("data-response-id");if(selected){selection.add(id);}else{selection.remove(id);}},_onMultiSelectApplied:function(e){var self=e.data.self;e.$checkboxes.each(function(){self._updateResponseSelection(this);});},_onItemSelected:function(e){var self=e.data.self;if(!e.isEditingAll){self._updateResponseSelection(e.target);}},_onCountChange:function(e){var self=e.data.self;if(self.responses.selection.isAll()){self.$el.find("input[response-item-chkbx]").each(function(){this.checked=true;});self.$el.data("multiselect").reset();}else if(self.responses.selection.isNone()){self.$el.find("input[response-item-chkbx]").each(function(){this.checked=false;});self.$el.data("multiselect").reset();}},_onIsSearching:function(e){var self=e.data.self;self._infiniteScroll.set("isActive",false);self.render();},_onResponsesLoaded:function(e){var self=e.data.self;self.render();if(!self._hasUnloadedResponses()){self._infiniteScroll.removeMarker();}
self._infiniteScroll.set("isActive",true);},_onResponsesFailed:function(e){var self=e.data.self;if(e.value){self.render();}},_onResponsesAppended:function(e){var self=e.data.self,frag=self._createListFragment(e.respondents);self.$el.find("[data-response-id]").last().after(frag);if(!self._hasUnloadedResponses()){self._infiniteScroll.removeMarker();}
self._infiniteScroll.set("isActive",true);},_onApplyCategories:function(e){var self=e.data.self,diff,responseModel=self.responses.map[e.responseID];diff=responseModel.applyCategories(e.selection,{label:e.name,color:e.color});responseModel.save(diff);}});SM.TaResponsesPanelView=SM.Views.extend({ __NAME:"TAResponsePanel",__templateID:"ta-response-panel-template",__model:'taModel', __create:function(){var self=this;self.survey=self.taModel.get("survey");self.hasTextAnalysis=self.taModel.hasTextAnalysis();}, __afterRender:function(md){var self=this,upgradeView,listView,toolbarView;if(self._shouldShowUpgradeView()){upgradeView=SM.Views.create(SM.TaUpgradeView,{model:self.taModel});self.$el.append(upgradeView.el);}
if(self._shouldShowToolbar()){toolbarView=SM.Views.create(SM.TaResponseToolbarView,{model:self.taModel});self.$el.append(toolbarView.el);}
listView=SM.Views.create(SM.TaResponseListView,{model:self.taModel.responses});self.$el.append(listView.el);}, _shouldShowToolbar:function(){return!SM.App.isSharingApp();},_shouldShowUpgradeView:function(){var self=this;if(SM.App.isSharingApp()){return false;}else{return!self.hasTextAnalysis&&!self.survey.owner.hasDismissedTaUpgrade;}}});SM.TaAnalysisShowTextView=SM.Views.register({__NAME:"TaAnalysisShowText",__templateID:"ta-analysis-summary-text-template",__model:'phrases',__beforeRender:function(){var phrases=this.phrases,phraseCount=phrases.list.length;return{hasAny:phraseCount>0,count:phraseCount,hasError:phrases.failed};}});SM.TaAnalysisToolbarView=SM.Views.register({__NAME:"TaAnalysisToolbar",__templateID:"ta-analysis-toolbar-template",__model:'taModel',__init:function(){this.taModel.phrases.on("viewMode.changed",{self:this},this._onViewModeChanged);this.$el.on("click","[ta-phrase-mode-tab]",{self:this},this._onTabClick);},__destroy:function(){this.taModel.phrases.off("viewMode.changed",this._onViewModeChanged);},__beforeRender:function(){var viewModes=this.taModel.phrases.viewModes;return{cloudTab:viewModes.CLOUD,listTab:viewModes.LIST,isDisabled:this.taModel.phrases.failed};},__afterRender:function(){var showTextView,taModel=this.taModel,phrases=taModel.phrases,searchFormView;searchFormView=SM.Views.create(SM.TaResponseSearchFormView,{model:taModel});showTextView=SM.Views.create(SM.TaAnalysisShowTextView,{model:phrases});if(!this.taModel.phrases.failed){this.$el.find("[ta-phrase-mode-tab="+phrases.viewMode+"]").addClass("open");}
this.$el.find("[ta-toolbar-row-a]").prepend(searchFormView.el);this.$el.append(showTextView.el);},_onViewModeChanged:function(e){var self=e.data.self;self.$el.find("[ta-phrase-mode-tab]").removeClass("open");self.$el.find("[ta-phrase-mode-tab="+e.value+"]").addClass("open");},_onTabClick:function(e){var self=e.data.self,$tab=$(e.target),phrases=self.taModel.phrases;e.preventDefault();if(!phrases.failed){phrases.set("viewMode",$tab.attr("ta-phrase-mode-tab"),{notify:true});}}});SM.TaAnalysisListView=SM.Views.register({__NAME:"TaAnalysisListView",__templateID:"ta-analysis-list-template",__model:'phrases',__beforeRender:function(){var phrases=$.map(this.phrases.list,function(phrase,i){return{ID:phrase.ID,localizedPercent:phrase.get("localizedPercent"),percent:phrase.get("percent"),count:phrase.responseCount,text:phrase.text};});return{phrases:phrases};}});SM.TaAnalysisCloudView=SM.Views.register({__NAME:"TaAnalysisCloudView",__templateID:"ta-analysis-cloud-template",__model:'phrases',__init:function(){this._popouts={};this.$el.on('click','[phrase-filter-id]',{self:this},this._onClick).on('mouseenter','[phrase-filter-id]',{self:this},this._onMouseenter).on('mouseleave','[phrase-filter-id]',{self:this},this._onMouseleave);},__beforeRender:function(){var phrases=$.map(this.phrases.sortedList,function(phrase,i){return{ID:phrase.ID,fontSize:phrase.get("fontSize"),text:SM.String.truncate(phrase.text,100,false)};});return{phrases:phrases};},__destroy:function(){
 if(!!this._popouts){$.each(this._popouts,function(phraseID,$popout){$popout.remove();});}
this._popouts=null;},_onMouseenter:function(e){var self=e.data.self,$owner=$(e.target),phraseID=$owner.attr("phrase-filter-id");self._addTip($owner,phraseID);},_onMouseleave:function(e){var self=e.data.self,$owner=$(e.target),phraseID=$owner.attr("phrase-filter-id");self._removeTip(phraseID);},_onClick:function(e){var self=e.data.self,$owner=$(e.target),phraseID=$owner.attr("phrase-filter-id");self._removeTip(phraseID);},_phraseWidth:function(ownerWidth){if(ownerWidth>500){return'right top';}
return'center top';},_addTip:function($owner,phraseID){var phrase=this.phrases.map[phraseID],cloud;if(!this._popouts[phraseID]){cloud=SM.Template.renderHTML("ta-cloud-popout-template",{hasMany:phrase.hasManyResponses(),count:phrase.responseCount,percent:phrase.get("localizedPercent"),rank:phrase.rank});this._popouts[phraseID]=$(cloud);}
$(document.body).append(this._popouts[phraseID]);this._popouts[phraseID].removeClass("out").position({my:"center bottom",at:this._phraseWidth($owner.width()),of:$owner,collision:'none'}).addClass("active");},_removeTip:function(phraseID){var self=this;if(!this._popouts[phraseID]){return;}
this._popouts[phraseID].addClass("out");setTimeout(function(){if(self._popouts&&self._popouts[phraseID]){self._popouts[phraseID].removeClass("active").detach();}},200);}});SM.TaAnalysisContentView=SM.Views.register({ __NAME:"TaAnalysisContent",__templateID:"ta-analysis-panel-content-template",__model:'phrases',__init:function(){this.phrases.on("viewMode.changed",{self:this},this._onViewModeChanged);},__destroy:function(){this.phrases.off("viewMode.changed",this._onViewModeChanged);},__afterRender:function(md){var phrases=this.phrases,html,view,language=Globalize.culture().name;if(!phrases.isLanguageAvailable(language)){html=SM.Template.render('ta-analysis-error-template',{isUnsupported:true});}else if(phrases.isOverResponseLimit()){html=SM.Template.render('ta-analysis-error-template',{isOverLimit:true,limit:Globalize.format(phrases.LINGO_MAX_COUNT,"n0")});}else if(phrases.failed){html=SM.Template.render('ta-analysis-error-template',{isServiceError:true});}else if(phrases.viewMode==="cloud"){html=SM.Views.create(SM.TaAnalysisCloudView,{model:phrases}).el;}else{html=SM.Views.create(SM.TaAnalysisListView,{model:phrases}).el;}
this.$el.html(html);},_onViewModeChanged:function(e){var self=e.data.self;self.render();}});SM.TaAnalysisPanelView=SM.Views.extend({__NAME:"TaAnalysisPanel",__templateID:"ta-analysis-panel-template",__model:'taModel',__afterRender:function(md){var contentView,toolbarView;toolbarView=SM.Views.create(SM.TaAnalysisToolbarView,{model:this.taModel});contentView=SM.Views.create(SM.TaAnalysisContentView,{model:this.taModel.phrases});this.$el.append(toolbarView.el);this.$el.append(contentView.el);}});SM.TaTabsView=SM.Views.register({__NAME:"TaTabsView",__templateID:"ta-tabs-template",__model:'taModel',__defaults:{selectedTab:'responses'},__init:function(){var taModel=this.taModel;this.$el.tabs({selectedTab:this.__settings.selectedTab});taModel.on("category.deleted",{self:this},this._onCategoryCountChange);taModel.on("category.added",{self:this},this._onCategoryCountChange);this.$el.on("TAResponseSearchFrom.search",{self:this},this._onSearch).on("click","[category-filter-id]",{self:this},this._onCategoryClick).on("click","[phrase-filter-id]",{self:this},this._onPhraseClick).on("click","[learn-more-trigger]",{self:this},this._onLearnMoreClick);},__destroy:function(){this.taModel.off("category.deleted",this._onCategoryCountChange);this.taModel.off("category.added",this._onCategoryCountChange);},__beforeRender:function(){var hasTextAnalysis=this.taModel.hasTextAnalysis(),selectedTab=this.get("selectedTab"),taModel=this.taModel,tabs=[];tabs.push({name:"responses",icon:"w",hasCount:true,count:Globalize.format(taModel.filterCount,"n0"),text:Globalize.localize("Responses"),isDisabled:false});if(this._shouldShowAnalysisTab()){tabs.push({name:"analysis",icon:"C",text:Globalize.localize("Text Analysis"),isDisabled:!hasTextAnalysis});}
if(this._shouldShowCategoriesTab()){tabs.push({name:'categories',icon:"z",text:Globalize.localize("My Categories"),hasCount:!taModel.categories.failed,count:hasTextAnalysis&&!taModel.categories.failed?Globalize.format(taModel.categories.count(),"n0"):0,isDisabled:!hasTextAnalysis});}
$.each(tabs,function(i,tab){tab.isOpen=selectedTab===tab.name;});return{tabs:tabs};},__afterRender:function(md){var panelContents=[],responsesPanelView,analyzePanelView,categoriesPanelView,hasTextAnalysis=this.taModel.hasTextAnalysis(),$panels=this.$el.find("[ta-tabs-panel]");responsesPanelView=SM.Views.create(SM.TaResponsesPanelView,{model:this.taModel});panelContents.push(responsesPanelView.el);if(hasTextAnalysis){analyzePanelView=SM.Views.create(SM.TaAnalysisPanelView,{model:this.taModel});categoriesPanelView=SM.Views.create(SM.TaCategoriesPanelView,{model:this.taModel});panelContents.push(analyzePanelView.el);panelContents.push(categoriesPanelView.el);}
$.each(panelContents,function(i,contents){$panels.eq(i).append(contents);});},_onLearnMoreClick:function(e){var self=e.data.self,dialog=SM.Views.create(SM.TaLearnMoreView);e.preventDefault();dialog.open();},_onCategoryClick:function(e){var self=e.data.self,tabs=self.$el.data("tabs"),categoryID=$(e.target).attr("category-filter-id");e.preventDefault();self.taModel.filterCategories([categoryID]);tabs.open("responses");},_onPhraseClick:function(e){var self=e.data.self,tabs=self.$el.data("tabs"),phraseID,phraseText;e.preventDefault();phraseID=$(e.target).attr("phrase-filter-id");phraseText=self.taModel.phrases.map[phraseID].text;self.taModel.searchPhrase(phraseText);tabs.open("responses");},_onSearch:function(e){var self=e.data.self,tabs=self.$el.data("tabs");self.taModel.searchQuery(e.query);tabs.open("responses");},_onCategoryCountChange:function(e){var self=e.data.self,$responseCount=self.$el.find("[tab-target=categories] [ta-tab-count]");$responseCount.text("("+self.taModel.categories.count()+")");},_shouldShowAnalysisTab:function(){return!SM.App.isSharingApp();},_shouldShowCategoriesTab:function(){return!SM.App.isSharingApp();}});SM.TaContainerView=SM.Views.register({__NAME:"TaContainerView",__templateID:"ta-container-template",__model:'taModel',__afterRender:function(md){var tabSetView=SM.Views.create(SM.TaTabsView,{model:this.taModel});this.$el.append(tabSetView.$el);}});SM.SummaryChartContainerView=SM.Views.register({ __NAME:"summaryQuestionChartView",__templateID:"summary-chart-container-template",__model:"question", __create:function(options){var self=this;self.survey=options.survey;self.question=options.question;self.rollup=self.question.getRollup();self.display=self.rollup.display;self.isExport=options.isExport;self.randomAssignmentOption=options.randomAssignmentOption;self.questionView=options.questionView;}, __beforeRender:function(){var self=this,display=self.display.getDisplayData();return{isShown:display.show_chart};},__afterRender:function(){var self=this,chartView;if(self._shouldHideChart()){return;}
try{chartView=SM.Views.create(SM.BaseSummaryChartView,{question:self.question,questionView:self.questionView});self.$el.html(chartView.el);self.chartView=chartView;}catch(exception){self._handleRenderingError(exception);}},_shouldHideChart:function(){var self=this,display=self.display.getDisplayData();return!display.show_chart;},_handleRenderingError:function(exception){var self=this,div;div=document.createElement("div");div.innerHTML=SM.Template.render("summary-chart-display-error-template");self.$el.html(div);SM.Error.log(exception,"question summary chart rendering error, QuestionID: "+self.question.ID);}, __init:function(){var self=this;self.bindModel(self.display,"displayChange",{self:self},self._onDisplayChange);self.bindModel(self.display,"tempDisplayChange",{self:self},self._onDisplayChange);self.bindModel(self.display,"allDisplaysChange",{self:self},self._onDisplayChange);},_onDisplayChange:function(e){var self=e.data.self;if(self.question.hasRandomAssignment()&&!!self.randomAssignmentOption){self.question.randomAssignmentOption=self.randomAssignmentOption;}
self.render();}});SM.BaseSummaryChartView=SM.Views.register(SM.Object.deepExtend(SM.SummarySeriesFactory,{__NAME:"BaseSummaryChartView",__templateID:"summary-chart-template", HIGHCHARTS_CHART_TYPE_MAP:{"vbar":"column","hbar":"bar","area":"area","line":"line","stacked_vbar":"column","stacked_hbar":"bar","pie":"pie","donut":"pie","boxplot":"boxplot"},DATA_LABEL_OFFSETS:{column:[0,-10],bar:[10,0],pie:[10,0],donut:[10,0],line:[0,-10],area:[0,-10],boxplot:[10,0]},TITLE_HEIGHT:30, __create:function(options){var self=this;self._createAsSummarizable(options);self.DEFAULT_HIGHCHARTS_OPTIONS=SM.Object.deepExtend(SM.Highcharts.DEFAULT_OPTIONS,{plotOptions:{series:{dataLabels:{formatter:this._formatDataLabel}}}});_.bindAll(this,"_compileChartOptions","_renderChart");},getSeriesList:function(){var self=this;return self.seriesList;}, __beforeRender:function(){var self=this;self._getDisplayOptions();self._getChartMetadata();self._getSortedSummaryData();},__afterRender:function(){var self=this,questionOptionsList,chartOptionsList,configLimit,singleDataPoints=0,totalDataPoints=0;self.$el.empty(); self.seriesList=[]; if(self.summary.answered===0){self.$el.html(SM.Template.render("no-matching-responses-template"));return;}
questionOptionsList=self._buildQuestionOptions();chartOptionsList=_.map(questionOptionsList,self._compileChartOptions);


 singleDataPoints=_.size(chartOptionsList[0].series)*_.size(chartOptionsList[0].series[0].data);totalDataPoints=_.size(chartOptionsList)*singleDataPoints;configLimit=self.question.page.survey.config['question_chart_display_threshold'];if((singleDataPoints>configLimit)||(totalDataPoints>configLimit*3)){self.$el.html(SM.Template.render("chart-too-big-template"));return;}
_.each(chartOptionsList,self._renderChart);},_compileChartOptions:function(questionOptions,chartIndex){var self=this,chartOptions,eventOptions,plotOptions,tooltipOptions,legendOptions,colorOptions,compiledOptions,series,xAxisLabels,$chartContainer;$chartContainer=$("<div></div>");series=questionOptions.series;self.seriesList.push(series);xAxisLabels=questionOptions.xAxis.categories;chartOptions=self._buildChartOptions(series,xAxisLabels,$chartContainer,chartIndex);eventOptions=self._buildEventOptions($chartContainer);colorOptions=self._buildColorOptions();plotOptions=self._buildPlotOptions(series);tooltipOptions=self._buildTooltipOptions();legendOptions=self._buildLegendOptions();self._setDataLabelCoordinates(series,questionOptions.yAxis,chartOptions.chart);compiledOptions=SM.Object.deepExtend(self.DEFAULT_HIGHCHARTS_OPTIONS,chartOptions,eventOptions,colorOptions,plotOptions,tooltipOptions,legendOptions,questionOptions); return compiledOptions;},_renderChart:function(chartOptions){var self=this,chart,$chartContainer=$(chartOptions.chart.renderTo);self.$el.append($chartContainer);chart=new Highcharts.Chart(chartOptions,function(chartObj){});
 self._bindEvents($chartContainer,chart);},_bindEvents:function($chartContainer,chart){var self=this,yAxis=chart.yAxis[0];if(!SM.App.isSharingApp()){SM.Highcharts.bindYAxisEvents($chartContainer,yAxis);SM.Highcharts.bindAreaChartEvents($chartContainer);SM.Highcharts.bindXAxisEvents($chartContainer);}},_getChartMetadata:function(){var self=this;self.chartMetadata=self.rollup.display.getDisplayData();self.chartType=self.chartMetadata.chart_type;self.scaleType=self.chartMetadata.scale_type;self.scaleIsPercent=self.scaleType===self.SCALE_TYPE_PERCENT;self.isMirrored=self.chartMetadata.mirror;self.isWeightedAvg=self.chartMetadata.isWeightedAvg;self.isDistribution=self.chartMetadata.isDistribution;self.isStacked=self.chartMetadata.isStacked;self.isArea=self.chartMetadata.isAreaChart;self.isPie=self.chartMetadata.isPieChart;self.isDonut=self.chartMetadata.isDonutChart;self.isBoxplot=self.chartMetadata.isBoxplotChart;self.showDataLabels=self.chartMetadata.show_data;self.hideEmptyData=!self.chartMetadata.show_empty_data;self.hasXAxis=!self.isPie&&!self.isDonut;self.hasTitle=self._hasTitle();self.hasLegend=self._hasLegend();self.highchartsChartType=self.HIGHCHARTS_CHART_TYPE_MAP[self.chartType];self.isVertical=self._isVertical();},



 _buildQuestionOptions:function(){var self=this,optionsList;if(self.summaryType==="menu_matrix"){if(self.isWeightedAvg){optionsList=self._buildMenuMatrixWeightedAvgChartOptionsList();}else if(self.isPie||self.isDonut){optionsList=self._buildMenuMatrixPieChartOptionsList();}else{optionsList=self._buildMenuMatrixChartOptionsList();}}else if(self.summaryType==="matrix"){if(self.isWeightedAvg){optionsList=[self._buildMatrixWeightedAvgChartOptions()];}else if(self.isPie||self.isDonut){optionsList=[self._buildPieChartOptions()];}else{optionsList=[self._buildMatrixChartOptions()];}}else{if(self.isPie||self.isDonut){optionsList=[self._buildPieChartOptions()];}else if(self.isBoxplot){optionsList=[self._buildSimpleBoxPlotOptions()];}else{optionsList=[self._buildSimpleChartOptions()];}}
return optionsList;},_buildSimpleChartOptions:function(){var self=this,chartOptions,categories,series,sortedRows;sortedRows=self.sortedRowsList[0];if(self.isStacked){categories=[];series=self.buildSimpleStackedSeries(sortedRows);}else{categories=self.buildCategories(sortedRows);series=self.buildSimpleSeries();}
chartOptions={xAxis:self._buildXAxisOptions(categories),series:series,yAxis:self._buildYAxisOptions(series)};return chartOptions;},_buildPieChartOptions:function(options){var self=this,chartOptions,categories,series,sortedRows;options=options||{};sortedRows=self.sortedRowsList[0];categories=self.buildCategories(sortedRows);if(self.summaryType==="matrix"){if(self.isCompared){series=self.buildSimpleSeriesFromComparedMatrixSummary();}else{series=self.buildSimpleSeriesFromMatrixSummary();}}else if(self.summaryType==="menu_matrix"){series=self.buildSimpleSeriesFromMenuMatrixSummary(options.columnID);}else{series=self.buildSimpleSeries();} 
_.each(series,function(seriesItem){seriesItem.data=_.filter(seriesItem.data,function(d){return d.y>0;});});chartOptions={xAxis:self._buildXAxisOptions(categories),series:series,yAxis:self._buildYAxisOptions(series)};return chartOptions;},_buildMatrixChartOptions:function(){var self=this;var chartOptions,categories,series;
if(self.aggregateOverColumns){categories=self.buildCategories(self.sortedColumnsList[0]);series=self.buildMirroredMatrixSeries();}else{categories=self.buildCategories(self.sortedRowsList[0]);series=self.buildMatrixSeries();}
chartOptions={xAxis:self._buildXAxisOptions(categories),yAxis:self._buildYAxisOptions(series),series:series};return chartOptions;},_buildMenuMatrixChartOptionsList:function(){var self=this,columnChoices,columnChoiceTotals,chartOptionsList,chartOptions,sortedRows,sortedColumns,sortedColumnChoices,categories,series;if(self.question.isCompared()){chartOptionsList=_.map(self.rows,function(row,rowIndex){columnChoices=row.items;if(_.isEmpty(columnChoices)){return;}
if(self.isMirrored){sortedColumnChoices=self.sortedColumnChoicesList[rowIndex];categories=self.buildCategories(sortedColumnChoices);}else{sortedColumns=self.sortedColumnsList[rowIndex];categories=self.buildCategories(sortedColumns);}
columnChoiceTotals=self.columnChoiceTotalsByRow[row.id];series=self.buildComparedMatrixSeries(row,columnChoices,columnChoiceTotals);chartOptions=self._buildMenuMatrixChartOptions(categories,series,row.text);return chartOptions;});}else{chartOptionsList=_.map(self.columns,function(column,columnIndex){var columnChoices=column.items;if(self.isMirrored){sortedColumnChoices=self.sortedColumnChoicesList[columnIndex];categories=self.buildCategories(sortedColumnChoices);}else{sortedRows=self.sortedRowsList[columnIndex];categories=self.buildCategories(sortedRows);}
series=self.buildMenuMatrixSeries(column,columnIndex,columnChoices,self.columnChoiceTotalsByColumnChoice);chartOptions=self._buildMenuMatrixChartOptions(categories,series,column.text);return chartOptions;});}
chartOptionsList=_.compact(chartOptionsList);return chartOptionsList;},_buildMenuMatrixChartOptions:function(categories,series,titleText){var self=this;return{title:self._buildMenuMatrixTitleOptions(titleText),xAxis:self._buildXAxisOptions(categories),series:series,yAxis:self._buildYAxisOptions(series)};},_buildMatrixWeightedAvgChartOptions:function(){var self=this;return self._buildWeightedAvgChartOptions(0,function(dimensionId){if(self.isCompared){return self.weightedAveragesByColumn[dimensionId];}else{return self.weightedAveragesByRow[dimensionId];}});},_buildMenuMatrixWeightedAvgChartOptionsList:function(){var self=this;var chartOptionsList=[],chartOptions;if(self.isCompared){_.each(self.rows,function(row,rowIndex){chartOptions=self._buildWeightedAvgChartOptions(rowIndex,function(columnChoiceId){return self.weightedAveragesByRowAndColumnChoice[row.id][columnChoiceId];});chartOptions.title=self._buildMenuMatrixTitleOptions(row.text);chartOptionsList.push(chartOptions);});}else{_.each(self.columns,function(column,columnIndex){chartOptions=self._buildWeightedAvgChartOptions(columnIndex,function(rowId){return self.weightedAveragesByRowAndColumn[rowId][column.id];});chartOptions.title=self._buildMenuMatrixTitleOptions(column.text);chartOptionsList.push(chartOptions);});}
return chartOptionsList;},_buildMenuMatrixPieChartOptionsList:function(){var self=this;var chartOptionsList=[],chartOptions;_.each(self.columns,function(column,columnIndex){chartOptions=self._buildPieChartOptions({columnID:column.id});chartOptions.title=self._buildMenuMatrixTitleOptions(column.text);chartOptionsList.push(chartOptions);});return chartOptionsList;},_buildMenuMatrixTitleOptions:function(titleText){var self=this,options;titleText=_.string.truncate(titleText,SM.Highcharts.MAX_TITLE_CHARS);options={align:"left",text:titleText,useHTML:true,style:{padding:'10px 1500px 10px 10px',backgroundColor:'#DFDFDF',fontSize:'12px'},x:84,y:0};

if(this.highchartsChartType==="bar"&&!self.isStacked){options.x=104;}
return options;},_buildWeightedAvgChartOptions:function(sortedDimensionIndex,getWeightedAverageValue){var self=this,chartOptions,categories,series,seriesData;categories=[];seriesData=[];var categoryName,weightedAverage;if(self.isCompared){if(self.summaryType==="menu_matrix"){if(self.sortedColumnChoicesList.length){_.each(self.sortedColumnChoicesList[sortedDimensionIndex],function(columnChoice,columnChoiceID){categoryName=columnChoice.text;weightedAverage=getWeightedAverageValue(columnChoice.id);categories.push(categoryName);seriesData.push({y:weightedAverage,absoluteY:weightedAverage});});}}else{if(self.sortedColumnsList.length){_.each(self.sortedColumnsList[sortedDimensionIndex],function(column,columnIndex){categoryName=column.text;weightedAverage=getWeightedAverageValue(column.id);categories.push(categoryName);seriesData.push({y:weightedAverage,absoluteY:weightedAverage});});}}}else{if(self.sortedRowsList.length){_.each(self.sortedRowsList[sortedDimensionIndex],function(row,rowIndex){categoryName=row.text;weightedAverage=getWeightedAverageValue(row.id);categories.push(categoryName);seriesData.push({y:weightedAverage,absoluteY:weightedAverage});});}}
series=[self._buildSeriesItem(seriesData,{})];chartOptions={xAxis:self._buildXAxisOptions(categories),series:series,yAxis:self._buildYAxisOptions(series)};return chartOptions;},
 _fixBoxPlotSeries:function(series){var simpleData=[];_.each(series[0].data[1],function(item,index){simpleData.push(item.y);});series[0].data[1]=simpleData;return series;},_buildSimpleBoxPlotOptions:function(options,$container){var colorOptions={colors:SM.Highcharts.DEFAULT_OPTIONS.colors},benchmarkRollup=this.question.page.survey.getBenchmarkRollup(this.question.ID),responseMean=benchmarkRollup.getResponseMean(),benchmarkSeries=this.buildSimpleBenchmarkSeries(colorOptions),chartOptions={chart:{type:'boxplot',inverted:true,height:200,width:500},legend:{enabled:true,y:20},plotOptions:{boxplot:{dataLabels:{enabled:true}}},xAxis:{categories:['','','']},yAxis:{tickInterval:1,plotLines:[{value:responseMean,color:'red',width:1,zIndex:100}],min:1,max:this.question.structure.answers.rows.length}, series:this._fixBoxPlotSeries(benchmarkSeries)};return chartOptions;}, _buildChartOptions:function(series,xAxisLabels,$container,chartIndex){var self=this,numSeries=series.length,numXAxisLabels=_.isEmpty(xAxisLabels)?0:xAxisLabels.length,titleHeight=self.hasTitle?self.TITLE_HEIGHT:0,labelHeight=self.hasXAxis?SM.Highcharts.calculateXAxisLabelHeight(self.highchartsChartType,xAxisLabels):0,legendHeight=self.hasLegend?SM.Highcharts.calculateLegendHeight(series):0;var chartOptions={chart:{type:self.highchartsChartType,width:SM.Highcharts.calculateChartWidth(self.highchartsChartType,{numSeries:numSeries,numXAxisLabels:numXAxisLabels,isStacked:self.isStacked,isCompared:self.isCompared}),height:SM.Highcharts.calculateChartHeight(self.highchartsChartType,{answerStructures:self.answerStructures,titleHeight:titleHeight,labelHeight:labelHeight,legendHeight:legendHeight,isDistribution:self.isDistribution,isCompared:self.isCompared,isStacked:self.isStacked,isMirrored:self.isMirrored,chartIndex:chartIndex}),marginTop:SM.Highcharts.calculateMarginTop(0,titleHeight),marginBottom:SM.Highcharts.calculateMarginBottom(labelHeight,legendHeight),renderTo:$container[0]}};if(self.isPie||self.isDonut){chartOptions.chart.plotBackgroundColor='#FFF';chartOptions.chart.marginLeft=0;}
if(self.highchartsChartType==="bar"&&!self.isStacked){chartOptions.chart.marginLeft=115;}
return chartOptions;}, _buildEventOptions:function($chartContainer){var eventOptions,self=this;if(SM.App.isSharingApp()){return;}
eventOptions={chart:{events:{click:function(e){SM.CustomizeActionMenu.actionMenu.call(self,e,'background',{parent:$chartContainer});}}},plotOptions:{series:{events:{legendItemClick:function(e){e.preventDefault();SM.CustomizeActionMenu.actionMenu.call(self,e.browserEvent,'legend',{parent:$chartContainer});}},point:{events:{click:function(e){SM.CustomizeActionMenu.actionMenu.call(self,e,'dataPoint',{parent:$chartContainer});},mouseOver:SM.Highcharts.onPointMouseOver,mouseOut:SM.Highcharts.onPointMouseOut}}}}};return eventOptions;}, _buildColorOptions:function(){var self=this,options={};if(_.isEmpty(self.chartMetadata.colors)){return;}
options.colors=self.chartMetadata.colors;return options;}, _buildXAxisOptions:function(categories){var self=this,xAxisOptions={};if(_.isEmpty(categories)){xAxisOptions.labels={enabled:false};}else{xAxisOptions.categories=categories;if(_.contains(["column","line","area"],self.highchartsChartType)){SM.Object.deepUpdate(xAxisOptions,{labels:{y:25,formatter:SM.Highcharts.xAxisLabelFormatter}});}
if(_.include(["bar"],self.highchartsChartType)){SM.Object.deepUpdate(xAxisOptions,{labels:{
formatter:function(){return SM.Highcharts.formatAxisLabel(this.value,115,2);},style:{textAlign:"right"}}});}}
return xAxisOptions;},buildCategories:function(mappableItems){return _.map(mappableItems,function(item){return item.text;});}, _buildYAxisOptions:function(series){var self=this,scaleOptions,labelOptions,yAxisOptions={}; scaleOptions=self._getYAxisScaleOptions(series); labelOptions={labels:{formatter:self.scaleIsPercent?SM.Highcharts.percentageLabelFormatter:SM.Highcharts.yAxisLabelFormatter}};SM.Object.deepUpdate(yAxisOptions,scaleOptions);SM.Object.deepUpdate(yAxisOptions,labelOptions);return yAxisOptions;}, _getYAxisScaleOptions:function(series){var self=this,displayData=self.displayData,scaleOptions={},options={},dataMax,customScaleMax;if(self.scaleIsPercent){options.max=100;options.tickInterval=10;}else if(self.isStacked||(self.isArea&&!self.question.isSimple()&&!self.isWeightedAvg)){dataMax=SM.Highcharts.calculateStackedSeriesMax(series);options=SM.Highcharts.calculateYAxisMaxAndTickInterval(dataMax);}else{dataMax=SM.Highcharts.calculateSeriesMax(series);options=SM.Highcharts.calculateYAxisMaxAndTickInterval(dataMax);}
var rangeData=SM.Highcharts.calculateCustomScaleMaxRange([series],{isPercent:displayData.isPercent,isWeightedAvg:displayData.isWeightedAvg,isStacked:displayData.isStacked,isArea:displayData.isAreaChart,questionIsSimple:self.question.isSimple()});customScaleMax=self.display.getScaleMax(rangeData);if(customScaleMax){options.max=customScaleMax;}
scaleOptions.min=0;scaleOptions.max=options.max;scaleOptions.tickInterval=options.tickInterval;return scaleOptions;}, _buildPlotOptions:function(series){var self=this,numSeries=series.length,pointWidth,options={plotOptions:{series:{}}};options.plotOptions[self.highchartsChartType]={colorByPoint:self._shouldColorByPoint(numSeries),borderWidth:0,dataLabels:{enabled:self.showDataLabels,x:self.DATA_LABEL_OFFSETS[self.highchartsChartType][0],y:self.DATA_LABEL_OFFSETS[self.highchartsChartType][1]}};if(self.isStacked){options.plotOptions.series.stacking='normal'; options.plotOptions[self.highchartsChartType].dataLabels.x=0;options.plotOptions[self.highchartsChartType].dataLabels.y=0;} 
if(self.isArea){options.plotOptions.area.stacking='normal'; options.plotOptions.area.dataLabels.y=30;}
if(self.isPie||self.isDonut){options.plotOptions.pie.dataLabels={enabled:self.showDataLabels||self.chartMetadata.label_type==="labels",color:'#000000',connectorColor:'#000000'};options.plotOptions.series.dataLabels={formatter:self._formatPieChartDataLabel};if(self.isDonut){options.plotOptions.series.innerSize='40%';}
if(self._hasLegend()){options.plotOptions.pie.showInLegend=true;}} 
pointWidth=self._calculatePointWidth(series);if(pointWidth){options.plotOptions[self.highchartsChartType].pointWidth=pointWidth;}
return options;},_getNumPoints:function(series){var self=this,points,numPoints;points=_.map(series,function(s){return s.data?s.data.length:0;});if(self.isStacked){numPoints=_.max(points);}else{numPoints=_.reduce(points,function(memo,point){return memo+point;},0);}
return numPoints;},_calculatePointWidth:function(series){var self=this,numPoints=self._getNumPoints(series),pointWidth;if(self.highchartsChartType==="column"){if(numPoints<=4){pointWidth=80;}else if(numPoints<=6){pointWidth=60;}}
if(self.highchartsChartType==="bar"){if(numPoints<=4){pointWidth=50;}else if(numPoints<=6){pointWidth=40;}}
return pointWidth;},_shouldColorByPoint:function(numSeries){var self=this,shouldColorByPoint;if(numSeries===1){if(_.contains(["line","area"],self.highchartsChartType)||self.isStacked||(self.isMirrored&&!self.isCompared)||(self.isCompared&&!self.isMirrored)){shouldColorByPoint=false;}else{shouldColorByPoint=true;}}else{shouldColorByPoint=false;}
return shouldColorByPoint;}, _buildTooltipOptions:function(){var self=this,options={tooltip:{}}; if(self.showDataLabels){options.tooltip.enabled=false;}
return options;}, _buildLegendOptions:function(){var self=this,options={legend:{enabled:self._hasLegend()}};if(self._hasLegend()){options.legend.enabled=true;if(self.isPie||self.isDonut){options.legend.align="center";}else{options.legend.x=75;options.legend.align="left";options.legend.width=514;}}
return options;}, _hasTitle:function(){var self=this;return self.questionType==="menu_matrix"||(self.questionType==="compare"&&self.questionFamily==="matrix");},_hasLegend:function(){var self=this;if((self.isPie||self.isDonut)&&self.chartMetadata.label_type!=="legend"){return false;}
return((self.questionType==="simple"&&self.isStacked)||self.questionType==="matrix"||self.questionType==="menu_matrix"||self.questionType==="compare"||((self.isPie||self.isDonut)&&self.chartMetadata.label_type==="legend"))&&!self.isWeightedAvg;},_isVertical:function(){var self=this;if(!self.highchartsChartType){throw"_isVertical requires highchartsChartType to be set";}
return _.contains(["column","area","line"],self.highchartsChartType);},
_formatDataLabel:function(){var options=this.series.options.__options,scaleType=options.scaleType,decimalPlaces=options.decimalPlaces; if(this.y===0){return null;}
return SM.Highcharts.formatYValue(this.y,scaleType,decimalPlaces);},_formatPieChartDataLabel:function(){var options=this.series.options.__options,shouldShowDataLabels=options.showDataLabels,hasLegend=options.isLegend,name,absoluteY,percentageY;name=SM.Highcharts.formatTextualAxisLabel(this.point.name,150,4);absoluteY=this.point.absoluteY;percentageY=SM.Highcharts.formatYValue(this.point.percentageY,'percent',options.decimalPlaces);if(shouldShowDataLabels){if(hasLegend){return percentageY+'<br>'+'('+absoluteY+')';}else{return'<b>'+name+'</b> <br>'+percentageY+' ('+absoluteY+')';}}else{return'<b>'+name+'</b>';}},_setDataLabelCoordinates:function(series,yAxisOptions,chartOptions){var self=this,chartType=chartOptions.type,plotAreaHeight=chartOptions.height-chartOptions.marginTop-chartOptions.marginBottom,yAxisMax=yAxisOptions.max,label,labelLength,decimalPlaces;
 if(self.isStacked){return;}
_.each(series,function(seriesItem,i){_.each(seriesItem.data,function(data,j){if(typeof data==="number"){label=SM.Highcharts.formatYValue(data,self.scaleType,self.decimalPlaces);labelLength=label.length;if(self._shouldPlaceLabelInsidePoint(labelLength,data.y,yAxisMax,chartType,plotAreaHeight)){series[i].data[j]={y:data,dataLabels:self._buildDataLabelCoordinateOptions(labelLength)};}}else if(typeof data==="object"){if(data.y){label=SM.Highcharts.formatYValue(data.y,self.scaleType,self.decimalPlaces);labelLength=label.length;if(self._shouldPlaceLabelInsidePoint(labelLength,data.y,yAxisMax,chartType,plotAreaHeight)){data.dataLabels=self._buildDataLabelCoordinateOptions(labelLength);}}}});});}, _shouldPlaceLabelInsidePoint:function(labelLength,yValue,yAxisMax,chartType,plotAreaHeight){var self=this;if(self.isVertical){return SM.Highcharts.DATA_LABEL_CHARACTER_HEIGHT+ Math.abs(self.DATA_LABEL_OFFSETS[chartType][1])+
SM.Highcharts.DATA_LABEL_PADDING>((yAxisMax-yValue)/yAxisMax)*plotAreaHeight;}else{return labelLength*SM.Highcharts.DATA_LABEL_CHARACTER_WIDTH+
self.DATA_LABEL_OFFSETS[chartType][0]+
SM.Highcharts.DATA_LABEL_PADDING>((yAxisMax-yValue)/yAxisMax)*SM.Highcharts.PLOT_AREA_WIDTH;}},

_buildDataLabelCoordinateOptions:function(labelLength){var self=this,x,y,characterWidth=10,minOffset=30;x=self.isVertical?0:Math.min(-labelLength*characterWidth,-minOffset);y=self.isVertical?Math.max(-labelLength*characterWidth,minOffset):0;return{x:x,y:y};}}));SM.SummaryTableContainerView=SM.Views.register({__NAME:"SummaryTableContainerView",__templateID:"summary-table-container-template", __create:function(options){var self=this;self.survey=options.survey;self.question=options.question;self.rollup=self.question.getRollup();self.display=self.rollup.display;self.tableViewType=options.tableViewType;self.hasBenchmarkingOptions=options.hasBenchmarkingOptions;self.isExport=options.isExport;self.randomAssignmentOption=options.randomAssignmentOption;self._showingBenchmark=false;self.benchmarkRollup=self.question.page.survey.getBenchmarkRollup(self.question.ID);_.bindAll(this,'_onTableDisplayChange','_onDisplaySaving','_setHighlightedLabelCell','_unsetHighlightedLabelCell');},__init:function(){var self=this;self.bindModel(self.display,"displayChange",{self:self},self._onTableDisplayChange);self.bindModel(self.display,"tempDisplayChange",{self:self},self._onTableDisplayChange);self.bindModel(self.display,"allDisplaysChange",{self:self},self._onTableDisplayChange);self.bindModel(self.display,"saving",{self:self},self._onDisplaySaving);if(self.benchmarkRollup){self.bindModel(self.benchmarkRollup,'benchmarkRollupLoaded',{self:self},self._onBenchmarkRollupLoaded);self.bindModel(self.benchmarkRollup,'revertBenchmarkRollup',{self:self},self._onRevertBenchmarkRollup);}
self.$el.on("setHighlightedLabelCell",self._setHighlightedLabelCell);}, __afterRender:function(){var self=this,tableView,tableViewType;if(self._shouldHideTable()){return;}
try{tableViewType=self._getTableViewType();tableView=SM.Views.create(tableViewType,{question:self.question,highlightedDimensionID:self.highlightedDimensionID,isExport:self.isExport});self.$el.html(tableView.el);}catch(exception){self._handleRenderingError(exception);}},_hasBenchmarking:function(){return this.hasBenchmarkingOptions&&this.survey.owner.hasBenchmarking()&&this._showingBenchmark;},_getTableViewType:function(){var self=this,tableViewType;if(self.question.isCompared()){if(self.question.isMenuMatrix()){tableViewType=SM.ComparedMenuMatrixSummaryTablesView;}else{tableViewType=SM.ComparedMatrixSummaryTableView;}}else{if(self.question.isMenuMatrix()){tableViewType=SM.MenuMatrixSummaryTablesView;}else if(self.question.isMatrix()){tableViewType=SM.MatrixSummaryTableView;}else if(self.question.isNumerical()){tableViewType=SM.NumericalSummaryTableView;}else{if(self._hasBenchmarking()){tableViewType=SM.SimpleBenchmarkTableView;}
else{tableViewType=SM.SimpleSummaryTableView;}}}
return tableViewType;},_shouldHideTable:function(){var self=this,display=self.display.getDisplayData();return!display.show_table;},_handleRenderingError:function(exception){var self=this,div;div=document.createElement("div");div.innerHTML=SM.Template.render("summary-table-display-error-template");self.$el.html(div);SM.Error.log(exception,"question summary table rendering error, QuestionID: "+self.question.ID);},_setHighlightedLabelCell:function(e){var self=this;self.highlightedDimensionID=e.answerID;},_unsetHighlightedLabelCell:function(e){var self=this;self.highlightedDimensionID=null;}, _onTableDisplayChange:function(e){var self=this;if(self.question.hasRandomAssignment()&&!!self.randomAssignmentOption){self.question.randomAssignmentOption=self.randomAssignmentOption;}
self.render();},_onDisplaySaving:function(e){var self=this;self._unsetHighlightedLabelCell();}, _onBenchmarkRollupLoaded:function(e){var self=e.data.self;self._showingBenchmark=true;self.render();},_onRevertBenchmarkRollup:function(e){var self=e.data.self;self._showingBenchmark=false;self.render();}});SM.BaseSummaryTableView=SM.Object.extend(SM.SummarySeriesFactory,{ __defaults:{tableOptions:{headingsType:null,showFooter:false,hideExpandLinks:false},seriesOptions:{},seriesData:{},labelsData:{}}, __create:function(options){var self=this;self._createAsSummarizable(options);self._buildLocalizedLabels();self._bindEvents(options.events);self._runIntegrityChecks();self.seriesOptions=self.__settings.seriesOptions;self.tableOptions=self.__settings.tableOptions;self.isExport=options.isExport;self.highlightedDimensionID=options.highlightedDimensionID;},_runIntegrityChecks:function(){var self=this;if(self.__settings.tableOptions.headingsType===undefined){throw"You must define tableOptions.headingsType as one of 'series' or 'labels'";}},_buildLocalizedLabels:function(){var self=this;self.localizedLabels={answerChoices:Globalize.localize("Answer Choices"),responses:Globalize.localize("Responses"),total:Globalize.localize("Total"),totalNumber:Globalize.localize("Total Number"),totalRespondents:Globalize.localize("Total Respondents"),averageNumber:Globalize.localize("Average Number"),averageRating:Globalize.localize("Average Rating"),averageRanking:Globalize.localize("Average Ranking")};},_bindEvents:function(options){var self=this;
_.bindAll(this,'_onCaptionClick','_onThClick','_onTdClick','_onThActionSelected','_onTAToggleLinkClick');}, __beforeRender:function(){var self=this;self._getDisplayOptions();self._getSortedSummaryData();if(self._setSeriesOptions){self._setSeriesOptions(self.get("seriesOptions"));}},__afterRender:function(){var self=this,tableOptions;self.$el.empty(); _.each(["_buildTableHeaderRowData","_buildTableBodyRowData","_buildTableFooterRowData"],function(method){if(self[method]===undefined){throw"You must define "+method+" in "+self.__NAME;}});if(self._setLabelsAndSeriesData){self._setLabelsAndSeriesData();}
tableOptions=self._getTableOptions();Hightables.renderTable(tableOptions);if(self.highlightedDimensionID){self._highlightLabelCell(self.highlightedDimensionID);}},__init:function(){var self=this;self.$el.on(SM.Event.CLICK,"[ta-toggle-link]",{self:self},self._onTAToggleLinkClick);self.$el.on("actionMenu.actionSelected","th",{self:self},self._onThActionSelected);self.$el.on("highlightLabelCell",function(e){self._highlightLabelCell(e.answerID);});self.$el.on("unHighlightLabelCell",function(e){self._unHighlightLabelCell(e.answerID);});},_highlightLabelCell:function(dimensionID){var self=this;self.$el.find(".highlight").removeClass("highlight");self.$el.find("[data-dimension-id='"+dimensionID+"']").addClass("highlight");},_unHighlightLabelCell:function(dimensionID){var self=this;self.$el.find("[data-dimension-id='"+dimensionID+"']").removeClass("highlight");}, _getTableOptions:function(){var self=this,tableData=self._getTableData(),tableClasses=self._getTableClasses(),isExport=!!self.isExport,hightablesOptions;hightablesOptions={target:self.$el,tableData:tableData,tableClasses:tableClasses,useDivs:isExport,flattenNestedTables:isExport,events:{thClick:self._onThClick,tdClick:self._onTdClick}};return hightablesOptions;},_getTableData:function(options){var self=this,options=options||{},captionData,theadRowData,tbodyRowData,tfootRowData;if(self._buildTableCaptionData){captionData=self._buildTableCaptionData(options);}
tbodyRowData=self._buildTableBodyRowData(options);theadRowData=self._buildTableHeaderRowData(options);tfootRowData=self._buildTableFooterRowData(options);return{caption:captionData,thead:{rows:theadRowData},tbody:{rows:tbodyRowData},tfoot:{rows:tfootRowData}};},_getTableLabelsData:function(mappableItems){var self=this,question=self.question,summary,labelsData,labelData,responsesCount;labelsData=_.map(mappableItems,function(item){labelData={dimensionID:item.id,labelText:item.text};if(item.mediaHTML){labelData.labelHTML=item.mediaHTML;}
if(self._labelCellHasComments(item)&&self._shouldShowCommentsInLabelCell()){summary=self.summary.summary.options[item.id];if(!!question.randomAssignmentOption){labelData.variationID=self.question.randomAssignmentOption.toString();if(self.questionFamily=="demographic"){summary=self.summary.summary.options[question.randomAssignmentOption];}}else{labelData.variationID="0";}
if(summary){responsesCount=summary.count;}else{responsesCount=0;}
labelData.hasComments=true;labelData.optionID=item.id;labelData.responsesCount=responsesCount;}
return labelData;});return labelsData;},_labelCellHasComments:function(item){var self=this;return self.question.isNumerical()||self.question.isOpenEnded()||(item.is_openended&&item.is_answer);},_shouldShowCommentsInLabelCell:function(){var self=this;return!self.isCompared;},_getTableHeaderRowDataForLabels:function(options){var self=this,labelsData=options.labelsData,includeBlankCell=options.includeBlankCell,rows=[],row={},cells=[],cell,cssClasses,numTableRows,isSortable;numTableRows=self.numRows;isSortable=numTableRows>1;if(includeBlankCell){cell=self._buildBlankTableHeaderCell({isSortable:isSortable});cells.push(cell);}
_.each(labelsData,function(labelData){cssClasses=self._getTableHeaderCellCSSClasses(isSortable,labelData.dimensionType);cell={template:"table-header-cell",context:{labelText:labelData.text,classes:cssClasses,dimensionType:labelData.dimensionType, hideMenu:labelData.hideMenu,variationID:"0"}};cells.push(cell);});row.cells=cells;rows.push(row);return rows;},_getTableHeaderRowDataForSeries:function(options){var series=options.series,includeBlankCell=options.includeBlankCell,scopedDimensionID=options.scopedDimensionID;var self=this,rows=[],cells=[],row={},cell,cssClasses,numTableRows,isSortable;numTableRows=series[0].data.length;isSortable=numTableRows>1;if(includeBlankCell){cell=self._buildBlankTableHeaderCell({scopedDimensionID:scopedDimensionID,isSortable:isSortable});cells.push(cell);} 
var itemOptions,dimensionType,dimensionID;_.each(series,function(seriesItem){itemOptions=seriesItem.__options;dimensionType=itemOptions.dimensionType;dimensionID=itemOptions.dimensionID;cssClasses=self._getTableHeaderCellCSSClasses(isSortable,dimensionType,dimensionID,scopedDimensionID);cell={template:"table-header-cell",context:{labelText:itemOptions.labelText,labelHTML:itemOptions.labelHTML,classes:cssClasses,dimensionType:dimensionType,dimensionID:dimensionID,hasCommentsPerRow:itemOptions.hasCommentsPerRow,optionID:dimensionID,variationID:"0",responsesCount:itemOptions.numComments,columnHasComments:itemOptions.numComments>0,colSpan:itemOptions.colSpan}};cells.push(cell);});row.cells=cells;rows.push(row);return rows;},_buildBlankTableHeaderCell:function(options){var self=this,cssClasses,dimensionType,scopedDimensionID=options.scopedDimensionID,isSortable=options.isSortable;dimensionType="labels";cssClasses=self._getTableHeaderCellCSSClasses(isSortable,dimensionType,null,scopedDimensionID);return{template:"table-header-blank-cell",context:{classes:cssClasses,dimensionType:dimensionType}};},_getTableBodyRowData:function(options){var self=this,rows=[],row,cells,cell,labelsData=options.labelsData,series=options.series;_.each(labelsData,function(labelData,tableRowIndex){cells=[]; cell=self._buildLabelCell(labelData);cells.push(cell); _.each(series,function(seriesItem){cell=self._buildSeriesCell(seriesItem,tableRowIndex);cells.push(cell);});row={cells:cells};rows.push(row);});return rows;},_buildLabelCell:function(labelData){return{template:"table-label-cell",context:labelData};},_buildSeriesCell:function(seriesItem,tableRowIndex){var self=this,seriesData,dimensionType,context={},template;seriesData=seriesItem.data[tableRowIndex];dimensionType=seriesItem.__options.dimensionType;template=seriesItem.__options.template||"table-response-cell";context.numResponses=self._formattedNumResponses(seriesData.absoluteY,dimensionType);if(self._shouldIncludePercentageData(dimensionType)){context.percentage=self._formattedPercentage(seriesData.percentageY);}

 
if(seriesData.__options&&seriesData.__options.commentData){var commentData=seriesData.__options.commentData;context.hasComments=true;context.numComments=commentData.numComments;context.optionID=commentData.optionID;context.crossedOptionID=commentData.crossedOptionID;context.matrixCrossTab=commentData.matrixCross;context.variationID=commentData.variationID||"0";}
return{template:template,context:context};},_formattedNumResponses:function(numResponses){var formatType=SM.Highcharts.getGlobalizeFormatType("absolute",this.decimalPlacesAbsolute);return Globalize.format(numResponses,formatType);},_formattedPercentage:function(value){var formatType=SM.Highcharts.getGlobalizeFormatType("percent",this.decimalPlacesPercentage);return Globalize.format(value/100,formatType);},_shouldIncludePercentageData:function(dimensionType){return!_.include(["totals","averageRating","averageNumber","responses"],dimensionType);},_getTableFooterRowData:function(options){var self=this,rows=[],row;if(self.question.isSimple()){row={template:"simple-table-footer-row",context:{questionIsMultiResponse:self.question.isMultiResponse(),numRespondents:Globalize.format(self.rollup.answered,"n0")}};rows.push(row);}else if(self.question.isNumerical()){row={template:"numerical-table-footer-row",context:{numRespondents:Globalize.format(self.rollup.answered,"n0")}};rows.push(row);}
if(self._shouldShowCommentsRow()){row={template:"table-footer-comments-row",context:{colSpan:options.colSpan,optionID:options.optionID,variationID:options.variationID,hasComments:options.hasComments,numComments:options.numComments}};rows.push(row);}
return rows;},_shouldShowCommentsRow:function(){var self=this;if(self.isExport){return false;}
return self._hasCommentField()&&!self._commentFieldIsAnswer()&&!self._hasCommentFieldPerRow();}, _getTableClasses:function(){var self=this,classes=[];classes.push("sm-data-table"); if(SM.App.isSharingApp()){classes.push("shared");}
if(self.questionType==="simple"){classes.push("sm-data-table-summary");}else if(self.questionType==="matrix"||self.questionType==="menu_matrix"||self.question.isCompared()){classes.push("sm-matrix-table");}
return classes.join(" ");},_getTableHeaderCellCSSClasses:function(isSortable,dimensionType,dimensionID,scopedDimensionID){var self=this,cssClasses=[],sortData;sortData=self._getSortData(scopedDimensionID);if(isSortable){cssClasses.push("sortable");}
if(_.contains(["totals","averageRating","averageNumber","averageRanking"],dimensionType)){cssClasses.push(dimensionType);} 
if(sortData.dimensionType===dimensionType){if(dimensionID){if(sortData.dimensionID===dimensionID){cssClasses.push(sortData.order);}}else{cssClasses.push(sortData.order);}}
return cssClasses.join(" ");},
_hasCommentField:function(){var self=this;return!!self.question.commentField;},_commentFieldIsAnswer:function(){var self=this;return!!self.question.commentField.is_answer;},_hasCommentFieldPerRow:function(){var self=this;return self._hasCommentField()&&self.question.commentField.apply_all_rows;},


_getSortData:function(scopedDimensionID){var self=this,sortData;if(scopedDimensionID){sortData=self.displayData.sort_data[scopedDimensionID];}else{sortData=self.displayData.sort_data;}
return sortData;}, _onCaptionClick:function(e){var self=this,$currentTarget=$(e.currentTarget),dimensionID=$currentTarget.attr('data-dimension-id'),actionMenuOptions={};actionMenuOptions.answerID=dimensionID;SM.CustomizeActionMenu.actionMenu.call(self,e,'caption',actionMenuOptions);},_onThClick:function(e){var self=this,$currentTarget=$(e.currentTarget),dimensionType=$currentTarget.attr('data-dimension-type'),dimensionID=$currentTarget.attr('data-dimension-id'),actionMenuOptions={parent:$currentTarget,visibleOptions:{}};
if(_.isEmpty(dimensionType)){return;} 
if(SM.App.isSharingApp()){return;}

if(_.contains(["labels","totals","averageRating","averageNumber","responses"],dimensionType)){actionMenuOptions.visibleOptions.labels=false;}else{actionMenuOptions.visibleOptions.labels=true;} 
if(dimensionType==="labels"){actionMenuOptions.visibleOptions.number=false;}else{actionMenuOptions.visibleOptions.number=true;}
actionMenuOptions.answerID=dimensionID;SM.CustomizeActionMenu.actionMenu.call(self,e,'th',actionMenuOptions);},_onThActionSelected:function(e){var self=this,$target=$(e.target),$cell=$target,$table=$cell.parents('table').eq(0),dimensionType=$cell.attr("data-dimension-type"),dimensionID=$cell.attr("data-dimension-id"),scopedDimensionID,scopedDimensionType,sortOrder; if(_.contains(['unsorted','ascending','descending'],e.action)){sortOrder=e.action; if($table.attr("data-dimension-id")){scopedDimensionID=$table.attr("data-dimension-id");scopedDimensionType=$table.attr("data-dimension-type");}
self.rollup.display.sort(dimensionType,dimensionID,sortOrder,scopedDimensionType,scopedDimensionID);}},_onTdClick:function(e){var self=this,$target=$(e.target),$currentTarget=$(e.currentTarget),dimensionID,actionMenuOptions={}; if(SM.App.isSharingApp()){return;}
if($currentTarget.parents('tfoot').length){return;} 
if($target.is("a")){return;} 
dimensionID=$currentTarget.attr("data-dimension-id");if(dimensionID){actionMenuOptions.answerID=dimensionID;SM.CustomizeActionMenu.actionMenu.call(self,e,'td',actionMenuOptions);}}, _onTAToggleLinkClick:function(e){e.preventDefault();var self=this,visibilityAttr="ta-visible",visibilityClass="ta-visible",$target=$(e.target),$cell,$prevCell,taIsVisible;if(self.question.hasCommentsPerRow()&&!self.question.isCompared()&&self.isMirrored){$cell=$target.parents('th:eq(0)');}else{$cell=$target.parents('td:eq(0)');}
$prevCell=$target.closest('tr').find('['+visibilityAttr+'=true]').not($cell);taIsVisible=$cell.attr(visibilityAttr)==="true";
 if($prevCell.length){$prevCell.attr(visibilityAttr,"false");$prevCell.removeClass(visibilityClass);self._hideTARowView($prevCell);}
 
if(taIsVisible){self._hideTARowView($target);$cell.attr(visibilityAttr,"false");$cell.removeClass(visibilityClass);}else{self._expandTARowView($target);$cell.attr(visibilityAttr,"true");$cell.addClass(visibilityClass);}},_expandTARowView:function($target){var self=this,optionID=$target.attr("option-id"),variationID=$target.attr("variation-id"), crossedOptionID=$target.attr("crossed-option-id"), matrixCrossTab=$target.attr("matrix-crosstab"), count=$target.data("responseCount"),taModel,taRowView,$row=$target.closest("tr");taModel=self.rollup.getTaModel(optionID,crossedOptionID);if(!taModel){taModel=self.rollup.createTaModel(optionID,crossedOptionID,matrixCrossTab,variationID);}
taModel.set("filterCount",count);taRowView=SM.Views.create(SM.SummaryTaRowView,{model:taModel});$row.after(taRowView.el);},_hideTARowView:function($target){var $row=$target.closest("tr"),taRow=$row.next()[0];$row.parent()[0].removeChild(taRow);}});SM.SimpleSummaryTableView=SM.Views.extend(SM.BaseSummaryTableView,{__NAME:"SimpleSummaryTableView",__templateID:"summary-table-template",_buildTableHeaderRowData:function(){var self=this,headerRowData,labelsData;labelsData=[{text:self.localizedLabels.answerChoices,dimensionType:self.DIMENSION_TYPES.LABELS},{text:self.localizedLabels.responses,dimensionType:self.DIMENSION_TYPES.RESPONSES}];headerRowData=self._getTableHeaderRowDataForLabels({labelsData:labelsData});return headerRowData;},_buildTableBodyRowData:function(){var self=this,bodyRowData,rows=self.sortedRowsList[0],labelsData,seriesData; labelsData=self._getTableLabelsData(rows);seriesData=self.buildSimpleSeries(self.seriesOptions);bodyRowData=self._getTableBodyRowData({labelsData:labelsData,series:seriesData});return bodyRowData;},_buildTableFooterRowData:function(){var self=this,footerRowData,footerOptions,numComments;footerOptions={colSpan:2};if(self._hasCommentField()&&!self._commentFieldIsAnswer()){numComments=self.summary.other_option||0;var variationID="0";if(self.question.randomAssignmentOption){variationID=self.question.randomAssignmentOption.toString();}
_.extend(footerOptions,{optionID:self.question.commentField.id,variationID:variationID,hasComments:numComments>0,numComments:numComments});}
footerRowData=self._getTableFooterRowData(footerOptions);return footerRowData;}});SM.NumericalSummaryTableView=SM.Views.extend(SM.BaseSummaryTableView,{__NAME:"NumericalSummaryTableView",__templateID:"summary-table-template",_setSeriesOptions:function(seriesOptions){var self=this;seriesOptions.averageSeriesName=self.localizedLabels.averageNumber;seriesOptions.totalSeriesName=self.localizedLabels.totalNumber;seriesOptions.responsesSeriesName=self.localizedLabels.responses;},_buildTableHeaderRowData:function(){var self=this,headerRowData,labelsData;labelsData=[{text:self.localizedLabels.answerChoices,dimensionType:self.DIMENSION_TYPES.LABELS},{text:self.localizedLabels.averageNumber,dimensionType:self.DIMENSION_TYPES.AVERAGE_NUMBER},{text:self.localizedLabels.totalNumber,dimensionType:self.DIMENSION_TYPES.TOTALS},{text:self.localizedLabels.responses,dimensionType:self.DIMENSION_TYPES.RESPONSES}];headerRowData=self._getTableHeaderRowDataForLabels({labelsData:labelsData});return headerRowData;},_buildTableBodyRowData:function(){var self=this,bodyRowData,rows=self.sortedRowsList[0], labelsData,seriesData,seriesOptions=self.get("seriesOptions");seriesData=self.buildNumericalSeries(seriesOptions);labelsData=self._getTableLabelsData(rows);bodyRowData=self._getTableBodyRowData({labelsData:labelsData,series:seriesData});return bodyRowData;},_buildTableFooterRowData:function(){var self=this,footerRowData;footerRowData=self._getTableFooterRowData({colSpan:4});return footerRowData;}});SM.MatrixSummaryTableView=SM.Views.extend(SM.BaseSummaryTableView,{__NAME:"MatrixSummaryTableView",__templateID:"summary-table-template",_setSeriesOptions:function(seriesOptions){var self=this;seriesOptions.includeTotal=true;if(self.question.isMultiResponse()){seriesOptions.totalSeriesName=self.localizedLabels.totalRespondents;}else{seriesOptions.totalSeriesName=self.localizedLabels.total;}
if(self.question.isRating()||self.question.isRanking()){seriesOptions.includeAverage=true;if(self.question.isRating()){seriesOptions.averageSeriesName=self.localizedLabels.averageRating;}else{seriesOptions.averageSeriesName=self.localizedLabels.averageRanking;}}},_setLabelsAndSeriesData:function(){var self=this,sortedRows,sortedColumns,seriesOptions=self.get("seriesOptions");
 if(self.isMirrored){sortedColumns=self.sortedColumnsList[0];self.labelsData=self._getTableLabelsData(sortedColumns);self.seriesData=self.buildMirroredMatrixSeries(seriesOptions);}else{sortedRows=self.sortedRowsList[0];self.seriesData=self.buildMatrixSeries(seriesOptions);if(self._hasCommentFieldPerRow()){self.labelsData=self._getCommentsPerRowTableLabelsData(sortedRows);}else{self.labelsData=self._getTableLabelsData(sortedRows);}}},_getCommentsPerRowTableLabelsData:function(rows){var self=this,summary,cell,responsesCount;return _.map(rows,function(row){summary=self.summary.summary.options[row.id];responsesCount=(summary&&summary.row_other)?summary.row_other:0;cell={labelText:row.text,labelHTML:row.mediaHTML,hasCommentsPerRow:true,optionID:row.id,responsesCount:responsesCount,rowHasComments:responsesCount>0};return cell;});},_buildTableHeaderRowData:function(){var self=this,headerRowData;headerRowData=self._getTableHeaderRowDataForSeries({series:self.seriesData,includeBlankCell:true});return headerRowData;},_buildTableBodyRowData:function(){var self=this,bodyRowData;bodyRowData=self._getTableBodyRowData({labelsData:self.labelsData,series:self.seriesData});return bodyRowData;},_buildTableFooterRowData:function(){var self=this,footerRowData,footerOptions;if(self._hasCommentField()&&!self._hasCommentFieldPerRow()){var numComments=self.summary.other_option||0,colSpan=self.seriesData.length+1;footerOptions={colSpan:colSpan,optionID:self.question.commentField.id,variationID:self.question.randomAssignmentOption,hasComments:numComments>0,numComments:numComments};footerRowData=self._getTableFooterRowData(footerOptions);return footerRowData;}}});SM.BaseMenuMatrixSummaryTablesView=SM.Views.extend(SM.BaseSummaryTableView,{__NAME:"BaseMenuMatrixSummaryTablesView",__templateID:"summary-table-template",_setSeriesOptions:function(seriesOptions){var self=this;seriesOptions.includeTotal=true;seriesOptions.totalSeriesName=self.localizedLabels.total;seriesOptions.averageSeriesName=self.localizedLabels.averageNumber;},

__afterRender:function(){var self=this,tableOptions;self.$el.empty();


if(!self.dimensionalSplitKey){throw"You must define self.dimensionalSplitKey for menu-matrix questions";}
_.each(self[self.dimensionalSplitKey],function(scopedDimension,scopedDimensionIndex){self._setLabelsAndSeriesData(scopedDimension,scopedDimensionIndex);tableOptions=self._getTableOptions(scopedDimension,scopedDimensionIndex);Hightables.renderTable(tableOptions);});if(self._hasOtherCommentsTable()){self._renderOtherCommentsTable();}
if(self.highlightedDimensionID){self._highlightLabelCell(self.highlightedDimensionID);}},_getTableOptions:function(scopedDimension,scopedDimensionIndex){var self=this,tableData=self._getTableData({scopedDimension:scopedDimension,scopedDimensionIndex:scopedDimensionIndex}),tableClasses=self._getTableClasses(),isExport=!!self.isExport,hightablesOptions,$target;

$target=$("<div></div>");self.$el.append($target);hightablesOptions={target:$target,tableData:tableData,tableClasses:tableClasses,tableAttrs:{"dimension-id":scopedDimension.id,"dimension-type":scopedDimension.type},events:{captionClick:self._onCaptionClick,thClick:self._onThClick,tdClick:self._onTdClick},useDivs:isExport,flattenNestedTables:isExport};return hightablesOptions;},_buildTableCaptionData:function(options){var self=this,scopedDimension=options.scopedDimension;return{template:"table-caption",context:{caption:scopedDimension.text,dimensionID:scopedDimension.id,mediaCaption:scopedDimension.mediaHTML,classes:""}};},_buildTableHeaderRowData:function(options){var self=this,headerRowData,scopedDimensionID=options.scopedDimension.id;headerRowData=self._getTableHeaderRowDataForSeries({series:self.seriesData,includeBlankCell:true,scopedDimensionID:scopedDimensionID});return headerRowData;},_buildTableBodyRowData:function(options){var self=this,bodyRowData,scopedDimensionID=options.scopedDimension.id;bodyRowData=self._getTableBodyRowData({labelsData:self.labelsData,series:self.seriesData,scopedDimensionID:scopedDimensionID});return bodyRowData;}});SM.MenuMatrixSummaryTablesView=SM.Views.extend(SM.BaseMenuMatrixSummaryTablesView,{__NAME:"MenuMatrixSummaryTablesView",dimensionalSplitKey:"columns",_setLabelsAndSeriesData:function(column,columnIndex){var self=this,seriesOptions=self.get("seriesOptions"),columnChoices,sortedColumnChoices,sortedRows;if(self.isMirrored){sortedColumnChoices=self.sortedColumnChoicesList[columnIndex];self.labelsData=self._getTableLabelsData(sortedColumnChoices);}else{sortedRows=self.sortedRowsList[columnIndex];self.labelsData=self._getTableLabelsData(sortedRows);}
columnChoices=column.items;self.seriesData=self.buildMenuMatrixSeries(column,columnIndex,columnChoices,self.columnChoiceTotalsByColumnChoice,seriesOptions);},_buildTableFooterRowData:function(options){}, _hasOtherCommentsTable:function(){var self=this;return self._hasCommentField();},_getOtherTableData:function(){var self=this,numComments=self.summary.other_option||0;return{optionID:self.question.commentField.id,hasComments:numComments>0,numComments:numComments,variationID:"0"};},_renderOtherCommentsTable:function(){var self=this,otherTableData=self._getOtherTableData();self.$el.append(SM.Template.render("other-comments-for-menu-matrix-table",otherTableData));}});SM.ComparedMatrixSummaryTableView=SM.Views.deepExtend(SM.BaseSummaryTableView,{__NAME:"ComparedMatrixSummaryTableView",__templateID:"summary-table-template",_setSeriesOptions:function(seriesOptions){var self=this;seriesOptions.includeTotal=true;seriesOptions.totalSeriesName=self.localizedLabels.total;},_setLabelsAndSeriesData:function(){var self=this,sortedRows,sortedColumns,seriesOptions=self.get("seriesOptions");
 if(self.isMirrored){sortedColumns=self.sortedColumnsList[0];self.labelsData=self._getTableLabelsData(sortedColumns);self.seriesData=self.buildMirroredMatrixSeries(seriesOptions);}else{sortedRows=self.sortedRowsList[0];self.seriesData=self.buildMatrixSeries(seriesOptions);self.labelsData=self._getTableLabelsData(sortedRows);}},_buildTableHeaderRowData:function(){var self=this,headerRowData;headerRowData=self._getTableHeaderRowDataForSeries({series:self.seriesData,includeBlankCell:true});return headerRowData;},_buildTableBodyRowData:function(){var self=this,bodyRowData;bodyRowData=self._getTableBodyRowData({labelsData:self.labelsData,series:self.seriesData});return bodyRowData;},_buildTableFooterRowData:function(){var self=this,footerRowData,footerOptions={};if(self._hasCommentField()&&!self._commentFieldIsAnswer()){footerOptions.showComments=true;}
footerRowData=self._getTableFooterRowData(footerOptions);return footerRowData;},_getTableFooterRowData:function(options){var self=this,tfootRowData=[],totalsRowData,commentsRowData;totalsRowData=self._getTableFooterTotalsRowData();tfootRowData.push(totalsRowData);if(options.showComments){if(self.isMirrored){commentsRowData=self._getMirroredTableFooterCommentsRowData();tfootRowData.push(commentsRowData);}else{commentsRowData=self._getTableFooterCommentsRowData(); tfootRowData.push(commentsRowData);}}
return tfootRowData;},_getTableFooterTotalsRowData:function(){var self=this,totals,tableRow,tableCells=[],tableCell;tableCell={template:"table-label-cell",context:{labelText:self.localizedLabels.totalRespondents}};tableCells.push(tableCell); if(self.isMirrored){totals=_.map(self.rows,function(row){return self.respondentCountsByRow[row.id];});}else{totals=_.map(self.columns,function(column){return self.respondentCountsByColumn[column.id];});}
_.each(totals,function(total){tableCell={template:"table-footer-total-cell",context:{total:total}};tableCells.push(tableCell);}); tableCell={template:"table-footer-total-cell",context:{total:self.summary.answered}};tableCells.push(tableCell);tableRow={cells:tableCells};return tableRow;},_getTableFooterCommentsRowData:function(){var self=this,rollup=self.question.getRollup(),otherSummary,sortedColumns=self.sortedColumnsList[0],matrixCross,numComments,totalComments=0,tableRow,tableCells=[],tableCell,summary;try{otherSummary=rollup.options.other_option.options;}catch(e){}
matrixCross=rollup.summary.crossed_cols?"1":"0"; tableCell={template:"table-label-cell",context:{labelText:self.question.commentField.text}};tableCells.push(tableCell); _.each(sortedColumns,function(column){if(otherSummary&&otherSummary[column.id]){summary=otherSummary[column.id];numComments=summary.count;}else{numComments=0;}
totalComments+=numComments;tableCell={template:"table-footer-comment-cell",context:{hasComments:numComments>0,numComments:numComments,optionID:self.question.commentField.id,crossedOptionID:column.id,matrixCrossTab:matrixCross,responsesCount:numComments}};tableCells.push(tableCell);}); tableCell={template:"table-footer-total-cell",context:{total:totalComments}};tableCells.push(tableCell);tableRow={cells:tableCells};return tableRow;},_getMirroredTableFooterCommentsRowData:function(){var self=this,rollup=self.question.getRollup(),otherSummary,sortedColumns=self.sortedColumnsList[0],tableBodyRowData=[],tableRow,tableCells,numComments,matrixCross,colSpan;try{otherSummary=rollup.options.other_option.options}catch(e){}
matrixCross=rollup.summary.crossed_cols?"1":"0";_.each(sortedColumns,function(column){if(otherSummary&&otherSummary[column.id]){numComments=otherSummary[column.id].count;}else{numComments=0;} 
if(matrixCross==="2"){variationID=column.id||0;variationID.toString();}else{variationID="0";}
tableCells=[{labelText:column.text,numComments:numComments,hasComments:numComments>0,optionID:self.question.commentField.id,crossedOptionID:column.id,matrixCrossTab:matrixCross,variationID:variationID}];tableRow={cells:tableCells};tableBodyRowData.push(tableRow);}); colSpan=self.numRows+2;return{template:"mirrored-compared-other-comments-for-matrix-table",context:{otherFieldLabel:self.question.commentField.text,rows:tableBodyRowData,colSpan:colSpan,variationID:"0"}};}});SM.ComparedMenuMatrixSummaryTablesView=SM.Views.extend(SM.BaseMenuMatrixSummaryTablesView,{__NAME:"ComparedMenuMatrixSummaryTablesView",dimensionalSplitKey:"rows",_setLabelsAndSeriesData:function(row,rowIndex){var self=this,seriesOptions,columnChoices,sortedColumnChoices,sortedColumns,columnChoiceTotals;seriesOptions=self.get("seriesOptions");columnChoices=row.items;if(self.isMirrored){sortedColumnChoices=self.sortedColumnChoicesList[rowIndex];self.labelsData=self._getTableLabelsData(sortedColumnChoices);}else{sortedColumns=self.sortedColumnsList[rowIndex];self.labelsData=self._getTableLabelsData(sortedColumns);}
columnChoiceTotals=self.columnChoiceTotalsByRow[row.id];self.seriesData=self.buildComparedMatrixSeries(row,columnChoices,columnChoiceTotals,seriesOptions);},_buildTableFooterRowData:function(options){},

_hasOtherCommentsTable:function(){var self=this;return self._hasCommentField()&&!self._commentFieldIsAnswer()&&!self._hasCommentFieldPerRow();},_crossedOptionInOtherSummary:function(otherSummary,crossedOptionID){var self=this;column=_.find(otherSummary,function(row){return crossedOptionID in row;});return column[crossedOptionID];},_getOtherTableData:function(){var self=this,rollup=self.question.getRollup(),otherSummary,labelsData=[],labelData,cellsData=[],cellData,numComments,totalNumComments=0,matrixCross,colSpan;try{otherSummary=rollup.options.other_option.options.other_option.options;}catch(error){}
matrixCross=rollup.summary.crossed_cols?"1":"0";_.each(self.crossedOptions,function(crossedOption){labelData={text:crossedOption.text};labelsData.push(labelData);if(otherSummary){if(otherSummary[crossedOption.id]){numComments=otherSummary[crossedOption.id].count;}else if(self._crossedOptionInOtherSummary(otherSummary,crossedOption.id)){numComments=self._crossedOptionInOtherSummary(otherSummary,crossedOption.id).count}}else{numComments=0;}
variationID=crossedOption.variable_id||0;variationID=variationID.toString();totalNumComments+=numComments;cellData={hasComments:numComments>0,numComments:numComments,optionID:self.question.commentField.id,crossedOptionID:crossedOption.id,matrixCrossTab:matrixCross,variationID:variationID};cellsData.push(cellData);}); if(self.isMirrored){colSpan=self.columns.length+2;}else{colSpan=self.crossedOptions.length+2;}
return{crossedOptionLabels:labelsData,otherOptionLabel:self.question.commentField.text,crossedOptionCells:cellsData,totalNumComments:totalNumComments,colSpan:colSpan};},_renderOtherCommentsTable:function(){var self=this,otherTableData=self._getOtherTableData();self.$el.append(SM.Template.render("compared-other-comments-for-menu-matrix-table",otherTableData));}});SM.SimpleBenchmarkTableView=SM.Views.extend(SM.BaseSummaryTableView,{__NAME:"SimpleBenchmarkTableView",__templateID:"summary-table-template",_buildTableHeaderRowData:function(){var self=this,headerRowData,labelsData;labelsData=[{text:self.localizedLabels.dataSegment,dimensionType:self.DIMENSION_TYPES.DATA_SEGMENT,hideMenu:true},{text:self.localizedLabels.min,dimensionType:self.DIMENSION_TYPES.MIN,hideMenu:true},{text:self.localizedLabels.lowerQuartile,dimensionType:self.DIMENSION_TYPES.LOWER_QUARTILE,hideMenu:true},{text:self.localizedLabels.median,dimensionType:self.DIMENSION_TYPES.MEDIAN,hideMenu:true},{text:self.localizedLabels.upperQuartile,dimensionType:self.DIMENSION_TYPES.UPPER_QUARTILE,hideMenu:true},{text:self.localizedLabels.max,dimensionType:self.DIMENSION_TYPES.MAX,hideMenu:true}];headerRowData=self._getTableHeaderRowDataForLabels({labelsData:labelsData});return headerRowData;},_buildLocalizedLabels:function(){var self=this;self.localizedLabels={dataSegment:Globalize.localize("Data Segment"),min:Globalize.localize("Min"),lowerQuartile:Globalize.localize("Lower Quartile"),median:Globalize.localize("Median"),upperQuartile:Globalize.localize("Upper Quartile"),max:Globalize.localize("Max")};}, _formattedNumResponses:function(numResponses){var formatType=SM.Highcharts.getGlobalizeFormatType("absolute",2);return Globalize.format(numResponses,formatType);},_buildTableBodyRowData:function(){var self=this,bodyRowData,benchmarkRollup=self.question.page.survey.getBenchmarkRollup(self.question.ID),labelsData,seriesData=self.buildSimpleBenchmarkSeries({colors:['#000','#000'],tableOutput:true});labelsData=[{labelText:Globalize.localize('SurveyMonkey Average')}]; bodyRowData=self._getTableBodyRowData({labelsData:labelsData,series:seriesData});return bodyRowData;},_buildTableFooterRowData:function(){var self=this,footerRowData,footerOptions,benchmarkRollup=self.question.page.survey.getBenchmarkRollup(self.question.ID);
footerOptions={colSpan:6};footerRowData=[{context:{responseMean:Globalize.format(benchmarkRollup.getResponseMean(),"n2")},template:'simple-benchmark-table-footer-row'}];return footerRowData;}});SM.SummaryTaRowView=SM.Views.register({__NAME:"SummaryTaRowView",__templateID:"summary-ta-row-template",__model:"taModel",__init:function(){if(!this.taModel.hasLoaded()){this.taModel.on("loaded",{self:this},this._onLoaded);this.taModel.fetch();}},__destroy:function(){this.taModel.off("loaded",this._onLoaded);},__beforeRender:function(){return{isLoading:!this.taModel.hasLoaded()};},__afterRender:function(){var view;if(this.taModel.hasLoaded()){view=SM.Views.create(SM.TaContainerView,{model:this.taModel});this.$el.find("td").append(view.el);}},_onLoaded:function(e){e.data.self.render();}});SM.SummaryQuestionViewContainer=SM.Views.register({ __NAME:"summaryQuestionViewContainer",__templateID:"summary-question-container-template",__model:"question",nestedQuestionDict:{}, __create:function(options){this.questionViewProto=options.questionViewProto;}, __beforeRender:function(){var self=this,question=this.question,rollup=question.getRollup(),hasRollupLoaded=question.hasRollupLoaded(),survey=question.page.survey,currentUserID=survey.currentUserID,questionViewProto=this.questionViewProto,questionHeading;if(hasRollupLoaded){ self._showingBenchmark=rollup.display.isBenchmarkShown();if(question.hasRandomAssignment()&&question.isPresentation()){questionHeading=question.heading;}
return{isVisible:!question.isAfterLastLoadedRollup()&&hasRollupLoaded&&question.isShown(),question:question,questionHeading:questionHeading,encryptedID:self.question.page.survey.encryptedID,userID:currentUserID,hasTable:questionViewProto._hasTableView,hasChart:questionViewProto._hasChartView,hasBenchmarking:self._hasBenchmarking(),exportEnabled:survey.isExportFormatTypeEnabled('png','chart')};}else{return{isVisible:!question.isAfterLastLoadedRollup()&&hasRollupLoaded&&question.isShown(),question:question}}},__afterRender:function(md){var self=this,question=this.question,hasRandomAssignment=question.hasRandomAssignment();if(md.isDisabledQuestionType||!md.isVisible){return;}
self.$questionContent=this.$el.find("[sm-questionview-content-container]");if(hasRandomAssignment){self._renderRandomAssignmentQuestionViews();}else{self._renderQuestionView();}
if(!SM.App.isSharingApp()){self.$el.find(".share-btn").popout();}
if(this._shouldShowExportBtn()){self.$el.find("[export-btn]").append(SM.Views.create(SM.ExportAllBtnView,{model:self.question.page.survey,noBorder:false,singleMode:true,question:self.question,hasChartView:self.question.hasChartView()}).el);} 
self._showOrHideButtons(0,'','');self.$el.find('[benchmark-sub-heading]').hide();},_renderQuestionView:function(){var self=this;self.questionView=SM.Views.create(self.questionViewProto,{model:self.question});self.$questionContent.append(self.questionView.el);},



_renderRandomAssignmentQuestionViews:function(){var self=this,questionView,randomAssignmentOption,randomAssignmentList,randomAssignmentVarID,questionModel,i=0;randomAssignmentList=this.question.randomAssignmentList;for(i;i<randomAssignmentList.length;i++){randomAssignmentOption=randomAssignmentList[i];randomAssignmentVarID=randomAssignmentOption.variable_id;questionModel=self.__settings.nestedQuestionDict[randomAssignmentVarID];if(questionModel){questionView=SM.Views.create(this.questionViewProto,{model:questionModel.question,isRandomAssignment:true,optionTypeID:randomAssignmentVarID,randomAssignmentIndex:i});self.$questionContent.append(questionView.el);}}},__init:function(){var self=this,benchmarkRollup;self.$el.on(SM.Event.CLICK,"[benchmarking-btn], [summary-btn]",{self:self},self._onBenchmarkingBtnClick).on(SM.Event.CLICK,"[customize-btn]",{self:self},self._onCustomizeBtnClick).on(SM.Event.CLICK,"[share-btn]",{self:self},self._onShareBtnClick);self.$el.on("openCustomizeView",{self:self},self._onOpenCustomizeView);self.$el.on("beforeCustomizeViewAnimateIn","[sm-customize-question-view]",{self:self},self._onBeforeCustomizeViewAnimateIn);self.$el.on("afterCustomizeViewAnimateOut","[sm-customize-question-view]",{self:self},self._onAfterCustomizeViewAnimateOut);self.bindModel(self.question,"rollupLoaded",{self:self},self._onQuestionLoaded);self.bindModel(self.question.page.survey,"rollupsAppended",{self:self},self._onSurveyRollupsAppended);benchmarkRollup=self.question.page.survey.getBenchmarkRollup(self.question.ID);if(benchmarkRollup){self.bindModel(benchmarkRollup,'benchmarkRollupLoaded',{self:self},self._onBenchmarkRollupLoaded);}}, _onCustomizeBtnClick:function(e){var self=e.data.self;e.preventDefault();
 self.openCustomizeView("chartType");},_onBeforeCustomizeViewAnimateIn:function(e){var self=e.data.self;self.$el.find('[customize-btn]').hide();self.$el.find('[export-btn]').hide();self.$el.find('[share-btn]').hide();},_onAfterCustomizeViewAnimateOut:function(e){var self=e.data.self;self.$el.find('[customize-btn]').show();self.$el.find('[export-btn]').show();self.$el.find('[share-btn]').show();self.customizeView.$el.remove();self.customizeView=null;},_onOpenCustomizeView:function(e){var self=e.data.self,tabName=e.action,answerID=e.answerID;self.openCustomizeView(tabName,{answerID:answerID});},_onBenchmarkRollupLoaded:function(e){var self=e.data.self,display=self.question.getRollup().display,bmRollup=e.bmRollup,logicalID=bmRollup.logicalID,dateStart=bmRollup.getDateStart(),dateEnd=bmRollup.getDateEnd(),sampleSize=bmRollup.getSampleSize();self._toggleBenchmarkingBtn(sampleSize,dateStart,dateEnd);display.setBenchmarkDisplay(true);},_showOrHideButtons:function(sampleSize,dateStart,dateEnd){var $summaryBtn=this.$el.find('[summary-btn]'),$bmBtn=this.$el.find('[benchmarking-btn]'),$customizeBtn=this.$el.find('[customize-btn]'),$exportBtn=this.$el.find('[export-btn]'),$shareBtn=this.$el.find('[share-btn]'),$qSubHeading=this.$el.find('[question-sub-heading]'),$bmSubHeading=this.$el.find('[benchmark-sub-heading]'),date;if(this._showingBenchmark){$summaryBtn.show();$bmBtn.hide(); $customizeBtn.hide();$exportBtn.hide();$shareBtn.hide();$qSubHeading.hide();this.$el.find('[sample-size]').text(''+sampleSize);this.$el.find('[date-start]').text(moment.unix(dateStart).format('l'));this.$el.find('[date-end]').text(moment.unix(dateEnd).format('l'));$bmSubHeading.show();}else{$summaryBtn.hide();$bmBtn.show(); $customizeBtn.show();$exportBtn.show();$shareBtn.show();$qSubHeading.show();$bmSubHeading.hide();}},_toggleBenchmarkingBtn:function(sampleSize,dateStart,dateEnd){this._showingBenchmark=!this._showingBenchmark;this._showOrHideButtons(sampleSize,dateStart,dateEnd);},_onBenchmarkingBtnClick:function(e){var self=e.data.self,benchmarkRollup=self.question.page.survey.getBenchmarkRollup(self.question.ID),display=self.question.getRollup().display;e.preventDefault();if(self._showingBenchmark){

self._toggleBenchmarkingBtn();display.setBenchmarkDisplay(false);benchmarkRollup.revertBenchmarkRollup();}else{
 benchmarkRollup.fetchBenchmarkRollup({keys:[],date_start:moment({year:2013,month:3,day:1}).unix(),date_end:moment({year:2014,month:2,day:31}).unix()});}},_onShareBtnClick:function(e){e.preventDefault();},_onQuestionLoaded:function(e){e.data.self.render();}, _onSurveyRollupsAppended:function(e){var self=e.data.self;if(self.question.position>e.lastLoadedPosition){self.render();}}, openCustomizeView:function(tabName,options){var self=this,customizeViewOptions,scrollTop;options=options||{};if(!self.customizeView){customizeViewOptions=self._buildCustomizeViewOptions();self.customizeView=SM.Views.create(SM.CustomizeQuestionSummaryView,customizeViewOptions);}
self.customizeView.tabs.open(tabName);

 scrollTop=self.$el.offset().top-20;$('body').animate({scrollTop:scrollTop},250,function(){self.customizeView.animateIn(self.$el.find("[sm-questionview-content-container]"),function(){if(tabName==="labels"){self.customizeView.currentView.scrollToLabel(options.answerID);}});});},_buildCustomizeViewOptions:function(){var self=this,questionViewProto=this.questionViewProto;return{question:self.question,questionView:self.questionView,hasMirrorOptions:questionViewProto._hasMirrorOptions,hasDepthOptions:questionViewProto._hasDepthOptions,hasScaleOptions:questionViewProto._hasScaleOptions,hasShowEmptyOptions:questionViewProto._hasShowEmptyOptions,hasPieDonutCharts:questionViewProto._hasPieDonutCharts,hasStackedCharts:questionViewProto._hasStackedCharts};},_shouldShowExportBtn:function(){var survey=this.question.page.survey;return survey.isExportEnabled()&&!SM.App.isSharingApp();},_hasBenchmarking:function(){var self=this,owner=self.question.page.survey.owner;


return self.questionViewProto._hasBenchmarkingOptions&&owner.hasBenchmarking()&&self.question.isBenchmarkable();}});SM.SummaryBaseQuestionView={ __templateID:"summary-question-template",__model:"question",_hasTableView:false,_hasChartView:false,_hasTextView:false,_hasPieDonutCharts:false,_hasStackedCharts:false,_hasScaleOptions:false,_hasDepthOptions:false,_hasMirrorOptions:false,_hasShowEmptyOptions:false,_hasBenchmarkingOptions:false,_tableViewType:undefined,_textViewType:undefined,_isDisabledQuestionType:false,_isPresentation:false,isRandomAssignment:false,optionTypeID:undefined,randomAssignmentIndex:undefined, __create:function(options){var self=this;if(!!self.__settings.optionTypeID&&!!self.__settings.isRandomAssignment){self.question.randomAssignmentOption=self.__settings.optionTypeID;}
self.rollup=self.question.getRollup();self.survey=self.question.page.survey;self.display=self.rollup.display;self.currentQuestionHeading=self._getQuestionHeading();self.questionContainerView=options.questionContainerView;}, __beforeRender:function(){var self=this,question=this.question,rollup=question.getRollup(),hasRollupLoaded=question.hasRollupLoaded(),survey=question.page.survey,currentUserID=survey.currentUserID,hasRandomAssignment=this.__settings.isRandomAssignment,questionHeading=self.currentQuestionHeading,viewedNumber,viewedPercentage,optionLetter,randomAssignmentOption,isTextPresentation,crossed_rows,i;



 crossed_rows=rollup.summary.crossed_rows;if(crossed_rows!==undefined&&hasRandomAssignment){for(i=0;i<crossed_rows.length;i++){if(question.randomAssignmentOption===crossed_rows[i]){hasRandomAssignment=false;break;}}}
if(hasRandomAssignment){randomAssignmentOption=question.randomAssignmentList[this.__settings.randomAssignmentIndex];questionHeading=randomAssignmentOption.heading||randomAssignmentOption.variable_name;optionLetter=this.__settings.randomAssignmentIndex;viewedNumber=parseInt(rollup.answered,0);if(this._isPresentation){viewedPercentage=Globalize.formatPercent(viewedNumber/rollup.answeredCount,2);if(question.subtype===question.QTYPE.descriptive_text){questionHeading="";isTextPresentation=true;}}else{viewedPercentage=Globalize.formatPercent(viewedNumber/(parseInt(rollup.skipped,0)+viewedNumber),2);}}
return{isVisible:!question.isAfterLastLoadedRollup()&&hasRollupLoaded&&question.isShown(),questionHeading:questionHeading,answered:rollup.answered,skipped:rollup.skipped,showBenchmark:this.showBenchmark,sampleSize:5467,dateStart:"1/10/2010",dateEnd:"1/30/2012",isDisabledQuestionType:this._isDisabledQuestionType,disabledMsg:this.__settings.disabledMsg,encryptedID:this.question.page.survey.encryptedID,userID:currentUserID,hasRandomAssignment:hasRandomAssignment,optionLetter:optionLetter+1,viewedPercentage:viewedPercentage,viewedNumber:Globalize.format(viewedNumber,'n0'),isPresentation:this._isPresentation,isTextPresentation:isTextPresentation};},__afterRender:function(md){var self=this;if(md.isDisabledQuestionType||!md.isVisible){return;}
self.$questionContent=this.$el;if(this._hasChartView){this._renderChartView();}
if(this._hasTableView){this._renderTableView();}
if(this._hasTextView){if(this._shouldRenderTextView()){this._renderTextView();}else{this._renderUnavailableTextView();}}
if(this._isPresentation){this._renderPresentationView();}
self._setMinHeight();},__init:function(){var self=this;self.$el.on(SM.Event.CLICK,"[question-heading]",{self:self},self._onQuestionHeadingClick);self.$el.on("actionMenu.actionSelected","[question-heading]",{self:self},self._onQuestionHeadingActionSelected);self.$el.on("actionMenu.actionSelected",".sm-chart-container *",{self:this},this._onChartActionSelected);self.$el.on("actionMenu.actionSelected",".sm-data-table-container *",{self:this},this._onTableActionSelected);self.bindModel(self.display,"displayChange",{self:self},self._onDisplayChange);self.bindModel(self.display,"tempDisplayChange",{self:self},self._onDisplayChange);self.bindModel(self.display,"allDisplaysChange",{self:self},self._onDisplayChange);},_getQuestionHeading:function(){var label=this.display.getQuestionHeadingLabel();if(label&&!_.isEmpty(label.text)){return label.text;}else{return this.question.heading;}},_renderQuestionHeading:function(){var self=this,heading=self._getQuestionHeading();if(self.currentQuestionHeading!==heading){self.$el.find("[question-heading]").text(heading);self.currentQuestionHeading=heading;}},_renderChartView:function(){var self=this,chartContainerView;chartContainerView=SM.Views.create(SM.SummaryChartContainerView,{survey:self.survey,question:self.question,randomAssignmentOption:self.question.randomAssignmentOption,questionView:self});self.$questionContent.append(chartContainerView.el);self.chartContainerView=chartContainerView;},_renderTableView:function(){var self=this,tableView;tableView=SM.Views.create(SM.SummaryTableContainerView,{survey:this.survey,question:this.question,tableViewType:this._tableViewType,hasBenchmarkingOptions:this._hasBenchmarkingOptions,randomAssignmentOption:self.question.randomAssignmentOption});self.$questionContent.append(tableView.el);},_renderTextView:function(){var self=this,rollup=this.question.getRollup(),taModel=rollup.getTaModel(),textView;if(this.question.hasRandomAssignment()){taModel=rollup.getTaModel(0,0,this.question.randomAssignmentOption);}
taModel.set("filterCount",rollup.answeredCount);textView=SM.Views.create(SM.TaContainerView,{model:taModel});self.$questionContent.append(textView.el);},_renderPresentationView:function(){var self=this,presentationView;presentationView=SM.Views.create(SM.SummaryPresentationContainerView,{question:this.question,randomAssignmentOption:this.question.randomAssignmentList[this.__settings.randomAssignmentIndex]});self.$questionContent.append(presentationView.el);},_renderUnavailableTextView:function(){var $target=this.$el.find(".summary-question-text-analysis-container"),html=SM.Template.render("response-data-unavailable-template");$target.append(html);}, _onQuestionHeadingClick:function(e){var self=e.data.self,actionMenuOptions={};if(self._hasChartView){SM.CustomizeActionMenu.actionMenu.call(self,e,'h1',actionMenuOptions);}},_onDisplayChange:function(e){var self=e.data.self;self._setMinHeight();self._renderQuestionHeading();},_onQuestionHeadingActionSelected:function(e){var self=e.data.self;e.stopPropagation();if(e.action==='labels'){self.$el.trigger({type:"openCustomizeView",action:e.action,answerID:null});}},_onTableActionSelected:function(e){var self=e.data.self;e.stopPropagation();if(e.action==='labels'){self.$el.trigger({type:"openCustomizeView",action:e.action,answerID:e.$action.attr("data-answer-id")});}},_onChartActionSelected:function(e){var self=e.data.self,dialog,isBasic=self.survey.owner.isBasic();e.stopPropagation();if(e.action==='colors'&&isBasic){dialog=SM.Views.create(SM.DialogView,{width:800,isModal:true,templateID:'customize-upgrade-dialog-template'});dialog.open();}else{self.$el.trigger({type:"openCustomizeView",action:e.action});}},
 _setMinHeight:function(){var self=this,height;setTimeout(function(){height=0;

 if(self.$questionContent!==undefined){_.each(self.$questionContent.children(":visible"),function(child){height+=$(child).outerHeight();});self.$questionContent.css({'min-height':height});}},150);},_shouldRenderTextView:function(){if(SM.App.isSharingApp()){return SM.App.sharedView.includeOpenEnded();}else{return true;}},getCurrentChartView:function(){var self=this;return self.chartContainerView.chartView;}};SM.SummarySingleChoiceQuestionView=SM.Views.extend(SM.SummaryBaseQuestionView,{__NAME:"summarySingleChoiceQuestionView",_hasTableView:true,_hasChartView:true,_hasPieDonutCharts:true,_hasStackedCharts:true,_hasScaleOptions:true,_hasShowEmptyOptions:true,_hasBenchmarkingOptions:true});SM.SummaryMultipleChoiceQuestionView=SM.Views.extend(SM.SummaryBaseQuestionView,{__NAME:"summaryMultipleChoiceQuestionView",_hasTableView:true,_hasChartView:true,_hasStackedCharts:true,_hasScaleOptions:true,_hasShowEmptyOptions:true});SM.SummaryPresentationQuestionView=SM.Views.extend(SM.SummaryBaseQuestionView,{__NAME:"summaryPresentationQuestionView",_isPresentation:true});SM.SummaryNumericalQuestionView=SM.Views.extend(SM.SummaryBaseQuestionView,{__NAME:"summaryNumericalQuestionView",_hasTableView:true,_hasChartView:true});SM.SummaryDemographicQuestionView=SM.Views.extend(SM.SummaryBaseQuestionView,{__NAME:"summaryDemographicQuestionView",_hasTableView:true});SM.SummaryOpenEndedMultiQuestionView=SM.Views.extend(SM.SummaryBaseQuestionView,{__NAME:"summaryOpenEndedQuestionView",_hasTableView:true});SM.SummaryDateTimeQuestionView=SM.Views.extend(SM.SummaryBaseQuestionView,{__NAME:"summaryDateTimeQuestionView",_hasTableView:true});SM.SummaryEssayQuestionView=SM.Views.extend(SM.SummaryBaseQuestionView,{__NAME:"summaryEssayQuestionView",_hasTextView:true,_textViewType:SM.SummaryTextView});SM.SummaryMatrixRatingQuestionView=SM.Views.extend(SM.SummaryBaseQuestionView,{__NAME:"summaryMatrixRatingQuestionView",_hasTableView:true,_hasChartView:true,_hasStackedCharts:true,_hasScaleOptions:true,_hasDepthOptions:true,_hasMirrorOptions:true});SM.SummarySingleMatrixQuestionView=SM.Views.extend(SM.SummaryBaseQuestionView,{__NAME:"summarySingleMatrixQuestionView",_hasTableView:true,_hasChartView:true,_hasStackedCharts:true,_hasScaleOptions:true,_hasDepthOptions:true,_hasMirrorOptions:true});SM.SummaryMatrixRankingQuestionView=SM.Views.extend(SM.SummaryBaseQuestionView,{__NAME:"summaryMatrixRankingQuestionView",_hasTableView:true,_hasChartView:true,_hasStackedCharts:true,_hasScaleOptions:true,_hasDepthOptions:true,_hasMirrorOptions:true});SM.SummaryMultiMatrixQuestionView=SM.Views.extend(SM.SummaryBaseQuestionView,{__NAME:"summaryMultiMatrixQuestionView",_hasTableView:true,_hasChartView:true,_hasStackedCharts:true,_hasScaleOptions:true,_hasDepthOptions:true,_hasMirrorOptions:true});SM.SummaryMenuMatrixQuestionView=SM.Views.extend(SM.SummaryBaseQuestionView,{__NAME:"summaryMenuMatrixQuestionView",_hasTableView:true,_hasChartView:true,_hasStackedCharts:true,_hasScaleOptions:true,_hasDepthOptions:true,_hasMirrorOptions:true});SM.SummaryDisabledQuestionView=SM.Views.deepExtend(SM.SummaryBaseQuestionView,{__NAME:"summaryDisabledQuestionView",__defaults:{disabledMsg:"This question is disabled"},_hasTableView:false,_hasChartView:false,_isDisabledQuestionType:true});SM.SummaryCompareNumericalQuestionView=SM.Views.deepExtend(SM.SummarySingleMatrixQuestionView,{__NAME:"summaryCompareNumericalQuestionView",_hasChartView:false,_tableViewType:SM.SummaryCompareMatrixTableView,_exportTableViewType:SM.ExportSummaryCompareMatrixTableView});SM.SummaryCompareDemographicQuestionView=SM.Views.deepExtend(SM.SummarySingleMatrixQuestionView,{__NAME:"summaryCompareDemographicQuestionView",_hasChartView:false,_tableViewType:SM.SummaryCompareMatrixTableView,_exportTableViewType:SM.ExportSummaryCompareMatrixTableView});SM.SummaryCompareOpenEndedMultiQuestionView=SM.Views.deepExtend(SM.SummarySingleMatrixQuestionView,{__NAME:"summaryCompareOpenEndedQuestionView",_hasChartView:false,_tableViewType:SM.SummaryCompareMatrixTableView,_exportTableViewType:SM.ExportSummaryCompareMatrixTableView});SM.SummaryCompareDateTimeQuestionView=SM.Views.deepExtend(SM.SummarySingleMatrixQuestionView,{__NAME:"summaryCompareDateTimeQuestionView",_hasChartView:false,_tableViewType:SM.SummaryCompareMatrixTableView,_exportTableViewType:SM.ExportSummaryCompareMatrixTableView});SM.SummaryCompareEssayQuestionView=SM.Views.deepExtend(SM.SummarySingleMatrixQuestionView,{__NAME:"summaryCompareEssayQuestionView",_hasChartView:false,_hasTextView:false,_tableViewType:SM.SummaryCompareMatrixTableView,_exportTableViewType:SM.ExportSummaryCompareMatrixTableView});SM.SummaryCompareMenuMatrixQuestionView=SM.Views.deepExtend(SM.SummaryDisabledQuestionView,{__setup:function(){this.__defaults.disabledMsg=Globalize.localize("Compare rules do not apply to this question");},__defaults:{},__NAME:"summaryCompareMenuMatrixQuestionView"});SM.SummaryCompareSingleChoiceQuestionView=SM.Views.extend(SM.SummarySingleMatrixQuestionView,{__NAME:"summaryCompareSingleChoiceQuestionView",_tableViewType:SM.SummaryCompareMatrixTableView,_exportTableViewType:SM.ExportSummaryCompareMatrixTableView});SM.SummaryCompareMultipleChoiceQuestionView=SM.Views.extend(SM.SummaryCompareSingleChoiceQuestionView,{__NAME:"summaryCompareMultipleChoiceQuestionView",_tableViewType:SM.SummaryCompareMatrixTableView,_exportTableViewType:SM.ExportSummaryCompareMatrixTableView});SM.SummaryCompareMatrixRatingQuestionView=SM.Views.extend(SM.SummaryMenuMatrixQuestionView,{__NAME:"summaryCompareMatrixRatingQuestionView",_tableViewType:SM.SummaryCompareMenuMatrixTableView,_exportTableViewType:SM.ExportSummaryCompareMenuMatrixTableView});SM.SummaryCompareMatrixRankingQuestionView=SM.Views.extend(SM.SummaryMenuMatrixQuestionView,{__NAME:"summaryCompareMatrixRatingQuestionView",_tableViewType:SM.SummaryCompareMenuMatrixTableView,_exportTableViewType:SM.ExportSummaryCompareMenuMatrixTableView});SM.SummaryCompareSingleMatrixQuestionView=SM.Views.extend(SM.SummaryMenuMatrixQuestionView,{__NAME:"summaryCompareSingleMatrixQuestionView",_tableViewType:SM.SummaryCompareMenuMatrixTableView,_exportTableViewType:SM.ExportSummaryCompareMenuMatrixTableView});SM.SummaryCompareMultiMatrixQuestionView=SM.Views.extend(SM.SummaryMenuMatrixQuestionView,{__NAME:"summaryCompareMultiMatrixQuestionView",_tableViewType:SM.SummaryCompareMenuMatrixTableView,_exportTableViewType:SM.ExportSummaryCompareMenuMatrixTableView});SM.SummaryComparePresentationQuestionView=SM.Views.deepExtend(SM.SummaryDisabledQuestionView,{__setup:function(){this.__defaults.disabledMsg=Globalize.localize("Compare rules do not apply to this question");},__defaults:{},__NAME:"summaryComparePresentationQuestionView"});SM.SummaryQuestionListView=SM.Views.register({ __NAME:"summaryQuestionList",__templateID:"summary-question-list-template",__model:"page", qTypes:{standard:{single_choice:SM.SummarySingleChoiceQuestionView,multiple_choice:SM.SummaryMultipleChoiceQuestionView,matrix_rating:SM.SummaryMatrixRatingQuestionView,matrix_ranking:SM.SummaryMatrixRankingQuestionView,matrix_single:SM.SummarySingleMatrixQuestionView,matrix_multi:SM.SummaryMultiMatrixQuestionView,matrix_menu:SM.SummaryMenuMatrixQuestionView,open_ended_essay:SM.SummaryEssayQuestionView,open_ended_single:SM.SummaryEssayQuestionView,open_ended_multi:SM.SummaryOpenEndedMultiQuestionView,open_ended_numerical:SM.SummaryNumericalQuestionView,demographic:SM.SummaryDemographicQuestionView,datetime:SM.SummaryDateTimeQuestionView,presentation:SM.SummaryPresentationQuestionView},compare:{single_choice:SM.SummaryCompareSingleChoiceQuestionView,multiple_choice:SM.SummaryCompareMultipleChoiceQuestionView,matrix_rating:SM.SummaryCompareMatrixRatingQuestionView,matrix_ranking:SM.SummaryCompareMatrixRankingQuestionView,matrix_single:SM.SummaryCompareSingleMatrixQuestionView,matrix_multi:SM.SummaryCompareMultiMatrixQuestionView,matrix_menu:SM.SummaryCompareMenuMatrixQuestionView,open_ended_essay:SM.SummaryCompareEssayQuestionView,open_ended_single:SM.SummaryCompareEssayQuestionView,open_ended_multi:SM.SummaryCompareOpenEndedMultiQuestionView,open_ended_numerical:SM.SummaryCompareNumericalQuestionView,demographic:SM.SummaryCompareDemographicQuestionView,datetime:SM.SummaryCompareDateTimeQuestionView,presentation:SM.SummaryComparePresentationQuestionView}}, __afterRender:function(){var questions=this.page.shownQuestionList,questionContainerView,questionViewProto,frag=document.createDocumentFragment(); _.each(questions,function(question){questionViewProto=this._getQuestionViewForQuestionType(question);questionContainerView=SM.Views.create(SM.SummaryQuestionViewContainer,{model:question,nestedQuestionDict:this.page.survey.questionRollups.questions[question.ID].nestedQuestionDict,questionViewProto:questionViewProto});frag.appendChild(questionContainerView.el);},this);this.el.appendChild(frag);}, _getQuestionViewForQuestionType:function(question){var summary=question.getRollup(), family=question.family,subtype=question.subtype,mode=summary.getDisplayMode();if(family==="single_choice"||family==="multiple_choice"){return this.qTypes[mode][family];}
if(family==="matrix"){return this.qTypes[mode]["matrix_"+subtype];}
if(family==="open_ended"){return this.qTypes[mode]["open_ended_"+subtype];}
if(family==="demographic"){return this.qTypes[mode].demographic;}
if(family==="datetime"){return this.qTypes[mode].datetime;}
if(family==="presentation"){return this.qTypes[mode].presentation;}}});SM.CustomizeQuestionSummaryView=SM.Views.register({ __NAME:"CustomizeQuestionSummaryView",__templateID:"customize-question-summary-template", __create:function(options){var self=this;self.question=options.question;self.survey=self.question.page.survey;self.rollup=self.question.getRollup();self.display=self.rollup.display;self.questionView=options.questionView;self.applyToAll=false;self.hasMirrorOptions=options.hasMirrorOptions;self.hasDepthOptions=options.hasDepthOptions;self.hasScaleOptions=options.hasScaleOptions;self.hasShowEmptyOptions=options.hasShowEmptyOptions;self.hasAreaCharts=options.hasAreaCharts;self.hasPieDonutCharts=options.hasPieDonutCharts;self.hasStackedCharts=options.hasStackedCharts;
self.currentView=null;_.bindAll(this,'_onBeforeTabOpen','_onTabClick','_onSaveBtnClick','_onCancelBtnClick','_onApplyToAllCheckBoxClick','_onDisplayChange','_enableSaveBtn');}, __beforeRender:function(){var self=this;return{questionID:self.question.ID};},__afterRender:function(){var self=this,isBasic;self.$el.css("height","auto");isBasic=self.survey.owner.isBasic();if(isBasic){self.tabs=self.$el.find('.tabs').tabs({requireOpenTab:true,noClickTab:'colors'}).data("tabs");}else{self.tabs=self.$el.find('.tabs').tabs({requireOpenTab:true}).data("tabs");}
self.$el.find(".sm-customize-actions [save-btn]").addClass("disabled");},_renderTab:function(tabName,$panel){var self=this;switch(tabName){case"chartType":self._renderCustomizeChartTypeView($panel);break;case"displayOptions":self._renderCustomizeDisplayOptionsView($panel);break;case"colors":self._renderCustomizeColorsView($panel);break;case"labels":self._renderCustomizeLabelsView($panel);break;}},_renderCustomizeChartTypeView:function($panel){var self=this;self.currentView=SM.Views.create(SM.CustomizeChartTypeView,{question:self.question,rollup:self.rollup,display:self.display,hasPieDonutCharts:self.hasPieDonutCharts,hasStackedCharts:self.hasStackedCharts});$panel.html(self.currentView.el);},_renderCustomizeDisplayOptionsView:function($panel){var self=this;self.currentView=SM.Views.create(SM.CustomizeDisplayOptionsView,{question:self.question,rollup:self.rollup,display:self.display,customizeView:self,hasMirrorOptions:self.hasMirrorOptions,hasDepthOptions:self.hasDepthOptions,hasScaleOptions:self.hasScaleOptions,hasShowEmptyOptions:self.hasShowEmptyOptions});$panel.html(self.currentView.el);},_renderCustomizeColorsView:function($panel){var self=this;self.currentView=SM.Views.create(SM.CustomizeColorsView,{question:self.question,rollup:self.rollup,display:self.display});$panel.html(self.currentView.el);},_renderCustomizeLabelsView:function($panel){var self=this;self.currentView=SM.Views.create(SM.CustomizeLabelsView,{question:self.question,rollup:self.rollup,display:self.display});$panel.html(self.currentView.el);}, animateIn:function($target,cb){var self=this; if($target.find("[sm-customize-question-view]").length===0){self.$el.prependTo($target);}
self.$el.trigger({type:"beforeCustomizeViewAnimateIn"});self.$el.slideDown(500,function(){if(cb){cb();}});},animateOut:function(){var self=this;self.$el.slideUp({duration:250,complete:function(){self.$el.trigger({type:"afterCustomizeViewAnimateOut"});self.$el.find(".sm-customize-actions [save-btn]").addClass("disabled");}});}, __init:function(){var self=this;self.tabs.$el.children("nav").find(".tab").on("click",self._onTabClick);self.tabs.$el.on("tabs.beforeOpen",self._onBeforeTabOpen);self.$el.find(".apply-to-all .q").popout();self.$el.on("click","[apply-to-all-checkbox]",self._onApplyToAllCheckBoxClick);self.$el.on("click",".sm-customize-actions [save-btn]",self._onSaveBtnClick);self.$el.on("click",".sm-customize-actions [cancel-btn]",self._onCancelBtnClick);self.bindModel(self.display,"allDisplaysChange",{self:self},function(){self.currentView.render();});self.bindModel(self.display,"displayChange",{self:self},self._onDisplayChange);self.bindModel(self.display,"tempDisplayChange",{self:self},self._onDisplayChange);self.bindModel(self.display,"allDisplaysChange",{self:self},self._onDisplayChange);},_onDisplayChange:function(){var self=this;if(self._shouldDisableTabs()){self._disableTabs();}else{self._enableTabs();}
if(self._canSave()){self._enableSaveBtn();}else{self._disableSaveBtn();}},_onTabClick:function(e){var self=this,dialog,$tab=$(e.target),tabKey=$tab.attr('tab-target'),userIsBasic=self.survey.owner.isBasic();e.preventDefault();if(userIsBasic&&tabKey==='colors'){dialog=SM.Views.create(SM.DialogView,{width:800,isModal:true,templateID:'customize-upgrade-dialog-template'});dialog.open();}},_onBeforeTabOpen:function(e){var self=this,tabName=e.tab.key,$panel=e.tab.$panel;self._renderTab(tabName,$panel);},_onApplyToAllCheckBoxClick:function(e){var self=this,$target=$(e.target);self.applyToAll=$target.prop("checked");


if(self.applyToAll&&self._canSave()){self._enableSaveBtn();}else{if(!self._isDirty()){self._disableSaveBtn();}}},_onSaveBtnClick:function(e){var self=this,$btn=$(e.target);e.preventDefault();if($btn.hasClass("disabled")){return;}
self.display._trigger({type:"saving"});self._save({applyToAll:self.applyToAll});self.animateOut();},_onCancelBtnClick:function(e){var self=this;e.preventDefault();self._clearUpdates();self.animateOut();},






_save:function(options){options=options||{};var self=this,displayUpdates;displayUpdates=self.display.getDisplayUpdates();

if(!_.isEmpty(displayUpdates)){self.display.updateDisplayData(displayUpdates,{done:function(){if(options.applyToAll){self._applyToAll();}}});}else{if(options.applyToAll){self._applyToAll();}}
self._clearUpdates();},_applyToAll:function(){var self=this,sharedDisplayUpdates;sharedDisplayUpdates=self.display.getSharedDisplayUpdates();self.survey.anviews.defaultView.updateSharedDisplayData({updates:sharedDisplayUpdates,deletedKeys:self.display.SHARED_DISPLAY_OPTIONS,untypedKeys:self.display.UNTYPED_DISPLAY_OPTIONS,isCompared:self.question.isCompared()});self.survey.questionRollups.onSharedDisplayDataChange();},_clearUpdates:function(){var self=this;self.display.clearDisplayUpdates();self.display.clearTempDisplay();}, _canSave:function(){var self=this;if(self.display.labelUpdatesHaveEmptyLabel()){return false;}
return true;},_isDirty:function(){var self=this;return!_.isEmpty(self.display.getDisplayUpdates());},_shouldDisableTabs:function(){var self=this;if(self.display.labelUpdatesHaveEmptyLabel()){return true;}
return false;},_disableTabs:function(){this.tabs.$el.children("nav").find(".tab").addClass("disabled");},_enableTabs:function(){this.tabs.$el.children("nav").find(".tab").removeClass("disabled");},_enableSaveBtn:function(){var self=this;self.$el.find("[sm-customize-actions] [save-btn]").removeClass("disabled");},_disableSaveBtn:function(){var self=this;self.$el.find("[sm-customize-actions] [save-btn]").addClass("disabled");}});SM.CustomizeChartTypeView=SM.Views.register({ __NAME:"CustomizeChartTypeView",__templateID:"customize-chart-type-template",__defaults:{hasAreaCharts:false,hasPieDonutCharts:false,hasStackedCharts:false}, __create:function(options){var self=this;self.question=options.question;self.rollup=options.rollup;self.display=options.display;self.set("hasAreaCharts",options.hasAreaCharts);self.set("hasPieDonutCharts",options.hasPieDonutCharts);self.set("hasStackedCharts",options.hasStackedCharts);_.bindAll(this,'_onChartTypeClick');}, __beforeRender:function(md){var self=this,displayValues=self.display.DISPLAY_VALUES,displayData=self.display.getDisplayData(), chartType=self.display.getChartType();md={hbar:{isEnabled:true,isSelected:chartType===displayValues.hbar},vbar:{isEnabled:true,isSelected:chartType===displayValues.vbar},pie:{isEnabled:self.get("hasPieDonutCharts"),isSelected:chartType===displayValues.pie},donut:{isEnabled:self.get("hasPieDonutCharts"),isSelected:chartType===displayValues.donut},stacked_hbar:{isEnabled:self.get("hasStackedCharts"),isSelected:chartType===displayValues.stacked_hbar},stacked_vbar:{isEnabled:self.get("hasStackedCharts"),isSelected:chartType===displayValues.stacked_vbar},line:{isEnabled:true,isSelected:chartType===displayValues.line},area:{isEnabled:true,isSelected:chartType===displayValues.area}};
if(displayData.tableHasOneRow){md.stacked_hbar.isEnabled=true;md.stacked_vbar.isEnabled=true;md.line.isEnabled=false;md.area.isEnabled=false;if(!self.display._tableRowsAddToMoreThan100Percent(displayData)){md.pie.isEnabled=true;md.donut.isEnabled=true;}}
if(displayData.isWeightedAvg){md.stacked_hbar.isEnabled=false;md.stacked_vbar.isEnabled=false;md.pie.isEnabled=false;md.donut.isEnabled=false;}
if(!md[chartType].isEnabled&&md[chartType].isSelected){md[chartType].isSelected=false;chartType=self.display.DEFAULT_CHART_TYPE;md[chartType].isSelected=true;}
return md;},__init:function(){var self=this;self.$el.on(SM.Event.CLICK,".chart-types li",{self:self},self._onChartTypeClick);}, _onChartTypeClick:function(e){e.preventDefault();var self=this,$target=$(e.target),chartType;if($target.hasClass("disabled")){return;}
chartType=$target.attr("data-chart-type");self._changeChartType(chartType);},_changeChartType:function(chartType){var self=this,updates;updates=self.display.getChartTypeUpdates(chartType);self.display.updateTempDisplay(updates);self.display.setDisplayUpdates(updates);self.render();}});SM.CustomizeDisplayOptionsView=SM.Views.register({ __NAME:"CustomizeDisplayOptionsView",__templateID:"customize-display-options-template",__defaults:{hasDepthOptions:false,hasScaleOptions:false,hasMirrorOptions:false,hasShowEmptyOptions:false}, __create:function(options){var self=this;self.question=options.question;self.rollup=options.rollup;self.display=options.display;self.customizeView=options.customizeView; self.set("hasMirrorOptions",options.hasMirrorOptions);self.set("hasDepthOptions",options.hasDepthOptions);self.set("hasScaleOptions",options.hasScaleOptions);self.set("hasShowEmptyOptions",options.hasShowEmptyOptions);_.bindAll(this,"_onDisplayOptionSelected");}, __beforeRender:function(){var self=this,context,displayOptions=self.display.DISPLAY_OPTIONS,displayValues=self.display.DISPLAY_VALUES,displayData=self.display.getDisplayData(),hasDepthOptions=displayData.hasDepthOptions&&self.get("hasDepthOptions"),hasScaleOptions=displayData.hasScaleOptions&&self.get("hasScaleOptions"),isPercent=displayData.isPercent,isMirrorable=displayData.isMirrorable&&self.get("hasMirrorOptions"),hasShowEmptyOptions=displayData.hasShowEmptyOptions&&self.get("hasShowEmptyOptions"),decimalPlacesKey=isPercent?displayOptions.dp_percentage:displayOptions.dp_absolute,numDecimalPlaces=parseInt(isPercent?displayData.dp_percentage:displayData.dp_absolute),canWeightedAvgChart,scaleMaxOptionKey,axisMaxValues,hasMaxScaleOptions;canWeightedAvgChart=self._canChooseWeightedAvgChart(displayData,hasDepthOptions);scaleMaxOptionKey=self.display.getScaleMaxOptionKey();hasMaxScaleOptions=self._hasMaxScaleOptions(displayData);if(hasMaxScaleOptions){axisMaxValues=self._buildAxisMaxValuesContext();}
if(_.isEmpty(axisMaxValues)){hasMaxScaleOptions=false;}
context={questionID:self.question.ID,isTableShown:displayData.show_table,isChartShown:displayData.show_chart,isDataShown:displayData.show_data, hasEmptyOptions:hasShowEmptyOptions,canShowEmpty:hasShowEmptyOptions&&!displayData.show_empty_data,canHideEmpty:hasShowEmptyOptions&&displayData.show_empty_data,hasMirrorOptions:isMirrorable,canMirror:isMirrorable&&!displayData.mirror,canUnMirror:isMirrorable&&displayData.mirror,hasDepthOptions:hasDepthOptions,isDistributionChart:displayData.isDistribution,isWeightedAvg:displayData.isWeightedAvg,canDistributionChart:hasDepthOptions&&!displayData.isDistribution,canWeightedAvgChart:canWeightedAvgChart,hasScaleOptions:hasScaleOptions,scaleIsPercent:displayData.isPercent,hasMaxScaleOptions:hasMaxScaleOptions,scaleMaxOptionKey:scaleMaxOptionKey,axisMaxValues:axisMaxValues,decimalPlacesKey:decimalPlacesKey,dpIsZero:numDecimalPlaces===0,dpIsOne:numDecimalPlaces===1,dpIsTwo:numDecimalPlaces===2,isLabelable:displayData.isLableable,labelIsLegend:displayData.isLableable&&displayData.isLegend,labelIsLabel:displayData.isLableable&&!displayData.isLegend,displayOptions:displayOptions,displayValues:displayValues};return context;},__afterRender:function(){var self=this,$q; self.$el.find(".q").each(function(){$q=$(this);$q.popout({parentElement:$q});});}, __init:function(){var self=this;self.$el.on("change","input",self._onDisplayOptionSelected);self.$el.on("change","select",self._onDisplayOptionSelected);},

_onDisplayOptionSelected:function(e){var self=this,$target=$(e.target),$displayOption=$target.parent(".display-option"),$option,action,parts,field,modelType,value;if(!!$displayOption.attr("disabled")){return;}
if($target.is("select")){$option=$target.children("option:selected");action=$option.attr("data-action");value=$option.attr("data-value");}else{action=$target.attr("data-action");value=$target.attr("data-value");}
parts=action.split('.');modelType=parts[0];field=parts[1];e.preventDefault();if(value&&field&&modelType){if(modelType==="table"){self._updateTableDisplayOptions(field,value);}else if(modelType==="chart"){self._updateChartDisplayOptions(field,value);}else if(modelType==="both"){self._updateChartDisplayOptions(field,value); self._updateTableDisplayOptions(field,value);}}else{SM.Error.log({name:"DisplayOptionSelectedException",details:"_onDisplayOptionSelected: no field or value selected"});}
self.render();}, _updateChartDisplayOptions:function(field,value){var self=this,update={};update[field]=value;self.display.updateTempDisplay(update);self.display.setDisplayUpdates(update);},_updateTableDisplayOptions:function(field,value){var self=this,update={};update[field]=value;self.display.updateTempDisplay(update);self.display.setDisplayUpdates(update);},_canChooseWeightedAvgChart:function(displayData,hasDepthOptions){var self=this;return(hasDepthOptions&&displayData.isDistribution&&(self.question.isCompared()?displayData.mirror:!displayData.mirror))},_hasMaxScaleOptions:function(displayData){var self=this,hasMaxScaleOptions=true;if(self.question.hasRandomAssignment()){return false;}
if(self.customizeView.questionView.getCurrentChartView()){if(displayData.isPieChart||displayData.isDonutChart){hasMaxScaleOptions=false;}else{if(displayData.isPercent){if(displayData.isStacked){hasMaxScaleOptions=false;}else if(displayData.isAreaChart){if(!self.question.isSimple()){hasMaxScaleOptions=false;}}}}}else{hasMaxScaleOptions=false;}
return hasMaxScaleOptions;},_buildAxisMaxValuesContext:function(){var self=this,context,displayData,chartSeriesList,values,rangeData,selectedAxisMaxValue,selected;displayData=self.display.getDisplayData();chartSeriesList=self.customizeView.questionView.getCurrentChartView().getSeriesList();rangeData=SM.Highcharts.calculateCustomScaleMaxRange(chartSeriesList,{isPercent:displayData.isPercent,isWeightedAvg:displayData.isWeightedAvg,isStacked:displayData.isStacked,isArea:displayData.isAreaChart,questionIsSimple:self.question.isSimple()});selectedAxisMaxValue=self.display.getScaleMax(rangeData);values=_.range(rangeData.min,(rangeData.max+rangeData.step),rangeData.step);context=_.map(values,function(value,i){
if(selectedAxisMaxValue){selected=(value==selectedAxisMaxValue);}else{selected=(i==(values.length-1));}
return{value:value,selected:selected};});return context;}});SM.CustomizeColorsView=SM.Views.register({__NAME:"CustomizeColorsView",__templateID:"customize-colors-template", MIN_COLORS_FOR_DELETING:11, __create:function(options){var self=this;self.rollup=options.rollup;self.display=options.display;_.bindAll(this,'_newColor','_createColor','_editColor','_updateColor','_deleteColor','_sortColors','_onActionMenuAfterClose','_onColorPickerSwatchClick');}, __beforeRender:function(md){var self=this;self.displayUpdates=self.display.getDisplayUpdates();self.displayData=self.display.getDisplayData();self.tempDisplay=self.display.getTempDisplay();self.colors=self.displayData.colors||SM.Highcharts.DEFAULT_COLORS;return{colors:self._colorsForTemplate()};},__afterRender:function(){var self=this;self._bindActionMenusToColorListItems();self._makeColorListSortable();}, _colorsForTemplate:function(){var self=this,context;context=_.map(self.colors,function(hexValue,index){return{position:index,hex:hexValue};});return context;},_makeColorListSortable:function(){var self=this,$colorList=self.$el.find('.color-list'); $colorList.sortable({scroll:false,distance:5,tolerance:"pointer",containment:"parent",placeholder:"color-list-item-placeholder",forcePlaceholderSize:true,update:self._sortColors});},_bindActionMenusToColorListItems:function(){var self=this,color,$colorListItems,$colorListItem,$actionMenu,menuActions;$colorListItems=self.$el.find('.color-list-item');menuActions=[{text:Globalize.localize("Edit Color"),action:"_editColor"},{text:Globalize.localize("Copy Color"),action:"_copyColor"},{text:Globalize.localize("Delete Color"),action:"_deleteColor",isDisabled:self.colors.length<self.MIN_COLORS_FOR_DELETING}];_.each($colorListItems,function(colorListItems){$colorListItem=$(colorListItems);color={hex:$colorListItem.attr("data-hex"),position:parseInt($colorListItem.attr("data-position"))};$actionMenu=$colorListItem.actionMenu({templateID:"color-list-item-action-menu-template",actions:menuActions});(function(color,$colorListItem){$actionMenu.on("actionMenu.beforeOpen",function(e){self._onActionMenuBeforeOpen(e,color,$colorListItem);});$actionMenu.on("actionMenu.afterClose",function(e){self._onActionMenuAfterClose(e,color,$colorListItem);});})(color,$colorListItem);});},_renderColorPickerView:function($target,options){var self=this,view,viewOptions;viewOptions={position:options.position,originalHexValue:options.hexValue};if(options.add){viewOptions.onSwatchClick=self._onColorPickerSwatchClick;viewOptions.onColorSelected=self._createColor;viewOptions.primaryBtnText=Globalize.localize("Add");}else{viewOptions.onSwatchClick=self._onColorPickerSwatchClick;viewOptions.onColorSelected=self._updateColor;}
view=SM.Views.create(SM.CustomizeColorPickerView,viewOptions);$("body").append(view.el);
view.$el.position({my:"left center",at:"right center",of:$target,within:self.$el});}, __init:function(){var self=this;self.$el.on("click","[new-color]",self._newColor);},_onActionMenuBeforeOpen:function(e,color,$colorListItem){var self=this,actionMenu=e.actionMenu,menuView=actionMenu.get("menuView");var deleteActionContext=menuView.get("actions")[2];deleteActionContext.isDisabled=self.colors.length<self.MIN_COLORS_FOR_DELETING;},_onActionMenuAfterClose:function(e,color,$colorListItem){var self=this,actionMenu=e.actionMenu,menuView=actionMenu.get("menuView"),selectedAction=menuView.get("selectedAction");if(selectedAction){self[selectedAction].call(self,color,$colorListItem);}},_onColorPickerSwatchClick:function(data){var self=this,position=data.position,hexValue=data.hex,shouldUpdateTempDisplay;self.colors[position]=hexValue;shouldUpdateTempDisplay=self._shouldUpdateTempDisplay({position:position});if(shouldUpdateTempDisplay){self.display.updateTempDisplay({colors:self.colors});}},_newColor:function(e){e.preventDefault();var self=this,$currentTarget=$(e.currentTarget);self._renderColorPickerView($currentTarget,{add:true});},_createColor:function(options){var self=this,hexValue=options.hex;self.colors.push(hexValue);self.display.updateTempDisplay({colors:self.colors});self._setChartDisplayUpdates(self.colors);self.render();},_editColor:function(color,$colorListItem){var self=this,position,hexValue;hexValue=color.hex;position=color.position;self._renderColorPickerView($colorListItem,{position:position,hexValue:hexValue});}, _updateColor:function(data){var self=this,position=data.position,hexValue=data.hex;self.colors[position]=hexValue;self.display.updateTempDisplay({colors:self.colors});self._setChartDisplayUpdates(self.colors);self.render();},_copyColor:function(color,$colorListItem){var self=this,newPosition=color.position+1,hexValue=color.hex;self.colors.splice(newPosition,0,hexValue);self.display.updateTempDisplay({colors:self.colors});self._setChartDisplayUpdates(self.colors);self.render();},_deleteColor:function(color,$colorListItem){var self=this;self.colors.splice(color.position,1);self.display.updateTempDisplay({colors:self.colors});self._setChartDisplayUpdates(self.colors);$colorListItem.fadeOut(250,function(){self.render();});},_sortColors:function(event,ui){var self=this,$sortedColorListItems,sortedColors;$sortedColorListItems=self.$el.find('.color-list-item');sortedColors=_.map($sortedColorListItems,function(colorListItem){return $(colorListItem).attr("data-hex");});self.colors=sortedColors;if(self._shouldUpdateTempDisplay()){self.display.updateTempDisplay({colors:self.colors});}
self._setChartDisplayUpdates(self.colors);self.render();},

_shouldUpdateTempDisplay:function(options){return true;},_setChartDisplayUpdates:function(colors){var self=this,update={colors:colors};self.display.setDisplayUpdates(update);}});SM.CustomizeColorPickerView=SM.Views.register({__NAME:"CustomizeColorPickerView",__templateID:"customize-color-picker-template",DEFAULT_HEX_VALUES:["#FFFFFF","#E9E9E9","#CCCCCC","#999999","#676767","#343434","#010101","#D0CFBD","#B6B8AA","#93938B","#807E71","#717167","#5A5947","#4D4B3E","#FFFCB9","#F8F580","#E8EC74","#D0D04C","#A7C23D","#86A23C","#4F7A28","#FECB3E","#F1B12B","#F29E2C","#DC7E36","#C75227","#C6332B","#FF3301","#D9EDEC","#8CC8C9","#33BDBF","#01A3A6","#01858A","#36606E","#003849","#A7C6FC","#74A6FF","#398AFF","#0063FF","#0142AA","#01317D","#002055","#E493FC","#D257FF","#9A2ABD","#7B209F","#61197D","#450F5A","#2E073E"], __create:function(options){var self=this;self.position=options.position;self.originalHexValue=options.originalHexValue;self.onColorSelected=options.onColorSelected;self.onSwatchClick=options.onSwatchClick;self.primaryBtnText=options.primaryBtnText||Globalize.localize("Save");_.bindAll(this,'_onSwatchClick','_onCustomHexValueChange','_onSaveBtnClick','_onCancelBtnClick');}, __beforeRender:function(md){var self=this,defaultColors;self.newHexValue=null;self.$selectedSwatch=null;defaultColors=self._colorsForTemplate();return{defaultColors:defaultColors,primaryBtnText:self.primaryBtnText};},__afterRender:function(){var self=this;self.$customHexSwatch=self.$el.find("[custom-hex-swatch]");},__init:function(){var self=this;self.$el.on("click","[color-swatch]",self._onSwatchClick);self.$el.on("click","[primary-btn]",self._onSaveBtnClick);self.$el.on("click","[cancel-btn]",self._onCancelBtnClick);self.$el.on("keyup","[custom-hex-value]",self._onCustomHexValueChange);},_colorsForTemplate:function(){var self=this;return _.map(self.DEFAULT_HEX_VALUES,function(hexValue,index){return{position:index,hex:hexValue};});},_animateOut:function(){var self=this;self.$el.fadeOut(250,function(){self.$el.remove();});}, _onSwatchClick:function(e){e.preventDefault();var self=this,$target=$(e.currentTarget);self.newHexValue=$target.attr("data-hex");if(self.$selectedSwatch){self.$selectedSwatch.removeClass("selected");}
self.$selectedSwatch=$target;self.$selectedSwatch.addClass("selected");self.onSwatchClick({position:self.position,hex:self.newHexValue});},_onCustomHexValueChange:function(e){var self=this,$target=$(e.target),hexValue=$target.val();if(self._validateHexValue(hexValue)){self.$customHexSwatch.css({backgroundColor:hexValue});}else{}},_validateHexValue:function(hexValue){return true;},_onSaveBtnClick:function(e){e.preventDefault();var self=this;self.onColorSelected({position:self.position,hex:self.newHexValue});self._animateOut();},_onCancelBtnClick:function(e){e.preventDefault();var self=this;
if(self.newHexValue&&self.originalHexValue){self.onColorSelected({position:self.position,hex:self.originalHexValue});}
self._animateOut();}});SM.CustomizeLabelsView=SM.Views.register({ __NAME:"CustomizeLabelsView",__templateID:"customize-labels-template", __create:function(options){var self=this;self.question=options.question;self.rollup=options.rollup;self.display=options.display
_.bindAll(this,"_onLabelInputClick","_onLabelInputKeyUp","_onLabelInputFocus","_onLabelInputBlur","_onRevertLinkClick");}, __beforeRender:function(){var self=this,isCompared=self.question.isCompared(),answersStructures=self.question.getContextStructure().answers,rows=answersStructures.rows,columns=answersStructures.cols,columnChoices,crossedOptions=answersStructures.crossedOptions,otherOptions=answersStructures.other,answerLabels=[],questionHeadingLabel,rowLabels,columnLabels,columnChoiceLabels,crossedOptionLabels,otherOptionLabels;questionHeadingLabel=self._buildQuestionHeadingLabelContext();answerLabels=answerLabels.concat(questionHeadingLabel);rowLabels=self._buildLabelsContext("rows",rows);answerLabels=answerLabels.concat(rowLabels);
if(!isCompared||(isCompared&&(crossedOptions!==columns))){columnLabels=self._buildLabelsContext("columns",columns);answerLabels=answerLabels.concat(columnLabels);}
otherOptionLabels=self._buildLabelsContext("others",otherOptions);answerLabels=answerLabels.concat(otherOptionLabels);if(isCompared){crossedOptionLabels=self._buildLabelsContext("crossedOptions",crossedOptions);answerLabels=answerLabels.concat(crossedOptionLabels);}else{if(columns&&columns[0].items){_.each(columns,function(column){columnChoices=column.items;columnChoiceLabels=self._buildLabelsContext("columnChoices",columnChoices);answerLabels=answerLabels.concat(columnChoiceLabels);});}}
_.each(answerLabels,function(answerLabel,i){answerLabel.tabIndex=i+1;});return{answerLabels:answerLabels};},_buildQuestionHeadingLabelContext:function(){var self=this,label=self.display.getQuestionHeadingLabel(),customText=(label&&label.text&&label.text.length)?label.text:null;return self._buildLabelContext("questionHeading",self.question.heading,customText,{});},_buildLabelsContext:function(answersType,answersArray){var self=this,labelContexts=[],label,labelContext,customText;_.each(answersArray,function(answerData){if(self._isCustomizableAnswerOption(answerData)){label=self.display.getLabel(answersType,answerData.id);if(label&&label.text){customText=label.text.length?label.text:null;}else{customText=null;}
labelContext=self._buildLabelContext(answersType,answerData.text,customText,{answerID:answerData.id});labelContexts.push(labelContext);}});return labelContexts;},_isCustomizableAnswerOption:function(answerData){var isCustomizable=true;
 if(answerData.type==="other"&&!answerData['is_answer']){isCustomizable=false;}
return isCustomizable;},_buildLabelContext:function(labelType,originalText,customText,options){var labelContext={};labelContext.labelType=labelType;labelContext.originalText=originalText;labelContext.customText=customText;labelContext.showRevertLink=(originalText!=customText&&!_.isEmpty(customText));if(options.answerID){labelContext.answerID=options.answerID;}
return labelContext;},__init:function(){var self=this;self.$el.on("click","[custom-label-input]",self._onLabelInputClick);self.$el.on("focus","[custom-label-input]",self._onLabelInputFocus);self.$el.on("blur","[custom-label-input]",self._onLabelInputBlur);self.$el.on("keyup","[custom-label-input]",self._onLabelInputKeyUp);self.$el.on("click","[revert-custom-label-link]",self._onRevertLinkClick);},
 _onLabelInputClick:function(e){var self=this,$target=$(e.currentTarget);$target.select();self._hideErrorMessaging($target);},_onLabelInputFocus:function(e){var self=this,$target=$(e.currentTarget),answerID=$target.attr("answer-id");self._highlightTableLabelCell(answerID);self._hideErrorMessaging($target);},_onLabelInputKeyUp:function(e){var self=this,$target=$(e.currentTarget),$revertLink=$target.parent().parent().find("[revert-custom-label-link]"),answerID=$target.attr("answer-id"),labelType=$target.attr("label-type"),labelText=$target.val(),originalText;originalText=self._getOriginalText(labelType,answerID);if(labelText!==originalText){$revertLink.removeClass("hidden");self._changeLabel({labelType:labelType,answerID:answerID,labelText:labelText});}else{$revertLink.addClass("hidden");}},_onLabelInputBlur:function(e){var self=this,$target=$(e.currentTarget),answerID=$target.attr("answer-id"),$errorMessage=$target.next("[custom-label-error-message]"),labelText=$target.val();if(labelText==""){$target.addClass("has-errors");$errorMessage.show();}else{self._unHighlightTableLabelCell(answerID);}},_onRevertLinkClick:function(e){var self=this,$revertLink=$(e.currentTarget),$labelInput=$revertLink.parent().find("[custom-label-input]"),answerID=$labelInput.attr("answer-id"),labelType=$labelInput.attr("label-type"),originalText;e.preventDefault();originalText=self._getOriginalText(labelType,answerID);$labelInput.val(originalText);$revertLink.addClass("hidden");self._hideErrorMessaging($labelInput);self._changeLabel({labelType:labelType,answerID:answerID,labelText:null});}, scrollToLabel:function(answerID){var self=this,$labelInput,scrollTop;
if(answerID){$labelInput=self.$el.find("[answer-id='"+answerID+"']");}else{$labelInput=self.$el.find("[label-type='questionHeading']");}
scrollTop=self.$el.scrollTop()+$labelInput.position().top;self.$el.animate({scrollTop:scrollTop},250,function(){$labelInput.click();});},_highlightTableLabelCell:function(answerID){var self=this,$table=self.$el.parents("[sm-question-view]").find("[summary-table-container] table").eq(0);$table.trigger({type:"highlightLabelCell",answerID:answerID});},_unHighlightTableLabelCell:function(answerID){var self=this,$table=self.$el.parents("[sm-question-view]").find("[summary-table-container] > table");$table.trigger({type:"unHighlightLabelCell",answerID:answerID});},_setHighlightedTableLabelCell:function(answerID){var self=this,$tableContainer=self.$el.parents("[sm-question-view]").find("[summary-table-container]");$tableContainer.trigger({type:"setHighlightedLabelCell",answerID:answerID});},
 
_changeLabel:function(options){var self=this,updates;self._setHighlightedTableLabelCell(options.answerID);updates=self.display.buildLabelUpdates(options);self.display.updateTempDisplay(updates);self.display.setDisplayUpdates(updates);},_getOriginalText:function(labelType,answerID){var self=this,answers=self.question.getContextStructure().answers,answer,text;if(labelType==="questionHeading"){text=self.question.heading;}else{if(labelType==="rows"){answer=_.find(answers.rows,function(row){return row.id==answerID;});text=answer.text;}else if(labelType==="columns"){answer=_.find(answers.cols,function(column){return column.id==answerID;});text=answer.text;}else if(labelType==="columnChoices"){_.each(answers.cols,function(column){_.each(column.items,function(columnChoice){if(columnChoice.id==answerID){answer=columnChoice;text=answer.text;return;}});});}else if(labelType==="crossedOptions"){answer=_.find(answers.crossedOptions,function(crossedOption){return crossedOption.id==answerID;});text=answer.text;}else if(labelType==="others"){answer=_.find(answers.other,function(otherOption){return otherOption.id==answerID;});text=answer.text;}}
return text;},_hideErrorMessaging:function($target){var $errorMessage=$target.next("[custom-label-error-message]");if($target.hasClass("has-errors")){$target.removeClass("has-errors");$errorMessage.hide();}}});SM.SummaryPageView=SM.Views.register({__NAME:"summaryPageView",__model:"page",__templateID:"summary-page-template",__beforeRender:function(options){return{id:this.page.ID};},__afterRender:function(md){var self=this,div,pageHeaderView=SM.Views.create(SM.SummaryPageHeaderView,{model:this.page}),allPagesSelected=this.page.survey.state.get("allPagesSelected"),questionListView;this.$el.prepend(pageHeaderView.el);if(this.page.shownQuestionList.length){questionListView=SM.Views.create(SM.SummaryQuestionListView,{model:this.page});this.$el.find(".page-header").after(questionListView.el);}else{
 div=document.createElement("div");div.innerHTML=SM.Template.render("no-page-questions");this.el.appendChild(div);}}});SM.SummaryPageHeaderView=SM.Views.register({__NAME:"SummaryPageHeaderView",__model:"page",__templateID:"summary-page-title-template",__init:function(){this.bindModel(this.page.survey,"rollupsAppended",{self:this},this._onRollupsAppended);},__beforeRender:function(){var page=this.page,questionRollups=page.survey.questionRollups,isAfterLastLoadedPage=questionRollups.isAfterLastLoadedPage(page);return{isVisible:!isAfterLastLoadedPage&&this.page.isShown(),title:this.page.heading,number:this.page.position};},_onRollupsAppended:function(e){var self=e.data.self;self.render();}});SM.SummaryPageListView=SM.Views.register({__NAME:"pageListView",__model:"survey",__templateID:"summary-page-list-template",__create:function(){this.set("lazyLoaderID",this.__NAME+"loader"+this.__uid);},__init:function(){var survey=this.survey,allPagesSelected=survey.state.get("allPagesSelected"),questionRollups=survey.questionRollups;this.$el.on(SM.Event.CLICK,"[try-again-btn]",{self:this},this._onTryAgainClicked).on("infiniteScroll.reachedEnd",{self:this},this._onReachedEnd);this.bindModel(survey,"rollupsAppended",{self:this},this._onRollupsAppended);this.bindModel(survey.state,"page.changed",{self:this},this._onPageChange);this.bindModel(survey,"shownListsChanged",{self:this},this._onPageChange);this.infiniteScroll=this.$el.infiniteScroll({windowScroll:true,threshold:1000,markerID:this.get("lazyLoaderID"),isActive:!questionRollups.hasAll()&&questionRollups.isBuffered()}).data("infiniteScroll");},__beforeRender:function(){return{hasAllRollups:this.survey.questionRollups.hasAll()};},__afterRender:function(md){var listContent,pageModel,html,div,lazyLoadView,survey=this.survey,questionRollups=survey.questionRollups,hasShownQuestions=survey.shownQuestionList.length>0,pageIndex=survey.state.get("page"),allPagesSelected=survey.state.get("allPagesSelected");if(!hasShownQuestions){
 listContent=SM.Template.renderHTML("no-shown-page-questions");}else if(!allPagesSelected){pageModel=survey.pageList[pageIndex];listContent=this._renderPage(pageModel);}else{listContent=this._renderAllPages(survey.shownPageList);}
if(!questionRollups.hasAll()){lazyLoadView=SM.Views.create(SM.SummaryLazyLoadView,{model:this.survey,ID:this.get("lazyLoaderID")});this.el.appendChild(lazyLoadView.el);if(this.infiniteScroll&&questionRollups.isBuffered()){this.infiniteScroll.set("isActive",true);}}},_renderPage:function(pageModel){var pageView=SM.Views.create(SM.SummaryPageView,{model:pageModel});this.$el.prepend(pageView.el);},_renderAllPages:function(pageList){var pageView,frag=document.createDocumentFragment();$.each(pageList,function(i,pageModel){if(!pageModel.shownQuestionList.length){return true;}
pageView=SM.Views.create(SM.SummaryPageView,{model:pageModel});frag.appendChild(pageView.el);});this.$el.prepend(frag);},_onPageChange:function(e){var self=e.data.self;if(self.survey.questionRollups.isBuffered()){self.infiniteScroll.set("isActive",true);}else{self.infiniteScroll.set("isActive",false);self.survey.questionRollups.fetchMoreRollups();}
self.render();},_onTryAgainClicked:function(e){var self=e.data.self;self.infiniteScroll.set("isActive",false);self.survey.questionRollups.fetchMoreRollups();},_onReachedEnd:function(e){var self=e.data.self;self.survey.questionRollups.fetchMoreRollups();},_onRollupsAppended:function(e){var self=e.data.self;if(!self.survey.questionRollups.hasAll()){self.infiniteScroll.set("isActive",true);}else{self.infiniteScroll.removeMarker();self.infiniteScroll.set("isActive",false);}}});SM.SummaryLazyLoadView=SM.Views.register({__NAME:"lazyLoadView",__model:"survey",__templateID:"lazy-load-template",__defaults:{lastFetchFailed:false},__init:function(){this.$el.on(SM.Event.CLICK,"[try-again-btn]",{self:this},this._onTryAgainClicked);this.bindModel(this.survey,"fetchRollupsFailed",{self:this},this._onFetchFail);},__beforeRender:function(){return{id:this.get("ID"),lastFetchFailed:this.__settings.lastFetchFailed};},_onFetchFail:function(e){var self=e.data.self;self.__settings.lastFetchFailed=true;self.render();},_onTryAgainClicked:function(e){var self=e.data.self;e.preventDefault();self.__settings.lastFetchFailed=false;self.$el.trigger("tryFetchMore");self.render();}});SM.SummaryPresentationContainerView=SM.Views.register({__NAME:"summaryPresentationContainerView",__templateID:"summary-presentation-question-template",randomAssignmentOption:null,__create:function(options){var self=this;self.question=options.question;},__beforeRender:function(options){var self=this,randomAssignmentOption=self.__settings.randomAssignmentOption,imagePresentation=this.question.subtype===this.question.QTYPE.image,textPresentation=this.question.subtype===this.question.QTYPE.descriptive_text,imageObject,text,imageSource,imageSourceLink;if(imagePresentation){if(!!randomAssignmentOption){imageObject=randomAssignmentOption.image;imageSource=imageObject.source;}else{imageObject=this.image;imageSource=imageObject.source;}
if(imageObject.type==="upload"){imageSourceLink=this.question.page.survey.resourcePath+'/'+imageSource;}else{imageSourceLink=imageSource;}}else{if(!!randomAssignmentOption){text=randomAssignmentOption.heading;}else{text=this.heading;}}
return{imagePresentation:imagePresentation,textPresentation:textPresentation,imageObject:imageObject,text:text,surveyID:this.question.page.survey.ID,imageSourceLink:imageSourceLink};}});